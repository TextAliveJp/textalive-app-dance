!function(){function t(t,e,r,n){Object.defineProperty(t,e,{get:r,set:n,enumerable:!0,configurable:!0})}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function r(t){return t&&t.__esModule?t.default:t}var n={},i={},o=e.parcelRequire6931;null==o&&((o=function(t){if(t in n)return n[t].exports;if(t in i){let e=i[t];delete i[t];let r={id:t,exports:{}};return n[t]=r,e.call(r.exports,r,r.exports),r.exports}var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}).register=function(t,e){i[t]=e},e.parcelRequire6931=o),o.register("1oNCw",(function(e,r){var n,i;t(e.exports,"resolve",(()=>i),(t=>i=t)),t(e.exports,"register",(()=>n),(t=>n=t));var o={};n=function(t){for(var e=Object.keys(t),r=0;r<e.length;r++)o[e[r]]=t[e[r]]},i=function(t){var e=o[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),o("1oNCw").register(JSON.parse('{"52rwg":"index.ffb4354c.js","1kyaB":"main.876becd3.js","MzzjL":"webfontloader.ae846422.js"}')),o.register("g71hk",(function(e,r){t(e.exports,"Light",(()=>dh)),t(e.exports,"InterpolateLinear",(()=>Ve)),t(e.exports,"MirroredRepeatWrapping",(()=>gt)),t(e.exports,"REVISION",(()=>n)),t(e.exports,"RGBEEncoding",(()=>rr)),t(e.exports,"UnsignedShort5551Type",(()=>Dt)),t(e.exports,"SRGB8_ALPHA8_ASTC_8x5_Format",(()=>Oe)),t(e.exports,"BoundingBoxHelper",(()=>pf)),t(e.exports,"SubtractEquation",(()=>C)),t(e.exports,"AddOperation",(()=>$)),t(e.exports,"RepeatWrapping",(()=>ft)),t(e.exports,"QuaternionKeyframeTrack",(()=>Au)),t(e.exports,"UnsignedShort565Type",(()=>kt)),t(e.exports,"ReinhardToneMapping",(()=>rt)),t(e.exports,"CanvasRenderer",(()=>_f)),t(e.exports,"SrcAlphaSaturateFactor",(()=>z)),t(e.exports,"SrcColorFactor",(()=>N)),t(e.exports,"WebGLCubeRenderTarget",(()=>Ao)),t(e.exports,"MathUtils",(()=>jr)),t(e.exports,"SrcAlphaFactor",(()=>D)),t(e.exports,"Matrix3",(()=>zr)),t(e.exports,"CubeUVReflectionMapping",(()=>pt)),t(e.exports,"PolarGridHelper",(()=>Kp)),t(e.exports,"RedFormat",(()=>Yt)),t(e.exports,"CubeCamera",(()=>To)),t(e.exports,"ParametricBufferGeometry",(()=>ql)),t(e.exports,"DynamicBufferAttribute",(()=>Kd)),t(e.exports,"RGBA_ASTC_5x5_Format",(()=>pe)),t(e.exports,"CubeUVRefractionMapping",(()=>dt)),t(e.exports,"RGB_S3TC_DXT1_Format",(()=>$t)),t(e.exports,"EdgesGeometry",(()=>Qc)),t(e.exports,"Spherical",(()=>Op)),t(e.exports,"EquirectangularReflectionMapping",(()=>ct)),t(e.exports,"NearestMipmapNearestFilter",(()=>yt)),t(e.exports,"SplineCurve",(()=>lh)),t(e.exports,"GreaterEqualStencilFunc",(()=>Sr)),t(e.exports,"LuminanceFormat",(()=>zt)),t(e.exports,"SRGB8_ALPHA8_ASTC_8x8_Format",(()=>Le)),t(e.exports,"TorusBufferGeometry",(()=>lc)),t(e.exports,"SRGB8_ALPHA8_ASTC_12x12_Format",(()=>Ue)),t(e.exports,"XHRLoader",(()=>mf)),t(e.exports,"BackSide",(()=>v)),t(e.exports,"NoToneMapping",(()=>tt)),t(e.exports,"LensFlare",(()=>wf)),t(e.exports,"QuadraticBezierCurve",(()=>ah)),t(e.exports,"SRGB8_ALPHA8_ASTC_10x6_Format",(()=>Ne)),t(e.exports,"ArrowHelper",(()=>dd)),t(e.exports,"CatmullRomCurve3",(()=>Qu)),t(e.exports,"ClampToEdgeWrapping",(()=>mt)),t(e.exports,"TrianglesDrawMode",(()=>Ze)),t(e.exports,"StreamCopyUsage",(()=>Br)),t(e.exports,"SplineCurve3",(()=>cf)),t(e.exports,"Uniform",(()=>Sp)),t(e.exports,"Plane",(()=>ei)),t(e.exports,"Group",(()=>Ls)),t(e.exports,"Object3D",(()=>Sn)),t(e.exports,"Uint32BufferAttribute",(()=>Li)),t(e.exports,"ZeroSlopeEnding",(()=>qe)),t(e.exports,"TetrahedronGeometry",(()=>Jl)),t(e.exports,"QuaternionLinearInterpolant",(()=>Tu)),t(e.exports,"TextBufferGeometry",(()=>zc)),t(e.exports,"Font",(()=>jh)),t(e.exports,"MeshNormalMaterial",(()=>pu)),t(e.exports,"ReplaceStencilOp",(()=>dr)),t(e.exports,"Int16Attribute",(()=>ef)),t(e.exports,"OctahedronBufferGeometry",(()=>Ql)),t(e.exports,"LineStrip",(()=>kd)),t(e.exports,"DynamicCopyUsage",(()=>Nr)),t(e.exports,"ShaderChunk",(()=>ko)),t(e.exports,"Math",(()=>jr)),t(e.exports,"NeverStencilFunc",(()=>_r)),t(e.exports,"LineLoop",(()=>Ll)),t(e.exports,"TorusKnotBufferGeometry",(()=>ac)),t(e.exports,"StringKeyframeTrack",(()=>Cu)),t(e.exports,"Box3Helper",(()=>ld)),t(e.exports,"SRGB8_ALPHA8_ASTC_8x6_Format",(()=>Re)),t(e.exports,"SRGB8_ALPHA8_ASTC_10x8_Format",(()=>Be)),t(e.exports,"BufferAttribute",(()=>Si)),t(e.exports,"Float32Attribute",(()=>af)),t(e.exports,"WrapAroundEnding",(()=>Ye)),t(e.exports,"KeepStencilOp",(()=>pr)),t(e.exports,"Color",(()=>gi)),t(e.exports,"AudioLoader",(()=>Hh)),t(e.exports,"BufferGeometryLoader",(()=>Rh)),t(e.exports,"MixOperation",(()=>Q)),t(e.exports,"Face3",(()=>bi)),t(e.exports,"DoubleSide",(()=>y)),t(e.exports,"ZeroFactor",(()=>L)),t(e.exports,"LessEqualDepth",(()=>q)),t(e.exports,"ZeroCurvatureEnding",(()=>We)),t(e.exports,"ShaderMaterial",(()=>wo)),t(e.exports,"InstancedMesh",(()=>xl)),t(e.exports,"AxisHelper",(()=>hf)),t(e.exports,"HalfFloatType",(()=>Nt)),t(e.exports,"MeshDistanceMaterial",(()=>Ts)),t(e.exports,"TetrahedronBufferGeometry",(()=>Zl)),t(e.exports,"AlwaysDepth",(()=>H)),t(e.exports,"Frustum",(()=>Ro)),t(e.exports,"MeshBasicMaterial",(()=>Ei)),t(e.exports,"StaticCopyUsage",(()=>Ir)),t(e.exports,"Uncharted2ToneMapping",(()=>nt)),t(e.exports,"SceneUtils",(()=>xf)),t(e.exports,"UnsignedInt248Type",(()=>Ut)),t(e.exports,"RGBADepthPacking",(()=>lr)),t(e.exports,"RGB_ETC1_Format",(()=>se)),t(e.exports,"LOD",(()=>hl)),t(e.exports,"MaterialLoader",(()=>Ah)),t(e.exports,"DecrementStencilOp",(()=>mr)),t(e.exports,"SmoothShading",(()=>b)),t(e.exports,"UnsignedShortType",(()=>Ot)),t(e.exports,"FrontFaceDirectionCW",(()=>u)),t(e.exports,"TorusGeometry",(()=>sc)),t(e.exports,"DstAlphaFactor",(()=>U)),t(e.exports,"RGBA_ASTC_10x5_Format",(()=>ye)),t(e.exports,"LinearFilter",(()=>wt)),t(e.exports,"IntType",(()=>Rt)),t(e.exports,"SRGB8_ALPHA8_ASTC_6x5_Format",(()=>Ce)),t(e.exports,"IcosahedronGeometry",(()=>$l)),t(e.exports,"LinePieces",(()=>Ud)),t(e.exports,"Matrix4",(()=>sn)),t(e.exports,"HemisphereLightHelper",(()=>Jp)),t(e.exports,"MeshPhysicalMaterial",(()=>cu)),t(e.exports,"Euler",(()=>un)),t(e.exports,"MeshStandardMaterial",(()=>lu)),t(e.exports,"DirectionalLight",(()=>wh)),t(e.exports,"Loader",(()=>Bu)),t(e.exports,"Int32Attribute",(()=>nf)),t(e.exports,"RGBA_ASTC_8x8_Format",(()=>ve)),t(e.exports,"TOUCH",(()=>o)),t(e.exports,"PMREMGenerator",(()=>Cd)),t(e.exports,"ParticleSystem",(()=>qd)),t(e.exports,"AlphaFormat",(()=>Ft)),t(e.exports,"Raycaster",(()=>Ap)),t(e.exports,"PolyhedronGeometry",(()=>Yl)),t(e.exports,"RGBA_ASTC_10x10_Format",(()=>xe)),t(e.exports,"LessDepth",(()=>W)),t(e.exports,"DynamicReadUsage",(()=>Rr)),t(e.exports,"RGBA_PVRTC_2BPPV1_Format",(()=>ae)),t(e.exports,"BoxBufferGeometry",(()=>yo)),t(e.exports,"IncrementStencilOp",(()=>fr)),t(e.exports,"FloatType",(()=>It)),t(e.exports,"OneMinusSrcColorFactor",(()=>B)),t(e.exports,"AudioContext",(()=>Vh)),t(e.exports,"MeshDepthMaterial",(()=>Ss)),t(e.exports,"TextGeometry",(()=>Gc)),t(e.exports,"DepthTexture",(()=>Vl)),t(e.exports,"RGBAIntegerFormat",(()=>Qt)),t(e.exports,"ConeBufferGeometry",(()=>ru)),t(e.exports,"VertexColors",(()=>Gd)),t(e.exports,"PointsMaterial",(()=>Il)),t(e.exports,"DataTexture",(()=>Co)),t(e.exports,"CurvePath",(()=>uh)),t(e.exports,"RedIntegerFormat",(()=>Xt)),t(e.exports,"StereoCamera",(()=>Jh)),t(e.exports,"Mesh",(()=>lo)),t(e.exports,"Int16BufferAttribute",(()=>Pi)),t(e.exports,"RGBA_ASTC_8x5_Format",(()=>me)),t(e.exports,"WebGLMultisampleRenderTarget",(()=>Xr)),t(e.exports,"Float32BufferAttribute",(()=>Ii)),t(e.exports,"InterpolateSmooth",(()=>He)),t(e.exports,"Uint8BufferAttribute",(()=>Ai)),t(e.exports,"Uint8ClampedAttribute",(()=>tf)),t(e.exports,"Box3",(()=>jn)),t(e.exports,"WireframeHelper",(()=>ff)),t(e.exports,"Cylindrical",(()=>Rp)),t(e.exports,"PointLightHelper",(()=>Wp)),t(e.exports,"SphereGeometry",(()=>Vc)),t(e.exports,"Camera",(()=>Eo)),t(e.exports,"MultiMaterial",(()=>Vd)),t(e.exports,"NearestMipMapLinearFilter",(()=>xt)),t(e.exports,"GeometryUtils",(()=>yf)),t(e.exports,"HemisphereLight",(()=>fh)),t(e.exports,"OctahedronGeometry",(()=>Kl)),t(e.exports,"RectAreaLight",(()=>Mh)),t(e.exports,"RGBM16Encoding",(()=>or)),t(e.exports,"NormalAnimationBlendMode",(()=>Xe)),t(e.exports,"LatheBufferGeometry",(()=>Xc)),t(e.exports,"Int8BufferAttribute",(()=>Ti)),t(e.exports,"Particle",(()=>Wd)),t(e.exports,"ParticleSystemMaterial",(()=>Jd)),t(e.exports,"LoopRepeat",(()=>je)),t(e.exports,"AlwaysStencilFunc",(()=>Tr)),t(e.exports,"RGBIntegerFormat",(()=>Kt)),t(e.exports,"SubtractiveBlending",(()=>M)),t(e.exports,"MultiplyBlending",(()=>S)),t(e.exports,"TextureLoader",(()=>Vu)),t(e.exports,"UnsignedByteType",(()=>At)),t(e.exports,"RGBA_ASTC_10x6_Format",(()=>_e)),t(e.exports,"ImageLoader",(()=>Gu)),t(e.exports,"PCFSoftShadowMap",(()=>f)),t(e.exports,"ImageUtils",(()=>Vr)),t(e.exports,"Int8Attribute",(()=>Qd)),t(e.exports,"RGBA_ASTC_5x4_Format",(()=>he)),t(e.exports,"PolyhedronBufferGeometry",(()=>Xl)),t(e.exports,"EdgesHelper",(()=>df)),t(e.exports,"LoopOnce",(()=>Fe)),t(e.exports,"TriangleFanDrawMode",(()=>Qe)),t(e.exports,"InstancedBufferAttribute",(()=>Oh)),t(e.exports,"BufferGeometry",(()=>Hi)),t(e.exports,"TubeGeometry",(()=>nc)),t(e.exports,"ArcCurve",(()=>qu)),t(e.exports,"DynamicDrawUsage",(()=>Cr)),t(e.exports,"NearestMipmapLinearFilter",(()=>bt)),t(e.exports,"RGBA_ETC2_EAC_Format",(()=>ce)),t(e.exports,"BasicDepthPacking",(()=>sr)),t(e.exports,"StaticReadUsage",(()=>Or)),t(e.exports,"UVMapping",(()=>at)),t(e.exports,"InstancedInterleavedBuffer",(()=>Tp)),t(e.exports,"BooleanKeyframeTrack",(()=>Eu)),t(e.exports,"Triangle",(()=>pi)),t(e.exports,"ExtrudeBufferGeometry",(()=>Uc)),t(e.exports,"DataTexture2DArray",(()=>Ko)),t(e.exports,"LinearMipmapNearestFilter",(()=>Et)),t(e.exports,"DefaultLoadingManager",(()=>Nu)),t(e.exports,"JSONLoader",(()=>bf)),t(e.exports,"SphericalReflectionMapping",(()=>ht)),t(e.exports,"Curve",(()=>Hu)),t(e.exports,"Line3",(()=>Dp)),t(e.exports,"LineBasicMaterial",(()=>wl)),t(e.exports,"RGBM7Encoding",(()=>ir)),t(e.exports,"EquirectangularRefractionMapping",(()=>ut)),t(e.exports,"TorusKnotGeometry",(()=>oc)),t(e.exports,"CubeTextureLoader",(()=>zu)),t(e.exports,"Vertex",(()=>Zd)),t(e.exports,"CullFaceBack",(()=>s)),t(e.exports,"LineSegments",(()=>Rl)),t(e.exports,"ShapeGeometry",(()=>Jc)),t(e.exports,"EllipseCurve",(()=>Wu)),t(e.exports,"PropertyMixer",(()=>cp)),t(e.exports,"NotEqualDepth",(()=>Z)),t(e.exports,"CineonToneMapping",(()=>it)),t(e.exports,"LatheGeometry",(()=>Yc)),t(e.exports,"RGBA_ASTC_6x6_Format",(()=>fe)),t(e.exports,"CustomBlending",(()=>T)),t(e.exports,"EventDispatcher",(()=>Dr)),t(e.exports,"Vector4",(()=>qr)),t(e.exports,"RGIntegerFormat",(()=>Zt)),t(e.exports,"CubicBezierCurve3",(()=>nh)),t(e.exports,"DepthFormat",(()=>Wt)),t(e.exports,"Geometry",(()=>go)),t(e.exports,"WebGLRenderTarget",(()=>Yr)),t(e.exports,"DataTextureLoader",(()=>ju)),t(e.exports,"SkeletonHelper",(()=>Hp)),t(e.exports,"RingBufferGeometry",(()=>qc)),t(e.exports,"ObjectSpaceNormalMap",(()=>ur)),t(e.exports,"MeshPhongMaterial",(()=>uu)),t(e.exports,"KeyframeTrack",(()=>wu)),t(e.exports,"LoaderUtils",(()=>Ch)),t(e.exports,"SRGB8_ALPHA8_ASTC_10x10_Format",(()=>De)),t(e.exports,"SphereBufferGeometry",(()=>Hc)),t(e.exports,"ClosedSplineCurve3",(()=>lf)),t(e.exports,"PerspectiveCamera",(()=>Mo)),t(e.exports,"GreaterDepth",(()=>J)),t(e.exports,"GreaterStencilFunc",(()=>Er)),t(e.exports,"InstancedBufferGeometry",(()=>Ph)),t(e.exports,"Points",(()=>Ul)),t(e.exports,"AnimationUtils",(()=>vu)),t(e.exports,"AxesHelper",(()=>fd)),t(e.exports,"Texture",(()=>Wr)),t(e.exports,"FileLoader",(()=>ku)),t(e.exports,"NeverDepth",(()=>V)),t(e.exports,"NoBlending",(()=>x)),t(e.exports,"MaxEquation",(()=>R)),t(e.exports,"ShapeUtils",(()=>Nc)),t(e.exports,"ExtrudeGeometry",(()=>kc)),t(e.exports,"SpotLight",(()=>vh)),t(e.exports,"MeshToonMaterial",(()=>hu)),t(e.exports,"FontLoader",(()=>zh)),t(e.exports,"AudioListener",(()=>ep)),t(e.exports,"StaticDrawUsage",(()=>Ar)),t(e.exports,"CompressedTextureLoader",(()=>Fu)),t(e.exports,"RGBDEncoding",(()=>ar)),t(e.exports,"OneFactor",(()=>I)),t(e.exports,"LineCurve",(()=>ih)),t(e.exports,"RGBA_ASTC_6x5_Format",(()=>de)),t(e.exports,"ImageBitmapLoader",(()=>Uh)),t(e.exports,"PropertyBinding",(()=>xp)),t(e.exports,"LineCurve3",(()=>oh)),t(e.exports,"LessEqualStencilFunc",(()=>wr)),t(e.exports,"CullFaceFrontBack",(()=>c)),t(e.exports,"CanvasTexture",(()=>zl)),t(e.exports,"GreaterEqualDepth",(()=>X)),t(e.exports,"ConeGeometry",(()=>eu)),t(e.exports,"LessStencilFunc",(()=>br)),t(e.exports,"NormalBlending",(()=>w)),t(e.exports,"ReverseSubtractEquation",(()=>P)),t(e.exports,"CameraHelper",(()=>id)),t(e.exports,"SpriteMaterial",(()=>Vs)),t(e.exports,"PointCloud",(()=>Hd)),t(e.exports,"MinEquation",(()=>O)),t(e.exports,"AdditiveBlending",(()=>E)),t(e.exports,"OneMinusDstColorFactor",(()=>G)),t(e.exports,"RGBA_ASTC_8x6_Format",(()=>ge)),t(e.exports,"sRGBEncoding",(()=>tr)),t(e.exports,"CompressedTexture",(()=>Gl)),t(e.exports,"LineDashedMaterial",(()=>mu)),t(e.exports,"Interpolant",(()=>yu)),t(e.exports,"DirectionalLightHelper",(()=>ed)),t(e.exports,"MeshMatcapMaterial",(()=>fu)),t(e.exports,"SkinnedMesh",(()=>pl)),t(e.exports,"ColorKeyframeTrack",(()=>Mu)),t(e.exports,"SRGB8_ALPHA8_ASTC_10x5_Format",(()=>Ie)),t(e.exports,"LinearEncoding",(()=>$e)),t(e.exports,"CubeTexture",(()=>Zo)),t(e.exports,"LuminanceAlphaFormat",(()=>Vt)),t(e.exports,"DiscreteInterpolant",(()=>xu)),t(e.exports,"Fog",(()=>Us)),t(e.exports,"RGBA_ASTC_10x8_Format",(()=>be)),t(e.exports,"MultiplyOperation",(()=>K)),t(e.exports,"TriangleStripDrawMode",(()=>Ke)),t(e.exports,"BoxGeometry",(()=>vo)),t(e.exports,"CircleBufferGeometry",(()=>iu)),t(e.exports,"Sphere",(()=>Vn)),t(e.exports,"Uint8Attribute",(()=>$d)),t(e.exports,"LightShadow",(()=>mh)),t(e.exports,"Uint32Attribute",(()=>of)),t(e.exports,"OneMinusSrcAlphaFactor",(()=>k)),t(e.exports,"CubeRefractionMapping",(()=>lt)),t(e.exports,"SRGB8_ALPHA8_ASTC_4x4_Format",(()=>Se)),t(e.exports,"TangentSpaceNormalMap",(()=>cr)),t(e.exports,"PointCloudMaterial",(()=>Yd)),t(e.exports,"SpotLightShadow",(()=>gh)),t(e.exports,"LinearInterpolant",(()=>bu)),t(e.exports,"DirectionalLightShadow",(()=>xh)),t(e.exports,"DodecahedronGeometry",(()=>ec)),t(e.exports,"NotEqualStencilFunc",(()=>Mr)),t(e.exports,"ByteType",(()=>Ct)),t(e.exports,"ArrayCamera",(()=>Rs)),t(e.exports,"Float64BufferAttribute",(()=>Ni)),t(e.exports,"RGB_PVRTC_4BPPV1_Format",(()=>ne)),t(e.exports,"RingGeometry",(()=>Wc)),t(e.exports,"AnimationMixer",(()=>Mp)),t(e.exports,"SphericalHarmonics3",(()=>Sh)),t(e.exports,"Clock",(()=>Zh)),t(e.exports,"Float64Attribute",(()=>sf)),t(e.exports,"Vector2",(()=>Gr)),t(e.exports,"RGBA_S3TC_DXT5_Format",(()=>re)),t(e.exports,"LoopPingPong",(()=>Ge)),t(e.exports,"ShapeBufferGeometry",(()=>Zc)),t(e.exports,"PlaneHelper",(()=>cd)),t(e.exports,"LinearToneMapping",(()=>et)),t(e.exports,"PointLight",(()=>_h)),t(e.exports,"ACESFilmicToneMapping",(()=>ot)),t(e.exports,"OneMinusDstAlphaFactor",(()=>F)),t(e.exports,"BoxHelper",(()=>sd)),t(e.exports,"BasicShadowMap",(()=>p)),t(e.exports,"RGB_ETC2_Format",(()=>le)),t(e.exports,"RGBA_BPTC_Format",(()=>Me)),t(e.exports,"CylinderBufferGeometry",(()=>tu)),t(e.exports,"ShortType",(()=>Pt)),t(e.exports,"Vector3",(()=>Qr)),t(e.exports,"PlaneBufferGeometry",(()=>Do)),t(e.exports,"MOUSE",(()=>i)),t(e.exports,"NearestMipMapNearestFilter",(()=>_t)),t(e.exports,"WireframeGeometry",(()=>Hl)),t(e.exports,"DataTexture3D",(()=>Qo)),t(e.exports,"InvertStencilOp",(()=>yr)),t(e.exports,"VectorKeyframeTrack",(()=>Pu)),t(e.exports,"HemisphereLightProbe",(()=>Wh)),t(e.exports,"RGBFormat",(()=>jt)),t(e.exports,"AnimationObjectGroup",(()=>wp)),t(e.exports,"CubeReflectionMapping",(()=>st)),t(e.exports,"CubicInterpolant",(()=>_u)),t(e.exports,"Line",(()=>Cl)),t(e.exports,"Uint16Attribute",(()=>rf)),t(e.exports,"LinearMipMapNearestFilter",(()=>Mt)),t(e.exports,"RGFormat",(()=>Jt)),t(e.exports,"Path",(()=>hh)),t(e.exports,"CylinderGeometry",(()=>$c)),t(e.exports,"RGBA_ASTC_12x12_Format",(()=>Ee)),t(e.exports,"MeshLambertMaterial",(()=>du)),t(e.exports,"FaceColors",(()=>jd)),t(e.exports,"CullFaceFront",(()=>l)),t(e.exports,"RGBA_ASTC_12x10_Format",(()=>we)),t(e.exports,"Layers",(()=>hn)),t(e.exports,"ZeroStencilOp",(()=>hr)),t(e.exports,"ObjectLoader",(()=>Ih)),t(e.exports,"ParametricGeometry",(()=>Wl)),t(e.exports,"MeshFaceMaterial",(()=>zd)),t(e.exports,"CubicBezierCurve",(()=>rh)),t(e.exports,"SRGB8_ALPHA8_ASTC_5x4_Format",(()=>Te)),t(e.exports,"SpotLightHelper",(()=>Fp)),t(e.exports,"DstColorFactor",(()=>j)),t(e.exports,"Quaternion",(()=>Jr)),t(e.exports,"Spline",(()=>uf)),t(e.exports,"PlaneGeometry",(()=>Bo)),t(e.exports,"LinearMipmapLinearFilter",(()=>St)),t(e.exports,"RGBEFormat",(()=>Ht)),t(e.exports,"Material",(()=>wi)),t(e.exports,"AddEquation",(()=>A)),t(e.exports,"AnimationLoader",(()=>Uu)),t(e.exports,"GridHelper",(()=>Zp)),t(e.exports,"WebGLRenderer",(()=>Ds)),t(e.exports,"UnsignedShort4444Type",(()=>Bt)),t(e.exports,"LogLuvEncoding",(()=>nr)),t(e.exports,"IncrementWrapStencilOp",(()=>gr)),t(e.exports,"FlatShading",(()=>_)),t(e.exports,"RGBA_PVRTC_4BPPV1_Format",(()=>oe)),t(e.exports,"Bone",(()=>gl)),t(e.exports,"SRGB8_ALPHA8_ASTC_6x6_Format",(()=>Pe)),t(e.exports,"AmbientLightProbe",(()=>qh)),t(e.exports,"VSMShadowMap",(()=>m)),t(e.exports,"NearestFilter",(()=>vt)),t(e.exports,"QuadraticBezierCurve3",(()=>sh)),t(e.exports,"RawShaderMaterial",(()=>su)),t(e.exports,"CullFaceNone",(()=>a)),t(e.exports,"RGBA_S3TC_DXT1_Format",(()=>te)),t(e.exports,"AdditiveAnimationBlendMode",(()=>Je)),t(e.exports,"LoadingManager",(()=>Iu)),t(e.exports,"AudioAnalyser",(()=>lp)),t(e.exports,"BinaryTextureLoader",(()=>gf)),t(e.exports,"InterpolateDiscrete",(()=>ze)),t(e.exports,"ShadowMaterial",(()=>au)),t(e.exports,"EqualStencilFunc",(()=>xr)),t(e.exports,"ShaderLib",(()=>Uo)),t(e.exports,"StreamDrawUsage",(()=>Pr)),t(e.exports,"AmbientLight",(()=>Eh)),t(e.exports,"Scene",(()=>Tn)),t(e.exports,"ImmediateRenderObject",(()=>kp)),t(e.exports,"CubeGeometry",(()=>vo)),t(e.exports,"IcosahedronBufferGeometry",(()=>tc)),t(e.exports,"FogExp2",(()=>ks)),t(e.exports,"Shape",(()=>ph)),t(e.exports,"GammaEncoding",(()=>er)),t(e.exports,"PositionalAudio",(()=>sp)),t(e.exports,"Box2",(()=>Ip)),t(e.exports,"FrontSide",(()=>g)),t(e.exports,"NoColors",(()=>Fd)),t(e.exports,"EqualDepth",(()=>Y)),t(e.exports,"WebGLUtils",(()=>Os)),t(e.exports,"RGB_PVRTC_2BPPV1_Format",(()=>ie)),t(e.exports,"RGBA_ASTC_4x4_Format",(()=>ue)),t(e.exports,"OrthographicCamera",(()=>bh)),t(e.exports,"Sprite",(()=>rl)),t(e.exports,"AnimationClip",(()=>Ou)),t(e.exports,"Skeleton",(()=>ml)),t(e.exports,"LinearMipMapLinearFilter",(()=>Tt)),t(e.exports,"CircleGeometry",(()=>nu)),t(e.exports,"FrontFaceDirectionCCW",(()=>h)),t(e.exports,"WebGLRenderTargetCube",(()=>vf)),t(e.exports,"ParticleBasicMaterial",(()=>Xd)),t(e.exports,"NumberKeyframeTrack",(()=>Su)),t(e.exports,"Face4",(()=>Dd)),t(e.exports,"Uint8ClampedBufferAttribute",(()=>Ci)),t(e.exports,"Ray",(()=>Kn)),t(e.exports,"InterleavedBuffer",(()=>Fs)),t(e.exports,"InterleavedBufferAttribute",(()=>zs)),t(e.exports,"Int32BufferAttribute",(()=>Ri)),t(e.exports,"SRGB8_ALPHA8_ASTC_12x10_Format",(()=>ke)),t(e.exports,"RGBAFormat",(()=>Gt)),t(e.exports,"DepthStencilFormat",(()=>qt)),t(e.exports,"SRGB8_ALPHA8_ASTC_5x5_Format",(()=>Ae)),t(e.exports,"UniformsLib",(()=>Lo)),t(e.exports,"DodecahedronBufferGeometry",(()=>rc)),t(e.exports,"StreamReadUsage",(()=>Lr)),t(e.exports,"LightProbe",(()=>Th)),t(e.exports,"Uint16BufferAttribute",(()=>Oi)),t(e.exports,"Audio",(()=>rp)),t(e.exports,"UniformsUtils",(()=>xo)),t(e.exports,"TubeBufferGeometry",(()=>ic)),t(e.exports,"UnsignedIntType",(()=>Lt)),t(e.exports,"ShapePath",(()=>Fh)),t(e.exports,"PCFShadowMap",(()=>d)),t(e.exports,"DecrementWrapStencilOp",(()=>vr)),t(e.exports,"RGBA_S3TC_DXT3_Format",(()=>ee)),t(e.exports,"VideoTexture",(()=>jl)),t(e.exports,"Cache",(()=>Lu)),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");const e=Object(t);for(let t=1;t<arguments.length;t++){const r=arguments[t];if(null!=r)for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e});const n="117",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},o={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},a=0,s=1,l=2,c=3,u=0,h=1,p=0,d=1,f=2,m=3,g=0,v=1,y=2,_=1,b=2,x=0,w=1,E=2,M=3,S=4,T=5,A=100,C=101,P=102,O=103,R=104,L=200,I=201,N=202,B=203,D=204,k=205,U=206,F=207,j=208,G=209,z=210,V=0,H=1,W=2,q=3,Y=4,X=5,J=6,Z=7,K=0,Q=1,$=2,tt=0,et=1,rt=2,nt=3,it=4,ot=5,at=300,st=301,lt=302,ct=303,ut=304,ht=305,pt=306,dt=307,ft=1e3,mt=1001,gt=1002,vt=1003,yt=1004,_t=1004,bt=1005,xt=1005,wt=1006,Et=1007,Mt=1007,St=1008,Tt=1008,At=1009,Ct=1010,Pt=1011,Ot=1012,Rt=1013,Lt=1014,It=1015,Nt=1016,Bt=1017,Dt=1018,kt=1019,Ut=1020,Ft=1021,jt=1022,Gt=1023,zt=1024,Vt=1025,Ht=Gt,Wt=1026,qt=1027,Yt=1028,Xt=1029,Jt=1030,Zt=1031,Kt=1032,Qt=1033,$t=33776,te=33777,ee=33778,re=33779,ne=35840,ie=35841,oe=35842,ae=35843,se=36196,le=37492,ce=37496,ue=37808,he=37809,pe=37810,de=37811,fe=37812,me=37813,ge=37814,ve=37815,ye=37816,_e=37817,be=37818,xe=37819,we=37820,Ee=37821,Me=36492,Se=37840,Te=37841,Ae=37842,Ce=37843,Pe=37844,Oe=37845,Re=37846,Le=37847,Ie=37848,Ne=37849,Be=37850,De=37851,ke=37852,Ue=37853,Fe=2200,je=2201,Ge=2202,ze=2300,Ve=2301,He=2302,We=2400,qe=2401,Ye=2402,Xe=2500,Je=2501,Ze=0,Ke=1,Qe=2,$e=3e3,tr=3001,er=3007,rr=3002,nr=3003,ir=3004,or=3005,ar=3006,sr=3200,lr=3201,cr=0,ur=1,hr=0,pr=7680,dr=7681,fr=7682,mr=7683,gr=34055,vr=34056,yr=5386,_r=512,br=513,xr=514,wr=515,Er=516,Mr=517,Sr=518,Tr=519,Ar=35044,Cr=35048,Pr=35040,Or=35045,Rr=35049,Lr=35041,Ir=35046,Nr=35050,Br=35042;function Dr(){}Object.assign(Dr.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0!==this._listeners){var r=this._listeners[t];if(void 0!==r){var n=r.indexOf(e);-1!==n&&r.splice(n,1)}}},dispatchEvent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var r=e.slice(0),n=0,i=r.length;n<i;n++)r[n].call(this,t)}}}});for(var kr=[],Ur=0;Ur<256;Ur++)kr[Ur]=(Ur<16?"0":"")+Ur.toString(16);var Fr,jr={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(kr[255&t]+kr[t>>8&255]+kr[t>>16&255]+kr[t>>24&255]+"-"+kr[255&e]+kr[e>>8&255]+"-"+kr[e>>16&15|64]+kr[e>>24&255]+"-"+kr[63&r|128]+kr[r>>8&255]+"-"+kr[r>>16&255]+kr[r>>24&255]+kr[255&n]+kr[n>>8&255]+kr[n>>16&255]+kr[n>>24&255]).toUpperCase()},clamp:function(t,e,r){return Math.max(e,Math.min(r,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,r,n,i){return n+(t-e)*(i-n)/(r-e)},lerp:function(t,e,r){return(1-r)*t+r*e},smoothstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)},smootherstep:function(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*jr.DEG2RAD},radToDeg:function(t){return t*jr.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,r,n,i){var o=Math.cos,a=Math.sin,s=o(r/2),l=a(r/2),c=o((e+n)/2),u=a((e+n)/2),h=o((e-n)/2),p=a((e-n)/2),d=o((n-e)/2),f=a((n-e)/2);switch(i){case"XYX":t.set(s*u,l*h,l*p,s*c);break;case"YZY":t.set(l*p,s*u,l*h,s*c);break;case"ZXZ":t.set(l*h,l*p,s*u,s*c);break;case"XZX":t.set(s*u,l*f,l*d,s*c);break;case"YXY":t.set(l*d,s*u,l*f,s*c);break;case"ZYZ":t.set(l*f,l*d,s*u,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}};function Gr(t,e){this.x=t||0,this.y=e||0}function zr(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Gr.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(Gr.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(t){return this.x+=t,this.y+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(t){return this.x-=t,this.y-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){var e=this.x,r=this.y,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6],this.y=n[1]*e+n[4]*r+n[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y;return e*e+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=this.x-t.x,o=this.y-t.y;return this.x=i*r-o*n+t.x,this.y=i*n+o*r+t.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(zr.prototype,{isMatrix3:!0,set:function(t,e,r,n,i,o,a,s,l){var c=this.elements;return c[0]=t,c[1]=n,c[2]=a,c[3]=e,c[4]=i,c[5]=s,c[6]=r,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this},extractBasis:function(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],a=r[3],s=r[6],l=r[1],c=r[4],u=r[7],h=r[2],p=r[5],d=r[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],_=n[7],b=n[2],x=n[5],w=n[8];return i[0]=o*f+a*v+s*b,i[3]=o*m+a*y+s*x,i[6]=o*g+a*_+s*w,i[1]=l*f+c*v+u*b,i[4]=l*m+c*y+u*x,i[7]=l*g+c*_+u*w,i[2]=h*f+p*v+d*b,i[5]=h*m+p*y+d*x,i[8]=h*g+p*_+d*w,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],l=t[7],c=t[8];return e*o*c-e*a*l-r*i*c+r*a*s+n*i*l-n*o*s},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");var r=t.elements,n=this.elements,i=r[0],o=r[1],a=r[2],s=r[3],l=r[4],c=r[5],u=r[6],h=r[7],p=r[8],d=p*l-c*h,f=c*u-p*s,m=h*s-l*u,g=i*d+o*f+a*m;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);var v=1/g;return n[0]=d*v,n[1]=(a*h-p*o)*v,n[2]=(c*o-a*l)*v,n[3]=f*v,n[4]=(p*i-a*u)*v,n[5]=(a*s-c*i)*v,n[6]=m*v,n[7]=(o*u-h*i)*v,n[8]=(l*i-o*s)*v,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,r,n,i,o,a){var s=Math.cos(i),l=Math.sin(i);this.set(r*s,r*l,-r*(s*o+l*a)+o+t,-n*l,n*s,-n*(-l*o+s*a)+a+e,0,0,1)},scale:function(t,e){var r=this.elements;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=this.elements,i=n[0],o=n[3],a=n[6],s=n[1],l=n[4],c=n[7];return n[0]=e*i+r*s,n[3]=e*o+r*l,n[6]=e*a+r*c,n[1]=-r*i+e*s,n[4]=-r*o+e*l,n[7]=-r*a+e*c,this},translate:function(t,e){var r=this.elements;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<9;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<9;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}});var Vr={getDataURL:function(t){var e;if("undefined"==typeof HTMLCanvasElement)return t.src;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Fr&&(Fr=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Fr.width=t.width,Fr.height=t.height;var r=Fr.getContext("2d");t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0,t.width,t.height),e=Fr}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}},Hr=0;function Wr(t,e,r,n,i,o,a,s,l,c){Object.defineProperty(this,"id",{value:Hr++}),this.uuid=jr.generateUUID(),this.name="",this.image=void 0!==t?t:Wr.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:Wr.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:mt,this.wrapT=void 0!==n?n:mt,this.magFilter=void 0!==i?i:wt,this.minFilter=void 0!==o?o:St,this.anisotropy=void 0!==l?l:1,this.format=void 0!==a?a:Gt,this.internalFormat=null,this.type=void 0!==s?s:At,this.offset=new Gr(0,0),this.repeat=new Gr(1,1),this.center=new Gr(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new zr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==c?c:$e,this.version=0,this.onUpdate=null}function qr(t,e,r,n){this.x=t||0,this.y=e||0,this.z=r||0,this.w=void 0!==n?n:1}function Yr(t,e,r){this.width=t,this.height=e,this.scissor=new qr(0,0,t,e),this.scissorTest=!1,this.viewport=new qr(0,0,t,e),r=r||{},this.texture=new Wr(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:wt,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function Xr(t,e,r){Yr.call(this,t,e,r),this.samples=4}function Jr(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=void 0!==n?n:1}Wr.DEFAULT_IMAGE=void 0,Wr.DEFAULT_MAPPING=at,Wr.prototype=Object.assign(Object.create(Dr.prototype),{constructor:Wr,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var n=this.image;if(void 0===n.uuid&&(n.uuid=jr.generateUUID()),!e&&void 0===t.images[n.uuid]){var i;if(Array.isArray(n)){i=[];for(var o=0,a=n.length;o<a;o++)i.push(Vr.getDataURL(n[o]))}else i=Vr.getDataURL(n);t.images[n.uuid]={uuid:n.uuid,url:i}}r.image=n.uuid}return e||(t.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(this.mapping!==at)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ft:t.x=t.x-Math.floor(t.x);break;case mt:t.x=t.x<0?0:1;break;case gt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case ft:t.y=t.y-Math.floor(t.y);break;case mt:t.y=t.y<0?0:1;break;case gt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(Wr.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(qr.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(qr.prototype,{isVector4:!0,set:function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=this.w,o=t.elements;return this.x=o[0]*e+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*e+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*e+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*e+o[7]*r+o[11]*n+o[15]*i,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,r,n,i,o=.01,a=.1,s=t.elements,l=s[0],c=s[4],u=s[8],h=s[1],p=s[5],d=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(c-h)<o&&Math.abs(u-f)<o&&Math.abs(d-m)<o){if(Math.abs(c+h)<a&&Math.abs(u+f)<a&&Math.abs(d+m)<a&&Math.abs(l+p+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;var v=(l+1)/2,y=(p+1)/2,_=(g+1)/2,b=(c+h)/4,x=(u+f)/4,w=(d+m)/4;return v>y&&v>_?v<o?(r=0,n=.707106781,i=.707106781):(n=b/(r=Math.sqrt(v)),i=x/r):y>_?y<o?(r=.707106781,n=0,i=.707106781):(r=b/(n=Math.sqrt(y)),i=w/n):_<o?(r=.707106781,n=.707106781,i=0):(r=x/(i=Math.sqrt(_)),n=w/i),this.set(r,n,i,e),this}var E=Math.sqrt((m-d)*(m-d)+(u-f)*(u-f)+(h-c)*(h-c));return Math.abs(E)<.001&&(E=1),this.x=(m-d)/E,this.y=(u-f)/E,this.z=(h-c)/E,this.w=Math.acos((l+p+g-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this.w=t.w+(e.w-t.w)*r,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),Yr.prototype=Object.assign(Object.create(Dr.prototype),{constructor:Yr,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Xr.prototype=Object.assign(Object.create(Yr.prototype),{constructor:Xr,isWebGLMultisampleRenderTarget:!0,copy:function(t){return Yr.prototype.copy.call(this,t),this.samples=t.samples,this}}),Object.assign(Jr,{slerp:function(t,e,r,n){return r.copy(t).slerp(e,n)},slerpFlat:function(t,e,r,n,i,o,a){var s=r[n+0],l=r[n+1],c=r[n+2],u=r[n+3],h=i[o+0],p=i[o+1],d=i[o+2],f=i[o+3];if(u!==f||s!==h||l!==p||c!==d){var m=1-a,g=s*h+l*p+c*d+u*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var _=Math.sqrt(y),b=Math.atan2(_,g*v);m=Math.sin(m*b)/_,a=Math.sin(a*b)/_}var x=a*v;if(s=s*m+h*x,l=l*m+p*x,c=c*m+d*x,u=u*m+f*x,m===1-a){var w=1/Math.sqrt(s*s+l*l+c*c+u*u);s*=w,l*=w,c*=w,u*=w}}t[e]=s,t[e+1]=l,t[e+2]=c,t[e+3]=u},multiplyQuaternionsFlat:function(t,e,r,n,i,o){var a=r[n],s=r[n+1],l=r[n+2],c=r[n+3],u=i[o],h=i[o+1],p=i[o+2],d=i[o+3];return t[e]=a*d+c*u+s*p-l*h,t[e+1]=s*d+c*h+l*u-a*p,t[e+2]=l*d+c*p+a*h-s*u,t[e+3]=c*d-a*u-s*h-l*p,t}}),Object.defineProperties(Jr.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(Jr.prototype,{isQuaternion:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._w=n,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=t._x,n=t._y,i=t._z,o=t.order,a=Math.cos,s=Math.sin,l=a(r/2),c=a(n/2),u=a(i/2),h=s(r/2),p=s(n/2),d=s(i/2);switch(o){case"XYZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"YXZ":this._x=h*c*u+l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"ZXY":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u-h*p*d;break;case"ZYX":this._x=h*c*u-l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u+h*p*d;break;case"YZX":this._x=h*c*u+l*p*d,this._y=l*p*u+h*c*d,this._z=l*c*d-h*p*u,this._w=l*c*u-h*p*d;break;case"XZY":this._x=h*c*u-l*p*d,this._y=l*p*u-h*c*d,this._z=l*c*d+h*p*u,this._w=l*c*u+h*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(t){var e,r=t.elements,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],l=r[9],c=r[2],u=r[6],h=r[10],p=n+s+h;return p>0?(e=.5/Math.sqrt(p+1),this._w=.25/e,this._x=(u-l)*e,this._y=(o-c)*e,this._z=(a-i)*e):n>s&&n>h?(e=2*Math.sqrt(1+n-s-h),this._w=(u-l)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(o+c)/e):s>h?(e=2*Math.sqrt(1+s-n-h),this._w=(o-c)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(l+u)/e):(e=2*Math.sqrt(1+h-n-s),this._w=(a-i)/e,this._x=(o+c)/e,this._y=(l+u)/e,this._z=.25*e),this._onChangeCallback(),this},setFromUnitVectors:function(t,e){var r=t.dot(e)+1;return r<1e-6?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()},angleTo:function(t){return 2*Math.acos(Math.abs(jr.clamp(this.dot(t),-1,1)))},rotateTowards:function(t,e){var r=this.angleTo(t);if(0===r)return this;var n=Math.min(1,e/r);return this.slerp(t,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var r=t._x,n=t._y,i=t._z,o=t._w,a=e._x,s=e._y,l=e._z,c=e._w;return this._x=r*c+o*a+n*l-i*s,this._y=n*c+o*s+i*a-r*l,this._z=i*c+o*l+r*s-n*a,this._w=o*c-r*a-n*s-i*l,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this._x,n=this._y,i=this._z,o=this._w,a=o*t._w+r*t._x+n*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=r,this._y=n,this._z=i,this;var s=1-a*a;if(s<=Number.EPSILON){var l=1-e;return this._w=l*o+e*this._w,this._x=l*r+e*this._x,this._y=l*n+e*this._y,this._z=l*i+e*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),u=Math.atan2(c,a),h=Math.sin((1-e)*u)/c,p=Math.sin(e*u)/c;return this._w=o*h+this._w*p,this._x=r*h+this._x*p,this._y=n*h+this._y*p,this._z=i*h+this._z*p,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});var Zr=new Qr,Kr=new Jr;function Qr(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}Object.assign(Qr.prototype,{isVector3:!0,set:function(t,e,r){return this.x=t,this.y=e,this.z=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Kr.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(Kr.setFromAxisAngle(t,e))},applyMatrix3:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6]*n,this.y=i[1]*e+i[4]*r+i[7]*n,this.z=i[2]*e+i[5]*r+i[8]*n,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements,o=1/(i[3]*e+i[7]*r+i[11]*n+i[15]);return this.x=(i[0]*e+i[4]*r+i[8]*n+i[12])*o,this.y=(i[1]*e+i[5]*r+i[9]*n+i[13])*o,this.z=(i[2]*e+i[6]*r+i[10]*n+i[14])*o,this},applyQuaternion:function(t){var e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,a=t.z,s=t.w,l=s*e+o*n-a*r,c=s*r+a*e-i*n,u=s*n+i*r-o*e,h=-i*e-o*r-a*n;return this.x=l*s+h*-i+c*-a-u*-o,this.y=c*s+h*-o+u*-i-l*-a,this.z=u*s+h*-a+l*-o-c*-i,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){var e=this.x,r=this.y,n=this.z,i=t.elements;return this.x=i[0]*e+i[4]*r+i[8]*n,this.y=i[1]*e+i[5]*r+i[9]*n,this.z=i[2]*e+i[6]*r+i[10]*n,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(t,Math.min(e,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(t,e){var r=t.x,n=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=n*s-i*a,this.y=i*o-r*s,this.z=r*a-n*o,this},projectOnVector:function(t){var e=t.lengthSq();if(0===e)return this.set(0,0,0);var r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)},projectOnPlane:function(t){return Zr.copy(this).projectOnVector(t),this.sub(Zr)},reflect:function(t){return this.sub(Zr.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){var e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;var r=this.dot(t)/e;return Math.acos(jr.clamp(r,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)},setFromSphericalCoords:function(t,e,r){var n=Math.sin(e)*t;return this.x=n*Math.sin(r),this.y=Math.cos(e)*t,this.z=n*Math.cos(r),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});var $r=new Qr,tn=new sn,en=new Qr(0,0,0),rn=new Qr(1,1,1),nn=new Qr,on=new Qr,an=new Qr;function sn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(sn.prototype,{isMatrix4:!0,set:function(t,e,r,n,i,o,a,s,l,c,u,h,p,d,f,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=r,g[12]=n,g[1]=i,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=c,g[10]=u,g[14]=h,g[3]=p,g[7]=d,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new sn).fromArray(this.elements)},copy:function(t){var e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this},copyPosition:function(t){var e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},extractBasis:function(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this},extractRotation:function(t){var e=this.elements,r=t.elements,n=1/$r.setFromMatrixColumn(t,0).length(),i=1/$r.setFromMatrixColumn(t,1).length(),o=1/$r.setFromMatrixColumn(t,2).length();return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=0,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=0,e[8]=r[8]*o,e[9]=r[9]*o,e[10]=r[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var e=this.elements,r=t.x,n=t.y,i=t.z,o=Math.cos(r),a=Math.sin(r),s=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i);if("XYZ"===t.order){var h=o*c,p=o*u,d=a*c,f=a*u;e[0]=s*c,e[4]=-s*u,e[8]=l,e[1]=p+d*l,e[5]=h-f*l,e[9]=-a*s,e[2]=f-h*l,e[6]=d+p*l,e[10]=o*s}else if("YXZ"===t.order){var m=s*c,g=s*u,v=l*c,y=l*u;e[0]=m+y*a,e[4]=v*a-g,e[8]=o*l,e[1]=o*u,e[5]=o*c,e[9]=-a,e[2]=g*a-v,e[6]=y+m*a,e[10]=o*s}else if("ZXY"===t.order){m=s*c,g=s*u,v=l*c,y=l*u;e[0]=m-y*a,e[4]=-o*u,e[8]=v+g*a,e[1]=g+v*a,e[5]=o*c,e[9]=y-m*a,e[2]=-o*l,e[6]=a,e[10]=o*s}else if("ZYX"===t.order){h=o*c,p=o*u,d=a*c,f=a*u;e[0]=s*c,e[4]=d*l-p,e[8]=h*l+f,e[1]=s*u,e[5]=f*l+h,e[9]=p*l-d,e[2]=-l,e[6]=a*s,e[10]=o*s}else if("YZX"===t.order){var _=o*s,b=o*l,x=a*s,w=a*l;e[0]=s*c,e[4]=w-_*u,e[8]=x*u+b,e[1]=u,e[5]=o*c,e[9]=-a*c,e[2]=-l*c,e[6]=b*u+x,e[10]=_-w*u}else if("XZY"===t.order){_=o*s,b=o*l,x=a*s,w=a*l;e[0]=s*c,e[4]=-u,e[8]=l*c,e[1]=_*u+w,e[5]=o*c,e[9]=b*u-x,e[2]=x*u-b,e[6]=a*c,e[10]=w*u+_}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){return this.compose(en,t,rn)},lookAt:function(t,e,r){var n=this.elements;return an.subVectors(t,e),0===an.lengthSq()&&(an.z=1),an.normalize(),nn.crossVectors(r,an),0===nn.lengthSq()&&(1===Math.abs(r.z)?an.x+=1e-4:an.z+=1e-4,an.normalize(),nn.crossVectors(r,an)),nn.normalize(),on.crossVectors(an,nn),n[0]=nn.x,n[4]=on.x,n[8]=an.x,n[1]=nn.y,n[5]=on.y,n[9]=an.y,n[2]=nn.z,n[6]=on.z,n[10]=an.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var r=t.elements,n=e.elements,i=this.elements,o=r[0],a=r[4],s=r[8],l=r[12],c=r[1],u=r[5],h=r[9],p=r[13],d=r[2],f=r[6],m=r[10],g=r[14],v=r[3],y=r[7],_=r[11],b=r[15],x=n[0],w=n[4],E=n[8],M=n[12],S=n[1],T=n[5],A=n[9],C=n[13],P=n[2],O=n[6],R=n[10],L=n[14],I=n[3],N=n[7],B=n[11],D=n[15];return i[0]=o*x+a*S+s*P+l*I,i[4]=o*w+a*T+s*O+l*N,i[8]=o*E+a*A+s*R+l*B,i[12]=o*M+a*C+s*L+l*D,i[1]=c*x+u*S+h*P+p*I,i[5]=c*w+u*T+h*O+p*N,i[9]=c*E+u*A+h*R+p*B,i[13]=c*M+u*C+h*L+p*D,i[2]=d*x+f*S+m*P+g*I,i[6]=d*w+f*T+m*O+g*N,i[10]=d*E+f*A+m*R+g*B,i[14]=d*M+f*C+m*L+g*D,i[3]=v*x+y*S+_*P+b*I,i[7]=v*w+y*T+_*O+b*N,i[11]=v*E+y*A+_*R+b*B,i[15]=v*M+y*C+_*L+b*D,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},determinant:function(){var t=this.elements,e=t[0],r=t[4],n=t[8],i=t[12],o=t[1],a=t[5],s=t[9],l=t[13],c=t[2],u=t[6],h=t[10],p=t[14];return t[3]*(+i*s*u-n*l*u-i*a*h+r*l*h+n*a*p-r*s*p)+t[7]*(+e*s*p-e*l*h+i*o*h-n*o*p+n*l*c-i*s*c)+t[11]*(+e*l*u-e*a*p-i*o*u+r*o*p+i*a*c-r*l*c)+t[15]*(-n*a*c-e*s*u+e*a*h+n*o*u-r*o*h+r*s*c)},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(t,e,r){var n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=r),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");var r=this.elements,n=t.elements,i=n[0],o=n[1],a=n[2],s=n[3],l=n[4],c=n[5],u=n[6],h=n[7],p=n[8],d=n[9],f=n[10],m=n[11],g=n[12],v=n[13],y=n[14],_=n[15],b=d*y*h-v*f*h+v*u*m-c*y*m-d*u*_+c*f*_,x=g*f*h-p*y*h-g*u*m+l*y*m+p*u*_-l*f*_,w=p*v*h-g*d*h+g*c*m-l*v*m-p*c*_+l*d*_,E=g*d*u-p*v*u-g*c*f+l*v*f+p*c*y-l*d*y,M=i*b+o*x+a*w+s*E;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var S=1/M;return r[0]=b*S,r[1]=(v*f*s-d*y*s-v*a*m+o*y*m+d*a*_-o*f*_)*S,r[2]=(c*y*s-v*u*s+v*a*h-o*y*h-c*a*_+o*u*_)*S,r[3]=(d*u*s-c*f*s-d*a*h+o*f*h+c*a*m-o*u*m)*S,r[4]=x*S,r[5]=(p*y*s-g*f*s+g*a*m-i*y*m-p*a*_+i*f*_)*S,r[6]=(g*u*s-l*y*s-g*a*h+i*y*h+l*a*_-i*u*_)*S,r[7]=(l*f*s-p*u*s+p*a*h-i*f*h-l*a*m+i*u*m)*S,r[8]=w*S,r[9]=(g*d*s-p*v*s-g*o*m+i*v*m+p*o*_-i*d*_)*S,r[10]=(l*v*s-g*c*s+g*o*h-i*v*h-l*o*_+i*c*_)*S,r[11]=(p*c*s-l*d*s-p*o*h+i*d*h+l*o*m-i*c*m)*S,r[12]=E*S,r[13]=(p*v*a-g*d*a+g*o*f-i*v*f-p*o*y+i*d*y)*S,r[14]=(g*c*a-l*v*a-g*o*u+i*v*u+l*o*y-i*c*y)*S,r[15]=(l*d*a-p*c*a+p*o*u-i*d*u-l*o*f+i*c*f)*S,this},scale:function(t){var e=this.elements,r=t.x,n=t.y,i=t.z;return e[0]*=r,e[4]*=n,e[8]*=i,e[1]*=r,e[5]*=n,e[9]*=i,e[2]*=r,e[6]*=n,e[10]*=i,e[3]*=r,e[7]*=n,e[11]*=i,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,n))},makeTranslation:function(t,e,r){return this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this},makeRotationX:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this},makeRotationY:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this},makeRotationZ:function(t){var e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){var r=Math.cos(e),n=Math.sin(e),i=1-r,o=t.x,a=t.y,s=t.z,l=i*o,c=i*a;return this.set(l*o+r,l*a-n*s,l*s+n*a,0,l*a+n*s,c*a+r,c*s-n*o,0,l*s-n*a,c*s+n*o,i*s*s+r,0,0,0,0,1),this},makeScale:function(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(t,e,r){return this.set(1,e,r,0,t,1,r,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,r){var n=this.elements,i=e._x,o=e._y,a=e._z,s=e._w,l=i+i,c=o+o,u=a+a,h=i*l,p=i*c,d=i*u,f=o*c,m=o*u,g=a*u,v=s*l,y=s*c,_=s*u,b=r.x,x=r.y,w=r.z;return n[0]=(1-(f+g))*b,n[1]=(p+_)*b,n[2]=(d-y)*b,n[3]=0,n[4]=(p-_)*x,n[5]=(1-(h+g))*x,n[6]=(m+v)*x,n[7]=0,n[8]=(d+y)*w,n[9]=(m-v)*w,n[10]=(1-(h+f))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this},decompose:function(t,e,r){var n=this.elements,i=$r.set(n[0],n[1],n[2]).length(),o=$r.set(n[4],n[5],n[6]).length(),a=$r.set(n[8],n[9],n[10]).length();this.determinant()<0&&(i=-i),t.x=n[12],t.y=n[13],t.z=n[14],tn.copy(this);var s=1/i,l=1/o,c=1/a;return tn.elements[0]*=s,tn.elements[1]*=s,tn.elements[2]*=s,tn.elements[4]*=l,tn.elements[5]*=l,tn.elements[6]*=l,tn.elements[8]*=c,tn.elements[9]*=c,tn.elements[10]*=c,e.setFromRotationMatrix(tn),r.x=i,r.y=o,r.z=a,this},makePerspective:function(t,e,r,n,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var a=this.elements,s=2*i/(e-t),l=2*i/(r-n),c=(e+t)/(e-t),u=(r+n)/(r-n),h=-(o+i)/(o-i),p=-2*o*i/(o-i);return a[0]=s,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makeOrthographic:function(t,e,r,n,i,o){var a=this.elements,s=1/(e-t),l=1/(r-n),c=1/(o-i),u=(e+t)*s,h=(r+n)*l,p=(o+i)*c;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},equals:function(t){for(var e=this.elements,r=t.elements,n=0;n<16;n++)if(e[n]!==r[n])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(var r=0;r<16;r++)this.elements[r]=t[r+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}});var ln=new sn,cn=new Jr;function un(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._order=n||un.DefaultOrder}function hn(){this.mask=1}un.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],un.DefaultOrder="XYZ",Object.defineProperties(un.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(un.prototype,{isEuler:!0,set:function(t,e,r,n){return this._x=t,this._y=e,this._z=r,this._order=n||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,r){var n=jr.clamp,i=t.elements,o=i[0],a=i[4],s=i[8],l=i[1],c=i[5],u=i[9],h=i[2],p=i[6],d=i[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(n(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-n(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==r&&this._onChangeCallback(),this},setFromQuaternion:function(t,e,r){return ln.makeRotationFromQuaternion(t),this.setFromRotationMatrix(ln,e,r)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return cn.setFromEuler(this),this.setFromQuaternion(cn,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Qr(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(hn.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}});let pn=0;const dn=new Qr,fn=new Jr,mn=new sn,gn=new Qr,vn=new Qr,yn=new Qr,_n=new Jr,bn=new Qr(1,0,0),xn=new Qr(0,1,0),wn=new Qr(0,0,1),En={type:"added"},Mn={type:"removed"};function Sn(){Object.defineProperty(this,"id",{value:pn++}),this.uuid=jr.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Sn.DefaultUp.clone();var t=new Qr,e=new un,r=new Jr,n=new Qr(1,1,1);e._onChange((function(){r.setFromEuler(e,!1)})),r._onChange((function(){e.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new sn},normalMatrix:{value:new zr}}),this.matrix=new sn,this.matrixWorld=new sn,this.matrixAutoUpdate=Sn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new hn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Tn(){Sn.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Sn.DefaultUp=new Qr(0,1,0),Sn.DefaultMatrixAutoUpdate=!0,Sn.prototype=Object.assign(Object.create(Dr.prototype),{constructor:Sn,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return fn.setFromAxisAngle(t,e),this.quaternion.multiply(fn),this},rotateOnWorldAxis:function(t,e){return fn.setFromAxisAngle(t,e),this.quaternion.premultiply(fn),this},rotateX:function(t){return this.rotateOnAxis(bn,t)},rotateY:function(t){return this.rotateOnAxis(xn,t)},rotateZ:function(t){return this.rotateOnAxis(wn,t)},translateOnAxis:function(t,e){return dn.copy(t).applyQuaternion(this.quaternion),this.position.add(dn.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(bn,t)},translateY:function(t){return this.translateOnAxis(xn,t)},translateZ:function(t){return this.translateOnAxis(wn,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(mn.getInverse(this.matrixWorld))},lookAt:function(t,e,r){t.isVector3?gn.copy(t):gn.set(t,e,r);var n=this.parent;this.updateWorldMatrix(!0,!1),vn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?mn.lookAt(vn,gn,this.up):mn.lookAt(gn,vn,this.up),this.quaternion.setFromRotationMatrix(mn),n&&(mn.extractRotation(n.matrixWorld),fn.setFromRotationMatrix(mn),this.quaternion.premultiply(fn.inverse()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(En)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1),t.dispatchEvent(Mn)),this},attach:function(t){return this.updateWorldMatrix(!0,!1),mn.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),mn.multiply(t.parent.matrixWorld)),t.applyMatrix4(mn),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(var r=0,n=this.children.length;r<n;r++){var i=this.children[r].getObjectByProperty(t,e);if(void 0!==i)return i}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new Qr),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new Jr),this.updateMatrixWorld(!0),this.matrixWorld.decompose(vn,t,yn),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new Qr),this.updateMatrixWorld(!0),this.matrixWorld.decompose(vn,_n,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new Qr),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverse(t)},traverseVisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].traverseVisible(t)}},traverseAncestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,r=0,n=e.length;r<n;r++)e[r].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){var r=this.parent;if(!0===t&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e)for(var n=this.children,i=0,o=n.length;i<o;i++)n[i].updateWorldMatrix(!1,!0)},toJSON:function(t){var e=void 0===t||"string"==typeof t,r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var n={};function i(e,r){return void 0===e[r.uuid]&&(e[r.uuid]=r.toJSON(t)),r.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=i(t.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var a=o.shapes;if(Array.isArray(a))for(var s=0,l=a.length;s<l;s++){var c=a[s];i(t.shapes,c)}else i(t.shapes,a)}}if(void 0!==this.material)if(Array.isArray(this.material)){var u=[];for(s=0,l=this.material.length;s<l;s++)u.push(i(t.materials,this.material[s]));n.material=u}else n.material=i(t.materials,this.material);if(this.children.length>0){n.children=[];for(s=0;s<this.children.length;s++)n.children.push(this.children[s].toJSON(t).object)}if(e){var h=m(t.geometries),p=m(t.materials),d=m(t.textures),f=m(t.images);a=m(t.shapes);h.length>0&&(r.geometries=h),p.length>0&&(r.materials=p),d.length>0&&(r.textures=d),f.length>0&&(r.images=f),a.length>0&&(r.shapes=a)}function m(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}return r.object=n,r},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(var r=0;r<t.children.length;r++){var n=t.children[r];this.add(n.clone())}return this}}),Tn.prototype=Object.assign(Object.create(Sn.prototype),{constructor:Tn,isScene:!0,copy:function(t,e){return Sn.prototype.copy.call(this,t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this},toJSON:function(t){var e=Sn.prototype.toJSON.call(this,t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e},dispose:function(){this.dispatchEvent({type:"dispose"})}});var An=[new Qr,new Qr,new Qr,new Qr,new Qr,new Qr,new Qr,new Qr],Cn=new Qr,Pn=new jn,On=new Qr,Rn=new Qr,Ln=new Qr,In=new Qr,Nn=new Qr,Bn=new Qr,Dn=new Qr,kn=new Qr,Un=new Qr,Fn=new Qr;function jn(t,e){this.min=void 0!==t?t:new Qr(1/0,1/0,1/0),this.max=void 0!==e?e:new Qr(-1/0,-1/0,-1/0)}function Gn(t,e,r,n,i){var o,a;for(o=0,a=t.length-3;o<=a;o+=3){Fn.fromArray(t,o);var s=i.x*Math.abs(Fn.x)+i.y*Math.abs(Fn.y)+i.z*Math.abs(Fn.z),l=e.dot(Fn),c=r.dot(Fn),u=n.dot(Fn);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>s)return!1}return!0}Object.assign(jn.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.length;s<l;s+=3){var c=t[s],u=t[s+1],h=t[s+2];c<e&&(e=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,r,n),this.max.set(i,o,a),this},setFromBufferAttribute:function(t){for(var e=1/0,r=1/0,n=1/0,i=-1/0,o=-1/0,a=-1/0,s=0,l=t.count;s<l;s++){var c=t.getX(s),u=t.getY(s),h=t.getZ(s);c<e&&(e=c),u<r&&(r=u),h<n&&(n=h),c>i&&(i=c),u>o&&(o=u),h>a&&(a=h)}return this.min.set(e,r,n),this.max.set(i,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var r=Cn.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this},setFromObject:function(t){return this.makeEmpty(),this.expandByObject(t)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new Qr),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new Qr),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(t){t.updateWorldMatrix(!1,!1);var e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),Pn.copy(e.boundingBox),Pn.applyMatrix4(t.matrixWorld),this.union(Pn));for(var r=t.children,n=0,i=r.length;n<i;n++)this.expandByObject(r[n]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new Qr),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,Cn),Cn.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){var e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(Dn),kn.subVectors(this.max,Dn),On.subVectors(t.a,Dn),Rn.subVectors(t.b,Dn),Ln.subVectors(t.c,Dn),In.subVectors(Rn,On),Nn.subVectors(Ln,Rn),Bn.subVectors(On,Ln);var e=[0,-In.z,In.y,0,-Nn.z,Nn.y,0,-Bn.z,Bn.y,In.z,0,-In.x,Nn.z,0,-Nn.x,Bn.z,0,-Bn.x,-In.y,In.x,0,-Nn.y,Nn.x,0,-Bn.y,Bn.x,0];return!!Gn(e,On,Rn,Ln,kn)&&(!!Gn(e=[1,0,0,0,1,0,0,0,1],On,Rn,Ln,kn)&&(Un.crossVectors(In,Nn),Gn(e=[Un.x,Un.y,Un.z],On,Rn,Ln,kn)))},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new Qr),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Cn.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(Cn).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(An[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),An[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),An[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),An[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),An[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),An[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),An[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),An[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(An)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var zn=new jn;function Vn(t,e){this.center=void 0!==t?t:new Qr,this.radius=void 0!==e?e:-1}Object.assign(Vn.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){var r=this.center;void 0!==e?r.copy(e):zn.setFromPoints(t).getCenter(r);for(var n=0,i=0,o=t.length;i<o;i++)n=Math.max(n,r.distanceToSquared(t[i]));return this.radius=Math.sqrt(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},isEmpty:function(){return this.radius<0},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var r=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new Qr),e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new jn),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var Hn=new Qr,Wn=new Qr,qn=new Qr,Yn=new Qr,Xn=new Qr,Jn=new Qr,Zn=new Qr;function Kn(t,e){this.origin=void 0!==t?t:new Qr,this.direction=void 0!==e?e:new Qr(0,0,-1)}Object.assign(Kn.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new Qr),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,Hn)),this},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new Qr),e.subVectors(t,this.origin);var r=e.dot(this.direction);return r<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){var e=Hn.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Hn.copy(this.direction).multiplyScalar(e).add(this.origin),Hn.distanceToSquared(t))},distanceSqToSegment:function(t,e,r,n){Wn.copy(t).add(e).multiplyScalar(.5),qn.copy(e).sub(t).normalize(),Yn.copy(this.origin).sub(Wn);var i,o,a,s,l=.5*t.distanceTo(e),c=-this.direction.dot(qn),u=Yn.dot(this.direction),h=-Yn.dot(qn),p=Yn.lengthSq(),d=Math.abs(1-c*c);if(d>0)if(o=c*u-h,s=l*d,(i=c*h-u)>=0)if(o>=-s)if(o<=s){var f=1/d;a=(i*=f)*(i+c*(o*=f)+2*u)+o*(c*i+o+2*h)+p}else o=l,a=-(i=Math.max(0,-(c*o+u)))*i+o*(o+2*h)+p;else o=-l,a=-(i=Math.max(0,-(c*o+u)))*i+o*(o+2*h)+p;else o<=-s?a=-(i=Math.max(0,-(-c*l+u)))*i+(o=i>0?-l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p:o<=s?(i=0,a=(o=Math.min(Math.max(-l,-h),l))*(o+2*h)+p):a=-(i=Math.max(0,-(c*l+u)))*i+(o=i>0?l:Math.min(Math.max(-l,-h),l))*(o+2*h)+p;else o=c>0?-l:l,a=-(i=Math.max(0,-(c*o+u)))*i+o*(o+2*h)+p;return r&&r.copy(this.direction).multiplyScalar(i).add(this.origin),n&&n.copy(qn).multiplyScalar(o).add(Wn),a},intersectSphere:function(t,e){Hn.subVectors(t.center,this.origin);var r=Hn.dot(this.direction),n=Hn.dot(Hn)-r*r,i=t.radius*t.radius;if(n>i)return null;var o=Math.sqrt(i-n),a=r-o,s=r+o;return a<0&&s<0?null:a<0?this.at(s,e):this.at(a,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},intersectPlane:function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},intersectsPlane:function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){var r,n,i,o,a,s,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(r=(t.min.x-h.x)*l,n=(t.max.x-h.x)*l):(r=(t.max.x-h.x)*l,n=(t.min.x-h.x)*l),c>=0?(i=(t.min.y-h.y)*c,o=(t.max.y-h.y)*c):(i=(t.max.y-h.y)*c,o=(t.min.y-h.y)*c),r>o||i>n?null:((i>r||r!=r)&&(r=i),(o<n||n!=n)&&(n=o),u>=0?(a=(t.min.z-h.z)*u,s=(t.max.z-h.z)*u):(a=(t.max.z-h.z)*u,s=(t.min.z-h.z)*u),r>s||a>n?null:((a>r||r!=r)&&(r=a),(s<n||n!=n)&&(n=s),n<0?null:this.at(r>=0?r:n,e)))},intersectsBox:function(t){return null!==this.intersectBox(t,Hn)},intersectTriangle:function(t,e,r,n,i){Xn.subVectors(e,t),Jn.subVectors(r,t),Zn.crossVectors(Xn,Jn);var o,a=this.direction.dot(Zn);if(a>0){if(n)return null;o=1}else{if(!(a<0))return null;o=-1,a=-a}Yn.subVectors(this.origin,t);var s=o*this.direction.dot(Jn.crossVectors(Yn,Jn));if(s<0)return null;var l=o*this.direction.dot(Xn.cross(Yn));if(l<0)return null;if(s+l>a)return null;var c=-o*Yn.dot(Zn);return c<0?null:this.at(c/a,i)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});var Qn=new Qr,$n=new Qr,ti=new zr;function ei(t,e){this.normal=void 0!==t?t:new Qr(1,0,0),this.constant=void 0!==e?e:0}Object.assign(ei.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,r,n){return this.normal.set(t,e,r),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(t,e,r){var n=Qn.subVectors(r,e).cross($n.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new Qr),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new Qr);var r=t.delta(Qn),n=this.normal.dot(r);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;var i=-(t.start.dot(this.normal)+this.constant)/n;return i<0||i>1?void 0:e.copy(r).multiplyScalar(i).add(t.start)},intersectsLine:function(t){var e=this.distanceToPoint(t.start),r=this.distanceToPoint(t.end);return e<0&&r>0||r<0&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new Qr),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){var r=e||ti.getNormalMatrix(t),n=this.coplanarPoint(Qn).applyMatrix4(t),i=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(i),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var ri=new Qr,ni=new Qr,ii=new Qr,oi=new Qr,ai=new Qr,si=new Qr,li=new Qr,ci=new Qr,ui=new Qr,hi=new Qr;function pi(t,e,r){this.a=void 0!==t?t:new Qr,this.b=void 0!==e?e:new Qr,this.c=void 0!==r?r:new Qr}Object.assign(pi,{getNormal:function(t,e,r,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new Qr),n.subVectors(r,e),ri.subVectors(t,e),n.cross(ri);var i=n.lengthSq();return i>0?n.multiplyScalar(1/Math.sqrt(i)):n.set(0,0,0)},getBarycoord:function(t,e,r,n,i){ri.subVectors(n,e),ni.subVectors(r,e),ii.subVectors(t,e);var o=ri.dot(ri),a=ri.dot(ni),s=ri.dot(ii),l=ni.dot(ni),c=ni.dot(ii),u=o*l-a*a;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Qr),0===u)return i.set(-2,-1,-1);var h=1/u,p=(l*s-a*c)*h,d=(o*c-a*s)*h;return i.set(1-p-d,d,p)},containsPoint:function(t,e,r,n){return pi.getBarycoord(t,e,r,n,oi),oi.x>=0&&oi.y>=0&&oi.x+oi.y<=1},getUV:function(t,e,r,n,i,o,a,s){return this.getBarycoord(t,e,r,n,oi),s.set(0,0),s.addScaledVector(i,oi.x),s.addScaledVector(o,oi.y),s.addScaledVector(a,oi.z),s},isFrontFacing:function(t,e,r,n){return ri.subVectors(r,e),ni.subVectors(t,e),ri.cross(ni).dot(n)<0}}),Object.assign(pi.prototype,{set:function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},setFromPointsAndIndices:function(t,e,r,n){return this.a.copy(t[e]),this.b.copy(t[r]),this.c.copy(t[n]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return ri.subVectors(this.c,this.b),ni.subVectors(this.a,this.b),.5*ri.cross(ni).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new Qr),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return pi.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new ei),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return pi.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,r,n,i){return pi.getUV(t,this.a,this.b,this.c,e,r,n,i)},containsPoint:function(t){return pi.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return pi.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new Qr);var r,n,i=this.a,o=this.b,a=this.c;ai.subVectors(o,i),si.subVectors(a,i),ci.subVectors(t,i);var s=ai.dot(ci),l=si.dot(ci);if(s<=0&&l<=0)return e.copy(i);ui.subVectors(t,o);var c=ai.dot(ui),u=si.dot(ui);if(c>=0&&u<=c)return e.copy(o);var h=s*u-c*l;if(h<=0&&s>=0&&c<=0)return r=s/(s-c),e.copy(i).addScaledVector(ai,r);hi.subVectors(t,a);var p=ai.dot(hi),d=si.dot(hi);if(d>=0&&p<=d)return e.copy(a);var f=p*l-s*d;if(f<=0&&l>=0&&d<=0)return n=l/(l-d),e.copy(i).addScaledVector(si,n);var m=c*d-p*u;if(m<=0&&u-c>=0&&p-d>=0)return li.subVectors(a,o),n=(u-c)/(u-c+(p-d)),e.copy(o).addScaledVector(li,n);var g=1/(m+f+h);return r=f*g,n=h*g,e.copy(i).addScaledVector(ai,r).addScaledVector(si,n)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});var di={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},fi={h:0,s:0,l:0},mi={h:0,s:0,l:0};function gi(t,e,r){return void 0===e&&void 0===r?this.set(t):this.setRGB(t,e,r)}function vi(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}function yi(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function _i(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function bi(t,e,r,n,i,o){this.a=t,this.b=e,this.c=r,this.normal=n&&n.isVector3?n:new Qr,this.vertexNormals=Array.isArray(n)?n:[],this.color=i&&i.isColor?i:new gi,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}Object.assign(gi.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,r){return this.r=t,this.g=e,this.b=r,this},setHSL:function(t,e,r){if(t=jr.euclideanModulo(t,1),e=jr.clamp(e,0,1),r=jr.clamp(r,0,1),0===e)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+e):r+e-r*e,i=2*r-n;this.r=vi(i,n,t+1/3),this.g=vi(i,n,t),this.b=vi(i,n,t-1/3)}return this},setStyle:function(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var n,i=r[1],o=r[2];switch(i){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,e(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,e(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var a=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,l=parseInt(n[3],10)/100;return e(n[5]),this.setHSL(a,s,l)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(t)){var c=r[1],u=c.length;if(3===u)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===u)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this},setColorName:function(t){var e=di[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);var r=e>0?1/e:1;return this.r=Math.pow(t.r,r),this.g=Math.pow(t.g,r),this.b=Math.pow(t.b,r),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=yi(t.r),this.g=yi(t.g),this.b=yi(t.b),this},copyLinearToSRGB:function(t){return this.r=_i(t.r),this.g=_i(t.g),this.b=_i(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});var e,r,n=this.r,i=this.g,o=this.b,a=Math.max(n,i,o),s=Math.min(n,i,o),l=(s+a)/2;if(s===a)e=0,r=0;else{var c=a-s;switch(r=l<=.5?c/(a+s):c/(2-a-s),a){case n:e=(i-o)/c+(i<o?6:0);break;case i:e=(o-n)/c+2;break;case o:e=(n-i)/c+4}e/=6}return t.h=e,t.s=r,t.l=l,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,e,r){return this.getHSL(fi),fi.h+=t,fi.s+=e,fi.l+=r,this.setHSL(fi.h,fi.s,fi.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(t){return this.r+=t,this.g+=t,this.b+=t,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(t){return this.r*=t,this.g*=t,this.b*=t,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(fi),t.getHSL(mi);var r=jr.lerp(fi.h,mi.h,e),n=jr.lerp(fi.s,mi.s,e),i=jr.lerp(fi.l,mi.l,e);return this.setHSL(r,n,i),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},toJSON:function(){return this.getHex()}}),gi.NAMES=di,Object.assign(bi.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(var e=0,r=t.vertexNormals.length;e<r;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(e=0,r=t.vertexColors.length;e<r;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}});var xi=0;function wi(){Object.defineProperty(this,"id",{value:xi++}),this.uuid=jr.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=w,this.side=g,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=D,this.blendDst=k,this.blendEquation=A,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=q,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Tr,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=pr,this.stencilZFail=pr,this.stencilZPass=pr,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Ei(t){wi.call(this),this.type="MeshBasicMaterial",this.color=new gi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=K,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}wi.prototype=Object.assign(Object.create(Dr.prototype),{constructor:wi,isMaterial:!0,onBeforeCompile:function(){},setValues:function(t){if(void 0!==t)for(var e in t){var r=t[e];if(void 0!==r)if("shading"!==e){var n=this[e];void 0!==n?n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[e]=r:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===_;else console.warn("THREE.Material: '"+e+"' parameter is undefined.")}},toJSON:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){var e=[];for(var r in t){var n=t[r];delete n.metadata,e.push(n)}return e}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(t).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(t).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(t).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(t).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(t).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,void 0!==this.combine&&(r.combine=this.combine),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(r.size=this.size),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==w&&(r.blending=this.blending),!0===this.flatShading&&(r.flatShading=this.flatShading),this.side!==g&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(r.morphTargets=!0),!0===this.morphNormals&&(r.morphNormals=!0),!0===this.skinning&&(r.skinning=!0),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),e){var i=n(t.textures),o=n(t.images);i.length>0&&(r.textures=i),o.length>0&&(r.images=o)}return r},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;var e=t.clippingPlanes,r=null;if(null!==e){var n=e.length;r=new Array(n);for(var i=0;i!==n;++i)r[i]=e[i].clone()}return this.clippingPlanes=r,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(wi.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Ei.prototype=Object.create(wi.prototype),Ei.prototype.constructor=Ei,Ei.prototype.isMeshBasicMaterial=!0,Ei.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};var Mi=new Qr;function Si(t,e,r){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===r,this.usage=Ar,this.updateRange={offset:0,count:-1},this.version=0}function Ti(t,e,r){Si.call(this,new Int8Array(t),e,r)}function Ai(t,e,r){Si.call(this,new Uint8Array(t),e,r)}function Ci(t,e,r){Si.call(this,new Uint8ClampedArray(t),e,r)}function Pi(t,e,r){Si.call(this,new Int16Array(t),e,r)}function Oi(t,e,r){Si.call(this,new Uint16Array(t),e,r)}function Ri(t,e,r){Si.call(this,new Int32Array(t),e,r)}function Li(t,e,r){Si.call(this,new Uint32Array(t),e,r)}function Ii(t,e,r){Si.call(this,new Float32Array(t),e,r)}function Ni(t,e,r){Si.call(this,new Float64Array(t),e,r)}function Bi(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Di(t){if(0===t.length)return-1/0;let e=t[0];for(let r=1,n=t.length;r<n;++r)t[r]>e&&(e=t[r]);return e}Object.defineProperty(Si.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Si.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,r){t*=this.itemSize,r*=e.itemSize;for(var n=0,i=this.itemSize;n<i;n++)this.array[t+n]=e.array[r+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),o=new gi),e[r++]=o.r,e[r++]=o.g,e[r++]=o.b}return this},copyVector2sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),o=new Gr),e[r++]=o.x,e[r++]=o.y}return this},copyVector3sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),o=new Qr),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z}return this},copyVector4sArray:function(t){for(var e=this.array,r=0,n=0,i=t.length;n<i;n++){var o=t[n];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),o=new qr),e[r++]=o.x,e[r++]=o.y,e[r++]=o.z,e[r++]=o.w}return this},applyMatrix3:function(t){for(var e=0,r=this.count;e<r;e++)Mi.x=this.getX(e),Mi.y=this.getY(e),Mi.z=this.getZ(e),Mi.applyMatrix3(t),this.setXYZ(e,Mi.x,Mi.y,Mi.z);return this},applyMatrix4:function(t){for(var e=0,r=this.count;e<r;e++)Mi.x=this.getX(e),Mi.y=this.getY(e),Mi.z=this.getZ(e),Mi.applyMatrix4(t),this.setXYZ(e,Mi.x,Mi.y,Mi.z);return this},applyNormalMatrix:function(t){for(var e=0,r=this.count;e<r;e++)Mi.x=this.getX(e),Mi.y=this.getY(e),Mi.z=this.getZ(e),Mi.applyNormalMatrix(t),this.setXYZ(e,Mi.x,Mi.y,Mi.z);return this},transformDirection:function(t){for(var e=0,r=this.count;e<r;e++)Mi.x=this.getX(e),Mi.y=this.getY(e),Mi.z=this.getZ(e),Mi.transformDirection(t),this.setXYZ(e,Mi.x,Mi.y,Mi.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this},setXYZ:function(t,e,r,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=n,this.array[t+3]=i,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),Ti.prototype=Object.create(Si.prototype),Ti.prototype.constructor=Ti,Ai.prototype=Object.create(Si.prototype),Ai.prototype.constructor=Ai,Ci.prototype=Object.create(Si.prototype),Ci.prototype.constructor=Ci,Pi.prototype=Object.create(Si.prototype),Pi.prototype.constructor=Pi,Oi.prototype=Object.create(Si.prototype),Oi.prototype.constructor=Oi,Ri.prototype=Object.create(Si.prototype),Ri.prototype.constructor=Ri,Li.prototype=Object.create(Si.prototype),Li.prototype.constructor=Li,Ii.prototype=Object.create(Si.prototype),Ii.prototype.constructor=Ii,Ni.prototype=Object.create(Si.prototype),Ni.prototype.constructor=Ni,Object.assign(Bi.prototype,{computeGroups:function(t){for(var e,r=[],n=void 0,i=t.faces,o=0;o<i.length;o++){var a=i[o];a.materialIndex!==n&&(n=a.materialIndex,void 0!==e&&(e.count=3*o-e.start,r.push(e)),e={start:3*o,materialIndex:n})}void 0!==e&&(e.count=3*o-e.start,r.push(e)),this.groups=r},fromGeometry:function(t){var e,r=t.faces,n=t.vertices,i=t.faceVertexUvs,o=i[0]&&i[0].length>0,a=i[1]&&i[1].length>0,s=t.morphTargets,l=s.length;if(l>0){e=[];for(var c=0;c<l;c++)e[c]={name:s[c].name,data:[]};this.morphTargets.position=e}var u,h=t.morphNormals,p=h.length;if(p>0){u=[];for(c=0;c<p;c++)u[c]={name:h[c].name,data:[]};this.morphTargets.normal=u}var d=t.skinIndices,f=t.skinWeights,m=d.length===n.length,g=f.length===n.length;n.length>0&&0===r.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(c=0;c<r.length;c++){var v=r[c];this.vertices.push(n[v.a],n[v.b],n[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var _=v.normal;this.normals.push(_,_,_)}var b,x=v.vertexColors;if(3===x.length)this.colors.push(x[0],x[1],x[2]);else{var w=v.color;this.colors.push(w,w,w)}if(!0===o)void 0!==(b=i[0][c])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new Gr,new Gr,new Gr));if(!0===a)void 0!==(b=i[1][c])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new Gr,new Gr,new Gr));for(var E=0;E<l;E++){var M=s[E].vertices;e[E].data.push(M[v.a],M[v.b],M[v.c])}for(E=0;E<p;E++){var S=h[E].vertexNormals[c];u[E].data.push(S.a,S.b,S.c)}m&&this.skinIndices.push(d[v.a],d[v.b],d[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});var ki=1,Ui=new sn,Fi=new Sn,ji=new Qr,Gi=new jn,zi=new jn,Vi=new Qr;function Hi(){Object.defineProperty(this,"id",{value:ki+=2}),this.uuid=jr.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Hi.prototype=Object.assign(Object.create(Dr.prototype),{constructor:Hi,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(Di(t)>65535?Li:Oi)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,r){this.groups.push({start:t,count:e,materialIndex:void 0!==r?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){var e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);var r=this.attributes.normal;if(void 0!==r){var n=(new zr).getNormalMatrix(t);r.applyNormalMatrix(n),r.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Ui.makeRotationX(t),this.applyMatrix4(Ui),this},rotateY:function(t){return Ui.makeRotationY(t),this.applyMatrix4(Ui),this},rotateZ:function(t){return Ui.makeRotationZ(t),this.applyMatrix4(Ui),this},translate:function(t,e,r){return Ui.makeTranslation(t,e,r),this.applyMatrix4(Ui),this},scale:function(t,e,r){return Ui.makeScale(t,e,r),this.applyMatrix4(Ui),this},lookAt:function(t){return Fi.lookAt(t),Fi.updateMatrix(),this.applyMatrix4(Fi.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ji).negate(),this.translate(ji.x,ji.y,ji.z),this},setFromObject:function(t){var e=t.geometry;if(t.isPoints||t.isLine){var r=new Ii(3*e.vertices.length,3),n=new Ii(3*e.colors.length,3);if(this.setAttribute("position",r.copyVector3sArray(e.vertices)),this.setAttribute("color",n.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){var i=new Ii(e.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Ii(e,3)),this},updateFromObject:function(t){var e,r=t.geometry;if(t.isMesh){var n=r.__directGeometry;if(!0===r.elementsNeedUpdate&&(n=void 0,r.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(r);n.verticesNeedUpdate=r.verticesNeedUpdate,n.normalsNeedUpdate=r.normalsNeedUpdate,n.colorsNeedUpdate=r.colorsNeedUpdate,n.uvsNeedUpdate=r.uvsNeedUpdate,n.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=n}return!0===r.verticesNeedUpdate&&(void 0!==(e=this.attributes.position)&&(e.copyVector3sArray(r.vertices),e.needsUpdate=!0),r.verticesNeedUpdate=!1),!0===r.normalsNeedUpdate&&(void 0!==(e=this.attributes.normal)&&(e.copyVector3sArray(r.normals),e.needsUpdate=!0),r.normalsNeedUpdate=!1),!0===r.colorsNeedUpdate&&(void 0!==(e=this.attributes.color)&&(e.copyColorsArray(r.colors),e.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&(void 0!==(e=this.attributes.uv)&&(e.copyVector2sArray(r.uvs),e.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&(void 0!==(e=this.attributes.lineDistance)&&(e.copyArray(r.lineDistances),e.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(t.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Bi).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){var e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new Si(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){var r=new Float32Array(3*t.normals.length);this.setAttribute("normal",new Si(r,3).copyVector3sArray(t.normals))}if(t.colors.length>0){var n=new Float32Array(3*t.colors.length);this.setAttribute("color",new Si(n,3).copyColorsArray(t.colors))}if(t.uvs.length>0){var i=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new Si(i,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){var o=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new Si(o,2).copyVector2sArray(t.uvs2))}for(var a in this.groups=t.groups,t.morphTargets){for(var s=[],l=t.morphTargets[a],c=0,u=l.length;c<u;c++){var h=l[c],p=new Ii(3*h.data.length,3);p.name=h.name,s.push(p.copyVector3sArray(h.data))}this.morphAttributes[a]=s}if(t.skinIndices.length>0){var d=new Ii(4*t.skinIndices.length,4);this.setAttribute("skinIndex",d.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){var f=new Ii(4*t.skinWeights.length,4);this.setAttribute("skinWeight",f.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new jn);var t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(var r=0,n=e.length;r<n;r++){var i=e[r];Gi.setFromBufferAttribute(i),this.morphTargetsRelative?(Vi.addVectors(this.boundingBox.min,Gi.min),this.boundingBox.expandByPoint(Vi),Vi.addVectors(this.boundingBox.max,Gi.max),this.boundingBox.expandByPoint(Vi)):(this.boundingBox.expandByPoint(Gi.min),this.boundingBox.expandByPoint(Gi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Vn);var t=this.attributes.position,e=this.morphAttributes.position;if(t){var r=this.boundingSphere.center;if(Gi.setFromBufferAttribute(t),e)for(var n=0,i=e.length;n<i;n++){var o=e[n];zi.setFromBufferAttribute(o),this.morphTargetsRelative?(Vi.addVectors(Gi.min,zi.min),Gi.expandByPoint(Vi),Vi.addVectors(Gi.max,zi.max),Gi.expandByPoint(Vi)):(Gi.expandByPoint(zi.min),Gi.expandByPoint(zi.max))}Gi.getCenter(r);var a=0;for(n=0,i=t.count;n<i;n++)Vi.fromBufferAttribute(t,n),a=Math.max(a,r.distanceToSquared(Vi));if(e)for(n=0,i=e.length;n<i;n++){o=e[n];for(var s=this.morphTargetsRelative,l=0,c=o.count;l<c;l++)Vi.fromBufferAttribute(o,l),s&&(ji.fromBufferAttribute(t,l),Vi.add(ji)),a=Math.max(a,r.distanceToSquared(Vi))}this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var t=this.index,e=this.attributes;if(e.position){var r=e.position.array;if(void 0===e.normal)this.setAttribute("normal",new Si(new Float32Array(r.length),3));else for(var n=e.normal.array,i=0,o=n.length;i<o;i++)n[i]=0;var a,s,l,c=e.normal.array,u=new Qr,h=new Qr,p=new Qr,d=new Qr,f=new Qr;if(t){var m=t.array;for(i=0,o=t.count;i<o;i+=3)a=3*m[i+0],s=3*m[i+1],l=3*m[i+2],u.fromArray(r,a),h.fromArray(r,s),p.fromArray(r,l),d.subVectors(p,h),f.subVectors(u,h),d.cross(f),c[a]+=d.x,c[a+1]+=d.y,c[a+2]+=d.z,c[s]+=d.x,c[s+1]+=d.y,c[s+2]+=d.z,c[l]+=d.x,c[l+1]+=d.y,c[l+2]+=d.z}else for(i=0,o=r.length;i<o;i+=9)u.fromArray(r,i),h.fromArray(r,i+3),p.fromArray(r,i+6),d.subVectors(p,h),f.subVectors(u,h),d.cross(f),c[i]=d.x,c[i+1]=d.y,c[i+2]=d.z,c[i+3]=d.x,c[i+4]=d.y,c[i+5]=d.z,c[i+6]=d.x,c[i+7]=d.y,c[i+8]=d.z;this.normalizeNormals(),e.normal.needsUpdate=!0}},merge:function(t,e){if(t&&t.isBufferGeometry){void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var n in r)if(void 0!==t.attributes[n])for(var i=r[n].array,o=t.attributes[n],a=o.array,s=o.itemSize*e,l=Math.min(a.length,i.length-s),c=0,u=s;c<l;c++,u++)i[u]=a[c];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t)},normalizeNormals:function(){for(var t=this.attributes.normal,e=0,r=t.count;e<r;e++)Vi.x=t.getX(e),Vi.y=t.getY(e),Vi.z=t.getZ(e),Vi.normalize(),t.setXYZ(e,Vi.x,Vi.y,Vi.z)},toNonIndexed:function(){function t(t,e){for(var r=t.array,n=t.itemSize,i=t.normalized,o=new r.constructor(e.length*n),a=0,s=0,l=0,c=e.length;l<c;l++){a=e[l]*n;for(var u=0;u<n;u++)o[s++]=r[a++]}return new Si(o,n,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new Hi,r=this.index.array,n=this.attributes;for(var i in n){var o=t(n[i],r);e.setAttribute(i,o)}var a=this.morphAttributes;for(i in a){for(var s=[],l=a[i],c=0,u=l.length;c<u;c++){o=t(l[c],r);s.push(o)}e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;for(var h=this.groups,p=(c=0,h.length);c<p;c++){var d=h[c];e.addGroup(d.start,d.count,d.materialIndex)}return e},toJSON:function(){var t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}t.data={attributes:{}};var n=this.index;null!==n&&(t.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});var i=this.attributes;for(var r in i){var o=(p=i[r]).toJSON();""!==p.name&&(o.name=p.name),t.data.attributes[r]=o}var a={},s=!1;for(var r in this.morphAttributes){for(var l=this.morphAttributes[r],c=[],u=0,h=l.length;u<h;u++){var p;o=(p=l[u]).toJSON();""!==p.name&&(o.name=p.name),c.push(o)}c.length>0&&(a[r]=c,s=!0)}s&&(t.data.morphAttributes=a,t.data.morphTargetsRelative=this.morphTargetsRelative);var d=this.groups;d.length>0&&(t.data.groups=JSON.parse(JSON.stringify(d)));var f=this.boundingSphere;return null!==f&&(t.data.boundingSphere={center:f.center.toArray(),radius:f.radius}),t},clone:function(){return(new Hi).copy(this)},copy:function(t){var e,r,n;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var i=t.index;null!==i&&this.setIndex(i.clone());var o=t.attributes;for(e in o){var a=o[e];this.setAttribute(e,a.clone())}var s=t.morphAttributes;for(e in s){var l=[],c=s[e];for(r=0,n=c.length;r<n;r++)l.push(c[r].clone());this.morphAttributes[e]=l}this.morphTargetsRelative=t.morphTargetsRelative;var u=t.groups;for(r=0,n=u.length;r<n;r++){var h=u[r];this.addGroup(h.start,h.count,h.materialIndex)}var p=t.boundingBox;null!==p&&(this.boundingBox=p.clone());var d=t.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Wi=new sn,qi=new Kn,Yi=new Vn,Xi=new Qr,Ji=new Qr,Zi=new Qr,Ki=new Qr,Qi=new Qr,$i=new Qr,to=new Qr,eo=new Qr,ro=new Qr,no=new Gr,io=new Gr,oo=new Gr,ao=new Qr,so=new Qr;function lo(t,e){Sn.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Hi,this.material=void 0!==e?e:new Ei,this.updateMorphTargets()}function co(t,e,r,n,i,o,a,s){if(null===(e.side===v?n.intersectTriangle(a,o,i,!0,s):n.intersectTriangle(i,o,a,e.side!==y,s)))return null;so.copy(s),so.applyMatrix4(t.matrixWorld);var l=r.ray.origin.distanceTo(so);return l<r.near||l>r.far?null:{distance:l,point:so.clone(),object:t}}function uo(t,e,r,n,i,o,a,s,l,c,u,h){Xi.fromBufferAttribute(i,c),Ji.fromBufferAttribute(i,u),Zi.fromBufferAttribute(i,h);var p=t.morphTargetInfluences;if(e.morphTargets&&o&&p){to.set(0,0,0),eo.set(0,0,0),ro.set(0,0,0);for(var d=0,f=o.length;d<f;d++){var m=p[d],g=o[d];0!==m&&(Ki.fromBufferAttribute(g,c),Qi.fromBufferAttribute(g,u),$i.fromBufferAttribute(g,h),a?(to.addScaledVector(Ki,m),eo.addScaledVector(Qi,m),ro.addScaledVector($i,m)):(to.addScaledVector(Ki.sub(Xi),m),eo.addScaledVector(Qi.sub(Ji),m),ro.addScaledVector($i.sub(Zi),m)))}Xi.add(to),Ji.add(eo),Zi.add(ro)}t.isSkinnedMesh&&(t.boneTransform(c,Xi),t.boneTransform(u,Ji),t.boneTransform(h,Zi));var v=co(t,e,r,n,Xi,Ji,Zi,ao);if(v){s&&(no.fromBufferAttribute(s,c),io.fromBufferAttribute(s,u),oo.fromBufferAttribute(s,h),v.uv=pi.getUV(ao,Xi,Ji,Zi,no,io,oo,new Gr)),l&&(no.fromBufferAttribute(l,c),io.fromBufferAttribute(l,u),oo.fromBufferAttribute(l,h),v.uv2=pi.getUV(ao,Xi,Ji,Zi,no,io,oo,new Gr));var y=new bi(c,u,h);pi.getNormal(Xi,Ji,Zi,y.normal),v.face=y}return v}lo.prototype=Object.assign(Object.create(Sn.prototype),{constructor:lo,isMesh:!0,copy:function(t){return Sn.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)r=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){var r,n=this.geometry,i=this.material,o=this.matrixWorld;if(void 0!==i&&(null===n.boundingSphere&&n.computeBoundingSphere(),Yi.copy(n.boundingSphere),Yi.applyMatrix4(o),!1!==t.ray.intersectsSphere(Yi)&&(Wi.getInverse(o),qi.copy(t.ray).applyMatrix4(Wi),null===n.boundingBox||!1!==qi.intersectsBox(n.boundingBox))))if(n.isBufferGeometry){var a,s,l,c,u,h,p,d,f,m=n.index,g=n.attributes.position,v=n.morphAttributes.position,y=n.morphTargetsRelative,_=n.attributes.uv,b=n.attributes.uv2,x=n.groups,w=n.drawRange;if(null!==m)if(Array.isArray(i))for(c=0,h=x.length;c<h;c++)for(f=i[(d=x[c]).materialIndex],u=Math.max(d.start,w.start),p=Math.min(d.start+d.count,w.start+w.count);u<p;u+=3)a=m.getX(u),s=m.getX(u+1),l=m.getX(u+2),(r=uo(this,f,t,qi,g,v,y,_,b,a,s,l))&&(r.faceIndex=Math.floor(u/3),r.face.materialIndex=d.materialIndex,e.push(r));else for(c=Math.max(0,w.start),h=Math.min(m.count,w.start+w.count);c<h;c+=3)a=m.getX(c),s=m.getX(c+1),l=m.getX(c+2),(r=uo(this,i,t,qi,g,v,y,_,b,a,s,l))&&(r.faceIndex=Math.floor(c/3),e.push(r));else if(void 0!==g)if(Array.isArray(i))for(c=0,h=x.length;c<h;c++)for(f=i[(d=x[c]).materialIndex],u=Math.max(d.start,w.start),p=Math.min(d.start+d.count,w.start+w.count);u<p;u+=3)(r=uo(this,f,t,qi,g,v,y,_,b,a=u,s=u+1,l=u+2))&&(r.faceIndex=Math.floor(u/3),r.face.materialIndex=d.materialIndex,e.push(r));else for(c=Math.max(0,w.start),h=Math.min(g.count,w.start+w.count);c<h;c+=3)(r=uo(this,i,t,qi,g,v,y,_,b,a=c,s=c+1,l=c+2))&&(r.faceIndex=Math.floor(c/3),e.push(r))}else if(n.isGeometry){var E,M,S,T,A=Array.isArray(i),C=n.vertices,P=n.faces,O=n.faceVertexUvs[0];O.length>0&&(T=O);for(var R=0,L=P.length;R<L;R++){var I=P[R],N=A?i[I.materialIndex]:i;if(void 0!==N&&(E=C[I.a],M=C[I.b],S=C[I.c],r=co(this,N,t,qi,E,M,S,ao))){if(T&&T[R]){var B=T[R];no.copy(B[0]),io.copy(B[1]),oo.copy(B[2]),r.uv=pi.getUV(ao,E,M,S,no,io,oo,new Gr)}r.face=I,r.faceIndex=R,e.push(r)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var ho=0,po=new sn,fo=new Sn,mo=new Qr;function go(){Object.defineProperty(this,"id",{value:ho+=2}),this.uuid=jr.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}go.prototype=Object.assign(Object.create(Dr.prototype),{constructor:go,isGeometry:!0,applyMatrix4:function(t){for(var e=(new zr).getNormalMatrix(t),r=0,n=this.vertices.length;r<n;r++){this.vertices[r].applyMatrix4(t)}for(r=0,n=this.faces.length;r<n;r++){var i=this.faces[r];i.normal.applyMatrix3(e).normalize();for(var o=0,a=i.vertexNormals.length;o<a;o++)i.vertexNormals[o].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return po.makeRotationX(t),this.applyMatrix4(po),this},rotateY:function(t){return po.makeRotationY(t),this.applyMatrix4(po),this},rotateZ:function(t){return po.makeRotationZ(t),this.applyMatrix4(po),this},translate:function(t,e,r){return po.makeTranslation(t,e,r),this.applyMatrix4(po),this},scale:function(t,e,r){return po.makeScale(t,e,r),this.applyMatrix4(po),this},lookAt:function(t){return fo.lookAt(t),fo.updateMatrix(),this.applyMatrix4(fo.matrix),this},fromBufferGeometry:function(t){var e=this,r=null!==t.index?t.index.array:void 0,n=t.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=n.position.array,o=void 0!==n.normal?n.normal.array:void 0,a=void 0!==n.color?n.color.array:void 0,s=void 0!==n.uv?n.uv.array:void 0,l=void 0!==n.uv2?n.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var c=0;c<i.length;c+=3)e.vertices.push((new Qr).fromArray(i,c)),void 0!==a&&e.colors.push((new gi).fromArray(a,c));function u(t,r,n,i){var c=void 0===a?[]:[e.colors[t].clone(),e.colors[r].clone(),e.colors[n].clone()],u=new bi(t,r,n,void 0===o?[]:[(new Qr).fromArray(o,3*t),(new Qr).fromArray(o,3*r),(new Qr).fromArray(o,3*n)],c,i);e.faces.push(u),void 0!==s&&e.faceVertexUvs[0].push([(new Gr).fromArray(s,2*t),(new Gr).fromArray(s,2*r),(new Gr).fromArray(s,2*n)]),void 0!==l&&e.faceVertexUvs[1].push([(new Gr).fromArray(l,2*t),(new Gr).fromArray(l,2*r),(new Gr).fromArray(l,2*n)])}var h=t.groups;if(h.length>0)for(c=0;c<h.length;c++)for(var p=h[c],d=p.start,f=d,m=d+p.count;f<m;f+=3)void 0!==r?u(r[f],r[f+1],r[f+2],p.materialIndex):u(f,f+1,f+2,p.materialIndex);else if(void 0!==r)for(c=0;c<r.length;c+=3)u(r[c],r[c+1],r[c+2]);else for(c=0;c<i.length/3;c+=3)u(c,c+1,c+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(mo).negate(),this.translate(mo.x,mo.y,mo.z),this},normalize:function(){this.computeBoundingSphere();var t=this.boundingSphere.center,e=this.boundingSphere.radius,r=0===e?1:1/e,n=new sn;return n.set(r,0,0,-r*t.x,0,r,0,-r*t.y,0,0,r,-r*t.z,0,0,0,1),this.applyMatrix4(n),this},computeFaceNormals:function(){for(var t=new Qr,e=new Qr,r=0,n=this.faces.length;r<n;r++){var i=this.faces[r],o=this.vertices[i.a],a=this.vertices[i.b],s=this.vertices[i.c];t.subVectors(s,a),e.subVectors(o,a),t.cross(e),t.normalize(),i.normal.copy(t)}},computeVertexNormals:function(t){var e,r,n,i,o,a;for(void 0===t&&(t=!0),a=new Array(this.vertices.length),e=0,r=this.vertices.length;e<r;e++)a[e]=new Qr;if(t){var s,l,c,u=new Qr,h=new Qr;for(n=0,i=this.faces.length;n<i;n++)o=this.faces[n],s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],u.subVectors(c,l),h.subVectors(s,l),u.cross(h),a[o.a].add(u),a[o.b].add(u),a[o.c].add(u)}else for(this.computeFaceNormals(),n=0,i=this.faces.length;n<i;n++)a[(o=this.faces[n]).a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(e=0,r=this.vertices.length;e<r;e++)a[e].normalize();for(n=0,i=this.faces.length;n<i;n++){var p=(o=this.faces[n]).vertexNormals;3===p.length?(p[0].copy(a[o.a]),p[1].copy(a[o.b]),p[2].copy(a[o.c])):(p[0]=a[o.a].clone(),p[1]=a[o.b].clone(),p[2]=a[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var t,e,r;for(this.computeFaceNormals(),t=0,e=this.faces.length;t<e;t++){var n=(r=this.faces[t]).vertexNormals;3===n.length?(n[0].copy(r.normal),n[1].copy(r.normal),n[2].copy(r.normal)):(n[0]=r.normal.clone(),n[1]=r.normal.clone(),n[2]=r.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var t,e,r,n,i;for(r=0,n=this.faces.length;r<n;r++)for((i=this.faces[r]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),t=0,e=i.vertexNormals.length;t<e;t++)i.__originalVertexNormals[t]?i.__originalVertexNormals[t].copy(i.vertexNormals[t]):i.__originalVertexNormals[t]=i.vertexNormals[t].clone();var o=new go;for(o.faces=this.faces,t=0,e=this.morphTargets.length;t<e;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];var a=this.morphNormals[t].faceNormals,s=this.morphNormals[t].vertexNormals;for(r=0,n=this.faces.length;r<n;r++)l=new Qr,c={a:new Qr,b:new Qr,c:new Qr},a.push(l),s.push(c)}var l,c,u=this.morphNormals[t];for(o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0,n=this.faces.length;r<n;r++)i=this.faces[r],l=u.faceNormals[r],c=u.vertexNormals[r],l.copy(i.normal),c.a.copy(i.vertexNormals[0]),c.b.copy(i.vertexNormals[1]),c.c.copy(i.vertexNormals[2])}for(r=0,n=this.faces.length;r<n;r++)(i=this.faces[r]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new jn),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Vn),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,r){if(t&&t.isGeometry){var n,i=this.vertices.length,o=this.vertices,a=t.vertices,s=this.faces,l=t.faces,c=this.colors,u=t.colors;void 0===r&&(r=0),void 0!==e&&(n=(new zr).getNormalMatrix(e));for(var h=0,p=a.length;h<p;h++){var d=a[h].clone();void 0!==e&&d.applyMatrix4(e),o.push(d)}for(h=0,p=u.length;h<p;h++)c.push(u[h].clone());for(h=0,p=l.length;h<p;h++){var f,m,g,v=l[h],y=v.vertexNormals,_=v.vertexColors;(f=new bi(v.a+i,v.b+i,v.c+i)).normal.copy(v.normal),void 0!==n&&f.normal.applyMatrix3(n).normalize();for(var b=0,x=y.length;b<x;b++)m=y[b].clone(),void 0!==n&&m.applyMatrix3(n).normalize(),f.vertexNormals.push(m);f.color.copy(v.color);for(b=0,x=_.length;b<x;b++)g=_[b],f.vertexColors.push(g.clone());f.materialIndex=v.materialIndex+r,s.push(f)}for(h=0,p=t.faceVertexUvs.length;h<p;h++){var w=t.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(b=0,x=w.length;b<x;b++){for(var E=w[b],M=[],S=0,T=E.length;S<T;S++)M.push(E[S].clone());this.faceVertexUvs[h].push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t)},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){var t,e,r,n,i,o,a,s,l={},c=[],u=[],h=Math.pow(10,4);for(r=0,n=this.vertices.length;r<n;r++)t=this.vertices[r],void 0===l[e=Math.round(t.x*h)+"_"+Math.round(t.y*h)+"_"+Math.round(t.z*h)]?(l[e]=r,c.push(this.vertices[r]),u[r]=c.length-1):u[r]=u[l[e]];var p=[];for(r=0,n=this.faces.length;r<n;r++){(i=this.faces[r]).a=u[i.a],i.b=u[i.b],i.c=u[i.c],o=[i.a,i.b,i.c];for(var d=0;d<3;d++)if(o[d]===o[(d+1)%3]){p.push(r);break}}for(r=p.length-1;r>=0;r--){var f=p[r];for(this.faces.splice(f,1),a=0,s=this.faceVertexUvs.length;a<s;a++)this.faceVertexUvs[a].splice(f,1)}var m=this.vertices.length-c.length;return this.vertices=c,m},setFromPoints:function(t){this.vertices=[];for(var e=0,r=t.length;e<r;e++){var n=t[e];this.vertices.push(new Qr(n.x,n.y,n.z||0))}return this},sortFacesByMaterialIndex:function(){for(var t=this.faces,e=t.length,r=0;r<e;r++)t[r]._id=r;t.sort((function(t,e){return t.materialIndex-e.materialIndex}));var n,i,o=this.faceVertexUvs[0],a=this.faceVertexUvs[1];o&&o.length===e&&(n=[]),a&&a.length===e&&(i=[]);for(r=0;r<e;r++){var s=t[r]._id;n&&n.push(o[s]),i&&i.push(a[s])}n&&(this.faceVertexUvs[0]=n),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var r in e)void 0!==e[r]&&(t[r]=e[r]);return t}for(var n=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];n.push(o.x,o.y,o.z)}var a=[],s=[],l={},c=[],u={},h=[],p={};for(i=0;i<this.faces.length;i++){var d=this.faces[i],f=void 0!==this.faceVertexUvs[0][i],m=d.normal.length()>0,g=d.vertexNormals.length>0,v=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=d.vertexColors.length>0,_=0;if(_=E(_,0,0),_=E(_,1,!0),_=E(_,2,!1),_=E(_,3,f),_=E(_,4,m),_=E(_,5,g),_=E(_,6,v),_=E(_,7,y),a.push(_),a.push(d.a,d.b,d.c),a.push(d.materialIndex),f){var b=this.faceVertexUvs[0][i];a.push(T(b[0]),T(b[1]),T(b[2]))}if(m&&a.push(M(d.normal)),g){var x=d.vertexNormals;a.push(M(x[0]),M(x[1]),M(x[2]))}if(v&&a.push(S(d.color)),y){var w=d.vertexColors;a.push(S(w[0]),S(w[1]),S(w[2]))}}function E(t,e,r){return r?t|1<<e:t&~(1<<e)}function M(t){var e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==l[e]||(l[e]=s.length/3,s.push(t.x,t.y,t.z)),l[e]}function S(t){var e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==u[e]||(u[e]=c.length,c.push(t.getHex())),u[e]}function T(t){var e=t.x.toString()+t.y.toString();return void 0!==p[e]||(p[e]=h.length/2,h.push(t.x,t.y)),p[e]}return t.data={},t.data.vertices=n,t.data.normals=s,c.length>0&&(t.data.colors=c),h.length>0&&(t.data.uvs=[h]),t.data.faces=a,t},clone:function(){return(new go).copy(this)},copy:function(t){var e,r,n,i,o,a;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;var s=t.vertices;for(e=0,r=s.length;e<r;e++)this.vertices.push(s[e].clone());var l=t.colors;for(e=0,r=l.length;e<r;e++)this.colors.push(l[e].clone());var c=t.faces;for(e=0,r=c.length;e<r;e++)this.faces.push(c[e].clone());for(e=0,r=t.faceVertexUvs.length;e<r;e++){var u=t.faceVertexUvs[e];for(void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]),n=0,i=u.length;n<i;n++){var h=u[n],p=[];for(o=0,a=h.length;o<a;o++){var d=h[o];p.push(d.clone())}this.faceVertexUvs[e].push(p)}}var f=t.morphTargets;for(e=0,r=f.length;e<r;e++){var m={};if(m.name=f[e].name,void 0!==f[e].vertices)for(m.vertices=[],n=0,i=f[e].vertices.length;n<i;n++)m.vertices.push(f[e].vertices[n].clone());if(void 0!==f[e].normals)for(m.normals=[],n=0,i=f[e].normals.length;n<i;n++)m.normals.push(f[e].normals[n].clone());this.morphTargets.push(m)}var g=t.morphNormals;for(e=0,r=g.length;e<r;e++){var v={};if(void 0!==g[e].vertexNormals)for(v.vertexNormals=[],n=0,i=g[e].vertexNormals.length;n<i;n++){var y=g[e].vertexNormals[n],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),v.vertexNormals.push(_)}if(void 0!==g[e].faceNormals)for(v.faceNormals=[],n=0,i=g[e].faceNormals.length;n<i;n++)v.faceNormals.push(g[e].faceNormals[n].clone());this.morphNormals.push(v)}var b=t.skinWeights;for(e=0,r=b.length;e<r;e++)this.skinWeights.push(b[e].clone());var x=t.skinIndices;for(e=0,r=x.length;e<r;e++)this.skinIndices.push(x[e].clone());var w=t.lineDistances;for(e=0,r=w.length;e<r;e++)this.lineDistances.push(w[e]);var E=t.boundingBox;null!==E&&(this.boundingBox=E.clone());var M=t.boundingSphere;return null!==M&&(this.boundingSphere=M.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class vo extends go{constructor(t,e,r,n,i,o){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new yo(t,e,r,n,i,o)),this.mergeVertices()}}class yo extends Hi{constructor(t,e,r,n,i,o){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:r,widthSegments:n,heightSegments:i,depthSegments:o};const a=this;t=t||1,e=e||1,r=r||1,n=Math.floor(n)||1,i=Math.floor(i)||1,o=Math.floor(o)||1;const s=[],l=[],c=[],u=[];let h=0,p=0;function d(t,e,r,n,i,o,d,f,m,g,v){const y=o/m,_=d/g,b=o/2,x=d/2,w=f/2,E=m+1,M=g+1;let S=0,T=0;const A=new Qr;for(let o=0;o<M;o++){const a=o*_-x;for(let s=0;s<E;s++){const h=s*y-b;A[t]=h*n,A[e]=a*i,A[r]=w,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[r]=f>0?1:-1,c.push(A.x,A.y,A.z),u.push(s/m),u.push(1-o/g),S+=1}}for(let t=0;t<g;t++)for(let e=0;e<m;e++){const r=h+e+E*t,n=h+e+E*(t+1),i=h+(e+1)+E*(t+1),o=h+(e+1)+E*t;s.push(r,n,o),s.push(n,i,o),T+=6}a.addGroup(p,T,v),p+=T,h+=S}d("z","y","x",-1,-1,r,e,t,o,i,0),d("z","y","x",1,-1,r,e,-t,o,i,1),d("x","z","y",1,1,t,r,e,n,o,2),d("x","z","y",1,-1,t,r,-e,n,o,3),d("x","y","z",1,-1,t,e,r,n,i,4),d("x","y","z",-1,-1,t,e,-r,n,i,5),this.setIndex(s),this.setAttribute("position",new Ii(l,3)),this.setAttribute("normal",new Ii(c,3)),this.setAttribute("uv",new Ii(u,2))}}function _o(t){var e={};for(var r in t)for(var n in e[r]={},t[r]){var i=t[r][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?e[r][n]=i.clone():Array.isArray(i)?e[r][n]=i.slice():e[r][n]=i}return e}function bo(t){for(var e={},r=0;r<t.length;r++){var n=_o(t[r]);for(var i in n)e[i]=n[i]}return e}var xo={clone:_o,merge:bo};function wo(t){wi.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Eo(){Sn.call(this),this.type="Camera",this.matrixWorldInverse=new sn,this.projectionMatrix=new sn,this.projectionMatrixInverse=new sn}function Mo(t,e,r,n){Eo.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==r?r:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}wo.prototype=Object.create(wi.prototype),wo.prototype.constructor=wo,wo.prototype.isShaderMaterial=!0,wo.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=_o(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this},wo.prototype.toJSON=function(t){var e=wi.prototype.toJSON.call(this,t);for(var r in e.uniforms={},this.uniforms){var n=this.uniforms[r].value;n&&n.isTexture?e.uniforms[r]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[r]={type:"m4",value:n.toArray()}:e.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(e.extensions=i),e},Eo.prototype=Object.assign(Object.create(Sn.prototype),{constructor:Eo,isCamera:!0,copy:function(t,e){return Sn.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new Qr),this.updateMatrixWorld(!0);var e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){Sn.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){Sn.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Mo.prototype=Object.assign(Object.create(Eo.prototype),{constructor:Mo,isPerspectiveCamera:!0,copy:function(t,e){return Eo.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){var e=.5*this.getFilmHeight()/t;this.fov=2*jr.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){var t=Math.tan(.5*jr.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*jr.RAD2DEG*Math.atan(Math.tan(.5*jr.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,r,n,i,o){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=this.near,e=t*Math.tan(.5*jr.DEG2RAD*this.fov)/this.zoom,r=2*e,n=this.aspect*r,i=-.5*n,o=this.view;if(null!==this.view&&this.view.enabled){var a=o.fullWidth,s=o.fullHeight;i+=o.offsetX*n/a,e-=o.offsetY*r/s,n*=o.width/a,r*=o.height/s}var l=this.filmOffset;0!==l&&(i+=t*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+n,e,e-r,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=Sn.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});var So=90;function To(t,e,r){if(Sn.call(this),this.type="CubeCamera",!0===r.isWebGLCubeRenderTarget){this.renderTarget=r;var n=new Mo(So,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Qr(1,0,0)),this.add(n);var i=new Mo(So,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Qr(-1,0,0)),this.add(i);var o=new Mo(So,1,t,e);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new Qr(0,1,0)),this.add(o);var a=new Mo(So,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new Qr(0,-1,0)),this.add(a);var s=new Mo(So,1,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Qr(0,0,1)),this.add(s);var l=new Mo(So,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Qr(0,0,-1)),this.add(l),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();var c=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;var h=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,t.setRenderTarget(r,0),t.render(e,n),t.setRenderTarget(r,1),t.render(e,i),t.setRenderTarget(r,2),t.render(e,o),t.setRenderTarget(r,3),t.render(e,a),t.setRenderTarget(r,4),t.render(e,s),r.texture.generateMipmaps=h,t.setRenderTarget(r,5),t.render(e,l),t.setRenderTarget(u),t.xr.enabled=c},this.clear=function(t,e,n,i){for(var o=t.getRenderTarget(),a=0;a<6;a++)t.setRenderTarget(r,a),t.clear(e,n,i);t.setRenderTarget(o)}}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}function Ao(t,e,r){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=r),Yr.call(this,t,t,e)}function Co(t,e,r,n,i,o,a,s,l,c,u,h){Wr.call(this,null,o,a,s,l,c,n,i,u,h),this.image={data:t||null,width:e||1,height:r||1},this.magFilter=void 0!==l?l:vt,this.minFilter=void 0!==c?c:vt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}To.prototype=Object.create(Sn.prototype),To.prototype.constructor=To,Ao.prototype=Object.create(Yr.prototype),Ao.prototype.constructor=Ao,Ao.prototype.isWebGLCubeRenderTarget=!0,Ao.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;var r=new Tn,n={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#include <common>","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV = equirectUv( direction );","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new wo({type:"CubemapFromEquirect",uniforms:_o(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:v,blending:x});i.uniforms.tEquirect.value=e;var o=new lo(new yo(5,5,5),i);return r.add(o),new To(1,10,this).update(t,r),o.geometry.dispose(),o.material.dispose(),this},Co.prototype=Object.create(Wr.prototype),Co.prototype.constructor=Co,Co.prototype.isDataTexture=!0;var Po=new Vn,Oo=new Qr;function Ro(t,e,r,n,i,o){this.planes=[void 0!==t?t:new ei,void 0!==e?e:new ei,void 0!==r?r:new ei,void 0!==n?n:new ei,void 0!==i?i:new ei,void 0!==o?o:new ei]}Object.assign(Ro.prototype,{set:function(t,e,r,n,i,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(r),a[3].copy(n),a[4].copy(i),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,r=0;r<6;r++)e[r].copy(t.planes[r]);return this},setFromProjectionMatrix:function(t){var e=this.planes,r=t.elements,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],u=r[7],h=r[8],p=r[9],d=r[10],f=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return e[0].setComponents(a-n,u-s,f-h,y-m).normalize(),e[1].setComponents(a+n,u+s,f+h,y+m).normalize(),e[2].setComponents(a+i,u+l,f+p,y+g).normalize(),e[3].setComponents(a-i,u-l,f-p,y-g).normalize(),e[4].setComponents(a-o,u-c,f-d,y-v).normalize(),e[5].setComponents(a+o,u+c,f+d,y+v).normalize(),this},intersectsObject:function(t){var e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),Po.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Po)},intersectsSprite:function(t){return Po.center.set(0,0,0),Po.radius=.7071067811865476,Po.applyMatrix4(t.matrixWorld),this.intersectsSphere(Po)},intersectsSphere:function(t){for(var e=this.planes,r=t.center,n=-t.radius,i=0;i<6;i++){if(e[i].distanceToPoint(r)<n)return!1}return!0},intersectsBox:function(t){for(var e=this.planes,r=0;r<6;r++){var n=e[r];if(Oo.x=n.normal.x>0?t.max.x:t.min.x,Oo.y=n.normal.y>0?t.max.y:t.min.y,Oo.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Oo)<0)return!1}return!0},containsPoint:function(t){for(var e=this.planes,r=0;r<6;r++)if(e[r].distanceToPoint(t)<0)return!1;return!0}});var Lo={common:{diffuse:{value:new gi(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new zr},uv2Transform:{value:new zr},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Gr(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new gi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new gi(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new zr}},sprite:{diffuse:{value:new gi(15658734)},opacity:{value:1},center:{value:new Gr(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new zr}}};function Io(){var t=null,e=!1,r=null;function n(i,o){!1!==e&&(r(i,o),t.requestAnimationFrame(n))}return{start:function(){!0!==e&&null!==r&&(t.requestAnimationFrame(n),e=!0)},stop:function(){e=!1},setAnimationLoop:function(t){r=t},setContext:function(e){t=e}}}function No(t,e){var r=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);var r=n.get(e);r&&(t.deleteBuffer(r.buffer),n.delete(e))},update:function(e,i){e.isInterleavedBufferAttribute&&(e=e.data);var o=n.get(e);void 0===o?n.set(e,function(e,r){var n=e.array,i=e.usage,o=t.createBuffer();t.bindBuffer(r,o),t.bufferData(r,n,i),e.onUploadCallback();var a=5126;return n instanceof Float32Array?a=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?a=5123:n instanceof Int16Array?a=5122:n instanceof Uint32Array?a=5125:n instanceof Int32Array?a=5124:n instanceof Int8Array?a=5120:n instanceof Uint8Array&&(a=5121),{buffer:o,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(e,i)):o.version<e.version&&(!function(e,n,i){var o=n.array,a=n.updateRange;t.bindBuffer(i,e),-1===a.count?t.bufferSubData(i,0,o):(r?t.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o,a.offset,a.count):t.bufferSubData(i,a.offset*o.BYTES_PER_ELEMENT,o.subarray(a.offset,a.offset+a.count)),a.count=-1)}(o.buffer,e,i),o.version=e.version)}}}function Bo(t,e,r,n){go.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n},this.fromBufferGeometry(new Do(t,e,r,n)),this.mergeVertices()}function Do(t,e,r,n){Hi.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:r,heightSegments:n};var i,o,a=(t=t||1)/2,s=(e=e||1)/2,l=Math.floor(r)||1,c=Math.floor(n)||1,u=l+1,h=c+1,p=t/l,d=e/c,f=[],m=[],g=[],v=[];for(o=0;o<h;o++){var y=o*d-s;for(i=0;i<u;i++){var _=i*p-a;m.push(_,-y,0),g.push(0,0,1),v.push(i/l),v.push(1-o/c)}}for(o=0;o<c;o++)for(i=0;i<l;i++){var b=i+u*o,x=i+u*(o+1),w=i+1+u*(o+1),E=i+1+u*o;f.push(b,x,E),f.push(x,w,E)}this.setIndex(f),this.setAttribute("position",new Ii(m,3)),this.setAttribute("normal",new Ii(g,3)),this.setAttribute("uv",new Ii(v,2))}Bo.prototype=Object.create(go.prototype),Bo.prototype.constructor=Bo,Do.prototype=Object.create(Hi.prototype),Do.prototype.constructor=Do;var ko={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {\n      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {\n      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {\n      uv = vec2(direction.x, direction.y) / abs(direction.z);    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Uo={basic:{uniforms:bo([Lo.common,Lo.specularmap,Lo.envmap,Lo.aomap,Lo.lightmap,Lo.fog]),vertexShader:ko.meshbasic_vert,fragmentShader:ko.meshbasic_frag},lambert:{uniforms:bo([Lo.common,Lo.specularmap,Lo.envmap,Lo.aomap,Lo.lightmap,Lo.emissivemap,Lo.fog,Lo.lights,{emissive:{value:new gi(0)}}]),vertexShader:ko.meshlambert_vert,fragmentShader:ko.meshlambert_frag},phong:{uniforms:bo([Lo.common,Lo.specularmap,Lo.envmap,Lo.aomap,Lo.lightmap,Lo.emissivemap,Lo.bumpmap,Lo.normalmap,Lo.displacementmap,Lo.fog,Lo.lights,{emissive:{value:new gi(0)},specular:{value:new gi(1118481)},shininess:{value:30}}]),vertexShader:ko.meshphong_vert,fragmentShader:ko.meshphong_frag},standard:{uniforms:bo([Lo.common,Lo.envmap,Lo.aomap,Lo.lightmap,Lo.emissivemap,Lo.bumpmap,Lo.normalmap,Lo.displacementmap,Lo.roughnessmap,Lo.metalnessmap,Lo.fog,Lo.lights,{emissive:{value:new gi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ko.meshphysical_vert,fragmentShader:ko.meshphysical_frag},toon:{uniforms:bo([Lo.common,Lo.specularmap,Lo.aomap,Lo.lightmap,Lo.emissivemap,Lo.bumpmap,Lo.normalmap,Lo.displacementmap,Lo.gradientmap,Lo.fog,Lo.lights,{emissive:{value:new gi(0)},specular:{value:new gi(1118481)},shininess:{value:30}}]),vertexShader:ko.meshtoon_vert,fragmentShader:ko.meshtoon_frag},matcap:{uniforms:bo([Lo.common,Lo.bumpmap,Lo.normalmap,Lo.displacementmap,Lo.fog,{matcap:{value:null}}]),vertexShader:ko.meshmatcap_vert,fragmentShader:ko.meshmatcap_frag},points:{uniforms:bo([Lo.points,Lo.fog]),vertexShader:ko.points_vert,fragmentShader:ko.points_frag},dashed:{uniforms:bo([Lo.common,Lo.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ko.linedashed_vert,fragmentShader:ko.linedashed_frag},depth:{uniforms:bo([Lo.common,Lo.displacementmap]),vertexShader:ko.depth_vert,fragmentShader:ko.depth_frag},normal:{uniforms:bo([Lo.common,Lo.bumpmap,Lo.normalmap,Lo.displacementmap,{opacity:{value:1}}]),vertexShader:ko.normal_vert,fragmentShader:ko.normal_frag},sprite:{uniforms:bo([Lo.sprite,Lo.fog]),vertexShader:ko.sprite_vert,fragmentShader:ko.sprite_frag},background:{uniforms:{uvTransform:{value:new zr},t2D:{value:null}},vertexShader:ko.background_vert,fragmentShader:ko.background_frag},cube:{uniforms:bo([Lo.envmap,{opacity:{value:1}}]),vertexShader:ko.cube_vert,fragmentShader:ko.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ko.equirect_vert,fragmentShader:ko.equirect_frag},distanceRGBA:{uniforms:bo([Lo.common,Lo.displacementmap,{referencePosition:{value:new Qr},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ko.distanceRGBA_vert,fragmentShader:ko.distanceRGBA_frag},shadow:{uniforms:bo([Lo.lights,Lo.fog,{color:{value:new gi(0)},opacity:{value:1}}]),vertexShader:ko.shadow_vert,fragmentShader:ko.shadow_frag}};function Fo(t,e,r,n){var i,o,a=new gi(0),s=0,l=null,c=0,u=null;function h(t,r){e.buffers.color.setClear(t.r,t.g,t.b,r,n)}return{getClearColor:function(){return a},setClearColor:function(t,e){a.set(t),h(a,s=void 0!==e?e:1)},getClearAlpha:function(){return s},setClearAlpha:function(t){h(a,s=t)},render:function(e,n,p,d){var f=n.background,m=t.xr,y=m.getSession&&m.getSession();if(y&&"additive"===y.environmentBlendMode&&(f=null),null===f?h(a,s):f&&f.isColor&&(h(f,1),d=!0),(t.autoClear||d)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),f&&(f.isCubeTexture||f.isWebGLCubeRenderTarget||f.mapping===pt)){void 0===o&&((o=new lo(new yo(1,1,1),new wo({type:"BackgroundCubeMaterial",uniforms:_o(Uo.cube.uniforms),vertexShader:Uo.cube.vertexShader,fragmentShader:Uo.cube.fragmentShader,side:v,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(t,e,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(o));var _=f.isWebGLCubeRenderTarget?f.texture:f;o.material.uniforms.envMap.value=_,o.material.uniforms.flipEnvMap.value=_.isCubeTexture?-1:1,l===f&&c===_.version&&u===t.toneMapping||(o.material.needsUpdate=!0,l=f,c=_.version,u=t.toneMapping),e.unshift(o,o.geometry,o.material,0,0,null)}else f&&f.isTexture&&(void 0===i&&((i=new lo(new Do(2,2),new wo({type:"BackgroundMaterial",uniforms:_o(Uo.background.uniforms),vertexShader:Uo.background.vertexShader,fragmentShader:Uo.background.fragmentShader,side:g,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(i)),i.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),i.material.uniforms.uvTransform.value.copy(f.matrix),l===f&&c===f.version&&u===t.toneMapping||(i.material.needsUpdate=!0,l=f,c=f.version,u=t.toneMapping),e.unshift(i,i.geometry,i.material,0,0,null))}}}function jo(t,e,r,n){var i,o=n.isWebGL2;this.setMode=function(t){i=t},this.render=function(e,n){t.drawArrays(i,e,n),r.update(n,i)},this.renderInstances=function(n,a,s,l){if(0!==l){var c,u;if(o)c=t,u="drawArraysInstanced";else if(u="drawArraysInstancedANGLE",null===(c=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](i,a,s,l),r.update(s,i,l)}}}function Go(t,e,r){var n;function i(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var o="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext,a=void 0!==r.precision?r.precision:"highp",s=i(a);s!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",s,"instead."),a=s);var l=!0===r.logarithmicDepthBuffer,c=t.getParameter(34930),u=t.getParameter(35660),h=t.getParameter(3379),p=t.getParameter(34076),d=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),v=u>0,y=o||!!e.get("OES_texture_float");return{isWebGL2:o,getMaxAnisotropy:function(){if(void 0!==n)return n;var r=e.get("EXT_texture_filter_anisotropic");return n=null!==r?t.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:a,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:h,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?t.getParameter(36183):0}}function zo(){var t=this,e=null,r=0,n=!1,i=!1,o=new ei,a=new zr,s={value:null,needsUpdate:!1};function l(){s.value!==e&&(s.value=e,s.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(e,r,n,i){var l=null!==e?e.length:0,c=null;if(0!==l){if(c=s.value,!0!==i||null===c){var u=n+4*l,h=r.matrixWorldInverse;a.getNormalMatrix(h),(null===c||c.length<u)&&(c=new Float32Array(u));for(var p=0,d=n;p!==l;++p,d+=4)o.copy(e[p]).applyMatrix4(h,a),o.normal.toArray(c,d),c[d+3]=o.constant}s.value=c,s.needsUpdate=!0}return t.numPlanes=l,t.numIntersection=0,c}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(t,i,o){var a=0!==t.length||i||0!==r||n;return n=i,e=c(t,o,0),r=t.length,a},this.beginShadows=function(){i=!0,c(null)},this.endShadows=function(){i=!1,l()},this.setState=function(t,o,a,u,h,p){if(!n||null===t||0===t.length||i&&!a)i?c(null):l();else{var d=i?0:r,f=4*d,m=h.clippingState||null;s.value=m,m=c(t,u,f,p);for(var g=0;g!==f;++g)m[g]=e[g];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=d}}}function Vo(t){var e={};return{get:function(r){if(void 0!==e[r])return e[r];var n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return null===n&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),e[r]=n,n}}}function Ho(t,e,r){var n=new WeakMap,i=new WeakMap;function o(t){var a=t.target,s=n.get(a);for(var l in null!==s.index&&e.remove(s.index),s.attributes)e.remove(s.attributes[l]);a.removeEventListener("dispose",o),n.delete(a);var c=i.get(s);c&&(e.remove(c),i.delete(s)),r.memory.geometries--}function a(t){var r=[],n=t.index,o=t.attributes.position,a=0;if(null!==n){var s=n.array;a=n.version;for(var l=0,c=s.length;l<c;l+=3){var u=s[l+0],h=s[l+1],p=s[l+2];r.push(u,h,h,p,p,u)}}else{s=o.array;a=o.version;for(l=0,c=s.length/3-1;l<c;l+=3){u=l+0,h=l+1,p=l+2;r.push(u,h,h,p,p,u)}}var d=new(Di(r)>65535?Li:Oi)(r,1);d.version=a,e.update(d,34963);var f=i.get(t);f&&e.remove(f),i.set(t,d)}return{get:function(t,e){var i=n.get(e);return i||(e.addEventListener("dispose",o),e.isBufferGeometry?i=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new Hi).setFromObject(t)),i=e._bufferGeometry),n.set(e,i),r.memory.geometries++,i)},update:function(t){var r=t.index,n=t.attributes;for(var i in null!==r&&e.update(r,34963),n)e.update(n[i],34962);var o=t.morphAttributes;for(var i in o)for(var a=o[i],s=0,l=a.length;s<l;s++)e.update(a[s],34962)},getWireframeAttribute:function(t){var e=i.get(t);if(e){var r=t.index;null!==r&&e.version<r.version&&a(t)}else a(t);return i.get(t)}}}function Wo(t,e,r,n){var i,o,a,s=n.isWebGL2;this.setMode=function(t){i=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,n){t.drawElements(i,n,o,e*a),r.update(n,i)},this.renderInstances=function(n,l,c,u){if(0!==u){var h,p;if(s)h=t,p="drawElementsInstanced";else if(p="drawElementsInstancedANGLE",null===(h=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[p](i,c,o,l*a,u),r.update(c,i,u)}}}function qo(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,r,n){switch(n=n||1,e.calls++,r){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r)}}}}function Yo(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Xo(t){var e={},r=new Float32Array(8);return{update:function(n,i,o,a){var s=n.morphTargetInfluences,l=void 0===s?0:s.length,c=e[i.id];if(void 0===c){c=[];for(var u=0;u<l;u++)c[u]=[u,0];e[i.id]=c}var h=o.morphTargets&&i.morphAttributes.position,p=o.morphNormals&&i.morphAttributes.normal;for(u=0;u<l;u++){0!==(f=c[u])[1]&&(h&&i.deleteAttribute("morphTarget"+u),p&&i.deleteAttribute("morphNormal"+u))}for(u=0;u<l;u++){(f=c[u])[0]=u,f[1]=s[u]}c.sort(Yo);var d=0;for(u=0;u<8;u++){var f;if(f=c[u]){var m=f[0],g=f[1];if(g){h&&i.setAttribute("morphTarget"+u,h[m]),p&&i.setAttribute("morphNormal"+u,p[m]),r[u]=g,d+=g;continue}}r[u]=0}var v=i.morphTargetsRelative?1:1-d;a.getUniforms().setValue(t,"morphTargetBaseInfluence",v),a.getUniforms().setValue(t,"morphTargetInfluences",r)}}}function Jo(t,e,r,n){var i=new WeakMap;return{update:function(t){var o=n.render.frame,a=t.geometry,s=e.get(t,a);return i.get(s)!==o&&(a.isGeometry&&s.updateFromObject(t),e.update(s),i.set(s,o)),t.isInstancedMesh&&r.update(t.instanceMatrix,34962),s},dispose:function(){i=new WeakMap}}}function Zo(t,e,r,n,i,o,a,s,l,c){t=void 0!==t?t:[],e=void 0!==e?e:st,a=void 0!==a?a:jt,Wr.call(this,t,e,r,n,i,o,a,s,l,c),this.flipY=!1}function Ko(t,e,r,n){Wr.call(this,null),this.image={data:t||null,width:e||1,height:r||1,depth:n||1},this.magFilter=vt,this.minFilter=vt,this.wrapR=mt,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Qo(t,e,r,n){Wr.call(this,null),this.image={data:t||null,width:e||1,height:r||1,depth:n||1},this.magFilter=vt,this.minFilter=vt,this.wrapR=mt,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Uo.physical={uniforms:bo([Uo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Gr(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new gi(0)},transparency:{value:0}}]),vertexShader:ko.meshphysical_vert,fragmentShader:ko.meshphysical_frag},Zo.prototype=Object.create(Wr.prototype),Zo.prototype.constructor=Zo,Zo.prototype.isCubeTexture=!0,Object.defineProperty(Zo.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),Ko.prototype=Object.create(Wr.prototype),Ko.prototype.constructor=Ko,Ko.prototype.isDataTexture2DArray=!0,Qo.prototype=Object.create(Wr.prototype),Qo.prototype.constructor=Qo,Qo.prototype.isDataTexture3D=!0;var $o=new Wr,ta=new Ko,ea=new Qo,ra=new Zo,na=[],ia=[],oa=new Float32Array(16),aa=new Float32Array(9),sa=new Float32Array(4);function la(t,e,r){var n=t[0];if(n<=0||n>0)return t;var i=e*r,o=na[i];if(void 0===o&&(o=new Float32Array(i),na[i]=o),0!==e){n.toArray(o,0);for(var a=1,s=0;a!==e;++a)s+=r,t[a].toArray(o,s)}return o}function ca(t,e){if(t.length!==e.length)return!1;for(var r=0,n=t.length;r<n;r++)if(t[r]!==e[r])return!1;return!0}function ua(t,e){for(var r=0,n=e.length;r<n;r++)t[r]=e[r]}function ha(t,e){var r=ia[e];void 0===r&&(r=new Int32Array(e),ia[e]=r);for(var n=0;n!==e;++n)r[n]=t.allocateTextureUnit();return r}function pa(t,e){var r=this.cache;r[0]!==e&&(t.uniform1f(this.addr,e),r[0]=e)}function da(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),r[0]=e.x,r[1]=e.y);else{if(ca(r,e))return;t.uniform2fv(this.addr,e),ua(r,e)}}function fa(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),r[0]=e.x,r[1]=e.y,r[2]=e.z);else if(void 0!==e.r)r[0]===e.r&&r[1]===e.g&&r[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),r[0]=e.r,r[1]=e.g,r[2]=e.b);else{if(ca(r,e))return;t.uniform3fv(this.addr,e),ua(r,e)}}function ma(t,e){var r=this.cache;if(void 0!==e.x)r[0]===e.x&&r[1]===e.y&&r[2]===e.z&&r[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=e.w);else{if(ca(r,e))return;t.uniform4fv(this.addr,e),ua(r,e)}}function ga(t,e){var r=this.cache,n=e.elements;if(void 0===n){if(ca(r,e))return;t.uniformMatrix2fv(this.addr,!1,e),ua(r,e)}else{if(ca(r,n))return;sa.set(n),t.uniformMatrix2fv(this.addr,!1,sa),ua(r,n)}}function va(t,e){var r=this.cache,n=e.elements;if(void 0===n){if(ca(r,e))return;t.uniformMatrix3fv(this.addr,!1,e),ua(r,e)}else{if(ca(r,n))return;aa.set(n),t.uniformMatrix3fv(this.addr,!1,aa),ua(r,n)}}function ya(t,e){var r=this.cache,n=e.elements;if(void 0===n){if(ca(r,e))return;t.uniformMatrix4fv(this.addr,!1,e),ua(r,e)}else{if(ca(r,n))return;oa.set(n),t.uniformMatrix4fv(this.addr,!1,oa),ua(r,n)}}function _a(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.safeSetTexture2D(e||$o,i)}function ba(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTexture2DArray(e||ta,i)}function xa(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.setTexture3D(e||ea,i)}function wa(t,e,r){var n=this.cache,i=r.allocateTextureUnit();n[0]!==i&&(t.uniform1i(this.addr,i),n[0]=i),r.safeSetTextureCube(e||ra,i)}function Ea(t,e){var r=this.cache;r[0]!==e&&(t.uniform1i(this.addr,e),r[0]=e)}function Ma(t,e){var r=this.cache;ca(r,e)||(t.uniform2iv(this.addr,e),ua(r,e))}function Sa(t,e){var r=this.cache;ca(r,e)||(t.uniform3iv(this.addr,e),ua(r,e))}function Ta(t,e){var r=this.cache;ca(r,e)||(t.uniform4iv(this.addr,e),ua(r,e))}function Aa(t,e){var r=this.cache;r[0]!==e&&(t.uniform1ui(this.addr,e),r[0]=e)}function Ca(t,e){t.uniform1fv(this.addr,e)}function Pa(t,e){t.uniform1iv(this.addr,e)}function Oa(t,e){t.uniform2iv(this.addr,e)}function Ra(t,e){t.uniform3iv(this.addr,e)}function La(t,e){t.uniform4iv(this.addr,e)}function Ia(t,e){var r=la(e,this.size,2);t.uniform2fv(this.addr,r)}function Na(t,e){var r=la(e,this.size,3);t.uniform3fv(this.addr,r)}function Ba(t,e){var r=la(e,this.size,4);t.uniform4fv(this.addr,r)}function Da(t,e){var r=la(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,r)}function ka(t,e){var r=la(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,r)}function Ua(t,e){var r=la(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,r)}function Fa(t,e,r){var n=e.length,i=ha(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.safeSetTexture2D(e[o]||$o,i[o])}function ja(t,e,r){var n=e.length,i=ha(r,n);t.uniform1iv(this.addr,i);for(var o=0;o!==n;++o)r.safeSetTextureCube(e[o]||ra,i[o])}function Ga(t,e,r){this.id=t,this.addr=r,this.cache=[],this.setValue=function(t){switch(t){case 5126:return pa;case 35664:return da;case 35665:return fa;case 35666:return ma;case 35674:return ga;case 35675:return va;case 35676:return ya;case 5124:case 35670:return Ea;case 35667:case 35671:return Ma;case 35668:case 35672:return Sa;case 35669:case 35673:return Ta;case 5125:return Aa;case 35678:case 36198:case 36298:case 36306:case 35682:return _a;case 35679:case 36299:case 36307:return xa;case 35680:case 36300:case 36308:case 36293:return wa;case 36289:case 36303:case 36311:case 36292:return ba}}(e.type)}function za(t,e,r){this.id=t,this.addr=r,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Ca;case 35664:return Ia;case 35665:return Na;case 35666:return Ba;case 35674:return Da;case 35675:return ka;case 35676:return Ua;case 5124:case 35670:return Pa;case 35667:case 35671:return Oa;case 35668:case 35672:return Ra;case 35669:case 35673:return La;case 35678:case 36198:case 36298:case 36306:case 35682:return Fa;case 35680:case 36300:case 36308:case 36293:return ja}}(e.type)}function Va(t){this.id=t,this.seq=[],this.map={}}za.prototype.updateCache=function(t){var e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),ua(e,t)},Va.prototype.setValue=function(t,e,r){for(var n=this.seq,i=0,o=n.length;i!==o;++i){var a=n[i];a.setValue(t,e[a.id],r)}};var Ha=/([\w\d_]+)(\])?(\[|\.)?/g;function Wa(t,e){t.seq.push(e),t.map[e.id]=e}function qa(t,e,r){var n=t.name,i=n.length;for(Ha.lastIndex=0;;){var o=Ha.exec(n),a=Ha.lastIndex,s=o[1],l="]"===o[2],c=o[3];if(l&&(s|=0),void 0===c||"["===c&&a+2===i){Wa(r,void 0===c?new Ga(s,t,e):new za(s,t,e));break}var u=r.map[s];void 0===u&&Wa(r,u=new Va(s)),r=u}}function Ya(t,e){this.seq=[],this.map={};for(var r=t.getProgramParameter(e,35718),n=0;n<r;++n){var i=t.getActiveUniform(e,n);qa(i,t.getUniformLocation(e,i.name),this)}}function Xa(t,e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),n}Ya.prototype.setValue=function(t,e,r,n){var i=this.map[e];void 0!==i&&i.setValue(t,r,n)},Ya.prototype.setOptional=function(t,e,r){var n=e[r];void 0!==n&&this.setValue(t,r,n)},Ya.upload=function(t,e,r,n){for(var i=0,o=e.length;i!==o;++i){var a=e[i],s=r[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,n)}},Ya.seqWithValue=function(t,e){for(var r=[],n=0,i=t.length;n!==i;++n){var o=t[n];o.id in e&&r.push(o)}return r};var Ja=0;function Za(t){switch(t){case $e:return["Linear","( value )"];case tr:return["sRGB","( value )"];case rr:return["RGBE","( value )"];case ir:return["RGBM","( value, 7.0 )"];case or:return["RGBM","( value, 16.0 )"];case ar:return["RGBD","( value, 256.0 )"];case er:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case nr:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+t)}}function Ka(t,e,r){var n=t.getShaderParameter(e,35713),i=t.getShaderInfoLog(e).trim();return n&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+r+"\n"+i+function(t){for(var e=t.split("\n"),r=0;r<e.length;r++)e[r]=r+1+": "+e[r];return e.join("\n")}(t.getShaderSource(e))}function Qa(t,e){var r=Za(e);return"vec4 "+t+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function $a(t,e){var r;switch(e){case et:r="Linear";break;case rt:r="Reinhard";break;case nt:r="Uncharted2";break;case it:r="OptimizedCineon";break;case ot:r="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+e)}return"vec3 "+t+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function ts(t){return""!==t}function es(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function rs(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var ns=/^[ \t]*#include +<([\w\d./]+)>/gm;function is(t){return t.replace(ns,os)}function os(t,e){var r=ko[e];if(void 0===r)throw new Error("Can not resolve #include <"+e+">");return is(r)}var as=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ss=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function ls(t){return t.replace(ss,us).replace(as,cs)}function cs(t,e,r,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),us(t,e,r,n)}function us(t,e,r,n){for(var i="",o=parseInt(e);o<parseInt(r);o++)i+=n.replace(/\[ i \]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function hs(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function ps(t,e,r){var n,i,o,a,s,l=t.getContext(),c=r.defines,u=r.vertexShader,h=r.fragmentShader,p=function(t){var e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===d?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===f?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===m&&(e="SHADOWMAP_TYPE_VSM"),e}(r),g=function(t){var e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case st:case lt:e="ENVMAP_TYPE_CUBE";break;case pt:case dt:e="ENVMAP_TYPE_CUBE_UV";break;case ct:case ut:e="ENVMAP_TYPE_EQUIREC";break;case ht:e="ENVMAP_TYPE_SPHERE"}return e}(r),v=function(t){var e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case lt:case ut:e="ENVMAP_MODE_REFRACTION"}return e}(r),y=function(t){var e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case K:e="ENVMAP_BLENDING_MULTIPLY";break;case Q:e="ENVMAP_BLENDING_MIX";break;case $:e="ENVMAP_BLENDING_ADD"}return e}(r),_=t.gammaFactor>0?t.gammaFactor:1,b=r.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ts).join("\n")}(r),x=function(t){var e=[];for(var r in t){var n=t[r];!1!==n&&e.push("#define "+r+" "+n)}return e.join("\n")}(c),w=l.createProgram();if(r.isRawShaderMaterial?((n=[x].filter(ts).join("\n")).length>0&&(n+="\n"),(i=[b,x].filter(ts).join("\n")).length>0&&(i+="\n")):(n=[hs(r),"#define SHADER_NAME "+r.shaderName,x,r.instancing?"#define USE_INSTANCING":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+_,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+v:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+p:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ts).join("\n"),i=[b,hs(r),"#define SHADER_NAME "+r.shaderName,x,r.alphaTest?"#define ALPHATEST "+r.alphaTest+(r.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+_,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+g:"",r.envMap?"#define "+v:"",r.envMap?"#define "+y:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.sheen?"#define USE_SHEEN":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+p:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==tt?"#define TONE_MAPPING":"",r.toneMapping!==tt?ko.tonemapping_pars_fragment:"",r.toneMapping!==tt?$a("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.outputEncoding||r.mapEncoding||r.matcapEncoding||r.envMapEncoding||r.emissiveMapEncoding||r.lightMapEncoding?ko.encodings_pars_fragment:"",r.mapEncoding?Qa("mapTexelToLinear",r.mapEncoding):"",r.matcapEncoding?Qa("matcapTexelToLinear",r.matcapEncoding):"",r.envMapEncoding?Qa("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?Qa("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.lightMapEncoding?Qa("lightMapTexelToLinear",r.lightMapEncoding):"",r.outputEncoding?(o="linearToOutputTexel",a=r.outputEncoding,s=Za(a),"vec4 "+o+"( vec4 value ) { return LinearTo"+s[0]+s[1]+"; }"):"",r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(ts).join("\n")),u=rs(u=es(u=is(u),r),r),h=rs(h=es(h=is(h),r),r),u=ls(u),h=ls(h),r.isWebGL2&&!r.isRawShaderMaterial){var E=!1,M=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&null!==u.match(M)&&null!==h.match(M)&&(E=!0,u=u.replace(M,""),h=h.replace(M,"")),n=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+n,i=["#version 300 es\n","#define varying in",E?"":"out highp vec4 pc_fragColor;",E?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+i}var S,T,A=i+h,C=Xa(l,35633,n+u),P=Xa(l,35632,A);if(l.attachShader(w,C),l.attachShader(w,P),void 0!==r.index0AttributeName?l.bindAttribLocation(w,0,r.index0AttributeName):!0===r.morphTargets&&l.bindAttribLocation(w,0,"position"),l.linkProgram(w),t.debug.checkShaderErrors){var O=l.getProgramInfoLog(w).trim(),R=l.getShaderInfoLog(C).trim(),L=l.getShaderInfoLog(P).trim(),I=!0,N=!0;if(!1===l.getProgramParameter(w,35714)){I=!1;var B=Ka(l,C,"vertex"),D=Ka(l,P,"fragment");console.error("THREE.WebGLProgram: shader error: ",l.getError(),"35715",l.getProgramParameter(w,35715),"gl.getProgramInfoLog",O,B,D)}else""!==O?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",O):""!==R&&""!==L||(N=!1);N&&(this.diagnostics={runnable:I,programLog:O,vertexShader:{log:R,prefix:n},fragmentShader:{log:L,prefix:i}})}return l.deleteShader(C),l.deleteShader(P),this.getUniforms=function(){return void 0===S&&(S=new Ya(l,w)),S},this.getAttributes=function(){return void 0===T&&(T=function(t,e){for(var r={},n=t.getProgramParameter(e,35721),i=0;i<n;i++){var o=t.getActiveAttrib(e,i).name;r[o]=t.getAttribLocation(e,o)}return r}(l,w)),T},this.destroy=function(){l.deleteProgram(w),this.program=void 0},this.name=r.shaderName,this.id=Ja++,this.cacheKey=e,this.usedTimes=1,this.program=w,this.vertexShader=C,this.fragmentShader=P,this}function ds(t,e,r){var n=[],i=r.isWebGL2,o=r.logarithmicDepthBuffer,a=r.floatVertexTextures,s=r.precision,l=r.maxVertexUniforms,c=r.vertexTextures,u={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},h=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function p(t){var e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=$e,e}this.getParameters=function(n,h,d,f,m,g,_){var b=f.fog,x=n.isMeshStandardMaterial?f.environment:null,w=n.envMap||x,E=u[n.type],M=_.isSkinnedMesh?function(t){var e=t.skeleton.bones;if(a)return 1024;var r=l,n=Math.floor((r-20)/4),i=Math.min(n,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}(_):0;null!==n.precision&&(s=r.getMaxPrecision(n.precision))!==n.precision&&console.warn("THREE.WebGLProgram.getParameters:",n.precision,"not supported, using",s,"instead.");var S=function(t,e){var r;if(e){var n=Uo[e];r={name:t.type,uniforms:xo.clone(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}}else r={name:t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};return r}(n,E);n.onBeforeCompile(S,t);var T=t.getRenderTarget();return{isWebGL2:i,shaderID:E,shaderName:S.name,uniforms:S.uniforms,vertexShader:S.vertexShader,fragmentShader:S.fragmentShader,defines:n.defines,isRawShaderMaterial:n.isRawShaderMaterial,isShaderMaterial:n.isShaderMaterial,precision:s,instancing:!0===_.isInstancedMesh,supportsVertexTextures:c,outputEncoding:null!==T?p(T.texture):t.outputEncoding,map:!!n.map,mapEncoding:p(n.map),matcap:!!n.matcap,matcapEncoding:p(n.matcap),envMap:!!w,envMapMode:w&&w.mapping,envMapEncoding:p(w),envMapCubeUV:!!w&&(w.mapping===pt||w.mapping===dt),lightMap:!!n.lightMap,lightMapEncoding:p(n.lightMap),aoMap:!!n.aoMap,emissiveMap:!!n.emissiveMap,emissiveMapEncoding:p(n.emissiveMap),bumpMap:!!n.bumpMap,normalMap:!!n.normalMap,objectSpaceNormalMap:n.normalMapType===ur,tangentSpaceNormalMap:n.normalMapType===cr,clearcoatMap:!!n.clearcoatMap,clearcoatRoughnessMap:!!n.clearcoatRoughnessMap,clearcoatNormalMap:!!n.clearcoatNormalMap,displacementMap:!!n.displacementMap,roughnessMap:!!n.roughnessMap,metalnessMap:!!n.metalnessMap,specularMap:!!n.specularMap,alphaMap:!!n.alphaMap,gradientMap:!!n.gradientMap,sheen:!!n.sheen,combine:n.combine,vertexTangents:n.normalMap&&n.vertexTangents,vertexColors:n.vertexColors,vertexUvs:!!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatMap||n.clearcoatRoughnessMap||n.clearcoatNormalMap||n.displacementMap),uvsVertexOnly:!(n.map||n.bumpMap||n.normalMap||n.specularMap||n.alphaMap||n.emissiveMap||n.roughnessMap||n.metalnessMap||n.clearcoatNormalMap||!n.displacementMap),fog:!!b,useFog:n.fog,fogExp2:b&&b.isFogExp2,flatShading:n.flatShading,sizeAttenuation:n.sizeAttenuation,logarithmicDepthBuffer:o,skinning:n.skinning&&M>0,maxBones:M,useVertexTexture:a,morphTargets:n.morphTargets,morphNormals:n.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numDirLightShadows:h.directionalShadowMap.length,numPointLightShadows:h.pointShadowMap.length,numSpotLightShadows:h.spotShadowMap.length,numClippingPlanes:m,numClipIntersection:g,dithering:n.dithering,shadowMapEnabled:t.shadowMap.enabled&&d.length>0,shadowMapType:t.shadowMap.type,toneMapping:n.toneMapped?t.toneMapping:tt,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:n.premultipliedAlpha,alphaTest:n.alphaTest,doubleSided:n.side===y,flipSided:n.side===v,depthPacking:void 0!==n.depthPacking&&n.depthPacking,index0AttributeName:n.index0AttributeName,extensionDerivatives:n.extensions&&n.extensions.derivatives,extensionFragDepth:n.extensions&&n.extensions.fragDepth,extensionDrawBuffers:n.extensions&&n.extensions.drawBuffers,extensionShaderTextureLOD:n.extensions&&n.extensions.shaderTextureLOD,rendererExtensionFragDepth:i||null!==e.get("EXT_frag_depth"),rendererExtensionDrawBuffers:i||null!==e.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:i||null!==e.get("EXT_shader_texture_lod"),onBeforeCompile:n.onBeforeCompile}},this.getProgramCacheKey=function(e){var r=[];if(e.shaderID?r.push(e.shaderID):(r.push(e.fragmentShader),r.push(e.vertexShader)),void 0!==e.defines)for(var n in e.defines)r.push(n),r.push(e.defines[n]);if(void 0===e.isRawShaderMaterial){for(var i=0;i<h.length;i++)r.push(e[h[i]]);r.push(t.outputEncoding),r.push(t.gammaFactor)}return r.push(e.onBeforeCompile.toString()),r.join()},this.acquireProgram=function(e,r){for(var i,o=0,a=n.length;o<a;o++){var s=n[o];if(s.cacheKey===r){++(i=s).usedTimes;break}}return void 0===i&&(i=new ps(t,r,e),n.push(i)),i},this.releaseProgram=function(t){if(0==--t.usedTimes){var e=n.indexOf(t);n[e]=n[n.length-1],n.pop(),t.destroy()}},this.programs=n}function fs(){var t=new WeakMap;return{get:function(e){var r=t.get(e);return void 0===r&&(r={},t.set(e,r)),r},remove:function(e){t.delete(e)},update:function(e,r,n){t.get(e)[r]=n},dispose:function(){t=new WeakMap}}}function ms(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function gs(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function vs(){var t=[],e=0,r=[],n=[],i={id:-1};function o(r,n,o,a,s,l){var c=t[e];return void 0===c?(c={id:r.id,object:r,geometry:n,material:o,program:o.program||i,groupOrder:a,renderOrder:r.renderOrder,z:s,group:l},t[e]=c):(c.id=r.id,c.object=r,c.geometry=n,c.material=o,c.program=o.program||i,c.groupOrder=a,c.renderOrder=r.renderOrder,c.z=s,c.group=l),e++,c}return{opaque:r,transparent:n,init:function(){e=0,r.length=0,n.length=0},push:function(t,e,i,a,s,l){var c=o(t,e,i,a,s,l);(!0===i.transparent?n:r).push(c)},unshift:function(t,e,i,a,s,l){var c=o(t,e,i,a,s,l);(!0===i.transparent?n:r).unshift(c)},finish:function(){for(var r=e,n=t.length;r<n;r++){var i=t[r];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){r.length>1&&r.sort(t||ms),n.length>1&&n.sort(e||gs)}}}function ys(){var t=new WeakMap;function e(r){var n=r.target;n.removeEventListener("dispose",e),t.delete(n)}return{get:function(r,n){var i,o=t.get(r);return void 0===o?(i=new vs,t.set(r,new WeakMap),t.get(r).set(n,i),r.addEventListener("dispose",e)):void 0===(i=o.get(n))&&(i=new vs,o.set(n,i)),i},dispose:function(){t=new WeakMap}}}function _s(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var r;switch(e.type){case"DirectionalLight":r={direction:new Qr,color:new gi};break;case"SpotLight":r={position:new Qr,direction:new Qr,color:new gi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":r={position:new Qr,color:new gi,distance:0,decay:0};break;case"HemisphereLight":r={direction:new Qr,skyColor:new gi,groundColor:new gi};break;case"RectAreaLight":r={color:new gi,position:new Qr,halfWidth:new Qr,halfHeight:new Qr}}return t[e.id]=r,r}}}var bs=0;function xs(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function ws(){for(var t,e=new _s,r=(t={},{get:function(e){if(void 0!==t[e.id])return t[e.id];var r;switch(e.type){case"DirectionalLight":case"SpotLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new Gr};break;case"PointLight":r={shadowBias:0,shadowRadius:1,shadowMapSize:new Gr,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=r,r}}),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=0;i<9;i++)n.probe.push(new Qr);var o=new Qr,a=new sn,s=new sn;return{setup:function(t,i,l){for(var c=0,u=0,h=0,p=0;p<9;p++)n.probe[p].set(0,0,0);var d=0,f=0,m=0,g=0,v=0,y=0,_=0,b=0,x=l.matrixWorldInverse;t.sort(xs),p=0;for(var w=t.length;p<w;p++){var E=t[p],M=E.color,S=E.intensity,T=E.distance,A=E.shadow&&E.shadow.map?E.shadow.map.texture:null;if(E.isAmbientLight)c+=M.r*S,u+=M.g*S,h+=M.b*S;else if(E.isLightProbe)for(var C=0;C<9;C++)n.probe[C].addScaledVector(E.sh.coefficients[C],S);else if(E.isDirectionalLight){if((R=e.get(E)).color.copy(E.color).multiplyScalar(E.intensity),R.direction.setFromMatrixPosition(E.matrixWorld),o.setFromMatrixPosition(E.target.matrixWorld),R.direction.sub(o),R.direction.transformDirection(x),E.castShadow){var P=E.shadow;(O=r.get(E)).shadowBias=P.bias,O.shadowRadius=P.radius,O.shadowMapSize=P.mapSize,n.directionalShadow[d]=O,n.directionalShadowMap[d]=A,n.directionalShadowMatrix[d]=E.shadow.matrix,y++}n.directional[d]=R,d++}else if(E.isSpotLight){if((R=e.get(E)).position.setFromMatrixPosition(E.matrixWorld),R.position.applyMatrix4(x),R.color.copy(M).multiplyScalar(S),R.distance=T,R.direction.setFromMatrixPosition(E.matrixWorld),o.setFromMatrixPosition(E.target.matrixWorld),R.direction.sub(o),R.direction.transformDirection(x),R.coneCos=Math.cos(E.angle),R.penumbraCos=Math.cos(E.angle*(1-E.penumbra)),R.decay=E.decay,E.castShadow){P=E.shadow;(O=r.get(E)).shadowBias=P.bias,O.shadowRadius=P.radius,O.shadowMapSize=P.mapSize,n.spotShadow[m]=O,n.spotShadowMap[m]=A,n.spotShadowMatrix[m]=E.shadow.matrix,b++}n.spot[m]=R,m++}else if(E.isRectAreaLight){(R=e.get(E)).color.copy(M).multiplyScalar(S),R.position.setFromMatrixPosition(E.matrixWorld),R.position.applyMatrix4(x),s.identity(),a.copy(E.matrixWorld),a.premultiply(x),s.extractRotation(a),R.halfWidth.set(.5*E.width,0,0),R.halfHeight.set(0,.5*E.height,0),R.halfWidth.applyMatrix4(s),R.halfHeight.applyMatrix4(s),n.rectArea[g]=R,g++}else if(E.isPointLight){if((R=e.get(E)).position.setFromMatrixPosition(E.matrixWorld),R.position.applyMatrix4(x),R.color.copy(E.color).multiplyScalar(E.intensity),R.distance=E.distance,R.decay=E.decay,E.castShadow){var O;P=E.shadow;(O=r.get(E)).shadowBias=P.bias,O.shadowRadius=P.radius,O.shadowMapSize=P.mapSize,O.shadowCameraNear=P.camera.near,O.shadowCameraFar=P.camera.far,n.pointShadow[f]=O,n.pointShadowMap[f]=A,n.pointShadowMatrix[f]=E.shadow.matrix,_++}n.point[f]=R,f++}else if(E.isHemisphereLight){var R;(R=e.get(E)).direction.setFromMatrixPosition(E.matrixWorld),R.direction.transformDirection(x),R.direction.normalize(),R.skyColor.copy(E.color).multiplyScalar(S),R.groundColor.copy(E.groundColor).multiplyScalar(S),n.hemi[v]=R,v++}}n.ambient[0]=c,n.ambient[1]=u,n.ambient[2]=h;var L=n.hash;L.directionalLength===d&&L.pointLength===f&&L.spotLength===m&&L.rectAreaLength===g&&L.hemiLength===v&&L.numDirectionalShadows===y&&L.numPointShadows===_&&L.numSpotShadows===b||(n.directional.length=d,n.spot.length=m,n.rectArea.length=g,n.point.length=f,n.hemi.length=v,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=_,n.pointShadowMap.length=_,n.spotShadow.length=b,n.spotShadowMap.length=b,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=_,n.spotShadowMatrix.length=b,L.directionalLength=d,L.pointLength=f,L.spotLength=m,L.rectAreaLength=g,L.hemiLength=v,L.numDirectionalShadows=y,L.numPointShadows=_,L.numSpotShadows=b,n.version=bs++)},state:n}}function Es(){var t=new ws,e=[],r=[];return{init:function(){e.length=0,r.length=0},state:{lightsArray:e,shadowsArray:r,lights:t},setupLights:function(n){t.setup(e,r,n)},pushLight:function(t){e.push(t)},pushShadow:function(t){r.push(t)}}}function Ms(){var t=new WeakMap;function e(r){var n=r.target;n.removeEventListener("dispose",e),t.delete(n)}return{get:function(r,n){var i;return!1===t.has(r)?(i=new Es,t.set(r,new WeakMap),t.get(r).set(n,i),r.addEventListener("dispose",e)):!1===t.get(r).has(n)?(i=new Es,t.get(r).set(n,i)):i=t.get(r).get(n),i},dispose:function(){t=new WeakMap}}}function Ss(t){wi.call(this),this.type="MeshDepthMaterial",this.depthPacking=sr,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function Ts(t){wi.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Qr,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}Ss.prototype=Object.create(wi.prototype),Ss.prototype.constructor=Ss,Ss.prototype.isMeshDepthMaterial=!0,Ss.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},Ts.prototype=Object.create(wi.prototype),Ts.prototype.constructor=Ts,Ts.prototype.isMeshDistanceMaterial=!0,Ts.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};function As(t,e,r){var n=new Ro,i=new Gr,o=new Gr,a=new qr,s=[],l=[],c={},u={0:v,1:g,2:y},h=new wo({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:.125},uniforms:{shadow_pass:{value:null},resolution:{value:new Gr},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.HORIZONAL_PASS=1;var f=new Hi;f.setAttribute("position",new Si(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var _=new lo(f,h),b=this;function w(r,n){var i=e.update(_);h.uniforms.shadow_pass.value=r.map.texture,h.uniforms.resolution.value=r.mapSize,h.uniforms.radius.value=r.radius,t.setRenderTarget(r.mapPass),t.clear(),t.renderBufferDirect(n,null,i,h,_,null),p.uniforms.shadow_pass.value=r.mapPass.texture,p.uniforms.resolution.value=r.mapSize,p.uniforms.radius.value=r.radius,t.setRenderTarget(r.map),t.clear(),t.renderBufferDirect(n,null,i,p,_,null)}function E(t,e,r){var n=t<<0|e<<1|r<<2,i=s[n];return void 0===i&&(i=new Ss({depthPacking:lr,morphTargets:t,skinning:e}),s[n]=i),i}function M(t,e,r){var n=t<<0|e<<1|r<<2,i=l[n];return void 0===i&&(i=new Ts({morphTargets:t,skinning:e}),l[n]=i),i}function S(e,r,n,i,o,a,s){var l=null,h=E,p=e.customDepthMaterial;if(!0===i.isPointLight&&(h=M,p=e.customDistanceMaterial),void 0===p){var d=!1;!0===n.morphTargets&&(d=r.morphAttributes&&r.morphAttributes.position&&r.morphAttributes.position.length>0);var f=!1;!0===e.isSkinnedMesh&&(!0===n.skinning?f=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),l=h(d,f,!0===e.isInstancedMesh)}else l=p;if(t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){var g=l.uuid,v=n.uuid,y=c[g];void 0===y&&(y={},c[g]=y);var _=y[v];void 0===_&&(_=l.clone(),y[v]=_),l=_}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=s===m?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:u[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=o,l.farDistance=a),l}function T(r,i,o,a,s){if(!1!==r.visible){if(r.layers.test(i.layers)&&(r.isMesh||r.isLine||r.isPoints)&&(r.castShadow||r.receiveShadow&&s===m)&&(!r.frustumCulled||n.intersectsObject(r))){r.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,r.matrixWorld);var l=e.update(r),c=r.material;if(Array.isArray(c))for(var u=l.groups,h=0,p=u.length;h<p;h++){var d=u[h],f=c[d.materialIndex];if(f&&f.visible){var g=S(r,l,f,a,o.near,o.far,s);t.renderBufferDirect(o,null,l,g,r,d)}}else if(c.visible){g=S(r,l,c,a,o.near,o.far,s);t.renderBufferDirect(o,null,l,g,r,null)}}for(var v=r.children,y=0,_=v.length;y<_;y++)T(v[y],i,o,a,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=d,this.render=function(e,s,l){if(!1!==b.enabled&&(!1!==b.autoUpdate||!1!==b.needsUpdate)&&0!==e.length){var c=t.getRenderTarget(),u=t.getActiveCubeFace(),h=t.getActiveMipmapLevel(),p=t.state;p.setBlending(x),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(var d=0,f=e.length;d<f;d++){var g=e[d],v=g.shadow;if(void 0!==v){i.copy(v.mapSize);var y=v.getFrameExtents();if(i.multiply(y),o.copy(v.mapSize),(i.x>r||i.y>r)&&(i.x>r&&(o.x=Math.floor(r/y.x),i.x=o.x*y.x,v.mapSize.x=o.x),i.y>r&&(o.y=Math.floor(r/y.y),i.y=o.y*y.y,v.mapSize.y=o.y)),null===v.map&&!v.isPointLightShadow&&this.type===m){var _={minFilter:wt,magFilter:wt,format:Gt};v.map=new Yr(i.x,i.y,_),v.map.texture.name=g.name+".shadowMap",v.mapPass=new Yr(i.x,i.y,_),v.camera.updateProjectionMatrix()}if(null===v.map){_={minFilter:vt,magFilter:vt,format:Gt};v.map=new Yr(i.x,i.y,_),v.map.texture.name=g.name+".shadowMap",v.camera.updateProjectionMatrix()}t.setRenderTarget(v.map),t.clear();for(var E=v.getViewportCount(),M=0;M<E;M++){var S=v.getViewport(M);a.set(o.x*S.x,o.y*S.y,o.x*S.z,o.y*S.w),p.viewport(a),v.updateMatrices(g,M),n=v.getFrustum(),T(s,l,v.camera,g,this.type)}v.isPointLightShadow||this.type!==m||w(v,l)}else console.warn("THREE.WebGLShadowMap:",g,"has no shadow.")}b.needsUpdate=!1,t.setRenderTarget(c,u,h)}}}function Cs(t,e,r){var n=r.isWebGL2;var i=new function(){var e=!1,r=new qr,n=null,i=new qr(0,0,0,0);return{setMask:function(r){n===r||e||(t.colorMask(r,r,r,r),n=r)},setLocked:function(t){e=t},setClear:function(e,n,o,a,s){!0===s&&(e*=a,n*=a,o*=a),r.set(e,n,o,a),!1===i.equals(r)&&(t.clearColor(e,n,o,a),i.copy(r))},reset:function(){e=!1,n=null,i.set(-1,0,0,0)}}},o=new function(){var e=!1,r=null,n=null,i=null;return{setTest:function(t){t?_t(2929):bt(2929)},setMask:function(n){r===n||e||(t.depthMask(n),r=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case V:t.depthFunc(512);break;case H:t.depthFunc(519);break;case W:t.depthFunc(513);break;default:t.depthFunc(515);break;case Y:t.depthFunc(514);break;case X:t.depthFunc(518);break;case J:t.depthFunc(516);break;case Z:t.depthFunc(517)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){i!==e&&(t.clearDepth(e),i=e)},reset:function(){e=!1,r=null,n=null,i=null}}},c=new function(){var e=!1,r=null,n=null,i=null,o=null,a=null,s=null,l=null,c=null;return{setTest:function(t){e||(t?_t(2960):bt(2960))},setMask:function(n){r===n||e||(t.stencilMask(n),r=n)},setFunc:function(e,r,a){n===e&&i===r&&o===a||(t.stencilFunc(e,r,a),n=e,i=r,o=a)},setOp:function(e,r,n){a===e&&s===r&&l===n||(t.stencilOp(e,r,n),a=e,s=r,l=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,r=null,n=null,i=null,o=null,a=null,s=null,l=null,c=null}}},u=t.getParameter(34921),h=new Uint8Array(u),p=new Uint8Array(u),d=new Uint8Array(u),f={},m=null,g=null,_=null,b=null,K=null,Q=null,$=null,tt=null,et=null,rt=!1,nt=null,it=null,ot=null,at=null,st=null,lt=t.getParameter(35661),ct=!1,ut=0,ht=t.getParameter(7938);-1!==ht.indexOf("WebGL")?(ut=parseFloat(/^WebGL\ ([0-9])/.exec(ht)[1]),ct=ut>=1):-1!==ht.indexOf("OpenGL ES")&&(ut=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(ht)[1]),ct=ut>=2);var pt=null,dt={},ft=new qr,mt=new qr;function gt(e,r,n){var i=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(var a=0;a<n;a++)t.texImage2D(r+a,0,6408,1,1,0,6408,5121,i);return o}var vt={};function yt(r,i){(h[r]=1,0===p[r]&&(t.enableVertexAttribArray(r),p[r]=1),d[r]!==i)&&((n?t:e.get("ANGLE_instanced_arrays"))[n?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,i),d[r]=i)}function _t(e){!0!==f[e]&&(t.enable(e),f[e]=!0)}function bt(e){!1!==f[e]&&(t.disable(e),f[e]=!1)}vt[3553]=gt(3553,3553,1),vt[34067]=gt(34067,34069,6),i.setClear(0,0,0,1),o.setClear(1),c.setClear(0),_t(2929),o.setFunc(q),St(!1),Tt(s),_t(2884),Mt(x);var xt={[A]:32774,[C]:32778,[P]:32779};if(n)xt[O]=32775,xt[R]=32776;else{var wt=e.get("EXT_blend_minmax");null!==wt&&(xt[O]=wt.MIN_EXT,xt[R]=wt.MAX_EXT)}var Et={[L]:0,[I]:1,[N]:768,[D]:770,[z]:776,[j]:774,[U]:772,[B]:769,[k]:771,[G]:775,[F]:773};function Mt(e,r,n,i,o,a,s,l){if(e!==x){if(g||(_t(3042),g=!0),e===T)o=o||r,a=a||n,s=s||i,r===b&&o===$||(t.blendEquationSeparate(xt[r],xt[o]),b=r,$=o),n===K&&i===Q&&a===tt&&s===et||(t.blendFuncSeparate(Et[n],Et[i],Et[a],Et[s]),K=n,Q=i,tt=a,et=s),_=e,rt=null;else if(e!==_||l!==rt){if(b===A&&$===A||(t.blendEquation(32774),b=A,$=A),l)switch(e){case w:t.blendFuncSeparate(1,771,1,771);break;case E:t.blendFunc(1,1);break;case M:t.blendFuncSeparate(0,0,769,771);break;case S:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case w:t.blendFuncSeparate(770,771,1,771);break;case E:t.blendFunc(770,1);break;case M:t.blendFunc(0,769);break;case S:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}K=null,Q=null,tt=null,et=null,_=e,rt=l}}else g&&(bt(3042),g=!1)}function St(e){nt!==e&&(e?t.frontFace(2304):t.frontFace(2305),nt=e)}function Tt(e){e!==a?(_t(2884),e!==it&&(e===s?t.cullFace(1029):e===l?t.cullFace(1028):t.cullFace(1032))):bt(2884),it=e}function At(e,r,n){e?(_t(32823),at===r&&st===n||(t.polygonOffset(r,n),at=r,st=n)):bt(32823)}function Ct(e){void 0===e&&(e=33984+lt-1),pt!==e&&(t.activeTexture(e),pt=e)}return{buffers:{color:i,depth:o,stencil:c},initAttributes:function(){for(var t=0,e=h.length;t<e;t++)h[t]=0},enableAttribute:function(t){yt(t,0)},enableAttributeAndDivisor:yt,disableUnusedAttributes:function(){for(var e=0,r=p.length;e!==r;++e)p[e]!==h[e]&&(t.disableVertexAttribArray(e),p[e]=0)},vertexAttribPointer:function(e,r,i,o,a,s){!0!==n||5124!==i&&5125!==i?t.vertexAttribPointer(e,r,i,o,a,s):t.vertexAttribIPointer(e,r,i,o,a,s)},enable:_t,disable:bt,useProgram:function(e){return m!==e&&(t.useProgram(e),m=e,!0)},setBlending:Mt,setMaterial:function(t,e){t.side===y?bt(2884):_t(2884);var r=t.side===v;e&&(r=!r),St(r),t.blending===w&&!1===t.transparent?Mt(x):Mt(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),i.setMask(t.colorWrite);var n=t.stencilWrite;c.setTest(n),n&&(c.setMask(t.stencilWriteMask),c.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),c.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),At(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:St,setCullFace:Tt,setLineWidth:function(e){e!==ot&&(ct&&t.lineWidth(e),ot=e)},setPolygonOffset:At,setScissorTest:function(t){t?_t(3089):bt(3089)},activeTexture:Ct,bindTexture:function(e,r){null===pt&&Ct();var n=dt[pt];void 0===n&&(n={type:void 0,texture:void 0},dt[pt]=n),n.type===e&&n.texture===r||(t.bindTexture(e,r||vt[e]),n.type=e,n.texture=r)},unbindTexture:function(){var e=dt[pt];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===ft.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),ft.copy(e))},viewport:function(e){!1===mt.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),mt.copy(e))},reset:function(){for(var e=0;e<p.length;e++)1===p[e]&&(t.disableVertexAttribArray(e),p[e]=0);f={},pt=null,dt={},m=null,_=null,nt=null,it=null,i.reset(),o.reset(),c.reset()}}}function Ps(t,e,r,n,i,o,a){var s,l=i.isWebGL2,c=i.maxTextures,u=i.maxCubemapSize,h=i.maxTextureSize,p=i.maxSamples,d=new WeakMap,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return f?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,r,n){var i=1;if((t.width>n||t.height>n)&&(i=n/Math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){var o=e?jr.floorPowerOfTwo:Math.floor,a=o(i*t.width),l=o(i*t.height);void 0===s&&(s=m(a,l));var c=r?m(a,l):s;return c.width=a,c.height=l,c.getContext("2d").drawImage(t,0,0,a,l),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+a+"x"+l+")."),c}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function v(t){return jr.isPowerOfTwo(t.width)&&jr.isPowerOfTwo(t.height)}function y(t,e){return t.generateMipmaps&&e&&t.minFilter!==vt&&t.minFilter!==wt}function _(e,r,i,o){t.generateMipmap(e),n.get(r).__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function b(r,n,i){if(!1===l)return n;if(null!==r){if(void 0!==t[r])return t[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}var o=n;return 6403===n&&(5126===i&&(o=33326),5131===i&&(o=33325),5121===i&&(o=33321)),6407===n&&(5126===i&&(o=34837),5131===i&&(o=34843),5121===i&&(o=32849)),6408===n&&(5126===i&&(o=34836),5131===i&&(o=34842),5121===i&&(o=32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||e.get("EXT_color_buffer_float"),o}function x(t){return t===vt||t===yt||t===bt?9728:9729}function w(e){var r=e.target;r.removeEventListener("dispose",w),function(e){var r=n.get(e);if(void 0===r.__webglInit)return;t.deleteTexture(r.__webglTexture),n.remove(e)}(r),r.isVideoTexture&&d.delete(r),a.memory.textures--}function E(e){var r=e.target;r.removeEventListener("dispose",E),function(e){var r=n.get(e),i=n.get(e.texture);if(!e)return;void 0!==i.__webglTexture&&t.deleteTexture(i.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(var o=0;o<6;o++)t.deleteFramebuffer(r.__webglFramebuffer[o]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[o]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);n.remove(e.texture),n.remove(e)}(r),a.memory.textures--}var M=0;function S(t,e){var i=n.get(t);if(t.isVideoTexture&&function(t){var e=a.render.frame;d.get(t)!==e&&(d.set(t,e),t.update())}(t),t.version>0&&i.__version!==t.version){var o=t.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==o.complete)return void L(i,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+e),r.bindTexture(3553,i.__webglTexture)}function T(e,i){if(6===e.image.length){var a=n.get(e);if(e.version>0&&a.__version!==e.version){R(a,e),r.activeTexture(33984+i),r.bindTexture(34067,a.__webglTexture),t.pixelStorei(37440,e.flipY);for(var s=e&&(e.isCompressedTexture||e.image[0].isCompressedTexture),c=e.image[0]&&e.image[0].isDataTexture,h=[],p=0;p<6;p++)h[p]=s||c?c?e.image[p].image:e.image[p]:g(e.image[p],!1,!0,u);var d,f=h[0],m=v(f)||l,x=o.convert(e.format),w=o.convert(e.type),E=b(e.internalFormat,x,w);if(O(34067,e,m),s){for(p=0;p<6;p++){d=h[p].mipmaps;for(var M=0;M<d.length;M++){var S=d[M];e.format!==Gt&&e.format!==jt?null!==x?r.compressedTexImage2D(34069+p,M,E,S.width,S.height,0,S.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+p,M,E,S.width,S.height,0,x,w,S.data)}}a.__maxMipLevel=d.length-1}else{d=e.mipmaps;for(p=0;p<6;p++)if(c){r.texImage2D(34069+p,0,E,h[p].width,h[p].height,0,x,w,h[p].data);for(M=0;M<d.length;M++){var T=(S=d[M]).image[p].image;r.texImage2D(34069+p,M+1,E,T.width,T.height,0,x,w,T.data)}}else{r.texImage2D(34069+p,0,E,x,w,h[p]);for(M=0;M<d.length;M++){S=d[M];r.texImage2D(34069+p,M+1,E,x,w,S.image[p])}}a.__maxMipLevel=d.length}y(e,m)&&_(34067,e,f.width,f.height),a.__version=e.version,e.onUpdate&&e.onUpdate(e)}else r.activeTexture(33984+i),r.bindTexture(34067,a.__webglTexture)}}function A(t,e){r.activeTexture(33984+e),r.bindTexture(34067,n.get(t).__webglTexture)}var C={[ft]:10497,[mt]:33071,[gt]:33648},P={[vt]:9728,[yt]:9984,[bt]:9986,[wt]:9729,[Et]:9985,[St]:9987};function O(r,o,a){a?(t.texParameteri(r,10242,C[o.wrapS]),t.texParameteri(r,10243,C[o.wrapT]),32879!==r&&35866!==r||t.texParameteri(r,32882,C[o.wrapR]),t.texParameteri(r,10240,P[o.magFilter]),t.texParameteri(r,10241,P[o.minFilter])):(t.texParameteri(r,10242,33071),t.texParameteri(r,10243,33071),32879!==r&&35866!==r||t.texParameteri(r,32882,33071),o.wrapS===mt&&o.wrapT===mt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(r,10240,x(o.magFilter)),t.texParameteri(r,10241,x(o.minFilter)),o.minFilter!==vt&&o.minFilter!==wt&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=e.get("EXT_texture_filter_anisotropic");if(s){if(o.type===It&&null===e.get("OES_texture_float_linear"))return;if(o.type===Nt&&null===(l||e.get("OES_texture_half_float_linear")))return;(o.anisotropy>1||n.get(o).__currentAnisotropy)&&(t.texParameterf(r,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),n.get(o).__currentAnisotropy=o.anisotropy)}}function R(e,r){void 0===e.__webglInit&&(e.__webglInit=!0,r.addEventListener("dispose",w),e.__webglTexture=t.createTexture(),a.memory.textures++)}function L(e,n,i){var a=3553;n.isDataTexture2DArray&&(a=35866),n.isDataTexture3D&&(a=32879),R(e,n),r.activeTexture(33984+i),r.bindTexture(a,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment);var s=function(t){return!l&&(t.wrapS!==mt||t.wrapT!==mt||t.minFilter!==vt&&t.minFilter!==wt)}(n)&&!1===v(n.image),c=g(n.image,s,!1,h),u=v(c)||l,p=o.convert(n.format),d=o.convert(n.type),f=b(n.internalFormat,p,d);O(a,n,u);var m,x=n.mipmaps;if(n.isDepthTexture)f=6402,l?f=n.type===It?36012:n.type===Lt?33190:n.type===Ut?35056:33189:n.type===It&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===Wt&&6402===f&&n.type!==Ot&&n.type!==Lt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Ot,d=o.convert(n.type)),n.format===qt&&6402===f&&(f=34041,n.type!==Ut&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Ut,d=o.convert(n.type))),r.texImage2D(3553,0,f,c.width,c.height,0,p,d,null);else if(n.isDataTexture)if(x.length>0&&u){for(var w=0,E=x.length;w<E;w++)m=x[w],r.texImage2D(3553,w,f,m.width,m.height,0,p,d,m.data);n.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else r.texImage2D(3553,0,f,c.width,c.height,0,p,d,c.data),e.__maxMipLevel=0;else if(n.isCompressedTexture){for(w=0,E=x.length;w<E;w++)m=x[w],n.format!==Gt&&n.format!==jt?null!==p?r.compressedTexImage2D(3553,w,f,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,w,f,m.width,m.height,0,p,d,m.data);e.__maxMipLevel=x.length-1}else if(n.isDataTexture2DArray)r.texImage3D(35866,0,f,c.width,c.height,c.depth,0,p,d,c.data),e.__maxMipLevel=0;else if(n.isDataTexture3D)r.texImage3D(32879,0,f,c.width,c.height,c.depth,0,p,d,c.data),e.__maxMipLevel=0;else if(x.length>0&&u){for(w=0,E=x.length;w<E;w++)m=x[w],r.texImage2D(3553,w,f,p,d,m);n.generateMipmaps=!1,e.__maxMipLevel=x.length-1}else r.texImage2D(3553,0,f,p,d,c),e.__maxMipLevel=0;y(n,u)&&_(a,n,c.width,c.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n)}function I(e,i,a,s){var l=o.convert(i.texture.format),c=o.convert(i.texture.type),u=b(i.texture.internalFormat,l,c);r.texImage2D(s,0,u,i.width,i.height,0,l,c,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,a,s,n.get(i.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function N(e,r,n){if(t.bindRenderbuffer(36161,e),r.depthBuffer&&!r.stencilBuffer){var i=33189;if(n){var a=r.depthTexture;a&&a.isDepthTexture&&(a.type===It?i=36012:a.type===Lt&&(i=33190));var s=D(r);t.renderbufferStorageMultisample(36161,s,i,r.width,r.height)}else t.renderbufferStorage(36161,i,r.width,r.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(r.depthBuffer&&r.stencilBuffer){if(n){s=D(r);t.renderbufferStorageMultisample(36161,s,35056,r.width,r.height)}else t.renderbufferStorage(36161,34041,r.width,r.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{var l=o.convert(r.texture.format),c=o.convert(r.texture.type);i=b(r.texture.internalFormat,l,c);if(n){s=D(r);t.renderbufferStorageMultisample(36161,s,i,r.width,r.height)}else t.renderbufferStorage(36161,i,r.width,r.height)}t.bindRenderbuffer(36161,null)}function B(e){var r=n.get(e),i=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),S(r.depthTexture,0);var i=n.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Wt)t.framebufferTexture2D(36160,36096,3553,i,0);else{if(r.depthTexture.format!==qt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,i,0)}}(r.__webglFramebuffer,e)}else if(i){r.__webglDepthbuffer=[];for(var o=0;o<6;o++)t.bindFramebuffer(36160,r.__webglFramebuffer[o]),r.__webglDepthbuffer[o]=t.createRenderbuffer(),N(r.__webglDepthbuffer[o],e,!1)}else t.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),N(r.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function D(t){return l&&t.isWebGLMultisampleRenderTarget?Math.min(p,t.samples):0}var k=!1,U=!1;this.allocateTextureUnit=function(){var t=M;return t>=c&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+c),M+=1,t},this.resetTextureUnits=function(){M=0},this.setTexture2D=S,this.setTexture2DArray=function(t,e){var i=n.get(t);t.version>0&&i.__version!==t.version?L(i,t,e):(r.activeTexture(33984+e),r.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(t,e){var i=n.get(t);t.version>0&&i.__version!==t.version?L(i,t,e):(r.activeTexture(33984+e),r.bindTexture(32879,i.__webglTexture))},this.setTextureCube=T,this.setTextureCubeDynamic=A,this.setupRenderTarget=function(e){var i=n.get(e),s=n.get(e.texture);e.addEventListener("dispose",E),s.__webglTexture=t.createTexture(),a.memory.textures++;var c=!0===e.isWebGLCubeRenderTarget,u=!0===e.isWebGLMultisampleRenderTarget,h=v(e)||l;if(!l||e.texture.format!==jt||e.texture.type!==It&&e.texture.type!==Nt||(e.texture.format=Gt,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),c){i.__webglFramebuffer=[];for(var p=0;p<6;p++)i.__webglFramebuffer[p]=t.createFramebuffer()}else if(i.__webglFramebuffer=t.createFramebuffer(),u)if(l){i.__webglMultisampledFramebuffer=t.createFramebuffer(),i.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,i.__webglColorRenderbuffer);var d=o.convert(e.texture.format),f=o.convert(e.texture.type),m=b(e.texture.internalFormat,d,f),g=D(e);t.renderbufferStorageMultisample(36161,g,m,e.width,e.height),t.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(i.__webglDepthRenderbuffer=t.createRenderbuffer(),N(i.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(c){r.bindTexture(34067,s.__webglTexture),O(34067,e.texture,h);for(p=0;p<6;p++)I(i.__webglFramebuffer[p],e,36064,34069+p);y(e.texture,h)&&_(34067,e.texture,e.width,e.height),r.bindTexture(34067,null)}else r.bindTexture(3553,s.__webglTexture),O(3553,e.texture,h),I(i.__webglFramebuffer,e,36064,3553),y(e.texture,h)&&_(3553,e.texture,e.width,e.height),r.bindTexture(3553,null);e.depthBuffer&&B(e)},this.updateRenderTargetMipmap=function(t){var e=t.texture;if(y(e,v(t)||l)){var i=t.isWebGLCubeRenderTarget?34067:3553,o=n.get(e).__webglTexture;r.bindTexture(i,o),_(i,e,t.width,t.height),r.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(l){var r=n.get(e);t.bindFramebuffer(36008,r.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,r.__webglFramebuffer);var i=e.width,o=e.height,a=16384;e.depthBuffer&&(a|=256),e.stencilBuffer&&(a|=1024),t.blitFramebuffer(0,0,i,o,0,0,i,o,a,9728),t.bindFramebuffer(36160,r.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),t=t.texture),S(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?T(t,e):A(t,e)}}function Os(t,e,r){var n=r.isWebGL2;return{convert:function(t){var r;if(t===At)return 5121;if(t===Bt)return 32819;if(t===Dt)return 32820;if(t===kt)return 33635;if(t===Ct)return 5120;if(t===Pt)return 5122;if(t===Ot)return 5123;if(t===Rt)return 5124;if(t===Lt)return 5125;if(t===It)return 5126;if(t===Nt)return n?5131:null!==(r=e.get("OES_texture_half_float"))?r.HALF_FLOAT_OES:null;if(t===Ft)return 6406;if(t===jt)return 6407;if(t===Gt)return 6408;if(t===zt)return 6409;if(t===Vt)return 6410;if(t===Wt)return 6402;if(t===qt)return 34041;if(t===Yt)return 6403;if(t===Xt)return 36244;if(t===Jt)return 33319;if(t===Zt)return 33320;if(t===Kt)return 36248;if(t===Qt)return 36249;if(t===$t||t===te||t===ee||t===re){if(null===(r=e.get("WEBGL_compressed_texture_s3tc")))return null;if(t===$t)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===te)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===ee)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===re)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===ne||t===ie||t===oe||t===ae){if(null===(r=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===ne)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===ie)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===oe)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===ae)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===se)return null!==(r=e.get("WEBGL_compressed_texture_etc1"))?r.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===le||t===ce)&&null!==(r=e.get("WEBGL_compressed_texture_etc"))){if(t===le)return r.COMPRESSED_RGB8_ETC2;if(t===ce)return r.COMPRESSED_RGBA8_ETC2_EAC}return t===ue||t===he||t===pe||t===de||t===fe||t===me||t===ge||t===ve||t===ye||t===_e||t===be||t===xe||t===we||t===Ee||t===Se||t===Te||t===Ae||t===Ce||t===Pe||t===Oe||t===Re||t===Le||t===Ie||t===Ne||t===Be||t===De||t===ke||t===Ue?null!==(r=e.get("WEBGL_compressed_texture_astc"))?t:null:t===Me?null!==(r=e.get("EXT_texture_compression_bptc"))?t:null:t===Ut?n?34042:null!==(r=e.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Rs(t){Mo.call(this),this.cameras=t||[]}function Ls(){Sn.call(this),this.type="Group"}function Is(){this._targetRay=null,this._grip=null}function Ns(t,e){var r=this,n=null,i=1,o=null,a="local-floor",s=null,l=[],c=new Map,u=new Mo;u.layers.enable(1),u.viewport=new qr;var h=new Mo;h.layers.enable(2),h.viewport=new qr;var p=[u,h],d=new Rs;d.layers.enable(1),d.layers.enable(2);var f=null,m=null;function g(t){var e=c.get(t.inputSource);e&&e.dispatchEvent({type:t.type})}function v(){c.forEach((function(t,e){t.disconnect(e)})),c.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),M.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function y(t){o=t,M.setContext(n),M.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}function _(t){for(var e=n.inputSources,r=0;r<l.length;r++)c.set(e[r],l[r]);for(r=0;r<t.removed.length;r++){var i=t.removed[r];(o=c.get(i))&&(o.dispatchEvent({type:"disconnected",data:i}),c.delete(i))}for(r=0;r<t.added.length;r++){var o;i=t.added[r];(o=c.get(i))&&o.dispatchEvent({type:"connected",data:i})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){var e=l[t];return void 0===e&&(e=new Is,l[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){var e=l[t];return void 0===e&&(e=new Is,l[t]=e),e.getGripSpace()},this.setFramebufferScaleFactor=function(t){i=t,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return n},this.setSession=function(t){if(null!==(n=t)){n.addEventListener("select",g),n.addEventListener("selectstart",g),n.addEventListener("selectend",g),n.addEventListener("squeeze",g),n.addEventListener("squeezestart",g),n.addEventListener("squeezeend",g),n.addEventListener("end",v);var r=e.getContextAttributes();!0!==r.xrCompatible&&e.makeXRCompatible();var o={antialias:r.antialias,alpha:r.alpha,depth:r.depth,stencil:r.stencil,framebufferScaleFactor:i},s=new XRWebGLLayer(n,e,o);n.updateRenderState({baseLayer:s}),n.requestReferenceSpace(a).then(y),n.addEventListener("inputsourceschange",_)}};var b=new Qr,x=new Qr;function w(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){d.near=h.near=u.near=t.near,d.far=h.far=u.far=t.far,f===d.near&&m===d.far||(n.updateRenderState({depthNear:d.near,depthFar:d.far}),f=d.near,m=d.far);var e=t.parent,r=d.cameras;w(d,e);for(var i=0;i<r.length;i++)w(r[i],e);t.matrixWorld.copy(d.matrixWorld);for(var o=t.children,a=(i=0,o.length);i<a;i++)o[i].updateMatrixWorld(!0);return 2===r.length?function(t,e,r){b.setFromMatrixPosition(e.matrixWorld),x.setFromMatrixPosition(r.matrixWorld);var n=b.distanceTo(x),i=e.projectionMatrix.elements,o=r.projectionMatrix.elements,a=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],c=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(o[8]+1)/o[0],p=a*u,d=a*h,f=n/(-u+h),m=f*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(m),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);var g=a+f,v=s+f,y=p-m,_=d+(n-m),w=l*s/v*g,E=c*s/v*g;t.projectionMatrix.makePerspective(y,_,w,E,g,v)}(d,u,h):d.projectionMatrix.copy(u.projectionMatrix),d};var E=null;var M=new Io;M.setAnimationLoop((function(e,r){if(null!==(s=r.getViewerPose(o))){var i=s.views,a=n.renderState.baseLayer;t.setFramebuffer(a.framebuffer);var c=!1;i.length!==d.cameras.length&&(d.cameras.length=0,c=!0);for(var u=0;u<i.length;u++){var h=i[u],f=a.getViewport(h),m=p[u];m.matrix.fromArray(h.transform.matrix),m.projectionMatrix.fromArray(h.projectionMatrix),m.viewport.set(f.x,f.y,f.width,f.height),0===u&&d.matrix.copy(m.matrix),!0===c&&d.cameras.push(m)}}var g=n.inputSources;for(u=0;u<l.length;u++){var v=l[u],y=g[u];v.update(y,r,o)}E&&E(e,r)})),this.setAnimationLoop=function(t){E=t},this.dispose=function(){}}function Bs(t){function e(e,r,n){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map),r.alphaMap&&(e.alphaMap.value=r.alphaMap),r.specularMap&&(e.specularMap.value=r.specularMap);var i,o,a=r.envMap||n;a&&(e.envMap.value=a,e.flipEnvMap.value=a.isCubeTexture?-1:1,e.reflectivity.value=r.reflectivity,e.refractionRatio.value=r.refractionRatio,e.maxMipLevel.value=t.get(a).__maxMipLevel),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity),r.map?i=r.map:r.specularMap?i=r.specularMap:r.displacementMap?i=r.displacementMap:r.normalMap?i=r.normalMap:r.bumpMap?i=r.bumpMap:r.roughnessMap?i=r.roughnessMap:r.metalnessMap?i=r.metalnessMap:r.alphaMap?i=r.alphaMap:r.emissiveMap&&(i=r.emissiveMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix)),r.aoMap?o=r.aoMap:r.lightMap&&(o=r.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),e.uv2Transform.value.copy(o.matrix))}function r(t,e,r){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===v&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===v&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),(e.envMap||r)&&(t.envMapIntensity.value=e.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,i,o,a){n.isMeshBasicMaterial?e(t,n):n.isMeshLambertMaterial?(e(t,n),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,n)):n.isMeshToonMaterial?(e(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===v&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===v&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshPhongMaterial?(e(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===v&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===v&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshStandardMaterial?(e(t,n,i),n.isMeshPhysicalMaterial?function(t,e,n){r(t,e,n),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap);e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===v&&t.clearcoatNormalScale.value.negate());t.transparency.value=e.transparency}(t,n,i):r(t,n,i)):n.isMeshMatcapMaterial?(e(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===v&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===v&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDepthMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDistanceMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?(e(t,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===v&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===v&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,r,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*r,t.scale.value=.5*n,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);var i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n,o,a):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);var r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Ds(t){var e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,i=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,a=void 0!==t.antialias&&t.antialias,s=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",u=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat,h=null,p=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=$e,this.physicallyCorrectLights=!1,this.toneMapping=tt,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var d,f,m,g,v,y,_,b,x,w,E,M,S,T,A,C,P,O,R,L=this,I=!1,N=null,B=0,D=0,k=null,U=null,F=-1,j={geometry:null,program:null,wireframe:!1},G=null,z=null,V=new qr,H=new qr,W=null,q=e.width,Y=e.height,X=1,J=null,Z=null,K=new qr(0,0,q,Y),Q=new qr(0,0,q,Y),$=!1,et=new Ro,rt=new zo,nt=!1,it=!1,ot=new sn,at=new Qr;function st(){return null===k?X:1}try{var lt={alpha:n,depth:i,stencil:o,antialias:a,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:u};if(e.addEventListener("webglcontextlost",pt,!1),e.addEventListener("webglcontextrestored",dt,!1),null===(d=r||e.getContext("webgl",lt)||e.getContext("experimental-webgl",lt)))throw null!==e.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===d.getShaderPrecisionFormat&&(d.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function ct(){f=new Vo(d),!1===(m=new Go(d,f,t)).isWebGL2&&(f.get("WEBGL_depth_texture"),f.get("OES_texture_float"),f.get("OES_texture_half_float"),f.get("OES_texture_half_float_linear"),f.get("OES_standard_derivatives"),f.get("OES_element_index_uint"),f.get("ANGLE_instanced_arrays")),f.get("OES_texture_float_linear"),R=new Os(d,f,m),(g=new Cs(d,f,m)).scissor(H.copy(Q).multiplyScalar(X).floor()),g.viewport(V.copy(K).multiplyScalar(X).floor()),v=new qo(d),y=new fs,_=new Ps(d,f,g,y,m,R,v),b=new No(d,m),x=new Ho(d,b,v),w=new Jo(d,x,b,v),C=new Xo(d),E=new ds(L,f,m),M=new Bs(y),S=new ys,T=new Ms,A=new Fo(L,g,w,s),P=new jo(d,f,v,m),O=new Wo(d,f,v,m),v.programs=E.programs,L.capabilities=m,L.extensions=f,L.properties=y,L.renderLists=S,L.state=g,L.info=v}ct();var ut=new Ns(L,d);this.xr=ut;var ht=new As(L,w,m.maxTextureSize);function pt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function dt(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1,ct()}function ft(t){var e=t.target;e.removeEventListener("dispose",ft),function(t){mt(t),y.remove(t)}(e)}function mt(t){var e=y.get(t).program;t.program=void 0,void 0!==e&&E.releaseProgram(e)}this.shadowMap=ht,this.getContext=function(){return d},this.getContextAttributes=function(){return d.getContextAttributes()},this.forceContextLoss=function(){var t=f.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){var t=f.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return X},this.setPixelRatio=function(t){void 0!==t&&(X=t,this.setSize(q,Y,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Gr),t.set(q,Y)},this.setSize=function(t,r,n){ut.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(q=t,Y=r,e.width=Math.floor(t*X),e.height=Math.floor(r*X),!1!==n&&(e.style.width=t+"px",e.style.height=r+"px"),this.setViewport(0,0,t,r))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Gr),t.set(q*X,Y*X).floor()},this.setDrawingBufferSize=function(t,r,n){q=t,Y=r,X=n,e.width=Math.floor(t*n),e.height=Math.floor(r*n),this.setViewport(0,0,t,r)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new qr),t.copy(V)},this.getViewport=function(t){return t.copy(K)},this.setViewport=function(t,e,r,n){t.isVector4?K.set(t.x,t.y,t.z,t.w):K.set(t,e,r,n),g.viewport(V.copy(K).multiplyScalar(X).floor())},this.getScissor=function(t){return t.copy(Q)},this.setScissor=function(t,e,r,n){t.isVector4?Q.set(t.x,t.y,t.z,t.w):Q.set(t,e,r,n),g.scissor(H.copy(Q).multiplyScalar(X).floor())},this.getScissorTest=function(){return $},this.setScissorTest=function(t){g.setScissorTest($=t)},this.setOpaqueSort=function(t){J=t},this.setTransparentSort=function(t){Z=t},this.getClearColor=function(){return A.getClearColor()},this.setClearColor=function(){A.setClearColor.apply(A,arguments)},this.getClearAlpha=function(){return A.getClearAlpha()},this.setClearAlpha=function(){A.setClearAlpha.apply(A,arguments)},this.clear=function(t,e,r){var n=0;(void 0===t||t)&&(n|=16384),(void 0===e||e)&&(n|=256),(void 0===r||r)&&(n|=1024),d.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",pt,!1),e.removeEventListener("webglcontextrestored",dt,!1),S.dispose(),T.dispose(),y.dispose(),w.dispose(),ut.dispose(),yt.stop()},this.renderBufferImmediate=function(t,e){g.initAttributes();var r=y.get(t);t.hasPositions&&!r.position&&(r.position=d.createBuffer()),t.hasNormals&&!r.normal&&(r.normal=d.createBuffer()),t.hasUvs&&!r.uv&&(r.uv=d.createBuffer()),t.hasColors&&!r.color&&(r.color=d.createBuffer());var n=e.getAttributes();t.hasPositions&&(d.bindBuffer(34962,r.position),d.bufferData(34962,t.positionArray,35048),g.enableAttribute(n.position),d.vertexAttribPointer(n.position,3,5126,!1,0,0)),t.hasNormals&&(d.bindBuffer(34962,r.normal),d.bufferData(34962,t.normalArray,35048),g.enableAttribute(n.normal),d.vertexAttribPointer(n.normal,3,5126,!1,0,0)),t.hasUvs&&(d.bindBuffer(34962,r.uv),d.bufferData(34962,t.uvArray,35048),g.enableAttribute(n.uv),d.vertexAttribPointer(n.uv,2,5126,!1,0,0)),t.hasColors&&(d.bindBuffer(34962,r.color),d.bufferData(34962,t.colorArray,35048),g.enableAttribute(n.color),d.vertexAttribPointer(n.color,3,5126,!1,0,0)),g.disableUnusedAttributes(),d.drawArrays(4,0,t.count),t.count=0};var gt=new Tn;this.renderBufferDirect=function(t,e,r,n,i,o){null===e&&(e=gt);var a=i.isMesh&&i.matrixWorld.determinant()<0,s=Et(t,e,n,i);g.setMaterial(n,a);var l=!1;j.geometry===r.id&&j.program===s.id&&j.wireframe===(!0===n.wireframe)||(j.geometry=r.id,j.program=s.id,j.wireframe=!0===n.wireframe,l=!0),(n.morphTargets||n.morphNormals)&&(C.update(i,r,n,s),l=!0),!0===i.isInstancedMesh&&(l=!0);var c=r.index,u=r.attributes.position;if(null===c){if(void 0===u||0===u.count)return}else if(0===c.count)return;var h,p=1;!0===n.wireframe&&(c=x.getWireframeAttribute(r),p=2);var v=P;null!==c&&(h=b.get(c),(v=O).setIndex(h)),l&&(!function(t,e,r,n){if(!1===m.isWebGL2&&(t.isInstancedMesh||e.isInstancedBufferGeometry)&&null===f.get("ANGLE_instanced_arrays"))return;g.initAttributes();var i=e.attributes,o=n.getAttributes(),a=r.defaultAttributeValues;for(var s in o){var l=o[s];if(l>=0){var c=i[s];if(void 0!==c){var u=c.normalized,h=c.itemSize;if(void 0===(E=b.get(c)))continue;var p=E.buffer,v=E.type,y=E.bytesPerElement;if(c.isInterleavedBufferAttribute){var _=c.data,x=_.stride,w=c.offset;_&&_.isInstancedInterleavedBuffer?(g.enableAttributeAndDivisor(l,_.meshPerAttribute),void 0===e._maxInstanceCount&&(e._maxInstanceCount=_.meshPerAttribute*_.count)):g.enableAttribute(l),d.bindBuffer(34962,p),g.vertexAttribPointer(l,h,v,u,x*y,w*y)}else c.isInstancedBufferAttribute?(g.enableAttributeAndDivisor(l,c.meshPerAttribute),void 0===e._maxInstanceCount&&(e._maxInstanceCount=c.meshPerAttribute*c.count)):g.enableAttribute(l),d.bindBuffer(34962,p),g.vertexAttribPointer(l,h,v,u,0,0)}else if("instanceMatrix"===s){var E;if(void 0===(E=b.get(t.instanceMatrix)))continue;p=E.buffer,v=E.type;g.enableAttributeAndDivisor(l+0,1),g.enableAttributeAndDivisor(l+1,1),g.enableAttributeAndDivisor(l+2,1),g.enableAttributeAndDivisor(l+3,1),d.bindBuffer(34962,p),d.vertexAttribPointer(l+0,4,v,!1,64,0),d.vertexAttribPointer(l+1,4,v,!1,64,16),d.vertexAttribPointer(l+2,4,v,!1,64,32),d.vertexAttribPointer(l+3,4,v,!1,64,48)}else if(void 0!==a){var M=a[s];if(void 0!==M)switch(M.length){case 2:d.vertexAttrib2fv(l,M);break;case 3:d.vertexAttrib3fv(l,M);break;case 4:d.vertexAttrib4fv(l,M);break;default:d.vertexAttrib1fv(l,M)}}}}g.disableUnusedAttributes()}(i,r,n,s),null!==c&&d.bindBuffer(34963,h.buffer));var y=null!==c?c.count:u.count,_=r.drawRange.start*p,w=r.drawRange.count*p,E=null!==o?o.start*p:0,M=null!==o?o.count*p:1/0,S=Math.max(_,E),T=Math.min(y,_+w,E+M)-1,A=Math.max(0,T-S+1);if(0!==A){if(i.isMesh)!0===n.wireframe?(g.setLineWidth(n.wireframeLinewidth*st()),v.setMode(1)):v.setMode(4);else if(i.isLine){var R=n.linewidth;void 0===R&&(R=1),g.setLineWidth(R*st()),i.isLineSegments?v.setMode(1):i.isLineLoop?v.setMode(2):v.setMode(3)}else i.isPoints?v.setMode(0):i.isSprite&&v.setMode(4);if(i.isInstancedMesh)v.renderInstances(r,S,A,i.count);else if(r.isInstancedBufferGeometry){var L=Math.min(r.instanceCount,r._maxInstanceCount);v.renderInstances(r,S,A,L)}else v.render(S,A)}},this.compile=function(t,e){(p=T.get(t,e)).init(),t.traverse((function(t){t.isLight&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))})),p.setupLights(e);const r={};t.traverse((function(e){let n=e.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++){let o=n[i];o.uuid in r==!1&&(wt(o,t,e),r[o.uuid]=!0)}else n.uuid in r==!1&&(wt(n,t,e),r[n.uuid]=!0)}))};var vt=null;var yt=new Io;function _t(t,e,r,n){if(!1!==t.visible){if(t.layers.test(e.layers))if(t.isGroup)r=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)p.pushLight(t),t.castShadow&&p.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||et.intersectsSprite(t)){n&&at.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ot);var i=w.update(t);(o=t.material).visible&&h.push(t,i,o,r,at.z,null)}}else if(t.isImmediateRenderObject)n&&at.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ot),h.push(t,null,t.material,r,at.z,null);else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==v.render.frame&&(t.skeleton.update(),t.skeleton.frame=v.render.frame),!t.frustumCulled||et.intersectsObject(t))){n&&at.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ot);i=w.update(t);var o=t.material;if(Array.isArray(o))for(var a=i.groups,s=0,l=a.length;s<l;s++){var c=a[s],u=o[c.materialIndex];u&&u.visible&&h.push(t,i,u,r,at.z,c)}else o.visible&&h.push(t,i,o,r,at.z,null)}var d=t.children;for(s=0,l=d.length;s<l;s++)_t(d[s],e,r,n)}}function bt(t,e,r,n){for(var i=0,o=t.length;i<o;i++){var a=t[i],s=a.object,l=a.geometry,c=void 0===n?a.material:n,u=a.group;if(r.isArrayCamera){z=r;for(var h=r.cameras,d=0,f=h.length;d<f;d++){var m=h[d];s.layers.test(m.layers)&&(g.viewport(V.copy(m.viewport)),p.setupLights(m),xt(s,e,m,l,c,u))}}else z=null,xt(s,e,r,l,c,u)}}function xt(t,e,r,n,i,o){if(t.onBeforeRender(L,e,r,n,i,o),p=T.get(e,z||r),t.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){var a=Et(r,e,i,t);g.setMaterial(i),j.geometry=null,j.program=null,j.wireframe=!1,function(t,e){t.render((function(t){L.renderBufferImmediate(t,e)}))}(t,a)}else L.renderBufferDirect(r,e,n,i,t,o);t.onAfterRender(L,e,r,n,i,o),p=T.get(e,z||r)}function wt(t,e,r){var n=y.get(t),i=p.state.lights,o=p.state.shadowsArray,a=i.state.version,s=E.getParameters(t,i.state,o,e,rt.numPlanes,rt.numIntersection,r),l=E.getProgramCacheKey(s),c=n.program,u=!0;if(void 0===c)t.addEventListener("dispose",ft);else if(c.cacheKey!==l)mt(t);else if(n.lightsStateVersion!==a)n.lightsStateVersion=a,u=!1;else{if(void 0!==s.shaderID)return;u=!1}u&&(c=E.acquireProgram(s,l),n.program=c,n.uniforms=s.uniforms,n.outputEncoding=s.outputEncoding,t.program=c);var h=c.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(var d=0;d<L.maxMorphTargets;d++)h["morphTarget"+d]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(d=0;d<L.maxMorphNormals;d++)h["morphNormal"+d]>=0&&t.numSupportedMorphNormals++}var f=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=rt.numPlanes,n.numIntersection=rt.numIntersection,f.clippingPlanes=rt.uniform),n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=a,n.needsLights&&(f.ambientLightColor.value=i.state.ambient,f.lightProbe.value=i.state.probe,f.directionalLights.value=i.state.directional,f.directionalLightShadows.value=i.state.directionalShadow,f.spotLights.value=i.state.spot,f.spotLightShadows.value=i.state.spotShadow,f.rectAreaLights.value=i.state.rectArea,f.pointLights.value=i.state.point,f.pointLightShadows.value=i.state.pointShadow,f.hemisphereLights.value=i.state.hemi,f.directionalShadowMap.value=i.state.directionalShadowMap,f.directionalShadowMatrix.value=i.state.directionalShadowMatrix,f.spotShadowMap.value=i.state.spotShadowMap,f.spotShadowMatrix.value=i.state.spotShadowMatrix,f.pointShadowMap.value=i.state.pointShadowMap,f.pointShadowMatrix.value=i.state.pointShadowMatrix);var m=n.program.getUniforms(),g=Ya.seqWithValue(m.seq,f);n.uniformsList=g}function Et(t,e,r,n){_.resetTextureUnits();var i=e.fog,o=r.isMeshStandardMaterial?e.environment:null,a=null===k?L.outputEncoding:k.texture.encoding,s=y.get(r),l=p.state.lights;if(nt&&(it||t!==G)){var c=t===G&&r.id===F;rt.setState(r.clippingPlanes,r.clipIntersection,r.clipShadows,t,s,c)}r.version===s.__version?void 0===s.program||r.fog&&s.fog!==i||s.environment!==o||s.needsLights&&s.lightsStateVersion!==l.state.version?wt(r,e,n):void 0===s.numClippingPlanes||s.numClippingPlanes===rt.numPlanes&&s.numIntersection===rt.numIntersection?s.outputEncoding!==a&&wt(r,e,n):wt(r,e,n):(wt(r,e,n),s.__version=r.version);var u,h,f=!1,v=!1,b=!1,x=s.program,w=x.getUniforms(),E=s.uniforms;if(g.useProgram(x.program)&&(f=!0,v=!0,b=!0),r.id!==F&&(F=r.id,v=!0),f||G!==t){if(w.setValue(d,"projectionMatrix",t.projectionMatrix),m.logarithmicDepthBuffer&&w.setValue(d,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),G!==t&&(G=t,v=!0,b=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var S=w.map.cameraPosition;void 0!==S&&S.setValue(d,at.setFromMatrixPosition(t.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&w.setValue(d,"isOrthographic",!0===t.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.skinning)&&w.setValue(d,"viewMatrix",t.matrixWorldInverse)}if(r.skinning){w.setOptional(d,n,"bindMatrix"),w.setOptional(d,n,"bindMatrixInverse");var T=n.skeleton;if(T){var A=T.bones;if(m.floatVertexTextures){if(void 0===T.boneTexture){var C=Math.sqrt(4*A.length);C=jr.ceilPowerOfTwo(C),C=Math.max(C,4);var P=new Float32Array(C*C*4);P.set(T.boneMatrices);var O=new Co(P,C,C,Gt,It);T.boneMatrices=P,T.boneTexture=O,T.boneTextureSize=C}w.setValue(d,"boneTexture",T.boneTexture,_),w.setValue(d,"boneTextureSize",T.boneTextureSize)}else w.setOptional(d,T,"boneMatrices")}}return(v||s.receiveShadow!==n.receiveShadow)&&(s.receiveShadow=n.receiveShadow,w.setValue(d,"receiveShadow",n.receiveShadow)),v&&(w.setValue(d,"toneMappingExposure",L.toneMappingExposure),w.setValue(d,"toneMappingWhitePoint",L.toneMappingWhitePoint),s.needsLights&&(h=b,(u=E).ambientLightColor.needsUpdate=h,u.lightProbe.needsUpdate=h,u.directionalLights.needsUpdate=h,u.directionalLightShadows.needsUpdate=h,u.pointLights.needsUpdate=h,u.pointLightShadows.needsUpdate=h,u.spotLights.needsUpdate=h,u.spotLightShadows.needsUpdate=h,u.rectAreaLights.needsUpdate=h,u.hemisphereLights.needsUpdate=h),i&&r.fog&&M.refreshFogUniforms(E,i),M.refreshMaterialUniforms(E,r,o,X,Y),void 0!==E.ltc_1&&(E.ltc_1.value=Lo.LTC_1),void 0!==E.ltc_2&&(E.ltc_2.value=Lo.LTC_2),Ya.upload(d,s.uniformsList,E,_)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(Ya.upload(d,s.uniformsList,E,_),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&w.setValue(d,"center",n.center),w.setValue(d,"modelViewMatrix",n.modelViewMatrix),w.setValue(d,"normalMatrix",n.normalMatrix),w.setValue(d,"modelMatrix",n.matrixWorld),x}yt.setAnimationLoop((function(t){ut.isPresenting||vt&&vt(t)})),"undefined"!=typeof window&&yt.setContext(window),this.setAnimationLoop=function(t){vt=t,ut.setAnimationLoop(t),yt.start()},this.render=function(t,e){var r,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),r=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),e&&e.isCamera){if(!I){j.geometry=null,j.program=null,j.wireframe=!1,F=-1,G=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),ut.enabled&&ut.isPresenting&&(e=ut.getCamera(e)),t.onBeforeRender(L,t,e,r||k),(p=T.get(t,e)).init(),ot.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),et.setFromProjectionMatrix(ot),it=this.localClippingEnabled,nt=rt.init(this.clippingPlanes,it,e),(h=S.get(t,e)).init(),_t(t,e,0,L.sortObjects),h.finish(),!0===L.sortObjects&&h.sort(J,Z),nt&&rt.beginShadows();var i=p.state.shadowsArray;ht.render(i,t,e),p.setupLights(e),nt&&rt.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==r&&this.setRenderTarget(r),A.render(h,t,e,n);var o=h.opaque,a=h.transparent;if(t.overrideMaterial){var s=t.overrideMaterial;o.length&&bt(o,t,e,s),a.length&&bt(a,t,e,s)}else o.length&&bt(o,t,e),a.length&&bt(a,t,e);t.onAfterRender(L,t,e),null!==k&&(_.updateRenderTargetMipmap(k),_.updateMultisampleRenderTarget(k)),g.buffers.depth.setTest(!0),g.buffers.depth.setMask(!0),g.buffers.color.setMask(!0),g.setPolygonOffset(!1),h=null,p=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(t){N!==t&&null===k&&d.bindFramebuffer(36160,t),N=t},this.getActiveCubeFace=function(){return B},this.getActiveMipmapLevel=function(){return D},this.getRenderTarget=function(){return k},this.setRenderTarget=function(t,e,r){k=t,B=e,D=r,t&&void 0===y.get(t).__webglFramebuffer&&_.setupRenderTarget(t);var n=N,i=!1;if(t){var o=y.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(n=o[e||0],i=!0):n=t.isWebGLMultisampleRenderTarget?y.get(t).__webglMultisampledFramebuffer:o,V.copy(t.viewport),H.copy(t.scissor),W=t.scissorTest}else V.copy(K).multiplyScalar(X).floor(),H.copy(Q).multiplyScalar(X).floor(),W=$;if(U!==n&&(d.bindFramebuffer(36160,n),U=n),g.viewport(V),g.scissor(H),g.setScissorTest(W),i){var a=y.get(t.texture);d.framebufferTexture2D(36160,36064,34069+(e||0),a.__webglTexture,r||0)}},this.readRenderTargetPixels=function(t,e,r,n,i,o,a){if(t&&t.isWebGLRenderTarget){var s=y.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(s=s[a]),s){var l=!1;s!==U&&(d.bindFramebuffer(36160,s),l=!0);try{var c=t.texture,u=c.format,h=c.type;if(u!==Gt&&R.convert(u)!==d.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===At||R.convert(h)===d.getParameter(35738)||h===It&&(m.isWebGL2||f.get("OES_texture_float")||f.get("WEBGL_color_buffer_float"))||h===Nt&&(m.isWebGL2?f.get("EXT_color_buffer_float"):f.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===d.checkFramebufferStatus(36160)?e>=0&&e<=t.width-n&&r>=0&&r<=t.height-i&&d.readPixels(e,r,n,i,R.convert(u),R.convert(h),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&d.bindFramebuffer(36160,U)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(t,e,r){void 0===r&&(r=0);var n=Math.pow(2,-r),i=Math.floor(e.image.width*n),o=Math.floor(e.image.height*n),a=R.convert(e.format);_.setTexture2D(e,0),d.copyTexImage2D(3553,r,a,t.x,t.y,i,o,0),g.unbindTexture()},this.copyTextureToTexture=function(t,e,r,n){void 0===n&&(n=0);var i=e.image.width,o=e.image.height,a=R.convert(r.format),s=R.convert(r.type);_.setTexture2D(r,0),e.isDataTexture?d.texSubImage2D(3553,n,t.x,t.y,i,o,a,s,e.image.data):e.isCompressedTexture?d.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):d.texSubImage2D(3553,n,t.x,t.y,a,s,e.image),0===n&&r.generateMipmaps&&d.generateMipmap(3553),g.unbindTexture()},this.initTexture=function(t){_.setTexture2D(t,0),g.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function ks(t,e){this.name="",this.color=new gi(t),this.density=void 0!==e?e:25e-5}function Us(t,e,r){this.name="",this.color=new gi(t),this.near=void 0!==e?e:1,this.far=void 0!==r?r:1e3}function Fs(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=Ar,this.updateRange={offset:0,count:-1},this.version=0}Rs.prototype=Object.assign(Object.create(Mo.prototype),{constructor:Rs,isArrayCamera:!0}),Ls.prototype=Object.assign(Object.create(Sn.prototype),{constructor:Ls,isGroup:!0}),Object.assign(Is.prototype,{constructor:Is,getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Ls,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Ls,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),this},update:function(t,e,r){var n=null,i=null,o=this._targetRay,a=this._grip;return t&&(null!==o&&null!==(n=e.getPose(t.targetRaySpace,r))&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale)),null!==a&&t.gripSpace&&null!==(i=e.getPose(t.gripSpace,r))&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale))),null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==i),this}}),Object.assign(Ns.prototype,Dr.prototype),Object.assign(ks.prototype,{isFogExp2:!0,clone:function(){return new ks(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Us.prototype,{isFog:!0,clone:function(){return new Us(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Fs.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Fs.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,r){t*=this.stride,r*=e.stride;for(var n=0,i=this.stride;n<i;n++)this.array[t+n]=e.array[r+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(t){return this.onUploadCallback=t,this}});var js,Gs=new Qr;function zs(t,e,r,n){this.name="",this.data=t,this.itemSize=e,this.offset=r,this.normalized=!0===n}function Vs(t){wi.call(this),this.type="SpriteMaterial",this.color=new gi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}Object.defineProperties(zs.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(zs.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(var e=0,r=this.data.count;e<r;e++)Gs.x=this.getX(e),Gs.y=this.getY(e),Gs.z=this.getZ(e),Gs.applyMatrix4(t),this.setXYZ(e,Gs.x,Gs.y,Gs.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this},setXYZ:function(t,e,r,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this},setXYZW:function(t,e,r,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=r,this.data.array[t+2]=n,this.data.array[t+3]=i,this},clone:function(){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var r=e*this.data.stride+this.offset,n=0;n<this.itemSize;n++)t.push(this.data.array[r+n]);return new Si(new this.array.constructor(t),this.itemSize,this.normalized)},toJSON:function(){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],e=0;e<this.count;e++)for(var r=e*this.data.stride+this.offset,n=0;n<this.itemSize;n++)t.push(this.data.array[r+n]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}}),Vs.prototype=Object.create(wi.prototype),Vs.prototype.constructor=Vs,Vs.prototype.isSpriteMaterial=!0,Vs.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};var Hs=new Qr,Ws=new Qr,qs=new Qr,Ys=new Gr,Xs=new Gr,Js=new sn,Zs=new Qr,Ks=new Qr,Qs=new Qr,$s=new Gr,tl=new Gr,el=new Gr;function rl(t){if(Sn.call(this),this.type="Sprite",void 0===js){js=new Hi;var e=new Fs(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);js.setIndex([0,1,2,0,2,3]),js.setAttribute("position",new zs(e,3,0,!1)),js.setAttribute("uv",new zs(e,2,3,!1))}this.geometry=js,this.material=void 0!==t?t:new Vs,this.center=new Gr(.5,.5)}function nl(t,e,r,n,i,o){Ys.subVectors(t,r).addScalar(.5).multiply(n),void 0!==i?(Xs.x=o*Ys.x-i*Ys.y,Xs.y=i*Ys.x+o*Ys.y):Xs.copy(Ys),t.copy(e),t.x+=Xs.x,t.y+=Xs.y,t.applyMatrix4(Js)}rl.prototype=Object.assign(Object.create(Sn.prototype),{constructor:rl,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ws.setFromMatrixScale(this.matrixWorld),Js.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),qs.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ws.multiplyScalar(-qs.z);var r,n,i=this.material.rotation;0!==i&&(n=Math.cos(i),r=Math.sin(i));var o=this.center;nl(Zs.set(-.5,-.5,0),qs,o,Ws,r,n),nl(Ks.set(.5,-.5,0),qs,o,Ws,r,n),nl(Qs.set(.5,.5,0),qs,o,Ws,r,n),$s.set(0,0),tl.set(1,0),el.set(1,1);var a=t.ray.intersectTriangle(Zs,Ks,Qs,!1,Hs);if(null!==a||(nl(Ks.set(-.5,.5,0),qs,o,Ws,r,n),tl.set(0,1),null!==(a=t.ray.intersectTriangle(Zs,Qs,Ks,!1,Hs)))){var s=t.ray.origin.distanceTo(Hs);s<t.near||s>t.far||e.push({distance:s,point:Hs.clone(),uv:pi.getUV(Hs,Zs,Ks,Qs,$s,tl,el,new Gr),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(t){return Sn.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this}});var il,ol,al,sl,ll,cl=new Qr,ul=new Qr;function hl(){Sn.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function pl(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),lo.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new sn,this.bindMatrixInverse=new sn}hl.prototype=Object.assign(Object.create(Sn.prototype),{constructor:hl,isLOD:!0,copy:function(t){Sn.prototype.copy.call(this,t,!1);for(var e=t.levels,r=0,n=e.length;r<n;r++){var i=e[r];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);for(var r=this.levels,n=0;n<r.length&&!(e<r[n].distance);n++);return r.splice(n,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){var e=this.levels;if(e.length>0){for(var r=1,n=e.length;r<n&&!(t<e[r].distance);r++);return e[r-1].object}return null},raycast:function(t,e){if(this.levels.length>0){cl.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(cl);this.getObjectForDistance(r).raycast(t,e)}},update:function(t){var e=this.levels;if(e.length>1){cl.setFromMatrixPosition(t.matrixWorld),ul.setFromMatrixPosition(this.matrixWorld);var r=cl.distanceTo(ul)/t.zoom;e[0].object.visible=!0;for(var n=1,i=e.length;n<i&&r>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<i;n++)e[n].object.visible=!1}},toJSON:function(t){var e=Sn.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];for(var r=this.levels,n=0,i=r.length;n<i;n++){var o=r[n];e.object.levels.push({object:o.object.uuid,distance:o.distance})}return e}}),pl.prototype=Object.assign(Object.create(lo.prototype),{constructor:pl,isSkinnedMesh:!0,bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var t=new qr,e=this.geometry.attributes.skinWeight,r=0,n=e.count;r<n;r++){t.x=e.getX(r),t.y=e.getY(r),t.z=e.getZ(r),t.w=e.getW(r);var i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(r,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){lo.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)},boneTransform:(il=new Qr,ol=new qr,al=new qr,sl=new Qr,ll=new sn,function(t,e){var r=this.skeleton,n=this.geometry;ol.fromBufferAttribute(n.attributes.skinIndex,t),al.fromBufferAttribute(n.attributes.skinWeight,t),il.fromBufferAttribute(n.attributes.position,t).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(var i=0;i<4;i++){var o=al.getComponent(i);if(0!==o){var a=ol.getComponent(i);ll.multiplyMatrices(r.bones[a].matrixWorld,r.boneInverses[a]),e.addScaledVector(sl.copy(il).applyMatrix4(ll),o)}}return e.applyMatrix4(this.bindMatrixInverse)})});var dl=new sn,fl=new sn;function ml(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new sn)}}function gl(){Sn.call(this),this.type="Bone"}Object.assign(ml.prototype,{calculateInverses:function(){this.boneInverses=[];for(var t=0,e=this.bones.length;t<e;t++){var r=new sn;this.bones[t]&&r.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(r)}},pose:function(){var t,e,r;for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&t.matrixWorld.getInverse(this.boneInverses[e]);for(e=0,r=this.bones.length;e<r;e++)(t=this.bones[e])&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))},update:function(){for(var t=this.bones,e=this.boneInverses,r=this.boneMatrices,n=this.boneTexture,i=0,o=t.length;i<o;i++){var a=t[i]?t[i].matrixWorld:fl;dl.multiplyMatrices(a,e[i]),dl.toArray(r,16*i)}void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new ml(this.bones,this.boneInverses)},getBoneByName:function(t){for(var e=0,r=this.bones.length;e<r;e++){var n=this.bones[e];if(n.name===t)return n}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),gl.prototype=Object.assign(Object.create(Sn.prototype),{constructor:gl,isBone:!0});var vl=new sn,yl=new sn,_l=[],bl=new lo;function xl(t,e,r){lo.call(this,t,e),this.instanceMatrix=new Si(new Float32Array(16*r),16),this.count=r,this.frustumCulled=!1}function wl(t){wi.call(this),this.type="LineBasicMaterial",this.color=new gi(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}xl.prototype=Object.assign(Object.create(lo.prototype),{constructor:xl,isInstancedMesh:!0,getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){var r=this.matrixWorld,n=this.count;if(bl.geometry=this.geometry,bl.material=this.material,void 0!==bl.material)for(var i=0;i<n;i++){this.getMatrixAt(i,vl),yl.multiplyMatrices(r,vl),bl.matrixWorld=yl,bl.raycast(t,_l);for(var o=0,a=_l.length;o<a;o++){var s=_l[o];s.instanceId=i,s.object=this,e.push(s)}_l.length=0}},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),wl.prototype=Object.create(wi.prototype),wl.prototype.constructor=wl,wl.prototype.isLineBasicMaterial=!0,wl.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};var El=new Qr,Ml=new Qr,Sl=new sn,Tl=new Kn,Al=new Vn;function Cl(t,e,r){1===r&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),Sn.call(this),this.type="Line",this.geometry=void 0!==t?t:new Hi,this.material=void 0!==e?e:new wl,this.updateMorphTargets()}Cl.prototype=Object.assign(Object.create(Sn.prototype),{constructor:Cl,isLine:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,r=[0],n=1,i=e.count;n<i;n++)El.fromBufferAttribute(e,n-1),Ml.fromBufferAttribute(e,n),r[n]=r[n-1],r[n]+=El.distanceTo(Ml);t.setAttribute("lineDistance",new Ii(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var o=t.vertices;(r=t.lineDistances)[0]=0;for(n=1,i=o.length;n<i;n++)r[n]=r[n-1],r[n]+=o[n-1].distanceTo(o[n])}return this},raycast:function(t,e){var r=this.geometry,n=this.matrixWorld,i=t.params.Line.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),Al.copy(r.boundingSphere),Al.applyMatrix4(n),Al.radius+=i,!1!==t.ray.intersectsSphere(Al)){Sl.getInverse(n),Tl.copy(t.ray).applyMatrix4(Sl);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,s=new Qr,l=new Qr,c=new Qr,u=new Qr,h=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var p=r.index,d=r.attributes.position.array;if(null!==p)for(var f=p.array,m=0,g=f.length-1;m<g;m+=h){var v=f[m],y=f[m+1];if(s.fromArray(d,3*v),l.fromArray(d,3*y),!(Tl.distanceSqToSegment(s,l,u,c)>a))u.applyMatrix4(this.matrixWorld),(x=t.ray.origin.distanceTo(u))<t.near||x>t.far||e.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}else for(m=0,g=d.length/3-1;m<g;m+=h){if(s.fromArray(d,3*m),l.fromArray(d,3*m+3),!(Tl.distanceSqToSegment(s,l,u,c)>a))u.applyMatrix4(this.matrixWorld),(x=t.ray.origin.distanceTo(u))<t.near||x>t.far||e.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else if(r.isGeometry){var _=r.vertices,b=_.length;for(m=0;m<b-1;m+=h){var x;if(!(Tl.distanceSqToSegment(_[m],_[m+1],u,c)>a))u.applyMatrix4(this.matrixWorld),(x=t.ray.origin.distanceTo(u))<t.near||x>t.far||e.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)r=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Pl=new Qr,Ol=new Qr;function Rl(t,e){Cl.call(this,t,e),this.type="LineSegments"}function Ll(t,e){Cl.call(this,t,e),this.type="LineLoop"}function Il(t){wi.call(this),this.type="PointsMaterial",this.color=new gi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}Rl.prototype=Object.assign(Object.create(Cl.prototype),{constructor:Rl,isLineSegments:!0,computeLineDistances:function(){var t=this.geometry;if(t.isBufferGeometry)if(null===t.index){for(var e=t.attributes.position,r=[],n=0,i=e.count;n<i;n+=2)Pl.fromBufferAttribute(e,n),Ol.fromBufferAttribute(e,n+1),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+Pl.distanceTo(Ol);t.setAttribute("lineDistance",new Ii(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){var o=t.vertices;for(r=t.lineDistances,n=0,i=o.length;n<i;n+=2)Pl.copy(o[n]),Ol.copy(o[n+1]),r[n]=0===n?0:r[n-1],r[n+1]=r[n]+Pl.distanceTo(Ol)}return this}}),Ll.prototype=Object.assign(Object.create(Cl.prototype),{constructor:Ll,isLineLoop:!0}),Il.prototype=Object.create(wi.prototype),Il.prototype.constructor=Il,Il.prototype.isPointsMaterial=!0,Il.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};var Nl=new sn,Bl=new Kn,Dl=new Vn,kl=new Qr;function Ul(t,e){Sn.call(this),this.type="Points",this.geometry=void 0!==t?t:new Hi,this.material=void 0!==e?e:new Il,this.updateMorphTargets()}function Fl(t,e,r,n,i,o,a){var s=Bl.distanceSqToPoint(t);if(s<r){var l=new Qr;Bl.closestPointToPoint(t,l),l.applyMatrix4(n);var c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(s),point:l,index:e,face:null,object:a})}}function jl(t,e,r,n,i,o,a,s,l){Wr.call(this,t,e,r,n,i,o,a,s,l),this.format=void 0!==a?a:jt,this.minFilter=void 0!==o?o:wt,this.magFilter=void 0!==i?i:wt,this.generateMipmaps=!1}function Gl(t,e,r,n,i,o,a,s,l,c,u,h){Wr.call(this,null,o,a,s,l,c,n,i,u,h),this.image={width:e,height:r},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function zl(t,e,r,n,i,o,a,s,l){Wr.call(this,t,e,r,n,i,o,a,s,l),this.needsUpdate=!0}function Vl(t,e,r,n,i,o,a,s,l,c){if((c=void 0!==c?c:Wt)!==Wt&&c!==qt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&c===Wt&&(r=Ot),void 0===r&&c===qt&&(r=Ut),Wr.call(this,null,n,i,o,a,s,c,r,l),this.image={width:t,height:e},this.magFilter=void 0!==a?a:vt,this.minFilter=void 0!==s?s:vt,this.flipY=!1,this.generateMipmaps=!1}function Hl(t){Hi.call(this),this.type="WireframeGeometry";var e,r,n,i,o,a,s,l,c,u,h=[],p=[0,0],d={},f=["a","b","c"];if(t&&t.isGeometry){var m=t.faces;for(e=0,n=m.length;e<n;e++){var g=m[e];for(r=0;r<3;r++)s=g[f[r]],l=g[f[(r+1)%3]],p[0]=Math.min(s,l),p[1]=Math.max(s,l),void 0===d[c=p[0]+","+p[1]]&&(d[c]={index1:p[0],index2:p[1]})}for(c in d)a=d[c],u=t.vertices[a.index1],h.push(u.x,u.y,u.z),u=t.vertices[a.index2],h.push(u.x,u.y,u.z)}else if(t&&t.isBufferGeometry){var v,y,_,b,x,w,E;if(u=new Qr,null!==t.index){for(v=t.attributes.position,y=t.index,0===(_=t.groups).length&&(_=[{start:0,count:y.count,materialIndex:0}]),i=0,o=_.length;i<o;++i)for(e=x=(b=_[i]).start,n=x+b.count;e<n;e+=3)for(r=0;r<3;r++)s=y.getX(e+r),l=y.getX(e+(r+1)%3),p[0]=Math.min(s,l),p[1]=Math.max(s,l),void 0===d[c=p[0]+","+p[1]]&&(d[c]={index1:p[0],index2:p[1]});for(c in d)a=d[c],u.fromBufferAttribute(v,a.index1),h.push(u.x,u.y,u.z),u.fromBufferAttribute(v,a.index2),h.push(u.x,u.y,u.z)}else for(e=0,n=(v=t.attributes.position).count/3;e<n;e++)for(r=0;r<3;r++)w=3*e+r,u.fromBufferAttribute(v,w),h.push(u.x,u.y,u.z),E=3*e+(r+1)%3,u.fromBufferAttribute(v,E),h.push(u.x,u.y,u.z)}this.setAttribute("position",new Ii(h,3))}function Wl(t,e,r){go.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:r},this.fromBufferGeometry(new ql(t,e,r)),this.mergeVertices()}function ql(t,e,r){Hi.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:r};var n,i,o=[],a=[],s=[],l=[],c=1e-5,u=new Qr,h=new Qr,p=new Qr,d=new Qr,f=new Qr;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=e+1;for(n=0;n<=r;n++){var g=n/r;for(i=0;i<=e;i++){var v=i/e;t(v,g,h),a.push(h.x,h.y,h.z),v-c>=0?(t(v-c,g,p),d.subVectors(h,p)):(t(v+c,g,p),d.subVectors(p,h)),g-c>=0?(t(v,g-c,p),f.subVectors(h,p)):(t(v,g+c,p),f.subVectors(p,h)),u.crossVectors(d,f).normalize(),s.push(u.x,u.y,u.z),l.push(v,g)}}for(n=0;n<r;n++)for(i=0;i<e;i++){var y=n*m+i,_=n*m+i+1,b=(n+1)*m+i+1,x=(n+1)*m+i;o.push(y,_,x),o.push(_,b,x)}this.setIndex(o),this.setAttribute("position",new Ii(a,3)),this.setAttribute("normal",new Ii(s,3)),this.setAttribute("uv",new Ii(l,2))}function Yl(t,e,r,n){go.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},this.fromBufferGeometry(new Xl(t,e,r,n)),this.mergeVertices()}function Xl(t,e,r,n){Hi.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:r,detail:n},r=r||1;var i=[],o=[];function a(t,e,r,n){var i,o,a=Math.pow(2,n),l=[];for(i=0;i<=a;i++){l[i]=[];var c=t.clone().lerp(r,i/a),u=e.clone().lerp(r,i/a),h=a-i;for(o=0;o<=h;o++)l[i][o]=0===o&&i===a?c:c.clone().lerp(u,o/h)}for(i=0;i<a;i++)for(o=0;o<2*(a-i)-1;o++){var p=Math.floor(o/2);o%2==0?(s(l[i][p+1]),s(l[i+1][p]),s(l[i][p])):(s(l[i][p+1]),s(l[i+1][p+1]),s(l[i+1][p]))}}function s(t){i.push(t.x,t.y,t.z)}function l(e,r){var n=3*e;r.x=t[n+0],r.y=t[n+1],r.z=t[n+2]}function c(t,e,r,n){n<0&&1===t.x&&(o[e]=t.x-1),0===r.x&&0===r.z&&(o[e]=n/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}function h(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}!function(t){for(var r=new Qr,n=new Qr,i=new Qr,o=0;o<e.length;o+=3)l(e[o+0],r),l(e[o+1],n),l(e[o+2],i),a(r,n,i,t)}(n=n||0),function(t){for(var e=new Qr,r=0;r<i.length;r+=3)e.x=i[r+0],e.y=i[r+1],e.z=i[r+2],e.normalize().multiplyScalar(t),i[r+0]=e.x,i[r+1]=e.y,i[r+2]=e.z}(r),function(){for(var t=new Qr,e=0;e<i.length;e+=3){t.x=i[e+0],t.y=i[e+1],t.z=i[e+2];var r=u(t)/2/Math.PI+.5,n=h(t)/Math.PI+.5;o.push(r,1-n)}(function(){for(var t=new Qr,e=new Qr,r=new Qr,n=new Qr,a=new Gr,s=new Gr,l=new Gr,h=0,p=0;h<i.length;h+=9,p+=6){t.set(i[h+0],i[h+1],i[h+2]),e.set(i[h+3],i[h+4],i[h+5]),r.set(i[h+6],i[h+7],i[h+8]),a.set(o[p+0],o[p+1]),s.set(o[p+2],o[p+3]),l.set(o[p+4],o[p+5]),n.copy(t).add(e).add(r).divideScalar(3);var d=u(n);c(a,p+0,t,d),c(s,p+2,e,d),c(l,p+4,r,d)}})(),function(){for(var t=0;t<o.length;t+=6){var e=o[t+0],r=o[t+2],n=o[t+4],i=Math.max(e,r,n),a=Math.min(e,r,n);i>.9&&a<.1&&(e<.2&&(o[t+0]+=1),r<.2&&(o[t+2]+=1),n<.2&&(o[t+4]+=1))}}()}(),this.setAttribute("position",new Ii(i,3)),this.setAttribute("normal",new Ii(i.slice(),3)),this.setAttribute("uv",new Ii(o,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}function Jl(t,e){go.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Zl(t,e)),this.mergeVertices()}function Zl(t,e){Xl.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Kl(t,e){go.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ql(t,e)),this.mergeVertices()}function Ql(t,e){Xl.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function $l(t,e){go.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new tc(t,e)),this.mergeVertices()}function tc(t,e){var r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1];Xl.call(this,n,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function ec(t,e){go.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new rc(t,e)),this.mergeVertices()}function rc(t,e){var r=(1+Math.sqrt(5))/2,n=1/r,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n];Xl.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function nc(t,e,r,n,i,o){go.call(this),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var a=new ic(t,e,r,n,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals,this.fromBufferGeometry(a),this.mergeVertices()}function ic(t,e,r,n,i){Hi.call(this),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:r,radialSegments:n,closed:i},e=e||64,r=r||1,n=n||8,i=i||!1;var o=t.computeFrenetFrames(e,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var a,s,l=new Qr,c=new Qr,u=new Gr,h=new Qr,p=[],d=[],f=[],m=[];function g(i){h=t.getPointAt(i/e,h);var a=o.normals[i],u=o.binormals[i];for(s=0;s<=n;s++){var f=s/n*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);c.x=g*a.x+m*u.x,c.y=g*a.y+m*u.y,c.z=g*a.z+m*u.z,c.normalize(),d.push(c.x,c.y,c.z),l.x=h.x+r*c.x,l.y=h.y+r*c.y,l.z=h.z+r*c.z,p.push(l.x,l.y,l.z)}}!function(){for(a=0;a<e;a++)g(a);g(!1===i?e:0),function(){for(a=0;a<=e;a++)for(s=0;s<=n;s++)u.x=a/e,u.y=s/n,f.push(u.x,u.y)}(),function(){for(s=1;s<=e;s++)for(a=1;a<=n;a++){var t=(n+1)*(s-1)+(a-1),r=(n+1)*s+(a-1),i=(n+1)*s+a,o=(n+1)*(s-1)+a;m.push(t,r,o),m.push(r,i,o)}}()}(),this.setIndex(m),this.setAttribute("position",new Ii(p,3)),this.setAttribute("normal",new Ii(d,3)),this.setAttribute("uv",new Ii(f,2))}function oc(t,e,r,n,i,o,a){go.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},void 0!==a&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new ac(t,e,r,n,i,o)),this.mergeVertices()}function ac(t,e,r,n,i,o){Hi.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:r,radialSegments:n,p:i,q:o},t=t||1,e=e||.4,r=Math.floor(r)||64,n=Math.floor(n)||8,i=i||2,o=o||3;var a,s,l=[],c=[],u=[],h=[],p=new Qr,d=new Qr,f=new Qr,m=new Qr,g=new Qr,v=new Qr,y=new Qr;for(a=0;a<=r;++a){var _=a/r*i*Math.PI*2;for(A(_,i,o,t,f),A(_+.01,i,o,t,m),v.subVectors(m,f),y.addVectors(m,f),g.crossVectors(v,y),y.crossVectors(g,v),g.normalize(),y.normalize(),s=0;s<=n;++s){var b=s/n*Math.PI*2,x=-e*Math.cos(b),w=e*Math.sin(b);p.x=f.x+(x*y.x+w*g.x),p.y=f.y+(x*y.y+w*g.y),p.z=f.z+(x*y.z+w*g.z),c.push(p.x,p.y,p.z),d.subVectors(p,f).normalize(),u.push(d.x,d.y,d.z),h.push(a/r),h.push(s/n)}}for(s=1;s<=r;s++)for(a=1;a<=n;a++){var E=(n+1)*(s-1)+(a-1),M=(n+1)*s+(a-1),S=(n+1)*s+a,T=(n+1)*(s-1)+a;l.push(E,M,T),l.push(M,S,T)}function A(t,e,r,n,i){var o=Math.cos(t),a=Math.sin(t),s=r/e*t,l=Math.cos(s);i.x=n*(2+l)*.5*o,i.y=n*(2+l)*a*.5,i.z=n*Math.sin(s)*.5}this.setIndex(l),this.setAttribute("position",new Ii(c,3)),this.setAttribute("normal",new Ii(u,3)),this.setAttribute("uv",new Ii(h,2))}function sc(t,e,r,n,i){go.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},this.fromBufferGeometry(new lc(t,e,r,n,i)),this.mergeVertices()}function lc(t,e,r,n,i){Hi.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:r,tubularSegments:n,arc:i},t=t||1,e=e||.4,r=Math.floor(r)||8,n=Math.floor(n)||6,i=i||2*Math.PI;var o,a,s=[],l=[],c=[],u=[],h=new Qr,p=new Qr,d=new Qr;for(o=0;o<=r;o++)for(a=0;a<=n;a++){var f=a/n*i,m=o/r*Math.PI*2;p.x=(t+e*Math.cos(m))*Math.cos(f),p.y=(t+e*Math.cos(m))*Math.sin(f),p.z=e*Math.sin(m),l.push(p.x,p.y,p.z),h.x=t*Math.cos(f),h.y=t*Math.sin(f),d.subVectors(p,h).normalize(),c.push(d.x,d.y,d.z),u.push(a/n),u.push(o/r)}for(o=1;o<=r;o++)for(a=1;a<=n;a++){var g=(n+1)*o+a-1,v=(n+1)*(o-1)+a-1,y=(n+1)*(o-1)+a,_=(n+1)*o+a;s.push(g,v,_),s.push(v,y,_)}this.setIndex(s),this.setAttribute("position",new Ii(l,3)),this.setAttribute("normal",new Ii(c,3)),this.setAttribute("uv",new Ii(u,2))}Ul.prototype=Object.assign(Object.create(Sn.prototype),{constructor:Ul,isPoints:!0,raycast:function(t,e){var r=this.geometry,n=this.matrixWorld,i=t.params.Points.threshold;if(null===r.boundingSphere&&r.computeBoundingSphere(),Dl.copy(r.boundingSphere),Dl.applyMatrix4(n),Dl.radius+=i,!1!==t.ray.intersectsSphere(Dl)){Nl.getInverse(n),Bl.copy(t.ray).applyMatrix4(Nl);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(r.isBufferGeometry){var s=r.index,l=r.attributes.position.array;if(null!==s)for(var c=s.array,u=0,h=c.length;u<h;u++){var p=c[u];kl.fromArray(l,3*p),Fl(kl,p,a,n,t,e,this)}else{u=0;for(var d=l.length/3;u<d;u++)kl.fromArray(l,3*u),Fl(kl,u,a,n,t,e,this)}}else{var f=r.vertices;for(u=0,d=f.length;u<d;u++)Fl(f[u],u,a,n,t,e,this)}}},updateMorphTargets:function(){var t,e,r,n=this.geometry;if(n.isBufferGeometry){var i=n.morphAttributes,o=Object.keys(i);if(o.length>0){var a=i[o[0]];if(void 0!==a)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,e=a.length;t<e;t++)r=a[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=t}}else{var s=n.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),jl.prototype=Object.assign(Object.create(Wr.prototype),{constructor:jl,isVideoTexture:!0,update:function(){var t=this.image;t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Gl.prototype=Object.create(Wr.prototype),Gl.prototype.constructor=Gl,Gl.prototype.isCompressedTexture=!0,zl.prototype=Object.create(Wr.prototype),zl.prototype.constructor=zl,zl.prototype.isCanvasTexture=!0,Vl.prototype=Object.create(Wr.prototype),Vl.prototype.constructor=Vl,Vl.prototype.isDepthTexture=!0,Hl.prototype=Object.create(Hi.prototype),Hl.prototype.constructor=Hl,Wl.prototype=Object.create(go.prototype),Wl.prototype.constructor=Wl,ql.prototype=Object.create(Hi.prototype),ql.prototype.constructor=ql,Yl.prototype=Object.create(go.prototype),Yl.prototype.constructor=Yl,Xl.prototype=Object.create(Hi.prototype),Xl.prototype.constructor=Xl,Jl.prototype=Object.create(go.prototype),Jl.prototype.constructor=Jl,Zl.prototype=Object.create(Xl.prototype),Zl.prototype.constructor=Zl,Kl.prototype=Object.create(go.prototype),Kl.prototype.constructor=Kl,Ql.prototype=Object.create(Xl.prototype),Ql.prototype.constructor=Ql,$l.prototype=Object.create(go.prototype),$l.prototype.constructor=$l,tc.prototype=Object.create(Xl.prototype),tc.prototype.constructor=tc,ec.prototype=Object.create(go.prototype),ec.prototype.constructor=ec,rc.prototype=Object.create(Xl.prototype),rc.prototype.constructor=rc,nc.prototype=Object.create(go.prototype),nc.prototype.constructor=nc,ic.prototype=Object.create(Hi.prototype),ic.prototype.constructor=ic,ic.prototype.toJSON=function(){var t=Hi.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t},oc.prototype=Object.create(go.prototype),oc.prototype.constructor=oc,ac.prototype=Object.create(Hi.prototype),ac.prototype.constructor=ac,sc.prototype=Object.create(go.prototype),sc.prototype.constructor=sc,lc.prototype=Object.create(Hi.prototype),lc.prototype.constructor=lc;var cc=function(t,e,r){r=r||2;var n,i,o,a,s,l,c,u=e&&e.length,h=u?e[0]*r:t.length,p=uc(t,0,h,r,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=uc(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(xc(a));for(s.sort(vc),i=0;i<s.length;i++)yc(s[i],r),r=hc(r,r.next);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var f=r;f<h;f+=r)(s=t[f])<n&&(n=s),(l=t[f+1])<i&&(i=l),s>o&&(o=s),l>a&&(a=l);c=0!==(c=Math.max(o-n,a-i))?1/c:0}return pc(p,d,r,n,i,c),d};function uc(t,e,r,n,i){var o,a;if(i===function(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}(t,e,r,n)>0)for(o=e;o<r;o+=n)a=Rc(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=Rc(o,t[o],t[o+1],a);return a&&Sc(a,a.next)&&(Lc(a),a=a.next),a}function hc(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Sc(n,n.next)&&0!==Mc(n.prev,n,n.next))n=n.next;else{if(Lc(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function pc(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=bc(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,l,c=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<c&&(s++,n=n.nextZ);e++);for(l=c;s>0||l>0&&n;)0!==s&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(a>1)}(i)}(t,n,i,o);for(var s,l,c=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?fc(t,n,i,o):dc(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),Lc(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?pc(t=mc(hc(t),e,r),e,r,n,i,o,2):2===a&&gc(t,e,r,n,i,o):pc(hc(t),e,r,n,i,o,1);break}}}function dc(t){var e=t.prev,r=t,n=t.next;if(Mc(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(wc(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&Mc(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function fc(t,e,r,n){var i=t.prev,o=t,a=t.next;if(Mc(i,o,a)>=0)return!1;for(var s=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,l=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,h=bc(s,l,e,r,n),p=bc(c,u,e,r,n),d=t.prevZ,f=t.nextZ;d&&d.z>=h&&f&&f.z<=p;){if(d!==t.prev&&d!==t.next&&wc(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Mc(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==t.prev&&f!==t.next&&wc(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Mc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=h;){if(d!==t.prev&&d!==t.next&&wc(i.x,i.y,o.x,o.y,a.x,a.y,d.x,d.y)&&Mc(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&wc(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Mc(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function mc(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!Sc(i,o)&&Tc(i,n,n.next,o)&&Pc(i,o)&&Pc(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),Lc(n),Lc(n.next),n=t=o),n=n.next}while(n!==t);return hc(n)}function gc(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Ec(a,s)){var l=Oc(a,s);return a=hc(a,a.next),l=hc(l,l.next),pc(a,e,r,n,i,o),void pc(l,e,r,n,i,o)}s=s.next}a=a.next}while(a!==t)}function vc(t,e){return t.x-e.x}function yc(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r;var l,c=r,u=r.x,h=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=u&&i!==n.x&&wc(o<h?i:a,o,u,h,o<h?a:i,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(i-n.x),Pc(n,t)&&(l<p||l===p&&(n.x>r.x||n.x===r.x&&_c(r,n)))&&(r=n,p=l)),n=n.next}while(n!==c);return r}(t,e),e){var r=Oc(e,t);hc(e,e.next),hc(r,r.next)}}function _c(t,e){return Mc(t.prev,t,e.prev)<0&&Mc(e.next,t,t.next)<0}function bc(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function xc(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function wc(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function Ec(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Tc(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(Pc(t,e)&&Pc(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(Mc(t.prev,t,e.prev)||Mc(t,e.prev,e))||Sc(t,e)&&Mc(t.prev,t,t.next)>0&&Mc(e.prev,e,e.next)>0)}function Mc(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Sc(t,e){return t.x===e.x&&t.y===e.y}function Tc(t,e,r,n){var i=Cc(Mc(t,e,r)),o=Cc(Mc(t,e,n)),a=Cc(Mc(r,n,t)),s=Cc(Mc(r,n,e));return i!==o&&a!==s||(!(0!==i||!Ac(t,r,e))||(!(0!==o||!Ac(t,n,e))||(!(0!==a||!Ac(r,t,n))||!(0!==s||!Ac(r,e,n)))))}function Ac(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Cc(t){return t>0?1:t<0?-1:0}function Pc(t,e){return Mc(t.prev,t,t.next)<0?Mc(t,e,t.next)>=0&&Mc(t,t.prev,e)>=0:Mc(t,e,t.prev)<0||Mc(t,t.next,e)<0}function Oc(t,e){var r=new Ic(t.i,t.x,t.y),n=new Ic(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function Rc(t,e,r,n){var i=new Ic(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Lc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ic(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Nc={area:function(t){for(var e=t.length,r=0,n=e-1,i=0;i<e;n=i++)r+=t[n].x*t[i].y-t[i].x*t[n].y;return.5*r},isClockWise:function(t){return Nc.area(t)<0},triangulateShape:function(t,e){var r=[],n=[],i=[];Bc(t),Dc(r,t);var o=t.length;e.forEach(Bc);for(var a=0;a<e.length;a++)n.push(o),o+=e[a].length,Dc(r,e[a]);var s=cc(r,n);for(a=0;a<s.length;a+=3)i.push(s.slice(a,a+3));return i}};function Bc(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Dc(t,e){for(var r=0;r<e.length;r++)t.push(e[r].x),t.push(e[r].y)}function kc(t,e){go.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Uc(t,e)),this.mergeVertices()}function Uc(t,e){Hi.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var r=this,n=[],i=[],o=0,a=t.length;o<a;o++){s(t[o])}function s(t){var o=[],a=void 0!==e.curveSegments?e.curveSegments:12,s=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:100,c=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:6,h=void 0!==e.bevelSize?e.bevelSize:u-2,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3,f=e.extrudePath,m=void 0!==e.UVGenerator?e.UVGenerator:Fc;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);var g,v,y,_,b,x,w,E,M=!1;f&&(g=f.getSpacedPoints(s),M=!0,c=!1,v=f.computeFrenetFrames(s,!1),y=new Qr,_=new Qr,b=new Qr),c||(d=0,u=0,h=0,p=0);var S=t.extractPoints(a),T=S.shape,A=S.holes;if(!Nc.isClockWise(T))for(T=T.reverse(),w=0,E=A.length;w<E;w++)x=A[w],Nc.isClockWise(x)&&(A[w]=x.reverse());var C=Nc.triangulateShape(T,A),P=T;for(w=0,E=A.length;w<E;w++)x=A[w],T=T.concat(x);function O(t,e,r){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(r).add(t)}var R,L,I,N,B,D,k=T.length,U=C.length;function F(t,e,r){var n,i,o,a=t.x-e.x,s=t.y-e.y,l=r.x-t.x,c=r.y-t.y,u=a*a+s*s,h=a*c-s*l;if(Math.abs(h)>Number.EPSILON){var p=Math.sqrt(u),d=Math.sqrt(l*l+c*c),f=e.x-s/p,m=e.y+a/p,g=((r.x-c/d-f)*c-(r.y+l/d-m)*l)/(a*c-s*l),v=(n=f+a*g-t.x)*n+(i=m+s*g-t.y)*i;if(v<=2)return new Gr(n,i);o=Math.sqrt(v/2)}else{var y=!1;a>Number.EPSILON?l>Number.EPSILON&&(y=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),y?(n=-s,i=a,o=Math.sqrt(u)):(n=a,i=s,o=Math.sqrt(u/2))}return new Gr(n/o,i/o)}for(var j=[],G=0,z=P.length,V=z-1,H=G+1;G<z;G++,V++,H++)V===z&&(V=0),H===z&&(H=0),j[G]=F(P[G],P[V],P[H]);var W,q,Y=[],X=j.concat();for(w=0,E=A.length;w<E;w++){for(x=A[w],W=[],G=0,V=(z=x.length)-1,H=G+1;G<z;G++,V++,H++)V===z&&(V=0),H===z&&(H=0),W[G]=F(x[G],x[V],x[H]);Y.push(W),X=X.concat(W)}for(R=0;R<d;R++){for(I=R/d,N=u*Math.cos(I*Math.PI/2),L=h*Math.sin(I*Math.PI/2)+p,G=0,z=P.length;G<z;G++)Z((B=O(P[G],j[G],L)).x,B.y,-N);for(w=0,E=A.length;w<E;w++)for(x=A[w],W=Y[w],G=0,z=x.length;G<z;G++)Z((B=O(x[G],W[G],L)).x,B.y,-N)}for(L=h+p,G=0;G<k;G++)B=c?O(T[G],X[G],L):T[G],M?(_.copy(v.normals[0]).multiplyScalar(B.x),y.copy(v.binormals[0]).multiplyScalar(B.y),b.copy(g[0]).add(_).add(y),Z(b.x,b.y,b.z)):Z(B.x,B.y,0);for(q=1;q<=s;q++)for(G=0;G<k;G++)B=c?O(T[G],X[G],L):T[G],M?(_.copy(v.normals[q]).multiplyScalar(B.x),y.copy(v.binormals[q]).multiplyScalar(B.y),b.copy(g[q]).add(_).add(y),Z(b.x,b.y,b.z)):Z(B.x,B.y,l/s*q);for(R=d-1;R>=0;R--){for(I=R/d,N=u*Math.cos(I*Math.PI/2),L=h*Math.sin(I*Math.PI/2)+p,G=0,z=P.length;G<z;G++)Z((B=O(P[G],j[G],L)).x,B.y,l+N);for(w=0,E=A.length;w<E;w++)for(x=A[w],W=Y[w],G=0,z=x.length;G<z;G++)B=O(x[G],W[G],L),M?Z(B.x,B.y+g[s-1].y,g[s-1].x+N):Z(B.x,B.y,l+N)}function J(t,e){var r,n;for(G=t.length;--G>=0;){r=G,(n=G-1)<0&&(n=t.length-1);var i=0,o=s+2*d;for(i=0;i<o;i++){var a=k*i,l=k*(i+1);Q(e+r+a,e+n+a,e+n+l,e+r+l)}}}function Z(t,e,r){o.push(t),o.push(e),o.push(r)}function K(t,e,i){$(t),$(e),$(i);var o=n.length/3,a=m.generateTopUV(r,n,o-3,o-2,o-1);tt(a[0]),tt(a[1]),tt(a[2])}function Q(t,e,i,o){$(t),$(e),$(o),$(e),$(i),$(o);var a=n.length/3,s=m.generateSideWallUV(r,n,a-6,a-3,a-2,a-1);tt(s[0]),tt(s[1]),tt(s[3]),tt(s[1]),tt(s[2]),tt(s[3])}function $(t){n.push(o[3*t+0]),n.push(o[3*t+1]),n.push(o[3*t+2])}function tt(t){i.push(t.x),i.push(t.y)}!function(){var t=n.length/3;if(c){var e=0,i=k*e;for(G=0;G<U;G++)K((D=C[G])[2]+i,D[1]+i,D[0]+i);for(i=k*(e=s+2*d),G=0;G<U;G++)K((D=C[G])[0]+i,D[1]+i,D[2]+i)}else{for(G=0;G<U;G++)K((D=C[G])[2],D[1],D[0]);for(G=0;G<U;G++)K((D=C[G])[0]+k*s,D[1]+k*s,D[2]+k*s)}r.addGroup(t,n.length/3-t,0)}(),function(){var t=n.length/3,e=0;for(J(P,e),e+=P.length,w=0,E=A.length;w<E;w++)J(x=A[w],e),e+=x.length;r.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Ii(n,3)),this.setAttribute("uv",new Ii(i,2)),this.computeVertexNormals()}kc.prototype=Object.create(go.prototype),kc.prototype.constructor=kc,kc.prototype.toJSON=function(){var t=go.prototype.toJSON.call(this);return jc(this.parameters.shapes,this.parameters.options,t)},Uc.prototype=Object.create(Hi.prototype),Uc.prototype.constructor=Uc,Uc.prototype.toJSON=function(){var t=Hi.prototype.toJSON.call(this);return jc(this.parameters.shapes,this.parameters.options,t)};var Fc={generateTopUV:function(t,e,r,n,i){var o=e[3*r],a=e[3*r+1],s=e[3*n],l=e[3*n+1],c=e[3*i],u=e[3*i+1];return[new Gr(o,a),new Gr(s,l),new Gr(c,u)]},generateSideWallUV:function(t,e,r,n,i,o){var a=e[3*r],s=e[3*r+1],l=e[3*r+2],c=e[3*n],u=e[3*n+1],h=e[3*n+2],p=e[3*i],d=e[3*i+1],f=e[3*i+2],m=e[3*o],g=e[3*o+1],v=e[3*o+2];return Math.abs(s-u)<.01?[new Gr(a,1-l),new Gr(c,1-h),new Gr(p,1-f),new Gr(m,1-v)]:[new Gr(s,1-l),new Gr(u,1-h),new Gr(d,1-f),new Gr(g,1-v)]}};function jc(t,e,r){if(r.shapes=[],Array.isArray(t))for(var n=0,i=t.length;n<i;n++){var o=t[n];r.shapes.push(o.uuid)}else r.shapes.push(t.uuid);return void 0!==e.extrudePath&&(r.options.extrudePath=e.extrudePath.toJSON()),r}function Gc(t,e){go.call(this),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new zc(t,e)),this.mergeVertices()}function zc(t,e){var r=(e=e||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new go;var n=r.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),Uc.call(this,n,e),this.type="TextBufferGeometry"}function Vc(t,e,r,n,i,o,a){go.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},this.fromBufferGeometry(new Hc(t,e,r,n,i,o,a)),this.mergeVertices()}function Hc(t,e,r,n,i,o,a){Hi.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:r,phiStart:n,phiLength:i,thetaStart:o,thetaLength:a},t=t||1,e=Math.max(3,Math.floor(e)||8),r=Math.max(2,Math.floor(r)||6),n=void 0!==n?n:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,a=void 0!==a?a:Math.PI;var s,l,c=Math.min(o+a,Math.PI),u=0,h=[],p=new Qr,d=new Qr,f=[],m=[],g=[],v=[];for(l=0;l<=r;l++){var y=[],_=l/r,b=0;for(0==l&&0==o?b=.5/e:l==r&&c==Math.PI&&(b=-.5/e),s=0;s<=e;s++){var x=s/e;p.x=-t*Math.cos(n+x*i)*Math.sin(o+_*a),p.y=t*Math.cos(o+_*a),p.z=t*Math.sin(n+x*i)*Math.sin(o+_*a),m.push(p.x,p.y,p.z),d.copy(p).normalize(),g.push(d.x,d.y,d.z),v.push(x+b,1-_),y.push(u++)}h.push(y)}for(l=0;l<r;l++)for(s=0;s<e;s++){var w=h[l][s+1],E=h[l][s],M=h[l+1][s],S=h[l+1][s+1];(0!==l||o>0)&&f.push(w,E,S),(l!==r-1||c<Math.PI)&&f.push(E,M,S)}this.setIndex(f),this.setAttribute("position",new Ii(m,3)),this.setAttribute("normal",new Ii(g,3)),this.setAttribute("uv",new Ii(v,2))}function Wc(t,e,r,n,i,o){go.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new qc(t,e,r,n,i,o)),this.mergeVertices()}function qc(t,e,r,n,i,o){Hi.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:r,phiSegments:n,thetaStart:i,thetaLength:o},t=t||.5,e=e||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8;var a,s,l,c=[],u=[],h=[],p=[],d=t,f=(e-t)/(n=void 0!==n?Math.max(1,n):1),m=new Qr,g=new Gr;for(s=0;s<=n;s++){for(l=0;l<=r;l++)a=i+l/r*o,m.x=d*Math.cos(a),m.y=d*Math.sin(a),u.push(m.x,m.y,m.z),h.push(0,0,1),g.x=(m.x/e+1)/2,g.y=(m.y/e+1)/2,p.push(g.x,g.y);d+=f}for(s=0;s<n;s++){var v=s*(r+1);for(l=0;l<r;l++){var y=a=l+v,_=a+r+1,b=a+r+2,x=a+1;c.push(y,_,x),c.push(_,b,x)}}this.setIndex(c),this.setAttribute("position",new Ii(u,3)),this.setAttribute("normal",new Ii(h,3)),this.setAttribute("uv",new Ii(p,2))}function Yc(t,e,r,n){go.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},this.fromBufferGeometry(new Xc(t,e,r,n)),this.mergeVertices()}function Xc(t,e,r,n){Hi.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:r,phiLength:n},e=Math.floor(e)||12,r=r||0,n=n||2*Math.PI,n=jr.clamp(n,0,2*Math.PI);var i,o,a,s=[],l=[],c=[],u=1/e,h=new Qr,p=new Gr;for(o=0;o<=e;o++){var d=r+o*u*n,f=Math.sin(d),m=Math.cos(d);for(a=0;a<=t.length-1;a++)h.x=t[a].x*f,h.y=t[a].y,h.z=t[a].x*m,l.push(h.x,h.y,h.z),p.x=o/e,p.y=a/(t.length-1),c.push(p.x,p.y)}for(o=0;o<e;o++)for(a=0;a<t.length-1;a++){var g=i=a+o*t.length,v=i+t.length,y=i+t.length+1,_=i+1;s.push(g,v,_),s.push(v,y,_)}if(this.setIndex(s),this.setAttribute("position",new Ii(l,3)),this.setAttribute("uv",new Ii(c,2)),this.computeVertexNormals(),n===2*Math.PI){var b=this.attributes.normal.array,x=new Qr,w=new Qr,E=new Qr;for(i=e*t.length*3,o=0,a=0;o<t.length;o++,a+=3)x.x=b[a+0],x.y=b[a+1],x.z=b[a+2],w.x=b[i+a+0],w.y=b[i+a+1],w.z=b[i+a+2],E.addVectors(x,w).normalize(),b[a+0]=b[i+a+0]=E.x,b[a+1]=b[i+a+1]=E.y,b[a+2]=b[i+a+2]=E.z}}function Jc(t,e){go.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Zc(t,e)),this.mergeVertices()}function Zc(t,e){Hi.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;var r=[],n=[],i=[],o=[],a=0,s=0;if(!1===Array.isArray(t))c(t);else for(var l=0;l<t.length;l++)c(t[l]),this.addGroup(a,s,l),a+=s,s=0;function c(t){var a,l,c,u=n.length/3,h=t.extractPoints(e),p=h.shape,d=h.holes;for(!1===Nc.isClockWise(p)&&(p=p.reverse()),a=0,l=d.length;a<l;a++)c=d[a],!0===Nc.isClockWise(c)&&(d[a]=c.reverse());var f=Nc.triangulateShape(p,d);for(a=0,l=d.length;a<l;a++)c=d[a],p=p.concat(c);for(a=0,l=p.length;a<l;a++){var m=p[a];n.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(a=0,l=f.length;a<l;a++){var g=f[a],v=g[0]+u,y=g[1]+u,_=g[2]+u;r.push(v,y,_),s+=3}}this.setIndex(r),this.setAttribute("position",new Ii(n,3)),this.setAttribute("normal",new Ii(i,3)),this.setAttribute("uv",new Ii(o,2))}function Kc(t,e){if(e.shapes=[],Array.isArray(t))for(var r=0,n=t.length;r<n;r++){var i=t[r];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}function Qc(t,e){Hi.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;var r,n,i,o,a=[],s=Math.cos(jr.DEG2RAD*e),l=[0,0],c={},u=["a","b","c"];t.isBufferGeometry?(o=new go).fromBufferGeometry(t):o=t.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,p=o.faces,d=0,f=p.length;d<f;d++)for(var m=p[d],g=0;g<3;g++)r=m[u[g]],n=m[u[(g+1)%3]],l[0]=Math.min(r,n),l[1]=Math.max(r,n),void 0===c[i=l[0]+","+l[1]]?c[i]={index1:l[0],index2:l[1],face1:d,face2:void 0}:c[i].face2=d;for(i in c){var v=c[i];if(void 0===v.face2||p[v.face1].normal.dot(p[v.face2].normal)<=s){var y=h[v.index1];a.push(y.x,y.y,y.z),y=h[v.index2],a.push(y.x,y.y,y.z)}}this.setAttribute("position",new Ii(a,3))}function $c(t,e,r,n,i,o,a,s){go.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new tu(t,e,r,n,i,o,a,s)),this.mergeVertices()}function tu(t,e,r,n,i,o,a,s){Hi.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:r,radialSegments:n,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:s};var l=this;t=void 0!==t?t:1,e=void 0!==e?e:1,r=r||1,n=Math.floor(n)||8,i=Math.floor(i)||1,o=void 0!==o&&o,a=void 0!==a?a:0,s=void 0!==s?s:2*Math.PI;var c=[],u=[],h=[],p=[],d=0,f=[],m=r/2,g=0;function v(r){var i,o,f,v=new Gr,y=new Qr,_=0,b=!0===r?t:e,x=!0===r?1:-1;for(o=d,i=1;i<=n;i++)u.push(0,m*x,0),h.push(0,x,0),p.push(.5,.5),d++;for(f=d,i=0;i<=n;i++){var w=i/n*s+a,E=Math.cos(w),M=Math.sin(w);y.x=b*M,y.y=m*x,y.z=b*E,u.push(y.x,y.y,y.z),h.push(0,x,0),v.x=.5*E+.5,v.y=.5*M*x+.5,p.push(v.x,v.y),d++}for(i=0;i<n;i++){var S=o+i,T=f+i;!0===r?c.push(T,T+1,S):c.push(T+1,T,S),_+=3}l.addGroup(g,_,!0===r?1:2),g+=_}!function(){var o,v,y=new Qr,_=new Qr,b=0,x=(e-t)/r;for(v=0;v<=i;v++){var w=[],E=v/i,M=E*(e-t)+t;for(o=0;o<=n;o++){var S=o/n,T=S*s+a,A=Math.sin(T),C=Math.cos(T);_.x=M*A,_.y=-E*r+m,_.z=M*C,u.push(_.x,_.y,_.z),y.set(A,x,C).normalize(),h.push(y.x,y.y,y.z),p.push(S,1-E),w.push(d++)}f.push(w)}for(o=0;o<n;o++)for(v=0;v<i;v++){var P=f[v][o],O=f[v+1][o],R=f[v+1][o+1],L=f[v][o+1];c.push(P,O,L),c.push(O,R,L),b+=6}l.addGroup(g,b,0),g+=b}(),!1===o&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Ii(u,3)),this.setAttribute("normal",new Ii(h,3)),this.setAttribute("uv",new Ii(p,2))}function eu(t,e,r,n,i,o,a){$c.call(this,0,t,e,r,n,i,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function ru(t,e,r,n,i,o,a){tu.call(this,0,t,e,r,n,i,o,a),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:r,heightSegments:n,openEnded:i,thetaStart:o,thetaLength:a}}function nu(t,e,r,n){go.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},this.fromBufferGeometry(new iu(t,e,r,n)),this.mergeVertices()}function iu(t,e,r,n){Hi.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:r,thetaLength:n},t=t||1,e=void 0!==e?Math.max(3,e):8,r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var i,o,a=[],s=[],l=[],c=[],u=new Qr,h=new Gr;for(s.push(0,0,0),l.push(0,0,1),c.push(.5,.5),o=0,i=3;o<=e;o++,i+=3){var p=r+o/e*n;u.x=t*Math.cos(p),u.y=t*Math.sin(p),s.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(s[i]/t+1)/2,h.y=(s[i+1]/t+1)/2,c.push(h.x,h.y)}for(i=1;i<=e;i++)a.push(i,i+1,0);this.setIndex(a),this.setAttribute("position",new Ii(s,3)),this.setAttribute("normal",new Ii(l,3)),this.setAttribute("uv",new Ii(c,2))}Gc.prototype=Object.create(go.prototype),Gc.prototype.constructor=Gc,zc.prototype=Object.create(Uc.prototype),zc.prototype.constructor=zc,Vc.prototype=Object.create(go.prototype),Vc.prototype.constructor=Vc,Hc.prototype=Object.create(Hi.prototype),Hc.prototype.constructor=Hc,Wc.prototype=Object.create(go.prototype),Wc.prototype.constructor=Wc,qc.prototype=Object.create(Hi.prototype),qc.prototype.constructor=qc,Yc.prototype=Object.create(go.prototype),Yc.prototype.constructor=Yc,Xc.prototype=Object.create(Hi.prototype),Xc.prototype.constructor=Xc,Jc.prototype=Object.create(go.prototype),Jc.prototype.constructor=Jc,Jc.prototype.toJSON=function(){var t=go.prototype.toJSON.call(this);return Kc(this.parameters.shapes,t)},Zc.prototype=Object.create(Hi.prototype),Zc.prototype.constructor=Zc,Zc.prototype.toJSON=function(){var t=Hi.prototype.toJSON.call(this);return Kc(this.parameters.shapes,t)},Qc.prototype=Object.create(Hi.prototype),Qc.prototype.constructor=Qc,$c.prototype=Object.create(go.prototype),$c.prototype.constructor=$c,tu.prototype=Object.create(Hi.prototype),tu.prototype.constructor=tu,eu.prototype=Object.create($c.prototype),eu.prototype.constructor=eu,ru.prototype=Object.create(tu.prototype),ru.prototype.constructor=ru,nu.prototype=Object.create(go.prototype),nu.prototype.constructor=nu,iu.prototype=Object.create(Hi.prototype),iu.prototype.constructor=iu;var ou=Object.freeze({__proto__:null,WireframeGeometry:Hl,ParametricGeometry:Wl,ParametricBufferGeometry:ql,TetrahedronGeometry:Jl,TetrahedronBufferGeometry:Zl,OctahedronGeometry:Kl,OctahedronBufferGeometry:Ql,IcosahedronGeometry:$l,IcosahedronBufferGeometry:tc,DodecahedronGeometry:ec,DodecahedronBufferGeometry:rc,PolyhedronGeometry:Yl,PolyhedronBufferGeometry:Xl,TubeGeometry:nc,TubeBufferGeometry:ic,TorusKnotGeometry:oc,TorusKnotBufferGeometry:ac,TorusGeometry:sc,TorusBufferGeometry:lc,TextGeometry:Gc,TextBufferGeometry:zc,SphereGeometry:Vc,SphereBufferGeometry:Hc,RingGeometry:Wc,RingBufferGeometry:qc,PlaneGeometry:Bo,PlaneBufferGeometry:Do,LatheGeometry:Yc,LatheBufferGeometry:Xc,ShapeGeometry:Jc,ShapeBufferGeometry:Zc,ExtrudeGeometry:kc,ExtrudeBufferGeometry:Uc,EdgesGeometry:Qc,ConeGeometry:eu,ConeBufferGeometry:ru,CylinderGeometry:$c,CylinderBufferGeometry:tu,CircleGeometry:nu,CircleBufferGeometry:iu,BoxGeometry:vo,BoxBufferGeometry:yo});function au(t){wi.call(this),this.type="ShadowMaterial",this.color=new gi(0),this.transparent=!0,this.setValues(t)}function su(t){wo.call(this,t),this.type="RawShaderMaterial"}function lu(t){wi.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new gi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new gi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cr,this.normalScale=new Gr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function cu(t){lu.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Gr(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(t)}function uu(t){wi.call(this),this.type="MeshPhongMaterial",this.color=new gi(16777215),this.specular=new gi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new gi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cr,this.normalScale=new Gr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=K,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function hu(t){wi.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new gi(16777215),this.specular=new gi(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new gi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cr,this.normalScale=new Gr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function pu(t){wi.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cr,this.normalScale=new Gr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function du(t){wi.call(this),this.type="MeshLambertMaterial",this.color=new gi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new gi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=K,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function fu(t){wi.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new gi(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cr,this.normalScale=new Gr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function mu(t){wl.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}au.prototype=Object.create(wi.prototype),au.prototype.constructor=au,au.prototype.isShadowMaterial=!0,au.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.color.copy(t.color),this},su.prototype=Object.create(wo.prototype),su.prototype.constructor=su,su.prototype.isRawShaderMaterial=!0,lu.prototype=Object.create(wi.prototype),lu.prototype.constructor=lu,lu.prototype.isMeshStandardMaterial=!0,lu.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},cu.prototype=Object.create(lu.prototype),cu.prototype.constructor=cu,cu.prototype.isMeshPhysicalMaterial=!0,cu.prototype.copy=function(t){return lu.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new gi).copy(t.sheen):this.sheen=null,this.transparency=t.transparency,this},uu.prototype=Object.create(wi.prototype),uu.prototype.constructor=uu,uu.prototype.isMeshPhongMaterial=!0,uu.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},hu.prototype=Object.create(wi.prototype),hu.prototype.constructor=hu,hu.prototype.isMeshToonMaterial=!0,hu.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},pu.prototype=Object.create(wi.prototype),pu.prototype.constructor=pu,pu.prototype.isMeshNormalMaterial=!0,pu.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},du.prototype=Object.create(wi.prototype),du.prototype.constructor=du,du.prototype.isMeshLambertMaterial=!0,du.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},fu.prototype=Object.create(wi.prototype),fu.prototype.constructor=fu,fu.prototype.isMeshMatcapMaterial=!0,fu.prototype.copy=function(t){return wi.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},mu.prototype=Object.create(wl.prototype),mu.prototype.constructor=mu,mu.prototype.isLineDashedMaterial=!0,mu.prototype.copy=function(t){return wl.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var gu=Object.freeze({__proto__:null,ShadowMaterial:au,SpriteMaterial:Vs,RawShaderMaterial:su,ShaderMaterial:wo,PointsMaterial:Il,MeshPhysicalMaterial:cu,MeshStandardMaterial:lu,MeshPhongMaterial:uu,MeshToonMaterial:hu,MeshNormalMaterial:pu,MeshLambertMaterial:du,MeshDepthMaterial:Ss,MeshDistanceMaterial:Ts,MeshBasicMaterial:Ei,MeshMatcapMaterial:fu,LineDashedMaterial:mu,LineBasicMaterial:wl,Material:wi}),vu={arraySlice:function(t,e,r){return vu.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==r?r:t.length)):t.slice(e,r)},convertArray:function(t,e,r){return!t||!r&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){for(var e=t.length,r=new Array(e),n=0;n!==e;++n)r[n]=n;return r.sort((function(e,r){return t[e]-t[r]})),r},sortedArray:function(t,e,r){for(var n=t.length,i=new t.constructor(n),o=0,a=0;a!==n;++o)for(var s=r[o]*e,l=0;l!==e;++l)i[a++]=t[s+l];return i},flattenJSON:function(t,e,r,n){for(var i=1,o=t[0];void 0!==o&&void 0===o[n];)o=t[i++];if(void 0!==o){var a=o[n];if(void 0!==a)if(Array.isArray(a))do{void 0!==(a=o[n])&&(e.push(o.time),r.push.apply(r,a)),o=t[i++]}while(void 0!==o);else if(void 0!==a.toArray)do{void 0!==(a=o[n])&&(e.push(o.time),a.toArray(r,r.length)),o=t[i++]}while(void 0!==o);else do{void 0!==(a=o[n])&&(e.push(o.time),r.push(a)),o=t[i++]}while(void 0!==o)}},subclip:function(t,e,r,n,i){i=i||30;var o=t.clone();o.name=e;for(var a=[],s=0;s<o.tracks.length;++s){for(var l=o.tracks[s],c=l.getValueSize(),u=[],h=[],p=0;p<l.times.length;++p){var d=l.times[p]*i;if(!(d<r||d>=n)){u.push(l.times[p]);for(var f=0;f<c;++f)h.push(l.values[p*c+f])}}0!==u.length&&(l.times=vu.convertArray(u,l.times.constructor),l.values=vu.convertArray(h,l.values.constructor),a.push(l))}o.tracks=a;var m=1/0;for(s=0;s<o.tracks.length;++s)m>o.tracks[s].times[0]&&(m=o.tracks[s].times[0]);for(s=0;s<o.tracks.length;++s)o.tracks[s].shift(-1*m);return o.resetDuration(),o},makeClipAdditive:function(t,e,r,n){void 0===e&&(e=0),void 0===r&&(r=t),(void 0===n||n<=0)&&(n=30);for(var i=t.tracks.length,o=e/n,a=0;a<i;++a){var s=r.tracks[a],l=s.ValueTypeName;if("bool"!==l&&"string"!==l){var c=t.tracks.find((function(t){return t.name===s.name&&t.ValueTypeName===l}));if(void 0!==c){var u,h=s.getValueSize(),p=s.times.length-1;if(o<=s.times[0])u=vu.arraySlice(s.values,0,s.valueSize);else if(o>=s.times[p]){var d=p*h;u=vu.arraySlice(s.values,d)}else{var f=s.createInterpolant();f.evaluate(o),u=f.resultBuffer}if("quaternion"===l)new Jr(u[0],u[1],u[2],u[3]).normalize().conjugate().toArray(u);for(var m=c.times.length,g=0;g<m;++g){var v=g*h;if("quaternion"===l)Jr.multiplyQuaternionsFlat(c.values,v,u,0,c.values,v);else for(var y=0;y<h;++y)c.values[v+y]-=u[y]}}}}return t.blendMode=Je,t}};function yu(t,e,r,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(r),this.sampleValues=e,this.valueSize=r}function _u(t,e,r,n){yu.call(this,t,e,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function bu(t,e,r,n){yu.call(this,t,e,r,n)}function xu(t,e,r,n){yu.call(this,t,e,r,n)}function wu(t,e,r,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=vu.convertArray(e,this.TimeBufferType),this.values=vu.convertArray(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function Eu(t,e,r){wu.call(this,t,e,r)}function Mu(t,e,r,n){wu.call(this,t,e,r,n)}function Su(t,e,r,n){wu.call(this,t,e,r,n)}function Tu(t,e,r,n){yu.call(this,t,e,r,n)}function Au(t,e,r,n){wu.call(this,t,e,r,n)}function Cu(t,e,r,n){wu.call(this,t,e,r,n)}function Pu(t,e,r,n){wu.call(this,t,e,r,n)}function Ou(t,e,r,n){this.name=t,this.tracks=r,this.duration=void 0!==e?e:-1,this.blendMode=void 0!==n?n:Xe,this.uuid=jr.generateUUID(),this.duration<0&&this.resetDuration()}function Ru(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Su;case"vector":case"vector2":case"vector3":case"vector4":return Pu;case"color":return Mu;case"quaternion":return Au;case"bool":case"boolean":return Eu;case"string":return Cu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){var r=[],n=[];vu.flattenJSON(t.keys,r,n,"value"),t.times=r,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(yu.prototype,{evaluate:function(t){var e=this.parameterPositions,r=this._cachedIndex,n=e[r],i=e[r-1];t:{e:{var o;r:{n:if(!(t<n)){for(var a=r+2;;){if(void 0===n){if(t<i)break n;return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,t,i)}if(r===a)break;if(i=n,t<(n=e[++r]))break e}o=e.length;break r}if(t>=i)break t;var s=e[1];t<s&&(r=2,i=s);for(a=r-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(r===a)break;if(n=i,t>=(i=e[--r-1]))break e}o=r,r=0}for(;r<o;){var l=r+o>>>1;t<e[l]?o=l:r=l+1}if(n=e[r],void 0===(i=e[r-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return r=e.length,this._cachedIndex=r,this.afterEnd_(r-1,i,t)}this._cachedIndex=r,this.intervalChanged_(r,i,n)}return this.interpolate_(r,i,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){for(var e=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=t*n,o=0;o!==n;++o)e[o]=r[i+o];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(yu.prototype,{beforeStart_:yu.prototype.copySampleValue_,afterEnd_:yu.prototype.copySampleValue_}),_u.prototype=Object.assign(Object.create(yu.prototype),{constructor:_u,DefaultSettings_:{endingStart:We,endingEnd:We},intervalChanged_:function(t,e,r){var n=this.parameterPositions,i=t-2,o=t+1,a=n[i],s=n[o];if(void 0===a)switch(this.getSettings_().endingStart){case qe:i=t,a=2*e-r;break;case Ye:a=e+n[i=n.length-2]-n[i+1];break;default:i=t,a=r}if(void 0===s)switch(this.getSettings_().endingEnd){case qe:o=t,s=2*r-e;break;case Ye:o=1,s=r+n[1]-n[0];break;default:o=t-1,s=e}var l=.5*(r-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(s-r),this._offsetPrev=i*c,this._offsetNext=o*c},interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,p=this._weightNext,d=(r-e)/(n-e),f=d*d,m=f*d,g=-h*m+2*h*f-h*d,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,_=p*m-p*f,b=0;b!==a;++b)i[b]=g*o[c+b]+v*o[l+b]+y*o[s+b]+_*o[u+b];return i}}),bu.prototype=Object.assign(Object.create(yu.prototype),{constructor:bu,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=s-a,c=(r-e)/(n-e),u=1-c,h=0;h!==a;++h)i[h]=o[l+h]*u+o[s+h]*c;return i}}),xu.prototype=Object.assign(Object.create(yu.prototype),{constructor:xu,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(wu,{toJSON:function(t){var e,r=t.constructor;if(void 0!==r.toJSON)e=r.toJSON(t);else{e={name:t.name,times:vu.convertArray(t.times,Array),values:vu.convertArray(t.values,Array)};var n=t.getInterpolation();n!==t.DefaultInterpolation&&(e.interpolation=n)}return e.type=t.ValueTypeName,e}}),Object.assign(wu.prototype,{constructor:wu,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Ve,InterpolantFactoryMethodDiscrete:function(t){return new xu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new bu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new _u(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){var e;switch(t){case ze:e=this.InterpolantFactoryMethodDiscrete;break;case Ve:e=this.InterpolantFactoryMethodLinear;break;case He:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ze;case this.InterpolantFactoryMethodLinear:return Ve;case this.InterpolantFactoryMethodSmooth:return He}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,r=0,n=e.length;r!==n;++r)e[r]*=t;return this},trim:function(t,e){for(var r=this.times,n=r.length,i=0,o=n-1;i!==n&&r[i]<t;)++i;for(;-1!==o&&r[o]>e;)--o;if(++o,0!==i||o!==n){i>=o&&(i=(o=Math.max(o,1))-1);var a=this.getValueSize();this.times=vu.arraySlice(r,i,o),this.values=vu.arraySlice(this.values,i*a,o*a)}return this},validate:function(){var t=!0,e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);var r=this.times,n=this.values,i=r.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);for(var o=null,a=0;a!==i;a++){var s=r[a];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,s),t=!1;break}if(null!==o&&o>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,s,o),t=!1;break}o=s}if(void 0!==n&&vu.isTypedArray(n)){a=0;for(var l=n.length;a!==l;++a){var c=n[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),t=!1;break}}}return t},optimize:function(){for(var t=vu.arraySlice(this.times),e=vu.arraySlice(this.values),r=this.getValueSize(),n=this.getInterpolation()===He,i=1,o=t.length-1,a=1;a<o;++a){var s=!1,l=t[a];if(l!==t[a+1]&&(1!==a||l!==l[0]))if(n)s=!0;else for(var c=a*r,u=c-r,h=c+r,p=0;p!==r;++p){var d=e[c+p];if(d!==e[u+p]||d!==e[h+p]){s=!0;break}}if(s){if(a!==i){t[i]=t[a];var f=a*r,m=i*r;for(p=0;p!==r;++p)e[m+p]=e[f+p]}++i}}if(o>0){t[i]=t[o];for(f=o*r,m=i*r,p=0;p!==r;++p)e[m+p]=e[f+p];++i}return i!==t.length?(this.times=vu.arraySlice(t,0,i),this.values=vu.arraySlice(e,0,i*r)):(this.times=t,this.values=e),this},clone:function(){var t=vu.arraySlice(this.times,0),e=vu.arraySlice(this.values,0),r=new(0,this.constructor)(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}}),Eu.prototype=Object.assign(Object.create(wu.prototype),{constructor:Eu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:ze,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Mu.prototype=Object.assign(Object.create(wu.prototype),{constructor:Mu,ValueTypeName:"color"}),Su.prototype=Object.assign(Object.create(wu.prototype),{constructor:Su,ValueTypeName:"number"}),Tu.prototype=Object.assign(Object.create(yu.prototype),{constructor:Tu,interpolate_:function(t,e,r,n){for(var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=t*a,l=(r-e)/(n-e),c=s+a;s!==c;s+=4)Jr.slerpFlat(i,0,o,s-a,o,s,l);return i}}),Au.prototype=Object.assign(Object.create(wu.prototype),{constructor:Au,ValueTypeName:"quaternion",DefaultInterpolation:Ve,InterpolantFactoryMethodLinear:function(t){return new Tu(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Cu.prototype=Object.assign(Object.create(wu.prototype),{constructor:Cu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:ze,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Pu.prototype=Object.assign(Object.create(wu.prototype),{constructor:Pu,ValueTypeName:"vector"}),Object.assign(Ou,{parse:function(t){for(var e=[],r=t.tracks,n=1/(t.fps||1),i=0,o=r.length;i!==o;++i)e.push(Ru(r[i]).scale(n));return new Ou(t.name,t.duration,e,t.blendMode)},toJSON:function(t){for(var e=[],r=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode},i=0,o=r.length;i!==o;++i)e.push(wu.toJSON(r[i]));return n},CreateFromMorphTargetSequence:function(t,e,r,n){for(var i=e.length,o=[],a=0;a<i;a++){var s=[],l=[];s.push((a+i-1)%i,a,(a+1)%i),l.push(0,1,0);var c=vu.getKeyframeOrder(s);s=vu.sortedArray(s,1,c),l=vu.sortedArray(l,1,c),n||0!==s[0]||(s.push(i),l.push(l[0])),o.push(new Su(".morphTargetInfluences["+e[a].name+"]",s,l).scale(1/r))}return new Ou(t,-1,o)},findByName:function(t,e){var r=t;if(!Array.isArray(t)){var n=t;r=n.geometry&&n.geometry.animations||n.animations}for(var i=0;i<r.length;i++)if(r[i].name===e)return r[i];return null},CreateClipsFromMorphTargetSequences:function(t,e,r){for(var n={},i=/^([\w-]*?)([\d]+)$/,o=0,a=t.length;o<a;o++){var s=t[o],l=s.name.match(i);if(l&&l.length>1){var c=n[h=l[1]];c||(n[h]=c=[]),c.push(s)}}var u=[];for(var h in n)u.push(Ou.CreateFromMorphTargetSequence(h,n[h],e,r));return u},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(t,e,r,n,i){if(0!==r.length){var o=[],a=[];vu.flattenJSON(r,o,a,n),0!==o.length&&i.push(new t(e,o,a))}},n=[],i=t.name||"default",o=t.length||-1,a=t.fps||30,s=t.blendMode,l=t.hierarchy||[],c=0;c<l.length;c++){var u=l[c].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var h={},p=0;p<u.length;p++)if(u[p].morphTargets)for(var d=0;d<u[p].morphTargets.length;d++)h[u[p].morphTargets[d]]=-1;for(var f in h){var m=[],g=[];for(d=0;d!==u[p].morphTargets.length;++d){var v=u[p];m.push(v.time),g.push(v.morphTarget===f?1:0)}n.push(new Su(".morphTargetInfluence["+f+"]",m,g))}o=h.length*(a||1)}else{var y=".bones["+e[c].name+"]";r(Pu,y+".position",u,"pos",n),r(Au,y+".quaternion",u,"rot",n),r(Pu,y+".scale",u,"scl",n)}}return 0===n.length?null:new Ou(i,o,n,s)}}),Object.assign(Ou.prototype,{resetDuration:function(){for(var t=0,e=0,r=this.tracks.length;e!==r;++e){var n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Ou(this.name,this.duration,t,this.blendMode)}});var Lu={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Iu(t,e,r){var n=this,i=!1,o=0,a=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=r,this.itemStart=function(t){a++,!1===i&&void 0!==n.onStart&&n.onStart(t,o,a),i=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(i=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){var e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(var e=0,r=l.length;e<r;e+=2){var n=l[e],i=l[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}var Nu=new Iu;function Bu(t){this.manager=void 0!==t?t:Nu,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Bu.prototype,{load:function(){},loadAsync:function(t,e){var r=this;return new Promise((function(n,i){r.load(t,n,e,i)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});var Du={};function ku(t){Bu.call(this,t)}function Uu(t){Bu.call(this,t)}function Fu(t){Bu.call(this,t)}function ju(t){Bu.call(this,t)}function Gu(t){Bu.call(this,t)}function zu(t){Bu.call(this,t)}function Vu(t){Bu.call(this,t)}function Hu(){this.type="Curve",this.arcLengthDivisions=200}function Wu(t,e,r,n,i,o,a,s){Hu.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=r||1,this.yRadius=n||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=a||!1,this.aRotation=s||0}function qu(t,e,r,n,i,o){Wu.call(this,t,e,r,r,n,i,o),this.type="ArcCurve"}function Yu(){var t=0,e=0,r=0,n=0;function i(i,o,a,s){t=i,e=a,r=-3*i+3*o-2*a-s,n=2*i-2*o+a+s}return{initCatmullRom:function(t,e,r,n,o){i(e,r,o*(r-t),o*(n-e))},initNonuniformCatmullRom:function(t,e,r,n,o,a,s){var l=(e-t)/o-(r-t)/(o+a)+(r-e)/a,c=(r-e)/a-(n-e)/(a+s)+(n-r)/s;i(e,r,l*=a,c*=a)},calc:function(i){var o=i*i;return t+e*i+r*o+n*(o*i)}}}ku.prototype=Object.assign(Object.create(Bu.prototype),{constructor:ku,load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Lu.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;if(void 0===Du[t]){var a=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(a){var s=a[1],l=!!a[2],c=a[3];c=decodeURIComponent(c),l&&(c=atob(c));try{var u,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var p=new Uint8Array(c.length),d=0;d<c.length;d++)p[d]=c.charCodeAt(d);u="blob"===h?new Blob([p.buffer],{type:s}):p.buffer;break;case"document":var f=new DOMParser;u=f.parseFromString(c,s);break;case"json":u=JSON.parse(c);break;default:u=c}setTimeout((function(){e&&e(u),i.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}),0)}}else{Du[t]=[],Du[t].push({onLoad:e,onProgress:r,onError:n});var m=new XMLHttpRequest;for(var g in m.open("GET",t,!0),m.addEventListener("load",(function(e){var r=this.response,n=Du[t];if(delete Du[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Lu.add(t,r);for(var o=0,a=n.length;o<a;o++){(s=n[o]).onLoad&&s.onLoad(r)}i.manager.itemEnd(t)}else{for(o=0,a=n.length;o<a;o++){var s;(s=n[o]).onError&&s.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}}),!1),m.addEventListener("progress",(function(e){for(var r=Du[t],n=0,i=r.length;n<i;n++){var o=r[n];o.onProgress&&o.onProgress(e)}}),!1),m.addEventListener("error",(function(e){var r=Du[t];delete Du[t];for(var n=0,o=r.length;n<o;n++){var a=r[n];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),m.addEventListener("abort",(function(e){var r=Du[t];delete Du[t];for(var n=0,o=r.length;n<o;n++){var a=r[n];a.onError&&a.onError(e)}i.manager.itemError(t),i.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(g,this.requestHeader[g]);m.send(null)}return i.manager.itemStart(t),m}Du[t].push({onLoad:e,onProgress:r,onError:n})},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),Uu.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Uu,load:function(t,e,r,n){var i=this,o=new ku(i.manager);o.setPath(i.path),o.load(t,(function(r){try{e(i.parse(JSON.parse(r)))}catch(e){n?n(e):console.error(e),i.manager.itemError(t)}}),r,n)},parse:function(t){for(var e=[],r=0;r<t.length;r++){var n=Ou.parse(t[r]);e.push(n)}return e}}),Fu.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Fu,load:function(t,e,r,n){var i=this,o=[],a=new Gl;a.image=o;var s=new ku(this.manager);function l(l){s.load(t[l],(function(t){var r=i.parse(t,!0);o[l]={width:r.width,height:r.height,format:r.format,mipmaps:r.mipmaps},6===(c+=1)&&(1===r.mipmapCount&&(a.minFilter=wt),a.format=r.format,a.needsUpdate=!0,e&&e(a))}),r,n)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(t))for(var c=0,u=0,h=t.length;u<h;++u)l(u);else s.load(t,(function(t){var r=i.parse(t,!0);if(r.isCubemap)for(var n=r.mipmaps.length/r.mipmapCount,s=0;s<n;s++){o[s]={mipmaps:[]};for(var l=0;l<r.mipmapCount;l++)o[s].mipmaps.push(r.mipmaps[s*r.mipmapCount+l]),o[s].format=r.format,o[s].width=r.width,o[s].height=r.height}else a.image.width=r.width,a.image.height=r.height,a.mipmaps=r.mipmaps;1===r.mipmapCount&&(a.minFilter=wt),a.format=r.format,a.needsUpdate=!0,e&&e(a)}),r,n);return a}}),ju.prototype=Object.assign(Object.create(Bu.prototype),{constructor:ju,load:function(t,e,r,n){var i=this,o=new Co,a=new ku(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(t,(function(t){var r=i.parse(t);r&&(void 0!==r.image?o.image=r.image:void 0!==r.data&&(o.image.width=r.width,o.image.height=r.height,o.image.data=r.data),o.wrapS=void 0!==r.wrapS?r.wrapS:mt,o.wrapT=void 0!==r.wrapT?r.wrapT:mt,o.magFilter=void 0!==r.magFilter?r.magFilter:wt,o.minFilter=void 0!==r.minFilter?r.minFilter:wt,o.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.mipmaps&&(o.mipmaps=r.mipmaps,o.minFilter=St),1===r.mipmapCount&&(o.minFilter=wt),o.needsUpdate=!0,e&&e(o,r))}),r,n),o}}),Gu.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Gu,load:function(t,e,r,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Lu.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;var a=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),Lu.add(t,this),e&&e(this),i.manager.itemEnd(t)}function l(e){a.removeEventListener("load",s,!1),a.removeEventListener("error",l,!1),n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)}return a.addEventListener("load",s,!1),a.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(t),a.src=t,a}}),zu.prototype=Object.assign(Object.create(Bu.prototype),{constructor:zu,load:function(t,e,r,n){var i=new Zo,o=new Gu(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var a=0;function s(r){o.load(t[r],(function(t){i.images[r]=t,6===++a&&(i.needsUpdate=!0,e&&e(i))}),void 0,n)}for(var l=0;l<t.length;++l)s(l);return i}}),Vu.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Vu,load:function(t,e,r,n){var i=new Wr,o=new Gu(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,(function(r){i.image=r;var n=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=n?jt:Gt,i.needsUpdate=!0,void 0!==e&&e(i)}),r,n),i}}),Object.assign(Hu.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){var r=this.getUtoTmapping(t);return this.getPoint(r,e)},getPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);for(var e=[],r=0;r<=t;r++)e.push(this.getPointAt(r/t));return e},getLength:function(){var t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,r,n=[],i=this.getPoint(0),o=0;for(n.push(0),r=1;r<=t;r++)o+=(e=this.getPoint(r/t)).distanceTo(i),n.push(o),i=e;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){var r,n=this.getLengths(),i=0,o=n.length;r=e||t*n[o-1];for(var a,s=0,l=o-1;s<=l;)if((a=n[i=Math.floor(s+(l-s)/2)]-r)<0)s=i+1;else{if(!(a>0)){l=i;break}l=i-1}if(n[i=l]===r)return i/(o-1);var c=n[i];return(i+(r-c)/(n[i+1]-c))/(o-1)},getTangent:function(t,e){var r=1e-4,n=t-r,i=t+r;n<0&&(n=0),i>1&&(i=1);var o=this.getPoint(n),a=this.getPoint(i),s=e||(o.isVector2?new Gr:new Qr);return s.copy(a).sub(o).normalize(),s},getTangentAt:function(t,e){var r=this.getUtoTmapping(t);return this.getTangent(r,e)},computeFrenetFrames:function(t,e){var r,n,i,o=new Qr,a=[],s=[],l=[],c=new Qr,u=new sn;for(r=0;r<=t;r++)n=r/t,a[r]=this.getTangentAt(n,new Qr),a[r].normalize();s[0]=new Qr,l[0]=new Qr;var h=Number.MAX_VALUE,p=Math.abs(a[0].x),d=Math.abs(a[0].y),f=Math.abs(a[0].z);for(p<=h&&(h=p,o.set(1,0,0)),d<=h&&(h=d,o.set(0,1,0)),f<=h&&o.set(0,0,1),c.crossVectors(a[0],o).normalize(),s[0].crossVectors(a[0],c),l[0].crossVectors(a[0],s[0]),r=1;r<=t;r++)s[r]=s[r-1].clone(),l[r]=l[r-1].clone(),c.crossVectors(a[r-1],a[r]),c.length()>Number.EPSILON&&(c.normalize(),i=Math.acos(jr.clamp(a[r-1].dot(a[r]),-1,1)),s[r].applyMatrix4(u.makeRotationAxis(c,i))),l[r].crossVectors(a[r],s[r]);if(!0===e)for(i=Math.acos(jr.clamp(s[0].dot(s[t]),-1,1)),i/=t,a[0].dot(c.crossVectors(s[0],s[t]))>0&&(i=-i),r=1;r<=t;r++)s[r].applyMatrix4(u.makeRotationAxis(a[r],i*r)),l[r].crossVectors(a[r],s[r]);return{tangents:a,normals:s,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){var t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Wu.prototype=Object.create(Hu.prototype),Wu.prototype.constructor=Wu,Wu.prototype.isEllipseCurve=!0,Wu.prototype.getPoint=function(t,e){for(var r=e||new Gr,n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=o?0:n),!0!==this.aClockwise||o||(i===n?i=-n:i-=n);var a=this.aStartAngle+t*i,s=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=s-this.aX,p=l-this.aY;s=h*c-p*u+this.aX,l=h*u+p*c+this.aY}return r.set(s,l)},Wu.prototype.copy=function(t){return Hu.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Wu.prototype.toJSON=function(){var t=Hu.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},Wu.prototype.fromJSON=function(t){return Hu.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},qu.prototype=Object.create(Wu.prototype),qu.prototype.constructor=qu,qu.prototype.isArcCurve=!0;var Xu=new Qr,Ju=new Yu,Zu=new Yu,Ku=new Yu;function Qu(t,e,r,n){Hu.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=r||"centripetal",this.tension=n||.5}function $u(t,e,r,n,i){var o=.5*(n-e),a=.5*(i-r),s=t*t;return(2*r-2*n+o+a)*(t*s)+(-3*r+3*n-2*o-a)*s+o*t+r}function th(t,e,r,n){return function(t,e){var r=1-t;return r*r*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,r)+function(t,e){return t*t*e}(t,n)}function eh(t,e,r,n,i){return function(t,e){var r=1-t;return r*r*r*e}(t,e)+function(t,e){var r=1-t;return 3*r*r*t*e}(t,r)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,i)}function rh(t,e,r,n){Hu.call(this),this.type="CubicBezierCurve",this.v0=t||new Gr,this.v1=e||new Gr,this.v2=r||new Gr,this.v3=n||new Gr}function nh(t,e,r,n){Hu.call(this),this.type="CubicBezierCurve3",this.v0=t||new Qr,this.v1=e||new Qr,this.v2=r||new Qr,this.v3=n||new Qr}function ih(t,e){Hu.call(this),this.type="LineCurve",this.v1=t||new Gr,this.v2=e||new Gr}function oh(t,e){Hu.call(this),this.type="LineCurve3",this.v1=t||new Qr,this.v2=e||new Qr}function ah(t,e,r){Hu.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Gr,this.v1=e||new Gr,this.v2=r||new Gr}function sh(t,e,r){Hu.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new Qr,this.v1=e||new Qr,this.v2=r||new Qr}function lh(t){Hu.call(this),this.type="SplineCurve",this.points=t||[]}Qu.prototype=Object.create(Hu.prototype),Qu.prototype.constructor=Qu,Qu.prototype.isCatmullRomCurve3=!0,Qu.prototype.getPoint=function(t,e){var r,n,i,o,a=e||new Qr,s=this.points,l=s.length,c=(l-(this.closed?0:1))*t,u=Math.floor(c),h=c-u;if(this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/l)+1)*l:0===h&&u===l-1&&(u=l-2,h=1),this.closed||u>0?r=s[(u-1)%l]:(Xu.subVectors(s[0],s[1]).add(s[0]),r=Xu),n=s[u%l],i=s[(u+1)%l],this.closed||u+2<l?o=s[(u+2)%l]:(Xu.subVectors(s[l-1],s[l-2]).add(s[l-1]),o=Xu),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(r.distanceToSquared(n),p),f=Math.pow(n.distanceToSquared(i),p),m=Math.pow(i.distanceToSquared(o),p);f<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),Ju.initNonuniformCatmullRom(r.x,n.x,i.x,o.x,d,f,m),Zu.initNonuniformCatmullRom(r.y,n.y,i.y,o.y,d,f,m),Ku.initNonuniformCatmullRom(r.z,n.z,i.z,o.z,d,f,m)}else"catmullrom"===this.curveType&&(Ju.initCatmullRom(r.x,n.x,i.x,o.x,this.tension),Zu.initCatmullRom(r.y,n.y,i.y,o.y,this.tension),Ku.initCatmullRom(r.z,n.z,i.z,o.z,this.tension));return a.set(Ju.calc(h),Zu.calc(h),Ku.calc(h)),a},Qu.prototype.copy=function(t){Hu.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},Qu.prototype.toJSON=function(){var t=Hu.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++){var n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},Qu.prototype.fromJSON=function(t){Hu.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new Qr).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},rh.prototype=Object.create(Hu.prototype),rh.prototype.constructor=rh,rh.prototype.isCubicBezierCurve=!0,rh.prototype.getPoint=function(t,e){var r=e||new Gr,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(eh(t,n.x,i.x,o.x,a.x),eh(t,n.y,i.y,o.y,a.y)),r},rh.prototype.copy=function(t){return Hu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},rh.prototype.toJSON=function(){var t=Hu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},rh.prototype.fromJSON=function(t){return Hu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},nh.prototype=Object.create(Hu.prototype),nh.prototype.constructor=nh,nh.prototype.isCubicBezierCurve3=!0,nh.prototype.getPoint=function(t,e){var r=e||new Qr,n=this.v0,i=this.v1,o=this.v2,a=this.v3;return r.set(eh(t,n.x,i.x,o.x,a.x),eh(t,n.y,i.y,o.y,a.y),eh(t,n.z,i.z,o.z,a.z)),r},nh.prototype.copy=function(t){return Hu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},nh.prototype.toJSON=function(){var t=Hu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},nh.prototype.fromJSON=function(t){return Hu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},ih.prototype=Object.create(Hu.prototype),ih.prototype.constructor=ih,ih.prototype.isLineCurve=!0,ih.prototype.getPoint=function(t,e){var r=e||new Gr;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},ih.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},ih.prototype.getTangent=function(t,e){return(e||new Gr).copy(this.v2).sub(this.v1).normalize()},ih.prototype.copy=function(t){return Hu.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ih.prototype.toJSON=function(){var t=Hu.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ih.prototype.fromJSON=function(t){return Hu.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},oh.prototype=Object.create(Hu.prototype),oh.prototype.constructor=oh,oh.prototype.isLineCurve3=!0,oh.prototype.getPoint=function(t,e){var r=e||new Qr;return 1===t?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(t).add(this.v1)),r},oh.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},oh.prototype.copy=function(t){return Hu.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},oh.prototype.toJSON=function(){var t=Hu.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},oh.prototype.fromJSON=function(t){return Hu.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},ah.prototype=Object.create(Hu.prototype),ah.prototype.constructor=ah,ah.prototype.isQuadraticBezierCurve=!0,ah.prototype.getPoint=function(t,e){var r=e||new Gr,n=this.v0,i=this.v1,o=this.v2;return r.set(th(t,n.x,i.x,o.x),th(t,n.y,i.y,o.y)),r},ah.prototype.copy=function(t){return Hu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},ah.prototype.toJSON=function(){var t=Hu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},ah.prototype.fromJSON=function(t){return Hu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},sh.prototype=Object.create(Hu.prototype),sh.prototype.constructor=sh,sh.prototype.isQuadraticBezierCurve3=!0,sh.prototype.getPoint=function(t,e){var r=e||new Qr,n=this.v0,i=this.v1,o=this.v2;return r.set(th(t,n.x,i.x,o.x),th(t,n.y,i.y,o.y),th(t,n.z,i.z,o.z)),r},sh.prototype.copy=function(t){return Hu.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},sh.prototype.toJSON=function(){var t=Hu.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},sh.prototype.fromJSON=function(t){return Hu.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},lh.prototype=Object.create(Hu.prototype),lh.prototype.constructor=lh,lh.prototype.isSplineCurve=!0,lh.prototype.getPoint=function(t,e){var r=e||new Gr,n=this.points,i=(n.length-1)*t,o=Math.floor(i),a=i-o,s=n[0===o?o:o-1],l=n[o],c=n[o>n.length-2?n.length-1:o+1],u=n[o>n.length-3?n.length-1:o+2];return r.set($u(a,s.x,l.x,c.x,u.x),$u(a,s.y,l.y,c.y,u.y)),r},lh.prototype.copy=function(t){Hu.prototype.copy.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push(n.clone())}return this},lh.prototype.toJSON=function(){var t=Hu.prototype.toJSON.call(this);t.points=[];for(var e=0,r=this.points.length;e<r;e++){var n=this.points[e];t.points.push(n.toArray())}return t},lh.prototype.fromJSON=function(t){Hu.prototype.fromJSON.call(this,t),this.points=[];for(var e=0,r=t.points.length;e<r;e++){var n=t.points[e];this.points.push((new Gr).fromArray(n))}return this};var ch=Object.freeze({__proto__:null,ArcCurve:qu,CatmullRomCurve3:Qu,CubicBezierCurve:rh,CubicBezierCurve3:nh,EllipseCurve:Wu,LineCurve:ih,LineCurve3:oh,QuadraticBezierCurve:ah,QuadraticBezierCurve3:sh,SplineCurve:lh});function uh(){Hu.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function hh(t){uh.call(this),this.type="Path",this.currentPoint=new Gr,t&&this.setFromPoints(t)}function ph(t){hh.call(this,t),this.uuid=jr.generateUUID(),this.type="Shape",this.holes=[]}function dh(t,e){Sn.call(this),this.type="Light",this.color=new gi(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function fh(t,e,r){dh.call(this,t,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Sn.DefaultUp),this.updateMatrix(),this.groundColor=new gi(e)}function mh(t){this.camera=t,this.bias=0,this.radius=1,this.mapSize=new Gr(512,512),this.map=null,this.mapPass=null,this.matrix=new sn,this._frustum=new Ro,this._frameExtents=new Gr(1,1),this._viewportCount=1,this._viewports=[new qr(0,0,1,1)]}function gh(){mh.call(this,new Mo(50,1,.5,500))}function vh(t,e,r,n,i,o){dh.call(this,t,e),this.type="SpotLight",this.position.copy(Sn.DefaultUp),this.updateMatrix(),this.target=new Sn,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==r?r:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new gh}function yh(){mh.call(this,new Mo(90,1,.5,500)),this._frameExtents=new Gr(4,2),this._viewportCount=6,this._viewports=[new qr(2,1,1,1),new qr(0,1,1,1),new qr(3,1,1,1),new qr(1,1,1,1),new qr(3,0,1,1),new qr(1,0,1,1)],this._cubeDirections=[new Qr(1,0,0),new Qr(-1,0,0),new Qr(0,0,1),new Qr(0,0,-1),new Qr(0,1,0),new Qr(0,-1,0)],this._cubeUps=[new Qr(0,1,0),new Qr(0,1,0),new Qr(0,1,0),new Qr(0,1,0),new Qr(0,0,1),new Qr(0,0,-1)]}function _h(t,e,r,n){dh.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==r?r:0,this.decay=void 0!==n?n:1,this.shadow=new yh}function bh(t,e,r,n,i,o){Eo.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==r?r:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function xh(){mh.call(this,new bh(-5,5,5,-5,.5,500))}function wh(t,e){dh.call(this,t,e),this.type="DirectionalLight",this.position.copy(Sn.DefaultUp),this.updateMatrix(),this.target=new Sn,this.shadow=new xh}function Eh(t,e){dh.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function Mh(t,e,r,n){dh.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==r?r:10,this.height=void 0!==n?n:10}function Sh(){this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Qr)}function Th(t,e){dh.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new Sh}function Ah(t){Bu.call(this,t),this.textures={}}uh.prototype=Object.assign(Object.create(Hu.prototype),{constructor:uh,add:function(t){this.curves.push(t)},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new ih(e,t))},getPoint:function(t){for(var e=t*this.getLength(),r=this.getCurveLengths(),n=0;n<r.length;){if(r[n]>=e){var i=r[n]-e,o=this.curves[n],a=o.getLength(),s=0===a?0:1-i/a;return o.getPointAt(s)}n++}return null},getLength:function(){var t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,r=0,n=this.curves.length;r<n;r++)e+=this.curves[r].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],r=0;r<=t;r++)e.push(this.getPoint(r/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;for(var e,r=[],n=0,i=this.curves;n<i.length;n++)for(var o=i[n],a=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,s=o.getPoints(a),l=0;l<s.length;l++){var c=s[l];e&&e.equals(c)||(r.push(c),e=c)}return this.autoClose&&r.length>1&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(t){Hu.prototype.copy.call(this,t),this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){var t=Hu.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(var e=0,r=this.curves.length;e<r;e++){var n=this.curves[e];t.curves.push(n.toJSON())}return t},fromJSON:function(t){Hu.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(var e=0,r=t.curves.length;e<r;e++){var n=t.curves[e];this.curves.push((new ch[n.type]).fromJSON(n))}return this}}),hh.prototype=Object.assign(Object.create(uh.prototype),{constructor:hh,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,r=t.length;e<r;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){var r=new ih(this.currentPoint.clone(),new Gr(t,e));return this.curves.push(r),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,r,n){var i=new ah(this.currentPoint.clone(),new Gr(t,e),new Gr(r,n));return this.curves.push(i),this.currentPoint.set(r,n),this},bezierCurveTo:function(t,e,r,n,i,o){var a=new rh(this.currentPoint.clone(),new Gr(t,e),new Gr(r,n),new Gr(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this},splineThru:function(t){var e=new lh([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,r,n,i,o){var a=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(t+a,e+s,r,n,i,o),this},absarc:function(t,e,r,n,i,o){return this.absellipse(t,e,r,r,n,i,o),this},ellipse:function(t,e,r,n,i,o,a,s){var l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,r,n,i,o,a,s),this},absellipse:function(t,e,r,n,i,o,a,s){var l=new Wu(t,e,r,n,i,o,a,s);if(this.curves.length>0){var c=l.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(l);var u=l.getPoint(1);return this.currentPoint.copy(u),this},copy:function(t){return uh.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){var t=uh.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return uh.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),ph.prototype=Object.assign(Object.create(hh.prototype),{constructor:ph,getPointsHoles:function(t){for(var e=[],r=0,n=this.holes.length;r<n;r++)e[r]=this.holes[r].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){hh.prototype.copy.call(this,t),this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push(n.clone())}return this},toJSON:function(){var t=hh.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,r=this.holes.length;e<r;e++){var n=this.holes[e];t.holes.push(n.toJSON())}return t},fromJSON:function(t){hh.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,r=t.holes.length;e<r;e++){var n=t.holes[e];this.holes.push((new hh).fromJSON(n))}return this}}),dh.prototype=Object.assign(Object.create(Sn.prototype),{constructor:dh,isLight:!0,copy:function(t){return Sn.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){var e=Sn.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),fh.prototype=Object.assign(Object.create(dh.prototype),{constructor:fh,isHemisphereLight:!0,copy:function(t){return dh.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(mh.prototype,{_projScreenMatrix:new sn,_lightPositionWorld:new Qr,_lookTarget:new Qr,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){var e=this.camera,r=this.matrix,n=this._projScreenMatrix,i=this._lookTarget,o=this._lightPositionWorld;o.setFromMatrixPosition(t.matrixWorld),e.position.copy(o),i.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(i),e.updateMatrixWorld(),n.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(e.projectionMatrix),r.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),gh.prototype=Object.assign(Object.create(mh.prototype),{constructor:gh,isSpotLightShadow:!0,updateMatrices:function(t){var e=this.camera,r=2*jr.RAD2DEG*t.angle,n=this.mapSize.width/this.mapSize.height,i=t.distance||e.far;r===e.fov&&n===e.aspect&&i===e.far||(e.fov=r,e.aspect=n,e.far=i,e.updateProjectionMatrix()),mh.prototype.updateMatrices.call(this,t)}}),vh.prototype=Object.assign(Object.create(dh.prototype),{constructor:vh,isSpotLight:!0,copy:function(t){return dh.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),yh.prototype=Object.assign(Object.create(mh.prototype),{constructor:yh,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);var r=this.camera,n=this.matrix,i=this._lightPositionWorld,o=this._lookTarget,a=this._projScreenMatrix;i.setFromMatrixPosition(t.matrixWorld),r.position.copy(i),o.copy(r.position),o.add(this._cubeDirections[e]),r.up.copy(this._cubeUps[e]),r.lookAt(o),r.updateMatrixWorld(),n.makeTranslation(-i.x,-i.y,-i.z),a.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a)}}),_h.prototype=Object.assign(Object.create(dh.prototype),{constructor:_h,isPointLight:!0,copy:function(t){return dh.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),bh.prototype=Object.assign(Object.create(Eo.prototype),{constructor:bh,isOrthographicCamera:!0,copy:function(t,e){return Eo.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,r,n,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=r,this.view.offsetY=n,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2,i=r-t,o=r+t,a=n+e,s=n-e;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o=(i+=l*this.view.offsetX)+l*this.view.width,s=(a-=c*this.view.offsetY)-c*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){var e=Sn.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),xh.prototype=Object.assign(Object.create(mh.prototype),{constructor:xh,isDirectionalLightShadow:!0,updateMatrices:function(t){mh.prototype.updateMatrices.call(this,t)}}),wh.prototype=Object.assign(Object.create(dh.prototype),{constructor:wh,isDirectionalLight:!0,copy:function(t){return dh.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),Eh.prototype=Object.assign(Object.create(dh.prototype),{constructor:Eh,isAmbientLight:!0}),Mh.prototype=Object.assign(Object.create(dh.prototype),{constructor:Mh,isRectAreaLight:!0,copy:function(t){return dh.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){var e=dh.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}}),Object.assign(Sh.prototype,{isSphericalHarmonics3:!0,set:function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},zero:function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},getAt:function(t,e){var r=t.x,n=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*n),e.addScaledVector(o[2],.488603*i),e.addScaledVector(o[3],.488603*r),e.addScaledVector(o[4],r*n*1.092548),e.addScaledVector(o[5],n*i*1.092548),e.addScaledVector(o[6],.315392*(3*i*i-1)),e.addScaledVector(o[7],r*i*1.092548),e.addScaledVector(o[8],.546274*(r*r-n*n)),e},getIrradianceAt:function(t,e){var r=t.x,n=t.y,i=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],1.023328*n),e.addScaledVector(o[2],1.023328*i),e.addScaledVector(o[3],1.023328*r),e.addScaledVector(o[4],.858086*r*n),e.addScaledVector(o[5],.858086*n*i),e.addScaledVector(o[6],.743125*i*i-.247708),e.addScaledVector(o[7],.858086*r*i),e.addScaledVector(o[8],.429043*(r*r-n*n)),e},add:function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},addScaledSH:function(t,e){for(var r=0;r<9;r++)this.coefficients[r].addScaledVector(t.coefficients[r],e);return this},scale:function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this},lerp:function(t,e){for(var r=0;r<9;r++)this.coefficients[r].lerp(t.coefficients[r],e);return this},equals:function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,e){void 0===e&&(e=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].fromArray(t,e+3*n);return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var r=this.coefficients,n=0;n<9;n++)r[n].toArray(t,e+3*n);return t}}),Object.assign(Sh,{getBasisAt:function(t,e){var r=t.x,n=t.y,i=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*i,e[3]=.488603*r,e[4]=1.092548*r*n,e[5]=1.092548*n*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*r*i,e[8]=.546274*(r*r-n*n)}}),Th.prototype=Object.assign(Object.create(dh.prototype),{constructor:Th,isLightProbe:!0,copy:function(t){return dh.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){var e=dh.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),Ah.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Ah,load:function(t,e,r,n){var i=this,o=new ku(i.manager);o.setPath(i.path),o.load(t,(function(r){try{e(i.parse(JSON.parse(r)))}catch(e){n?n(e):console.error(e),i.manager.itemError(t)}}),r,n)},parse:function(t){var e=this.textures;function r(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}var n=new gu[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=(new gi).setHex(t.sheen)),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(n.morphNormals=t.morphNormals),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.vertexTangents&&(n.vertexTangents=t.vertexTangents),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(var i in t.uniforms){var o=t.uniforms[i];switch(n.uniforms[i]={},o.type){case"t":n.uniforms[i].value=r(o.value);break;case"c":n.uniforms[i].value=(new gi).setHex(o.value);break;case"v2":n.uniforms[i].value=(new Gr).fromArray(o.value);break;case"v3":n.uniforms[i].value=(new Qr).fromArray(o.value);break;case"v4":n.uniforms[i].value=(new qr).fromArray(o.value);break;case"m3":n.uniforms[i].value=(new zr).fromArray(o.value);case"m4":n.uniforms[i].value=(new sn).fromArray(o.value);break;default:n.uniforms[i].value=o.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(var a in t.extensions)n.extensions[a]=t.extensions[a];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=r(t.map)),void 0!==t.matcap&&(n.matcap=r(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=r(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=r(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=r(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){var s=t.normalScale;!1===Array.isArray(s)&&(s=[s,s]),n.normalScale=(new Gr).fromArray(s)}return void 0!==t.displacementMap&&(n.displacementMap=r(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=r(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=r(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=r(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=r(t.specularMap)),void 0!==t.envMap&&(n.envMap=r(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=r(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=r(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=r(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=r(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=r(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=r(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Gr).fromArray(t.clearcoatNormalScale)),n},setTextures:function(t){return this.textures=t,this}});var Ch={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);for(var e="",r=0,n=t.length;r<n;r++)e+=String.fromCharCode(t[r]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){var e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function Ph(){Hi.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Oh(t,e,r,n){"number"==typeof r&&(n=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Si.call(this,t,e,r),this.meshPerAttribute=n||1}function Rh(t){Bu.call(this,t)}Ph.prototype=Object.assign(Object.create(Hi.prototype),{constructor:Ph,isInstancedBufferGeometry:!0,copy:function(t){return Hi.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var t=Hi.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),Oh.prototype=Object.assign(Object.create(Si.prototype),{constructor:Oh,isInstancedBufferAttribute:!0,copy:function(t){return Si.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){var t=Si.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),Rh.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Rh,load:function(t,e,r,n){var i=this,o=new ku(i.manager);o.setPath(i.path),o.load(t,(function(r){try{e(i.parse(JSON.parse(r)))}catch(e){n?n(e):console.error(e),i.manager.itemError(t)}}),r,n)},parse:function(t){var e=t.isInstancedBufferGeometry?new Ph:new Hi,r=t.data.index;if(void 0!==r){var n=new Lh[r.type](r.array);e.setIndex(new Si(n,1))}var i=t.data.attributes;for(var o in i){var a=i[o],s=(n=new Lh[a.type](a.array),new(a.isInstancedBufferAttribute?Oh:Si)(n,a.itemSize,a.normalized));void 0!==a.name&&(s.name=a.name),e.setAttribute(o,s)}var l=t.data.morphAttributes;if(l)for(var o in l){for(var c=l[o],u=[],h=0,p=c.length;h<p;h++){a=c[h],s=new Si(n=new Lh[a.type](a.array),a.itemSize,a.normalized);void 0!==a.name&&(s.name=a.name),u.push(s)}e.morphAttributes[o]=u}t.data.morphTargetsRelative&&(e.morphTargetsRelative=!0);var d=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==d){h=0;for(var f=d.length;h!==f;++h){var m=d[h];e.addGroup(m.start,m.count,m.materialIndex)}}var g=t.data.boundingSphere;if(void 0!==g){var v=new Qr;void 0!==g.center&&v.fromArray(g.center),e.boundingSphere=new Vn(v,g.radius)}return t.name&&(e.name=t.name),t.userData&&(e.userData=t.userData),e}});var Lh={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Ih(t){Bu.call(this,t)}Ih.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Ih,load:function(t,e,r,n){var i=this,o=""===this.path?Ch.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;var a=new ku(i.manager);a.setPath(this.path),a.load(t,(function(r){var o=null;try{o=JSON.parse(r)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}var a=o.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(o,e):console.error("THREE.ObjectLoader: Can't load "+t)}),r,n)},parse:function(t,e){var r=this.parseShape(t.shapes),n=this.parseGeometries(t.geometries,r),i=this.parseImages(t.images,(function(){void 0!==e&&e(s)})),o=this.parseTextures(t.textures,i),a=this.parseMaterials(t.materials,o),s=this.parseObject(t.object,n,a);return t.animations&&(s.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(s),s},parseShape:function(t){var e={};if(void 0!==t)for(var r=0,n=t.length;r<n;r++){var i=(new ph).fromJSON(t[r]);e[i.uuid]=i}return e},parseGeometries:function(t,e){var r={};if(void 0!==t)for(var n=new Rh,i=0,o=t.length;i<o;i++){var a,s=t[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new ou[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new ou[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new ou[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new ou[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new ou[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new ou[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new ou[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new ou[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new ou[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new ou[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":a=new ou[s.type]((new ch[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":a=new ou[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new ou[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var l=[],c=0,u=s.shapes.length;c<u;c++){var h=e[s.shapes[c]];l.push(h)}a=new ou[s.type](l,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(l=[],c=0,u=s.shapes.length;c<u;c++){h=e[s.shapes[c]];l.push(h)}var p=s.options.extrudePath;void 0!==p&&(s.options.extrudePath=(new ch[p.type]).fromJSON(p)),a=new ou[s.type](l,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":a=n.parse(s);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),!0===a.isBufferGeometry&&void 0!==s.userData&&(a.userData=s.userData),r[s.uuid]=a}return r},parseMaterials:function(t,e){var r={},n={};if(void 0!==t){var i=new Ah;i.setTextures(e);for(var o=0,a=t.length;o<a;o++){var s=t[o];if("MultiMaterial"===s.type){for(var l=[],c=0;c<s.materials.length;c++){var u=s.materials[c];void 0===r[u.uuid]&&(r[u.uuid]=i.parse(u)),l.push(r[u.uuid])}n[s.uuid]=l}else void 0===r[s.uuid]&&(r[s.uuid]=i.parse(s)),n[s.uuid]=r[s.uuid]}}return n},parseAnimations:function(t){for(var e=[],r=0;r<t.length;r++){var n=t[r],i=Ou.parse(n);void 0!==n.uuid&&(i.uuid=n.uuid),e.push(i)}return e},parseImages:function(t,e){var r=this,n={};function i(t){return r.manager.itemStart(t),o.load(t,(function(){r.manager.itemEnd(t)}),void 0,(function(){r.manager.itemError(t),r.manager.itemEnd(t)}))}if(void 0!==t&&t.length>0){var o=new Gu(new Iu(e));o.setCrossOrigin(this.crossOrigin);for(var a=0,s=t.length;a<s;a++){var l=t[a],c=l.url;if(Array.isArray(c)){n[l.uuid]=[];for(var u=0,h=c.length;u<h;u++){var p=c[u],d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(p)?p:r.resourcePath+p;n[l.uuid].push(i(d))}}else{d=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:r.resourcePath+l.url;n[l.uuid]=i(d)}}}return n},parseTextures:function(t,e){function r(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}var n={};if(void 0!==t)for(var i=0,o=t.length;i<o;i++){var a,s=t[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(a=Array.isArray(e[s.image])?new Zo(e[s.image]):new Wr(e[s.image])).needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=r(s.mapping,Bh)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=r(s.wrap[0],Dh),a.wrapT=r(s.wrap[1],Dh)),void 0!==s.format&&(a.format=s.format),void 0!==s.type&&(a.type=s.type),void 0!==s.encoding&&(a.encoding=s.encoding),void 0!==s.minFilter&&(a.minFilter=r(s.minFilter,kh)),void 0!==s.magFilter&&(a.magFilter=r(s.magFilter,kh)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(a.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(a.unpackAlignment=s.unpackAlignment),n[s.uuid]=a}return n},parseObject:function(t,e,r){var n;function i(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function o(t){if(void 0!==t){if(Array.isArray(t)){for(var e=[],n=0,i=t.length;n<i;n++){var o=t[n];void 0===r[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),e.push(r[o])}return e}return void 0===r[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),r[t]}}switch(t.type){case"Scene":n=new Tn,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new gi(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new Us(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new ks(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new Mo(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new bh(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"AmbientLight":n=new Eh(t.color,t.intensity);break;case"DirectionalLight":n=new wh(t.color,t.intensity);break;case"PointLight":n=new _h(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new Mh(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new vh(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new fh(t.color,t.groundColor,t.intensity);break;case"LightProbe":n=(new Th).fromJSON(t);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":n=new lo(a=i(t.geometry),s=o(t.material));break;case"InstancedMesh":var a=i(t.geometry),s=o(t.material),l=t.count,c=t.instanceMatrix;(n=new xl(a,s,l)).instanceMatrix=new Si(new Float32Array(c.array),16);break;case"LOD":n=new hl;break;case"Line":n=new Cl(i(t.geometry),o(t.material),t.mode);break;case"LineLoop":n=new Ll(i(t.geometry),o(t.material));break;case"LineSegments":n=new Rl(i(t.geometry),o(t.material));break;case"PointCloud":case"Points":n=new Ul(i(t.geometry),o(t.material));break;case"Sprite":n=new rl(o(t.material));break;case"Group":n=new Ls;break;default:n=new Sn}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(n.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(n.matrixAutoUpdate=t.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.frustumCulled&&(n.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(n.renderOrder=t.renderOrder),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.layers&&(n.layers.mask=t.layers),void 0!==t.children)for(var u=t.children,h=0;h<u.length;h++)n.add(this.parseObject(u[h],e,r));if("LOD"===t.type){void 0!==t.autoUpdate&&(n.autoUpdate=t.autoUpdate);for(var p=t.levels,d=0;d<p.length;d++){var f=p[d],m=n.getObjectByProperty("uuid",f.object);void 0!==m&&n.addLevel(m,f.distance)}}return n}});var Nh,Bh={UVMapping:at,CubeReflectionMapping:st,CubeRefractionMapping:lt,EquirectangularReflectionMapping:ct,EquirectangularRefractionMapping:ut,SphericalReflectionMapping:ht,CubeUVReflectionMapping:pt,CubeUVRefractionMapping:dt},Dh={RepeatWrapping:ft,ClampToEdgeWrapping:mt,MirroredRepeatWrapping:gt},kh={NearestFilter:vt,NearestMipmapNearestFilter:yt,NearestMipmapLinearFilter:bt,LinearFilter:wt,LinearMipmapNearestFilter:Et,LinearMipmapLinearFilter:St};function Uh(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Bu.call(this,t),this.options=void 0}function Fh(){this.type="ShapePath",this.color=new gi,this.subPaths=[],this.currentPath=null}function jh(t){this.type="Font",this.data=t}function Gh(t,e,r,n,i){var o=i.glyphs[t]||i.glyphs["?"];if(o){var a,s,l,c,u,h,p,d,f=new Fh;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),g=0,v=m.length;g<v;){switch(m[g++]){case"m":a=m[g++]*e+r,s=m[g++]*e+n,f.moveTo(a,s);break;case"l":a=m[g++]*e+r,s=m[g++]*e+n,f.lineTo(a,s);break;case"q":l=m[g++]*e+r,c=m[g++]*e+n,u=m[g++]*e+r,h=m[g++]*e+n,f.quadraticCurveTo(u,h,l,c);break;case"b":l=m[g++]*e+r,c=m[g++]*e+n,u=m[g++]*e+r,h=m[g++]*e+n,p=m[g++]*e+r,d=m[g++]*e+n,f.bezierCurveTo(u,h,p,d,l,c)}}return{offsetX:o.ha*e,path:f}}console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".")}function zh(t){Bu.call(this,t)}Uh.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Uh,setOptions:function(t){return this.options=t,this},load:function(t,e,r,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);var i=this,o=Lu.get(t);if(void 0!==o)return i.manager.itemStart(t),setTimeout((function(){e&&e(o),i.manager.itemEnd(t)}),0),o;fetch(t).then((function(t){return t.blob()})).then((function(t){return void 0===i.options?createImageBitmap(t):createImageBitmap(t,i.options)})).then((function(r){Lu.add(t,r),e&&e(r),i.manager.itemEnd(t)})).catch((function(e){n&&n(e),i.manager.itemError(t),i.manager.itemEnd(t)})),i.manager.itemStart(t)}}),Object.assign(Fh.prototype,{moveTo:function(t,e){return this.currentPath=new hh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,r,n){return this.currentPath.quadraticCurveTo(t,e,r,n),this},bezierCurveTo:function(t,e,r,n,i,o){return this.currentPath.bezierCurveTo(t,e,r,n,i,o),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function r(t){for(var e=[],r=0,n=t.length;r<n;r++){var i=t[r],o=new ph;o.curves=i.curves,e.push(o)}return e}function n(t,e){for(var r=e.length,n=!1,i=r-1,o=0;o<r;i=o++){var a=e[i],s=e[o],l=s.x-a.x,c=s.y-a.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(a=e[o],l=-l,s=e[i],c=-c),t.y<a.y||t.y>s.y)continue;if(t.y===a.y){if(t.x===a.x)return!0}else{var u=c*(t.x-a.x)-l*(t.y-a.y);if(0===u)return!0;if(u<0)continue;n=!n}}else{if(t.y!==a.y)continue;if(s.x<=t.x&&t.x<=a.x||a.x<=t.x&&t.x<=s.x)return!0}}return n}var i=Nc.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===e)return r(o);var a,s,l,c=[];if(1===o.length)return s=o[0],(l=new ph).curves=s.curves,c.push(l),c;var u=!i(o[0].getPoints());u=t?!u:u;var h,p,d=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,y=o.length;v<y;v++)a=i(h=(s=o[v]).getPoints()),(a=t?!a:a)?(!u&&f[g]&&g++,f[g]={s:new ph,p:h},f[g].s.curves=s.curves,u&&g++,m[g]=[]):m[g].push({h:s,p:h[0]});if(!f[0])return r(o);if(f.length>1){for(var _=!1,b=[],x=0,w=f.length;x<w;x++)d[x]=[];for(x=0,w=f.length;x<w;x++)for(var E=m[x],M=0;M<E.length;M++){for(var S=E[M],T=!0,A=0;A<f.length;A++)n(S.p,f[A].p)&&(x!==A&&b.push({froms:x,tos:A,hole:M}),T?(T=!1,d[A].push(S)):_=!0);T&&d[x].push(S)}b.length>0&&(_||(m=d))}v=0;for(var C=f.length;v<C;v++){l=f[v].s,c.push(l);for(var P=0,O=(p=m[v]).length;P<O;P++)l.holes.push(p[P].h)}return c}}),Object.assign(jh.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);for(var r=[],n=function(t,e,r){for(var n=Array.from?Array.from(t):String(t).split(""),i=e/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*i,a=[],s=0,l=0,c=0;c<n.length;c++){var u=n[c];if("\n"===u)s=0,l-=o;else{var h=Gh(u,i,s,l,r);s+=h.offsetX,a.push(h.path)}}return a}(t,e,this.data),i=0,o=n.length;i<o;i++)Array.prototype.push.apply(r,n[i].toShapes());return r}}),zh.prototype=Object.assign(Object.create(Bu.prototype),{constructor:zh,load:function(t,e,r,n){var i=this,o=new ku(this.manager);o.setPath(this.path),o.load(t,(function(t){var r;try{r=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(t.substring(65,t.length-2))}var n=i.parse(r);e&&e(n)}),r,n)},parse:function(t){return new jh(t)}});var Vh={getContext:function(){return void 0===Nh&&(Nh=new(window.AudioContext||window.webkitAudioContext)),Nh},setContext:function(t){Nh=t}};function Hh(t){Bu.call(this,t)}function Wh(t,e,r){Th.call(this,void 0,r);var n=(new gi).set(t),i=(new gi).set(e),o=new Qr(n.r,n.g,n.b),a=new Qr(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(s),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}function qh(t,e){Th.call(this,void 0,e);var r=(new gi).set(t);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}Hh.prototype=Object.assign(Object.create(Bu.prototype),{constructor:Hh,load:function(t,e,r,n){var i=this,o=new ku(i.manager);o.setResponseType("arraybuffer"),o.setPath(i.path),o.load(t,(function(r){try{var o=r.slice(0);Vh.getContext().decodeAudioData(o,(function(t){e(t)}))}catch(e){n?n(e):console.error(e),i.manager.itemError(t)}}),r,n)}}),Wh.prototype=Object.assign(Object.create(Th.prototype),{constructor:Wh,isHemisphereLightProbe:!0,copy:function(t){return Th.prototype.copy.call(this,t),this},toJSON:function(t){return Th.prototype.toJSON.call(this,t)}}),qh.prototype=Object.assign(Object.create(Th.prototype),{constructor:qh,isAmbientLightProbe:!0,copy:function(t){return Th.prototype.copy.call(this,t),this},toJSON:function(t){return Th.prototype.toJSON.call(this,t)}});var Yh=new sn,Xh=new sn;function Jh(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Mo,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Mo,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Zh(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Jh.prototype,{update:function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;var r,n,i=t.projectionMatrix.clone(),o=e.eyeSep/2,a=o*e.near/e.focus,s=e.near*Math.tan(jr.DEG2RAD*e.fov*.5)/e.zoom;Xh.elements[12]=-o,Yh.elements[12]=o,r=-s*e.aspect+a,n=s*e.aspect+a,i.elements[0]=2*e.near/(n-r),i.elements[8]=(n+r)/(n-r),this.cameraL.projectionMatrix.copy(i),r=-s*e.aspect-a,n=s*e.aspect-a,i.elements[0]=2*e.near/(n-r),i.elements[8]=(n+r)/(n-r),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Xh),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Yh)}}),Object.assign(Zh.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});var Kh=new Qr,Qh=new Jr,$h=new Qr,tp=new Qr;function ep(){Sn.call(this),this.type="AudioListener",this.context=Vh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Zh}function rp(t){Sn.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._progress=0,this.filters=[]}ep.prototype=Object.assign(Object.create(Sn.prototype),{constructor:ep,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){Sn.prototype.updateMatrixWorld.call(this,t);var e=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Kh,Qh,$h),tp.set(0,0,-1).applyQuaternion(Qh),e.positionX){var n=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Kh.x,n),e.positionY.linearRampToValueAtTime(Kh.y,n),e.positionZ.linearRampToValueAtTime(Kh.z,n),e.forwardX.linearRampToValueAtTime(tp.x,n),e.forwardY.linearRampToValueAtTime(tp.y,n),e.forwardZ.linearRampToValueAtTime(tp.z,n),e.upX.linearRampToValueAtTime(r.x,n),e.upY.linearRampToValueAtTime(r.y,n),e.upZ.linearRampToValueAtTime(r.z,n)}else e.setPosition(Kh.x,Kh.y,Kh.z),e.setOrientation(tp.x,tp.y,tp.z,r.x,r.y,r.z)}}),rp.prototype=Object.assign(Object.create(Sn.prototype),{constructor:rp,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+t;var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(t){return this.setFilters(t?[t]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});var np=new Qr,ip=new Jr,op=new Qr,ap=new Qr;function sp(t){rp.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function lp(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}function cp(t,e,r){var n,i,o;switch(this.binding=t,this.valueSize=r,e){case"quaternion":n=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":n=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:n=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}sp.prototype=Object.assign(Object.create(rp.prototype),{constructor:sp,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,r){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(t){if(Sn.prototype.updateMatrixWorld.call(this,t),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(np,ip,op),ap.set(0,0,1).applyQuaternion(ip);var e=this.panner;if(e.positionX){var r=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(np.x,r),e.positionY.linearRampToValueAtTime(np.y,r),e.positionZ.linearRampToValueAtTime(np.z,r),e.orientationX.linearRampToValueAtTime(ap.x,r),e.orientationY.linearRampToValueAtTime(ap.y,r),e.orientationZ.linearRampToValueAtTime(ap.z,r)}else e.setPosition(np.x,np.y,np.z),e.setOrientation(ap.x,ap.y,ap.z)}}}),Object.assign(lp.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var t=0,e=this.getFrequencyData(),r=0;r<e.length;r++)t+=e[r];return t/e.length}}),Object.assign(cp.prototype,{accumulate:function(t,e){var r=this.buffer,n=this.valueSize,i=t*n+n,o=this.cumulativeWeight;if(0===o){for(var a=0;a!==n;++a)r[i+a]=r[a];o=e}else{var s=e/(o+=e);this._mixBufferRegion(r,i,0,s,n)}this.cumulativeWeight=o},accumulateAdditive:function(t){var e=this.buffer,r=this.valueSize,n=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,r),this.cumulativeWeightAdditive+=t},apply:function(t){var e=this.valueSize,r=this.buffer,n=t*e+e,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){var s=e*this._origIndex;this._mixBufferRegion(r,n,s,1-i,e)}o>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*e,1,e);for(var l=e,c=e+e;l!==c;++l)if(r[l]!==r[l+e]){a.setValue(r,n);break}},saveOriginalState:function(){var t=this.binding,e=this.buffer,r=this.valueSize,n=r*this._origIndex;t.getValue(e,n);for(var i=r,o=n;i!==o;++i)e[i]=e[n+i%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){for(var t=this._addIndex*this.valueSize,e=t+this.valueSize,r=t;r<e;r++)this.buffer[r]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){for(var t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize,r=0;r<this.valueSize;r++)this.buffer[e+r]=this.buffer[t+r]},_select:function(t,e,r,n,i){if(n>=.5)for(var o=0;o!==i;++o)t[e+o]=t[r+o]},_slerp:function(t,e,r,n){Jr.slerpFlat(t,e,t,e,t,r,n)},_slerpAdditive:function(t,e,r,n,i){var o=this._workIndex*i;Jr.multiplyQuaternionsFlat(t,o,t,e,t,r),Jr.slerpFlat(t,e,t,e,t,o,n)},_lerp:function(t,e,r,n,i){for(var o=1-n,a=0;a!==i;++a){var s=e+a;t[s]=t[s]*o+t[r+a]*n}},_lerpAdditive:function(t,e,r,n,i){for(var o=0;o!==i;++o){var a=e+o;t[a]=t[a]+t[r+o]*n}}});var up="\\[\\]\\.:\\/",hp=new RegExp("[\\[\\]\\.:\\/]","g"),pp="[^\\[\\]\\.:\\/]",dp="[^"+up.replace("\\.","")+"]",fp=/((?:WC+[\/:])*)/.source.replace("WC",pp),mp=/(WCOD+)?/.source.replace("WCOD",dp),gp=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",pp),vp=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",pp),yp=new RegExp("^"+fp+mp+gp+vp+"$"),_p=["material","materials","bones"];function bp(t,e,r){var n=r||xp.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function xp(t,e,r){this.path=e,this.parsedPath=r||xp.parseTrackName(e),this.node=xp.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function wp(){this.uuid=jr.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var e=0,r=arguments.length;e!==r;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var n=this;this.stats={objects:{get total(){return n._objects.length},get inUse(){return this.total-n.nCachedObjects_}},get bindingsPerObject(){return n._bindings.length}}}function Ep(t,e,r,n){this._mixer=t,this._clip=e,this._localRoot=r||null,this.blendMode=n||e.blendMode;for(var i=e.tracks,o=i.length,a=new Array(o),s={endingStart:We,endingEnd:We},l=0;l!==o;++l){var c=i[l].createInterpolant(null);a[l]=c,c.settings=s}this._interpolantSettings=s,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=je,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Mp(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Sp(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function Tp(t,e,r){Fs.call(this,t,e),this.meshPerAttribute=r||1}function Ap(t,e,r,n){this.ray=new Kn(t,e),this.near=r||0,this.far=n||1/0,this.camera=null,this.layers=new hn,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Cp(t,e){return t.distance-e.distance}function Pp(t,e,r,n){if(t.layers.test(e.layers)&&t.raycast(e,r),!0===n)for(var i=t.children,o=0,a=i.length;o<a;o++)Pp(i[o],e,r,!0)}function Op(t,e,r){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==r?r:0,this}function Rp(t,e,r){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==r?r:0,this}Object.assign(bp.prototype,{getValue:function(t,e){this.bind();var r=this._targetGroup.nCachedObjects_,n=this._bindings[r];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){for(var r=this._bindings,n=this._targetGroup.nCachedObjects_,i=r.length;n!==i;++n)r[n].setValue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetGroup.nCachedObjects_,r=t.length;e!==r;++e)t[e].unbind()}}),Object.assign(xp,{Composite:bp,create:function(t,e,r){return t&&t.isAnimationObjectGroup?new xp.Composite(t,e,r):new xp(t,e,r)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(hp,"")},parseTrackName:function(t){var e=yp.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);var r={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){var i=r.nodeName.substring(n+1);-1!==_p.indexOf(i)&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=i)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var r=t.skeleton.getBoneByName(e);if(void 0!==r)return r}if(t.children){var n=function(t){for(var r=0;r<t.length;r++){var i=t[r];if(i.name===e||i.uuid===e)return i;var o=n(i.children);if(o)return o}return null},i=n(t.children);if(i)return i}return null}}),Object.assign(xp.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)t[e++]=r[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++]},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){for(var r=this.resolvedProperty,n=0,i=r.length;n!==i;++n)r[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){var t=this.node,e=this.parsedPath,r=e.objectName,n=e.propertyName,i=e.propertyIndex;if(t||(t=xp.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=e.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var a=0;a<t.length;a++)if(t[a].name===o){o=a;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var s=t[n];if(void 0!==s){var l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var u=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+n+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(xp.prototype,{_getValue_unbound:xp.prototype.getValue,_setValue_unbound:xp.prototype.setValue}),Object.assign(wp.prototype,{isAnimationObjectGroup:!0,add:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._paths,o=this._parsedPaths,a=this._bindings,s=a.length,l=void 0,c=0,u=arguments.length;c!==u;++c){var h=arguments[c],p=h.uuid,d=n[p];if(void 0===d){d=e++,n[p]=d,t.push(h);for(var f=0,m=s;f!==m;++f)a[f].push(new xp(h,i[f],o[f]))}else if(d<r){l=t[d];var g=--r,v=t[g];n[v.uuid]=d,t[d]=v,n[p]=g,t[g]=h;for(f=0,m=s;f!==m;++f){var y=a[f],_=y[g],b=y[d];y[d]=_,void 0===b&&(b=new xp(h,i[f],o[f])),y[g]=b}}else t[d]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var t=this._objects,e=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,i=n.length,o=0,a=arguments.length;o!==a;++o){var s=arguments[o],l=s.uuid,c=r[l];if(void 0!==c&&c>=e){var u=e++,h=t[u];r[h.uuid]=c,t[c]=h,r[l]=u,t[u]=s;for(var p=0,d=i;p!==d;++p){var f=n[p],m=f[u],g=f[c];f[c]=m,f[u]=g}}}this.nCachedObjects_=e},uncache:function(){for(var t=this._objects,e=t.length,r=this.nCachedObjects_,n=this._indicesByUUID,i=this._bindings,o=i.length,a=0,s=arguments.length;a!==s;++a){var l=arguments[a],c=l.uuid,u=n[c];if(void 0!==u)if(delete n[c],u<r){var h=--r,p=t[h],d=t[y=--e];n[p.uuid]=u,t[u]=p,n[d.uuid]=h,t[h]=d,t.pop();for(var f=0,m=o;f!==m;++f){var g=(_=i[f])[h],v=_[y];_[u]=g,_[h]=v,_.pop()}}else{var y;n[(d=t[y=--e]).uuid]=u,t[u]=d,t.pop();for(f=0,m=o;f!==m;++f){var _;(_=i[f])[u]=_[y],_.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){var r=this._bindingsIndicesByPath,n=r[t],i=this._bindings;if(void 0!==n)return i[n];var o=this._paths,a=this._parsedPaths,s=this._objects,l=s.length,c=this.nCachedObjects_,u=new Array(l);n=i.length,r[t]=n,o.push(t),a.push(e),i.push(u);for(var h=c,p=s.length;h!==p;++h){var d=s[h];u[h]=new xp(d,t,e)}return u},unsubscribe_:function(t){var e=this._bindingsIndicesByPath,r=e[t];if(void 0!==r){var n=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,s=o[a];e[t[a]]=r,o[r]=s,o.pop(),i[r]=i[a],i.pop(),n[r]=n[a],n.pop()}}}),Object.assign(Ep.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(t){return this._startTime=t,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,r){if(t.fadeOut(e),this.fadeIn(e),r){var n=this._clip.duration,i=t._clip.duration,o=i/n,a=n/i;t.warp(1,o,e),this.warp(a,1,e)}return this},crossFadeTo:function(t,e,r){return t.crossFadeFrom(this,e,r)},stopFading:function(){var t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,r){var n=this._mixer,i=n.time,o=this._timeScaleInterpolant,a=this.timeScale;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=i,s[1]=i+r,l[0]=t/a,l[1]=e/a,this},stopWarping:function(){var t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(t,e,r,n){if(this.enabled){var i=this._startTime;if(null!==i){var o=(t-i)*r;if(o<0||0===r)return;this._startTime=null,e=r*o}e*=this._updateTimeScale(t);var a=this._updateTime(e),s=this._updateWeight(t);if(s>0){var l=this._interpolants,c=this._propertyBindings;if(this.blendMode===Je)for(var u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(s);else for(u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(n,s)}}else this._updateWeight(t)},_updateWeight:function(t){var e=0;if(this.enabled){e=this.weight;var r=this._weightInterpolant;if(null!==r){var n=r.evaluate(t)[0];e*=n,t>r.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e},_updateTimeScale:function(t){var e=0;if(!this.paused){e=this.timeScale;var r=this._timeScaleInterpolant;if(null!==r)e*=r.evaluate(t)[0],t>r.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}return this._effectiveTimeScale=e,e},_updateTime:function(t){var e=this.time+t,r=this._clip.duration,n=this.loop,i=this._loopCount,o=n===Ge;if(0===t)return-1===i?e:o&&1==(1&i)?r-e:e;if(n===Fe){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(e>=r)e=r;else{if(!(e<0)){this.time=e;break t}e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),e>=r||e<0){var a=Math.floor(e/r);e-=r*a,i+=Math.abs(a);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,e=t>0?r:0,this.time=e,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var l=t<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=e;if(o&&1==(1&i))return r-e}return e},_setEndings:function(t,e,r){var n=this._interpolantSettings;r?(n.endingStart=qe,n.endingEnd=qe):(n.endingStart=t?this.zeroSlopeAtStart?qe:We:Ye,n.endingEnd=e?this.zeroSlopeAtEnd?qe:We:Ye)},_scheduleFading:function(t,e,r){var n=this._mixer,i=n.time,o=this._weightInterpolant;null===o&&(o=n._lendControlInterpolant(),this._weightInterpolant=o);var a=o.parameterPositions,s=o.sampleValues;return a[0]=i,s[0]=e,a[1]=i+t,s[1]=r,this}}),Mp.prototype=Object.assign(Object.create(Dr.prototype),{constructor:Mp,_bindAction:function(t,e){var r=t._localRoot||this._root,n=t._clip.tracks,i=n.length,o=t._propertyBindings,a=t._interpolants,s=r.uuid,l=this._bindingsByRootAndName,c=l[s];void 0===c&&(c={},l[s]=c);for(var u=0;u!==i;++u){var h=n[u],p=h.name,d=c[p];if(void 0!==d)o[u]=d;else{if(void 0!==(d=o[u])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,p));continue}var f=e&&e._propertyBindings[u].binding.parsedPath;++(d=new cp(xp.create(r,p,f),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,p),o[u]=d}a[u].resultBuffer=d.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){var e=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,e)}for(var i=t._propertyBindings,o=0,a=i.length;o!==a;++o){var s=i[o];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){var e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,r){var n=this._actions,i=this._actionsByClip,o=i[e];if(void 0===o)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,i[e]=o;else{var a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=n.length,n.push(t),o.actionByRoot[r]=t},_removeInactiveAction:function(t){var e=this._actions,r=e[e.length-1],n=t._cacheIndex;r._cacheIndex=n,e[n]=r,e.pop(),t._cacheIndex=null;var i=t._clip.uuid,o=this._actionsByClip,a=o[i],s=a.knownActions,l=s[s.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,s[c]=l,s.pop(),t._byClipCacheIndex=null,delete a.actionByRoot[(t._localRoot||this._root).uuid],0===s.length&&delete o[i],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){for(var e=t._propertyBindings,r=0,n=e.length;r!==n;++r){var i=e[r];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){var e=this._actions,r=t._cacheIndex,n=this._nActiveActions++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackAction:function(t){var e=this._actions,r=t._cacheIndex,n=--this._nActiveActions,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_addInactiveBinding:function(t,e,r){var n=this._bindingsByRootAndName,i=n[e],o=this._bindings;void 0===i&&(i={},n[e]=i),i[r]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){var e=this._bindings,r=t.binding,n=r.rootNode.uuid,i=r.path,o=this._bindingsByRootAndName,a=o[n],s=e[e.length-1],l=t._cacheIndex;s._cacheIndex=l,e[l]=s,e.pop(),delete a[i],0===Object.keys(a).length&&delete o[n]},_lendBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=this._nActiveBindings++,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_takeBackBinding:function(t){var e=this._bindings,r=t._cacheIndex,n=--this._nActiveBindings,i=e[n];t._cacheIndex=n,e[n]=t,i._cacheIndex=r,e[r]=i},_lendControlInterpolant:function(){var t=this._controlInterpolants,e=this._nActiveControlInterpolants++,r=t[e];return void 0===r&&((r=new bu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=r),r},_takeBackControlInterpolant:function(t){var e=this._controlInterpolants,r=t.__cacheIndex,n=--this._nActiveControlInterpolants,i=e[n];t.__cacheIndex=n,e[n]=t,i.__cacheIndex=r,e[r]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,r){var n=e||this._root,i=n.uuid,o="string"==typeof t?Ou.findByName(n,t):t,a=null!==o?o.uuid:t,s=this._actionsByClip[a],l=null;if(void 0===r&&(r=null!==o?o.blendMode:Xe),void 0!==s){var c=s.actionByRoot[i];if(void 0!==c&&c.blendMode===r)return c;l=s.knownActions[0],null===o&&(o=l._clip)}if(null===o)return null;var u=new Ep(this,o,e,r);return this._bindAction(u,l),this._addInactiveAction(u,a,i),u},existingAction:function(t,e){var r=e||this._root,n=r.uuid,i="string"==typeof t?Ou.findByName(r,t):t,o=i?i.uuid:t,a=this._actionsByClip[o];return void 0!==a&&a.actionByRoot[n]||null},stopAllAction:function(){for(var t=this._actions,e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;for(var e=this._actions,r=this._nActiveActions,n=this.time+=t,i=Math.sign(t),o=this._accuIndex^=1,a=0;a!==r;++a){e[a]._update(n,t,i,o)}var s=this._bindings,l=this._nActiveBindings;for(a=0;a!==l;++a)s[a].apply(o);return this},setTime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){var e=this._actions,r=t.uuid,n=this._actionsByClip,i=n[r];if(void 0!==i){for(var o=i.knownActions,a=0,s=o.length;a!==s;++a){var l=o[a];this._deactivateAction(l);var c=l._cacheIndex,u=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,e[c]=u,e.pop(),this._removeInactiveBindingsForAction(l)}delete n[r]}},uncacheRoot:function(t){var e=t.uuid,r=this._actionsByClip;for(var n in r){var i=r[n].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var o=this._bindingsByRootAndName[e];if(void 0!==o)for(var a in o){var s=o[a];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(t,e){var r=this.existingAction(t,e);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),Sp.prototype.clone=function(){return new Sp(void 0===this.value.clone?this.value:this.value.clone())},Tp.prototype=Object.assign(Object.create(Fs.prototype),{constructor:Tp,isInstancedInterleavedBuffer:!0,copy:function(t){return Fs.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this}}),Object.assign(Ap.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,r){var n=r||[];return Pp(t,this,n,e),n.sort(Cp),n},intersectObjects:function(t,e,r){var n=r||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,o=t.length;i<o;i++)Pp(t[i],this,n,e);return n.sort(Cp),n}}),Object.assign(Op.prototype,{set:function(t,e,r){return this.radius=t,this.phi=e,this.theta=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){var t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+e*e+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,r),this.phi=Math.acos(jr.clamp(e/this.radius,-1,1))),this}}),Object.assign(Rp.prototype,{set:function(t,e,r){return this.radius=t,this.theta=e,this.y=r,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,r){return this.radius=Math.sqrt(t*t+r*r),this.theta=Math.atan2(t,r),this.y=e,this}});var Lp=new Gr;function Ip(t,e){this.min=void 0!==t?t:new Gr(1/0,1/0),this.max=void 0!==e?e:new Gr(-1/0,-1/0)}Object.assign(Ip.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this},setFromCenterAndSize:function(t,e){var r=Lp.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Gr),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Gr),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Gr),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Gr),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Lp.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});var Np=new Qr,Bp=new Qr;function Dp(t,e){this.start=void 0!==t?t:new Qr,this.end=void 0!==e?e:new Qr}function kp(t){Sn.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Object.assign(Dp.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.start.copy(t.start),this.end.copy(t.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new Qr),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new Qr),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new Qr),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){Np.subVectors(t,this.start),Bp.subVectors(this.end,this.start);var r=Bp.dot(Bp),n=Bp.dot(Np)/r;return e&&(n=jr.clamp(n,0,1)),n},closestPointToPoint:function(t,e,r){var n=this.closestPointToPointParameter(t,e);return void 0===r&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Qr),this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}),kp.prototype=Object.create(Sn.prototype),kp.prototype.constructor=kp,kp.prototype.isImmediateRenderObject=!0;var Up=new Qr;function Fp(t,e){Sn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;for(var r=new Hi,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1;i<32;i++,o++){var a=i/32*Math.PI*2,s=o/32*Math.PI*2;n.push(Math.cos(a),Math.sin(a),1,Math.cos(s),Math.sin(s),1)}r.setAttribute("position",new Ii(n,3));var l=new wl({fog:!1,toneMapped:!1});this.cone=new Rl(r,l),this.add(this.cone),this.update()}Fp.prototype=Object.create(Sn.prototype),Fp.prototype.constructor=Fp,Fp.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Fp.prototype.update=function(){this.light.updateMatrixWorld();var t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Up.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Up),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var jp=new Qr,Gp=new sn,zp=new sn;function Vp(t){var e=[];t&&t.isBone&&e.push(t);for(var r=0;r<t.children.length;r++)e.push.apply(e,Vp(t.children[r]));return e}function Hp(t){for(var e=Vp(t),r=new Hi,n=[],i=[],o=new gi(0,0,1),a=new gi(0,1,0),s=0;s<e.length;s++){var l=e[s];l.parent&&l.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}r.setAttribute("position",new Ii(n,3)),r.setAttribute("color",new Ii(i,3));var c=new wl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});Rl.call(this,r,c),this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}function Wp(t,e,r){this.light=t,this.light.updateMatrixWorld(),this.color=r;var n=new Hc(e,4,2),i=new Ei({wireframe:!0,fog:!1,toneMapped:!1});lo.call(this,n,i),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}Hp.prototype=Object.create(Rl.prototype),Hp.prototype.constructor=Hp,Hp.prototype.isSkeletonHelper=!0,Hp.prototype.updateMatrixWorld=function(t){var e=this.bones,r=this.geometry,n=r.getAttribute("position");zp.getInverse(this.root.matrixWorld);for(var i=0,o=0;i<e.length;i++){var a=e[i];a.parent&&a.parent.isBone&&(Gp.multiplyMatrices(zp,a.matrixWorld),jp.setFromMatrixPosition(Gp),n.setXYZ(o,jp.x,jp.y,jp.z),Gp.multiplyMatrices(zp,a.parent.matrixWorld),jp.setFromMatrixPosition(Gp),n.setXYZ(o+1,jp.x,jp.y,jp.z),o+=2)}r.getAttribute("position").needsUpdate=!0,Sn.prototype.updateMatrixWorld.call(this,t)},Wp.prototype=Object.create(lo.prototype),Wp.prototype.constructor=Wp,Wp.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Wp.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var qp=new Qr,Yp=new gi,Xp=new gi;function Jp(t,e,r){Sn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var n=new Ql(e);n.rotateY(.5*Math.PI),this.material=new Ei({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);var i=n.getAttribute("position"),o=new Float32Array(3*i.count);n.setAttribute("color",new Si(o,3)),this.add(new lo(n,this.material)),this.update()}function Zp(t,e,r,n){t=t||10,e=e||10,r=new gi(void 0!==r?r:4473924),n=new gi(void 0!==n?n:8947848);for(var i=e/2,o=t/e,a=t/2,s=[],l=[],c=0,u=0,h=-a;c<=e;c++,h+=o){s.push(-a,0,h,a,0,h),s.push(h,0,-a,h,0,a);var p=c===i?r:n;p.toArray(l,u),u+=3,p.toArray(l,u),u+=3,p.toArray(l,u),u+=3,p.toArray(l,u),u+=3}var d=new Hi;d.setAttribute("position",new Ii(s,3)),d.setAttribute("color",new Ii(l,3));var f=new wl({vertexColors:!0,toneMapped:!1});Rl.call(this,d,f),this.type="GridHelper"}function Kp(t,e,r,n,i,o){t=t||10,e=e||16,r=r||8,n=n||64,i=new gi(void 0!==i?i:4473924),o=new gi(void 0!==o?o:8947848);var a,s,l,c,u,h,p,d=[],f=[];for(c=0;c<=e;c++)l=c/e*(2*Math.PI),a=Math.sin(l)*t,s=Math.cos(l)*t,d.push(0,0,0),d.push(a,0,s),p=1&c?i:o,f.push(p.r,p.g,p.b),f.push(p.r,p.g,p.b);for(c=0;c<=r;c++)for(p=1&c?i:o,h=t-t/r*c,u=0;u<n;u++)l=u/n*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,d.push(a,0,s),f.push(p.r,p.g,p.b),l=(u+1)/n*(2*Math.PI),a=Math.sin(l)*h,s=Math.cos(l)*h,d.push(a,0,s),f.push(p.r,p.g,p.b);var m=new Hi;m.setAttribute("position",new Ii(d,3)),m.setAttribute("color",new Ii(f,3));var g=new wl({vertexColors:!0,toneMapped:!1});Rl.call(this,m,g),this.type="PolarGridHelper"}Jp.prototype=Object.create(Sn.prototype),Jp.prototype.constructor=Jp,Jp.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Jp.prototype.update=function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getAttribute("color");Yp.copy(this.light.color),Xp.copy(this.light.groundColor);for(var r=0,n=e.count;r<n;r++){var i=r<n/2?Yp:Xp;e.setXYZ(r,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(qp.setFromMatrixPosition(this.light.matrixWorld).negate())},Zp.prototype=Object.assign(Object.create(Rl.prototype),{constructor:Zp,copy:function(t){return Rl.prototype.copy.call(this,t),this.geometry.copy(t.geometry),this.material.copy(t.material),this},clone:function(){return(new this.constructor).copy(this)}}),Kp.prototype=Object.create(Rl.prototype),Kp.prototype.constructor=Kp;var Qp=new Qr,$p=new Qr,td=new Qr;function ed(t,e,r){Sn.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,void 0===e&&(e=1);var n=new Hi;n.setAttribute("position",new Ii([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));var i=new wl({fog:!1,toneMapped:!1});this.lightPlane=new Cl(n,i),this.add(this.lightPlane),(n=new Hi).setAttribute("position",new Ii([0,0,0,0,0,1],3)),this.targetLine=new Cl(n,i),this.add(this.targetLine),this.update()}ed.prototype=Object.create(Sn.prototype),ed.prototype.constructor=ed,ed.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},ed.prototype.update=function(){Qp.setFromMatrixPosition(this.light.matrixWorld),$p.setFromMatrixPosition(this.light.target.matrixWorld),td.subVectors($p,Qp),this.lightPlane.lookAt($p),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt($p),this.targetLine.scale.z=td.length()};var rd=new Qr,nd=new Eo;function id(t){var e=new Hi,r=new wl({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],i=[],o={},a=new gi(16755200),s=new gi(16711680),l=new gi(43775),c=new gi(16777215),u=new gi(3355443);function h(t,e,r){p(t,r),p(e,r)}function p(t,e){n.push(0,0,0),i.push(e.r,e.g,e.b),void 0===o[t]&&(o[t]=[]),o[t].push(n.length/3-1)}h("n1","n2",a),h("n2","n4",a),h("n4","n3",a),h("n3","n1",a),h("f1","f2",a),h("f2","f4",a),h("f4","f3",a),h("f3","f1",a),h("n1","f1",a),h("n2","f2",a),h("n3","f3",a),h("n4","f4",a),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",u),h("cn1","cn2",u),h("cn3","cn4",u),h("cf1","cf2",u),h("cf3","cf4",u),e.setAttribute("position",new Ii(n,3)),e.setAttribute("color",new Ii(i,3)),Rl.call(this,e,r),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function od(t,e,r,n,i,o,a){rd.set(i,o,a).unproject(n);var s=e[t];if(void 0!==s)for(var l=r.getAttribute("position"),c=0,u=s.length;c<u;c++)l.setXYZ(s[c],rd.x,rd.y,rd.z)}id.prototype=Object.create(Rl.prototype),id.prototype.constructor=id,id.prototype.update=function(){var t=this.geometry,e=this.pointMap;nd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),od("c",e,t,nd,0,0,-1),od("t",e,t,nd,0,0,1),od("n1",e,t,nd,-1,-1,-1),od("n2",e,t,nd,1,-1,-1),od("n3",e,t,nd,-1,1,-1),od("n4",e,t,nd,1,1,-1),od("f1",e,t,nd,-1,-1,1),od("f2",e,t,nd,1,-1,1),od("f3",e,t,nd,-1,1,1),od("f4",e,t,nd,1,1,1),od("u1",e,t,nd,.7,1.1,-1),od("u2",e,t,nd,-.7,1.1,-1),od("u3",e,t,nd,0,2,-1),od("cf1",e,t,nd,-1,0,1),od("cf2",e,t,nd,1,0,1),od("cf3",e,t,nd,0,-1,1),od("cf4",e,t,nd,0,1,1),od("cn1",e,t,nd,-1,0,-1),od("cn2",e,t,nd,1,0,-1),od("cn3",e,t,nd,0,-1,-1),od("cn4",e,t,nd,0,1,-1),t.getAttribute("position").needsUpdate=!0};var ad=new jn;function sd(t,e){this.object=t,void 0===e&&(e=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),i=new Hi;i.setIndex(new Si(r,1)),i.setAttribute("position",new Si(n,3)),Rl.call(this,i,new wl({color:e,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function ld(t,e){this.type="Box3Helper",this.box=t,e=e||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Hi;n.setIndex(new Si(r,1)),n.setAttribute("position",new Ii([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Rl.call(this,n,new wl({color:e,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function cd(t,e,r){this.plane=t,this.size=void 0===e?1:e;var n=void 0!==r?r:16776960,i=new Hi;i.setAttribute("position",new Ii([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),Cl.call(this,i,new wl({color:n,toneMapped:!1})),this.type="PlaneHelper";var o=new Hi;o.setAttribute("position",new Ii([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new lo(o,new Ei({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}sd.prototype=Object.create(Rl.prototype),sd.prototype.constructor=sd,sd.prototype.update=function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&ad.setFromObject(this.object),!ad.isEmpty()){var e=ad.min,r=ad.max,n=this.geometry.attributes.position,i=n.array;i[0]=r.x,i[1]=r.y,i[2]=r.z,i[3]=e.x,i[4]=r.y,i[5]=r.z,i[6]=e.x,i[7]=e.y,i[8]=r.z,i[9]=r.x,i[10]=e.y,i[11]=r.z,i[12]=r.x,i[13]=r.y,i[14]=e.z,i[15]=e.x,i[16]=r.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=r.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}},sd.prototype.setFromObject=function(t){return this.object=t,this.update(),this},sd.prototype.copy=function(t){return Rl.prototype.copy.call(this,t),this.object=t.object,this},sd.prototype.clone=function(){return(new this.constructor).copy(this)},ld.prototype=Object.create(Rl.prototype),ld.prototype.constructor=ld,ld.prototype.updateMatrixWorld=function(t){var e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),Sn.prototype.updateMatrixWorld.call(this,t))},cd.prototype=Object.create(Cl.prototype),cd.prototype.constructor=cd,cd.prototype.updateMatrixWorld=function(t){var e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?v:g,this.lookAt(this.plane.normal),Sn.prototype.updateMatrixWorld.call(this,t)};var ud,hd,pd=new Qr;function dd(t,e,r,n,i,o){Sn.call(this),this.type="ArrowHelper",void 0===t&&(t=new Qr(0,0,1)),void 0===e&&(e=new Qr(0,0,0)),void 0===r&&(r=1),void 0===n&&(n=16776960),void 0===i&&(i=.2*r),void 0===o&&(o=.2*i),void 0===ud&&((ud=new Hi).setAttribute("position",new Ii([0,0,0,0,1,0],3)),(hd=new tu(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Cl(ud,new wl({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new lo(hd,new Ei({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,i,o)}function fd(t){var e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],r=new Hi;r.setAttribute("position",new Ii(e,3)),r.setAttribute("color",new Ii([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var n=new wl({vertexColors:!0,toneMapped:!1});Rl.call(this,r,n),this.type="AxesHelper"}dd.prototype=Object.create(Sn.prototype),dd.prototype.constructor=dd,dd.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{pd.set(t.z,0,-t.x).normalize();var e=Math.acos(t.y);this.quaternion.setFromAxisAngle(pd,e)}},dd.prototype.setLength=function(t,e,r){void 0===e&&(e=.2*t),void 0===r&&(r=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(r,e,r),this.cone.position.y=t,this.cone.updateMatrix()},dd.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},dd.prototype.copy=function(t){return Sn.prototype.copy.call(this,t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this},dd.prototype.clone=function(){return(new this.constructor).copy(this)},fd.prototype=Object.create(Rl.prototype),fd.prototype.constructor=fd;var md=Math.pow(2,8),gd=[.125,.215,.35,.446,.526,.582],vd=5+gd.length,yd=20,_d={[$e]:0,[tr]:1,[rr]:2,[ir]:3,[or]:4,[ar]:5,[er]:6},bd=new bh,{_lodPlanes:xd,_sizeLods:wd,_sigmas:Ed}=function(){for(var t=[],e=[],r=[],n=8,i=0;i<vd;i++){var o=Math.pow(2,n);e.push(o);var a=1/o;i>4?a=gd[i-8+4-1]:0==i&&(a=0),r.push(a);for(var s=1/(o-1),l=-s/2,c=1+s/2,u=[l,l,c,l,c,c,l,l,c,c,l,c],h=new Float32Array(108),p=new Float32Array(72),d=new Float32Array(36),f=0;f<6;f++){var m=f%3*2/3-1,g=f>2?0:-1,v=[m,g,0,m+2/3,g,0,m+2/3,g+1,0,m,g,0,m+2/3,g+1,0,m,g+1,0];h.set(v,18*f),p.set(u,12*f);var y=[f,f,f,f,f,f];d.set(y,6*f)}var _=new Hi;_.setAttribute("position",new Si(h,3)),_.setAttribute("uv",new Si(p,2)),_.setAttribute("faceIndex",new Si(d,1)),t.push(_),n>4&&n--}return{_lodPlanes:t,_sizeLods:e,_sigmas:r}}(),Md=null,Sd=(1+Math.sqrt(5))/2,Td=1/Sd,Ad=[new Qr(1,1,1),new Qr(-1,1,1),new Qr(1,1,-1),new Qr(-1,1,-1),new Qr(0,Sd,Td),new Qr(0,Sd,-Td),new Qr(Td,0,Sd),new Qr(-Td,0,Sd),new Qr(Sd,Td,0),new Qr(-Sd,Td,0)];function Cd(t){var e,r,n,i;this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=(e=yd,r=new Float32Array(e),n=new Qr(0,1,0),(i=new su({defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:_d[$e]},outputEncoding:{value:_d[$e]}},vertexShader:Nd(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n${Bd()}\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvec3 getSample(float theta, vec3 axis) {\n\tfloat cosTheta = cos(theta);\n\t// Rodrigues' axis-angle rotation\n\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\treturn bilinearCubeUV(envMap, sampleDirection, mipInt);\n}\n\nvoid main() {\n\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\tif (all(equal(axis, vec3(0.0))))\n\t\taxis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);\n\taxis = normalize(axis);\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb += weights[0] * getSample(0.0, axis);\n\tfor (int i = 1; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfloat theta = dTheta * float(i);\n\t\tgl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);\n\t\tgl_FragColor.rgb += weights[i] * getSample(theta, axis);\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:x,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",i),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}function Pd(t){return void 0!==t&&t.type===At&&(t.encoding===$e||t.encoding===tr||t.encoding===er)}function Od(t){var e=new Yr(3*md,3*md,t);return e.texture.mapping=pt,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Rd(t,e,r,n,i){t.viewport.set(e,r,n,i),t.scissor.set(e,r,n,i)}function Ld(){var t=new su({uniforms:{envMap:{value:null},texelSize:{value:new Gr(1,1)},inputEncoding:{value:_d[$e]},outputEncoding:{value:_d[$e]}},vertexShader:Nd(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n${Bd()}\n\n#include <common>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv = equirectUv( outputDirection );\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:x,depthTest:!1,depthWrite:!1});return t.type="EquirectangularToCubeUV",t}function Id(){var t=new su({uniforms:{envMap:{value:null},inputEncoding:{value:_d[$e]},outputEncoding:{value:_d[$e]}},vertexShader:Nd(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n${Bd()}\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:x,depthTest:!1,depthWrite:!1});return t.type="CubemapToCubeUV",t}function Nd(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\n\n// RH coordinate system; PMREM face-indexing convention\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\t} else if (face == 2.0) {\n\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\t} else if (face == 5.0) {\n\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\t}\n\treturn direction;\n}\n\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function Bd(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function Dd(t,e,r,n,i,o,a){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new bi(t,e,r,i,o,a)}Cd.prototype={constructor:Cd,fromScene:function(t,e=0,r=.1,n=100){Md=this._renderer.getRenderTarget();var i=this._allocateTargets();return this._sceneToCubeUV(t,r,n,i),e>0&&this._blur(i,0,0,e),this._applyPMREM(i),this._cleanup(i),i},fromEquirectangular:function(t){return t.magFilter=vt,t.minFilter=vt,t.generateMipmaps=!1,this.fromCubemap(t)},fromCubemap:function(t){Md=this._renderer.getRenderTarget();var e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},compileCubemapShader:function(){null===this._cubemapShader&&(this._cubemapShader=Id(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){null===this._equirectShader&&(this._equirectShader=Ld(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(var t=0;t<xd.length;t++)xd[t].dispose()},_cleanup:function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Md),t.scissorTest=!1,t.setSize(t.width,t.height)},_allocateTargets:function(t){var e={magFilter:vt,minFilter:vt,generateMipmaps:!1,type:At,format:Ht,encoding:Pd(t)?t.encoding:rr,depthBuffer:!1,stencilBuffer:!1},r=Od(e);return r.depthBuffer=!t,this._pingPongRenderTarget=Od(e),r},_compileMaterial:function(t){var e=new lo(xd[0],t);this._renderer.compile(e,bd)},_sceneToCubeUV:function(t,e,r,n){var i=new Mo(90,1,e,r),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],s=this._renderer,l=s.outputEncoding,c=s.toneMapping,u=s.toneMappingExposure,h=s.getClearColor(),p=s.getClearAlpha();s.toneMapping=et,s.toneMappingExposure=1,s.outputEncoding=$e;var d=t.background;if(d&&d.isColor){d.convertSRGBToLinear();var f=Math.max(d.r,d.g,d.b),m=Math.min(Math.max(Math.ceil(Math.log2(f)),-128),127);d=d.multiplyScalar(Math.pow(2,-m));var g=(m+128)/255;s.setClearColor(d,g),t.background=null}for(var v=0;v<6;v++){var y=v%3;0==y?(i.up.set(0,o[v],0),i.lookAt(a[v],0,0)):1==y?(i.up.set(0,0,o[v]),i.lookAt(0,a[v],0)):(i.up.set(0,o[v],0),i.lookAt(0,0,a[v])),Rd(n,y*md,v>2?md:0,md,md),s.setRenderTarget(n),s.render(t,i)}s.toneMapping=c,s.toneMappingExposure=u,s.outputEncoding=l,s.setClearColor(h,p)},_textureToCubeUV:function(t,e){var r=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Id()):null==this._equirectShader&&(this._equirectShader=Ld());var n=t.isCubeTexture?this._cubemapShader:this._equirectShader,i=new lo(xd[0],n),o=n.uniforms;o.envMap.value=t,t.isCubeTexture||o.texelSize.value.set(1/t.image.width,1/t.image.height),o.inputEncoding.value=_d[t.encoding],o.outputEncoding.value=_d[e.texture.encoding],Rd(e,0,0,3*md,2*md),r.setRenderTarget(e),r.render(i,bd)},_applyPMREM:function(t){var e=this._renderer,r=e.autoClear;e.autoClear=!1;for(var n=1;n<vd;n++){var i=Math.sqrt(Ed[n]*Ed[n]-Ed[n-1]*Ed[n-1]),o=Ad[(n-1)%Ad.length];this._blur(t,n-1,n,i,o)}e.autoClear=r},_blur:function(t,e,r,n,i){var o=this._pingPongRenderTarget;this._halfBlur(t,o,e,r,n,"latitudinal",i),this._halfBlur(o,t,r,r,n,"longitudinal",i)},_halfBlur:function(t,e,r,n,i,o,a){var s=this._renderer,l=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new lo(xd[n],l),u=l.uniforms,h=wd[r]-1,p=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,d=i/p,f=isFinite(i)?1+Math.floor(3*d):yd;f>yd&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);for(var m=[],g=0,v=0;v<yd;++v){var y=v/d,_=Math.exp(-y*y/2);m.push(_),0==v?g+=_:v<f&&(g+=2*_)}for(v=0;v<m.length;v++)m[v]=m[v]/g;u.envMap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===o,a&&(u.poleAxis.value=a),u.dTheta.value=p,u.mipInt.value=8-r,u.inputEncoding.value=_d[t.texture.encoding],u.outputEncoding.value=_d[t.texture.encoding];var b=wd[n];Rd(e,y=3*Math.max(0,md-2*b),(0===n?0:2*md)+2*b*(n>4?n-8+4:0),3*b,2*b),s.setRenderTarget(e),s.render(c,bd)}};var kd=0,Ud=1,Fd=0,jd=1,Gd=2;function zd(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function Vd(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function Hd(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Ul(t,e)}function Wd(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new rl(t)}function qd(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Ul(t,e)}function Yd(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Il(t)}function Xd(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Il(t)}function Jd(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Il(t)}function Zd(t,e,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Qr(t,e,r)}function Kd(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Si(t,e).setUsage(Cr)}function Qd(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Ti(t,e)}function $d(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Ai(t,e)}function tf(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Ci(t,e)}function ef(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Pi(t,e)}function rf(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Oi(t,e)}function nf(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Ri(t,e)}function of(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Li(t,e)}function af(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Ii(t,e)}function sf(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Ni(t,e)}function lf(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Qu.call(this,t),this.type="catmullrom",this.closed=!0}function cf(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Qu.call(this,t),this.type="catmullrom"}function uf(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Qu.call(this,t),this.type="catmullrom"}function hf(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new fd(t)}function pf(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new sd(t,e)}function df(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Rl(new Qc(t.geometry),new wl({color:void 0!==e?e:16777215}))}function ff(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Rl(new Hl(t.geometry),new wl({color:void 0!==e?e:16777215}))}function mf(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new ku(t)}function gf(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new ju(t)}function vf(t,e,r){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ao(t,r)}Hu.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Hu.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(uh.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var e=new go,r=0,n=t.length;r<n;r++){var i=t[r];e.vertices.push(new Qr(i.x,i.y,i.z||0))}return e}}),Object.assign(hh.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),lf.prototype=Object.create(Qu.prototype),cf.prototype=Object.create(Qu.prototype),uf.prototype=Object.create(Qu.prototype),Object.assign(uf.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Zp.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Hp.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Bu.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ch.extractUrlBase(t)}}),Bu.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Ih.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(Ip.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(jn.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Vn.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Ro.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Dp.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(jr,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),jr.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),jr.ceilPowerOfTwo(t)}}),Object.assign(zr.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(sn.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Qr).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,r,n,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,r,i,o)}}),ei.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Jr.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Kn.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(pi.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(pi,{barycoordFromPoint:function(t,e,r,n,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),pi.getBarycoord(t,e,r,n,i)},normal:function(t,e,r,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),pi.getNormal(t,e,r,n)}}),Object.assign(ph.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new kc(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Jc(this,t)}}),Object.assign(Gr.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Qr.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(qr.prototype,{fromAttribute:function(t,e,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(go.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(Sn.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Sn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(lo.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(lo.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Ze},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(hl.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(ml.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),pl.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Hu.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),Mo.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(dh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(Si.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Cr},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Cr)}}}),Object.assign(Si.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Cr:Ar),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Hi.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new Si(arguments[1],arguments[2])))},addDrawCall:function(t,e,r){void 0!==r&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Hi.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Ph.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(Ap.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(Fs.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===Cr},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(Fs.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?Cr:Ar),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Uc.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Sp.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(wi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new gi}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=t===_}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(uu.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(wo.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Ds.prototype,{clearTarget:function(t,e,r,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,r,n)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Ds.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?tr:$e}}}),Object.defineProperties(As.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Yr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(rp.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var e=this;return(new Hh).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),lp.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},To.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};var yf={merge:function(t,e,r){var n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,r)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};function _f(){console.error("THREE.CanvasRenderer has been removed")}function bf(){console.error("THREE.JSONLoader has been removed.")}Vr.crossOrigin=void 0,Vr.loadTexture=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Vu;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,r,void 0,n);return e&&(o.mapping=e),o},Vr.loadTextureCube=function(t,e,r,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new zu;i.setCrossOrigin(this.crossOrigin);var o=i.load(t,r,void 0,n);return e&&(o.mapping=e),o},Vr.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Vr.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var xf={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function wf(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}}))}));var a,s,l,c=o("g71hk"),u=(c=o("g71hk"),{uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")});c=o("g71hk"),c=o("g71hk");function h(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}Object.assign(h.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),h.FullScreenQuad=(a=new c.OrthographicCamera(-1,1,1,-1,0,1),s=new c.PlaneBufferGeometry(2,2),l=function(t){this._mesh=new c.Mesh(s,t)},Object.defineProperty(l.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(l.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(t){t.render(this._mesh,a)}}),l);var p=function(t,e){h.call(this),this.textureID=void 0!==e?e:"tDiffuse",t instanceof c.ShaderMaterial?(this.uniforms=t.uniforms,this.material=t):t&&(this.uniforms=c.UniformsUtils.clone(t.uniforms),this.material=new c.ShaderMaterial({defines:Object.assign({},t.defines),uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader})),this.fsQuad=new h.FullScreenQuad(this.material)};p.prototype=Object.assign(Object.create(h.prototype),{constructor:p,render:function(t,e,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(e),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),this.fsQuad.render(t))}});var d=function(t,e){h.call(this),this.scene=t,this.camera=e,this.clear=!0,this.needsSwap=!1,this.inverse=!1};d.prototype=Object.assign(Object.create(h.prototype),{constructor:d,render:function(t,e,r){var n,i,o=t.getContext(),a=t.state;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(n=0,i=1):(n=1,i=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.buffers.stencil.setFunc(o.ALWAYS,n,4294967295),a.buffers.stencil.setClear(i),a.buffers.stencil.setLocked(!0),t.setRenderTarget(r),this.clear&&t.clear(),t.render(this.scene,this.camera),t.setRenderTarget(e),this.clear&&t.clear(),t.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(o.EQUAL,1,4294967295),a.buffers.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.buffers.stencil.setLocked(!0)}});var f=function(){h.call(this),this.needsSwap=!1};f.prototype=Object.create(h.prototype),Object.assign(f.prototype,{render:function(t){t.state.buffers.stencil.setLocked(!1),t.state.buffers.stencil.setTest(!1)}});var m=function(t,e){if(this.renderer=t,void 0===e){var r={minFilter:c.LinearFilter,magFilter:c.LinearFilter,format:c.RGBAFormat,stencilBuffer:!1},n=t.getSize(new c.Vector2);this._pixelRatio=t.getPixelRatio(),this._width=n.width,this._height=n.height,(e=new c.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=e.width,this._height=e.height;this.renderTarget1=e,this.renderTarget2=e.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],void 0===u&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===p&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new p(u),this.clock=new c.Clock};Object.assign(m.prototype,{swapBuffers:function(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t},addPass:function(t){this.passes.push(t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},insertPass:function(t,e){this.passes.splice(e,0,t),t.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)},isLastEnabledPass:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0},render:function(t){void 0===t&&(t=this.clock.getDelta());var e,r,n=this.renderer.getRenderTarget(),i=!1,o=this.passes.length;for(r=0;r<o;r++)if(!1!==(e=this.passes[r]).enabled){if(e.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),e.render(this.renderer,this.writeBuffer,this.readBuffer,t,i),e.needsSwap){if(i){var a=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),s.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==d&&(e instanceof d?i=!0:e instanceof f&&(i=!1))}this.renderer.setRenderTarget(n)},reset:function(t){if(void 0===t){var e=this.renderer.getSize(new c.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=e.width,this._height=e.height,(t=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(t,e){this._width=t,this._height=e;var r=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(r,n),this.renderTarget2.setSize(r,n);for(var i=0;i<this.passes.length;i++)this.passes[i].setSize(r,n)},setPixelRatio:function(t){this._pixelRatio=t,this.setSize(this._width,this._height)}});var g=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(g.prototype,{setSize:function(){},render:function(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}),g.FullScreenQuad=function(){var t=new c.OrthographicCamera(-1,1,1,-1,0,1),e=new c.PlaneBufferGeometry(2,2),r=function(t){this._mesh=new c.Mesh(e,t)};return Object.defineProperty(r.prototype,"material",{get:function(){return this._mesh.material},set:function(t){this._mesh.material=t}}),Object.assign(r.prototype,{dispose:function(){this._mesh.geometry.dispose()},render:function(e){e.render(this._mesh,t)}}),r}();var v=function(t,e,r,n,i){h.call(this),this.scene=t,this.camera=e,this.overrideMaterial=r,this.clearColor=n,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};v.prototype=Object.assign(Object.create(h.prototype),{constructor:v,render:function(t,e,r){var n,i,o,a=t.autoClear;t.autoClear=!1,void 0!==this.overrideMaterial&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(n=t.getClearColor().getHex(),i=t.getClearAlpha(),t.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&t.clearDepth(),t.setRenderTarget(this.renderToScreen?null:r),this.clear&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),t.render(this.scene,this.camera),this.clearColor&&t.setClearColor(n,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=o),t.autoClear=a}});class y{static getModelPath(t){return"models/"+["box_canna/box_canna.pmd","box_miku/box_miku.pmd","box_rin/box_rin.pmd","box_len/box_len.pmd","box_luka/box_luka.pmd"][t]}}y.CANNNA=0,y.MIKU=1,y.RIN=2,y.LEN=3,y.LUKA=4;class _{}_.stw=1280,_.sth=720,_.isDebug=!1,_.enabledWarn=!1,_.parameter=new class{constructor(){this.fontName="sans-serif",this.fontColor=3355460,this.colors=[16737996,16755387,16759620,16750950],this.bgColor=15658745,this.modelId=y.CANNNA,this.nekomimi=!0,this.seed=1}};class b{static random(t=null){var e=this.seed;return null!=t&&(e=t),e^=e<<13,e^=e>>17,e^=e<<15,this.seed=e,e/4294967296+.5}static randInt(t,e,r=null){return Math.floor(this.rand(t,e+1,r))}static rand(t,e,r=null){return this.random(r)*(e-t)+t}static toRad(t){return t*Math.PI/180}static toDeg(t){return 180*t/Math.PI}}b.seed=0;c=o("g71hk"),c=o("g71hk");o.register("41Sah",(function(t,e){(function(){var r=this,n=r.THREE||o("g71hk");if(!n)throw new Error("MeshLine requires three.js");function i(){n.BufferGeometry.call(this),this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new n.Matrix4,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(t){this.setGeometry(t,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(t){this.setPoints(t,this.widthCallback)}}})}function a(t,e){var r=new n.Matrix4,i=new n.Ray,o=new n.Sphere,a=new n.Vector3,s=this.geometry;if(o.copy(s.boundingSphere),o.applyMatrix4(this.matrixWorld),!1!==t.ray.intersectSphere(o,a)){r.getInverse(this.matrixWorld),i.copy(t.ray).applyMatrix4(r);var l=new n.Vector3,c=new n.Vector3,u=new n.Vector3,h=this instanceof n.LineSegments?2:1,p=s.index,d=s.attributes;if(null!==p)for(var f=p.array,m=d.position.array,g=d.width.array,v=0,y=f.length-1;v<y;v+=h){var _=f[v],b=f[v+1];l.fromArray(m,3*_),c.fromArray(m,3*b);var x=null!=g[Math.floor(v/3)]?g[Math.floor(v/3)]:1,w=t.params.Line.threshold+this.material.lineWidth*x/2,E=w*w;if(!(i.distanceSqToSegment(l,c,a,u)>E)){a.applyMatrix4(this.matrixWorld);var M=t.ray.origin.distanceTo(a);M<t.near||M>t.far||(e.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this}),v=y)}}}}function s(t,e,r,n,i){var o;if(t=t.subarray||t.slice?t:t.buffer,r=r.subarray||r.slice?r:r.buffer,t=e?t.subarray?t.subarray(e,i&&e+i):t.slice(e,i&&e+i):t,r.set)r.set(t,n);else for(o=0;o<t.length;o++)r[o+n]=t[o];return r}function l(t){n.ShaderMaterial.call(this,{uniforms:Object.assign({},n.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new n.Color(16777215)},opacity:{value:1},resolution:{value:new n.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new n.Vector2(1,1)}}),vertexShader:n.ShaderChunk.meshline_vert,fragmentShader:n.ShaderChunk.meshline_frag}),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(t){this.uniforms.color.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(t){this.uniforms.dashArray.value=t,this.useDash=0!==t?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(t){this.uniforms.useDash.value=t}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(t){this.uniforms.repeat.value.copy(t)}}}),this.setValues(t)}i.prototype=Object.create(n.BufferGeometry.prototype),i.prototype.constructor=i,i.prototype.isMeshLine=!0,i.prototype.setMatrixWorld=function(t){this.matrixWorld=t},i.prototype.setGeometry=function(t,e){this._geometry=t,t instanceof n.Geometry?this.setPoints(t.vertices,e):t instanceof n.BufferGeometry?this.setPoints(t.getAttribute("position").array,e):this.setPoints(t,e)},i.prototype.setPoints=function(t,e){if(t instanceof Float32Array||t instanceof Array){if(this._points=t,this.widthCallback=e,this.positions=[],this.counters=[],t.length&&t[0]instanceof n.Vector3)for(var r=0;r<t.length;r++){var i=t[r],o=r/t.length;this.positions.push(i.x,i.y,i.z),this.positions.push(i.x,i.y,i.z),this.counters.push(o),this.counters.push(o)}else for(r=0;r<t.length;r+=3){o=r/t.length;this.positions.push(t[r],t[r+1],t[r+2]),this.positions.push(t[r],t[r+1],t[r+2]),this.counters.push(o),this.counters.push(o)}this.process()}else console.error("ERROR: The BufferArray of points is not instancied correctly.")},i.prototype.raycast=a,i.prototype.compareV3=function(t,e){var r=6*t,n=6*e;return this.positions[r]===this.positions[n]&&this.positions[r+1]===this.positions[n+1]&&this.positions[r+2]===this.positions[n+2]},i.prototype.copyV3=function(t){var e=6*t;return[this.positions[e],this.positions[e+1],this.positions[e+2]]},i.prototype.process=function(){var t,e,r=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],e=this.compareV3(0,r-1)?this.copyV3(r-2):this.copyV3(0),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);for(var i=0;i<r;i++){if(this.side.push(1),this.side.push(-1),t=this.widthCallback?this.widthCallback(i/(r-1)):1,this.width.push(t),this.width.push(t),this.uvs.push(i/(r-1),0),this.uvs.push(i/(r-1),1),i<r-1){e=this.copyV3(i),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);var o=2*i;this.indices_array.push(o,o+1,o+2),this.indices_array.push(o+2,o+1,o+3)}i>0&&(e=this.copyV3(i),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]))}e=this.compareV3(r-1,0)?this.copyV3(1):this.copyV3(r-1),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new n.BufferAttribute(new Float32Array(this.positions),3),previous:new n.BufferAttribute(new Float32Array(this.previous),3),next:new n.BufferAttribute(new Float32Array(this.next),3),side:new n.BufferAttribute(new Float32Array(this.side),1),width:new n.BufferAttribute(new Float32Array(this.width),1),uv:new n.BufferAttribute(new Float32Array(this.uvs),2),index:new n.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new n.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()},i.prototype.advance=function(t){var e=this._attributes.position.array,r=this._attributes.previous.array,n=this._attributes.next.array,i=e.length;s(e,0,r,0,i),s(e,6,e,0,i-6),e[i-6]=t.x,e[i-5]=t.y,e[i-4]=t.z,e[i-3]=t.x,e[i-2]=t.y,e[i-1]=t.z,s(e,6,n,0,i-6),n[i-6]=t.x,n[i-5]=t.y,n[i-4]=t.z,n[i-3]=t.x,n[i-2]=t.y,n[i-1]=t.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},n.ShaderChunk.meshline_vert=["",n.ShaderChunk.logdepthbuf_pars_vertex,n.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",n.ShaderChunk.logdepthbuf_vertex,n.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",n.ShaderChunk.fog_vertex,"}"].join("\n"),n.ShaderChunk.meshline_frag=["",n.ShaderChunk.fog_pars_fragment,n.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",n.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",n.ShaderChunk.fog_fragment,"}"].join("\n"),l.prototype=Object.create(n.ShaderMaterial.prototype),l.prototype.constructor=l,l.prototype.isMeshLineMaterial=!0,l.prototype.copy=function(t){return n.ShaderMaterial.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.alphaMap=t.alphaMap,this.useAlphaMap=t.useAlphaMap,this.color.copy(t.color),this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.dashArray.copy(t.dashArray),this.dashOffset.copy(t.dashOffset),this.dashRatio.copy(t.dashRatio),this.useDash=t.useDash,this.visibility=t.visibility,this.alphaTest=t.alphaTest,this.repeat.copy(t.repeat),this},void 0!==e?(t.exports&&(e=t.exports={MeshLine:i,MeshLineMaterial:l,MeshLineRaycast:a}),e.MeshLine=i,e.MeshLineMaterial=l,e.MeshLineRaycast=a):(r.MeshLine=i,r.MeshLineMaterial=l,r.MeshLineRaycast=a)}).call(this)}));var x=o("41Sah");class w{get mesh(){return this._line}get x(){return this._line.position.x}get y(){return this._line.position.y}get z(){return this._line.position.z}get rotationX(){return this._line.rotation.x}get rotationY(){return this._line.rotation.y}get rotationZ(){return this._line.rotation.z}set x(t){this._line.position.x=t}set y(t){this._line.position.y=t}set z(t){this._line.position.z=t}set rotationX(t){this._line.rotation.x=t}set rotationY(t){this._line.rotation.y=t}set rotationZ(t){this._line.rotation.z=t}get dashOffset(){return this._line?this._line.material.uniforms.dashOffset.value:-1}set dashOffset(t){this._line&&(this._line.material.uniforms.dashOffset.value=t)}set progress(t){this.dashOffset=-this._dashArray*t}constructor(t){this._parent=t}changeColor(t){this._material&&this._material.color.set(t)}create(t){this.dispose(),t.color||(t.color=0),t.width||(t.width=2),t.division||(t.division=64),t.widthCallback||(t.widthCallback=function(t){return 4*t*(1-t)}),isNaN(t.dashRatio)&&(t.dashRatio=.9),isNaN(t.dashArray)&&(t.dashArray=2*(1-t.dashRatio)+1),this._dashArray=t.dashArray;var e=t.points,r=new c.CatmullRomCurve3(e).getPoints(t.division),n=(new c.Geometry).setFromPoints(r),i=new x.MeshLine;i.setGeometry(n,t.widthCallback);var o=new x.MeshLineMaterial({transparent:!0,lineWidth:t.width,color:new c.Color(t.color),opacity:1,dashOffset:0,dashArray:t.dashArray,dashRatio:t.dashRatio,sizeAttenuation:!0,depthWrite:!1,side:c.DoubleSide,fog:!0});this._material=o;var a=this._line=new c.Mesh(i.geometry,o);return this._parent.add(a),a}show(){this._line.visible=!0}hide(){this._line.visible=!1}dispose(){this._line&&(this._line.material=null,this._line.geometry.dispose(),this._line.geometry=null,this._parent.remove(this._line),this._line=null)}}c=o("g71hk"),c=o("g71hk");var E=function(){function t(t,e){this.mesh=t,this.iks=e||[],this._valid()}var e,r,n,i,o,a,s,l,u,h;function p(t,e){c.Object3D.call(this),this.root=t,this.iks=e||[],this.matrix.copy(t.matrixWorld),this.matrixAutoUpdate=!1,this.sphereGeometry=new c.SphereBufferGeometry(.25,16,8),this.targetSphereMaterial=new c.MeshBasicMaterial({color:new c.Color(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new c.MeshBasicMaterial({color:new c.Color(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new c.MeshBasicMaterial({color:new c.Color(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new c.LineBasicMaterial({color:new c.Color(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init()}return t.prototype={constructor:t,update:(e=new c.Quaternion,r=new c.Vector3,n=new c.Vector3,i=new c.Vector3,o=new c.Vector3,a=new c.Vector3,s=new c.Quaternion,l=new c.Vector3,u=new c.Vector3,h=new c.Vector3,function(){for(var t=this.mesh.skeleton.bones,c=this.iks,p=Math,d=0,f=c.length;d<f;d++){var m=c[d],g=t[m.effector],v=t[m.target];r.setFromMatrixPosition(v.matrixWorld);for(var y=m.links,_=void 0!==m.iteration?m.iteration:1,b=0;b<_;b++){for(var x=!1,w=0,E=y.length;w<E;w++){var M=t[y[w].index];if(!1===y[w].enabled)break;var S=y[w].limitation,T=y[w].rotationMin,A=y[w].rotationMax;M.matrixWorld.decompose(a,s,l),s.inverse(),i.setFromMatrixPosition(g.matrixWorld),o.subVectors(i,a),o.applyQuaternion(s),o.normalize(),n.subVectors(r,a),n.applyQuaternion(s),n.normalize();var C=n.dot(o);if(C>1?C=1:C<-1&&(C=-1),!((C=p.acos(C))<1e-5)){if(void 0!==m.minAngle&&C<m.minAngle&&(C=m.minAngle),void 0!==m.maxAngle&&C>m.maxAngle&&(C=m.maxAngle),u.crossVectors(o,n),u.normalize(),e.setFromAxisAngle(u,C),M.quaternion.multiply(e),void 0!==S){var P=M.quaternion.w;P>1&&(P=1);var O=p.sqrt(1-P*P);M.quaternion.set(S.x*O,S.y*O,S.z*O,P)}void 0!==T&&M.rotation.setFromVector3(M.rotation.toVector3(h).max(T)),void 0!==A&&M.rotation.setFromVector3(M.rotation.toVector3(h).min(A)),M.updateMatrixWorld(!0),x=!0}}if(!x)break}}return this}),createHelper:function(){return new p(this.mesh,this.mesh.geometry.userData.MMD.iks)},_valid:function(){for(var t=this.iks,e=this.mesh.skeleton.bones,r=0,n=t.length;r<n;r++){var i,o,a=t[r],s=e[a.effector],l=a.links;i=s;for(var c=0,u=l.length;c<u;c++)o=e[l[c].index],i.parent!==o&&console.warn("THREE.CCDIKSolver: bone "+i.name+" is not the child of bone "+o.name),i=o}}},p.prototype=Object.assign(Object.create(c.Object3D.prototype),{constructor:p,updateMatrixWorld:function(){var t=new c.Matrix4,e=new c.Vector3;function r(t,r){return e.setFromMatrixPosition(t.matrixWorld).applyMatrix4(r)}function n(t,e,n,i){var o=r(n,i);t[3*e+0]=o.x,t[3*e+1]=o.y,t[3*e+2]=o.z}return function(e){var i=this.root;if(this.visible){var o=0,a=this.iks,s=i.skeleton.bones;t.getInverse(i.matrixWorld);for(var l=0,u=a.length;l<u;l++){var h=a[l],p=s[h.target],d=s[h.effector],f=this.children[o++],m=this.children[o++];f.position.copy(r(p,t)),m.position.copy(r(d,t));for(var g=0,v=h.links.length;g<v;g++){var y=s[h.links[g].index];this.children[o++].position.copy(r(y,t))}var _=this.children[o++],b=_.geometry.attributes.position.array;n(b,0,p,t),n(b,1,d,t);for(g=0,v=h.links.length;g<v;g++){n(b,g+2,y=s[h.links[g].index],t)}_.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(i.matrixWorld),c.Object3D.prototype.updateMatrixWorld.call(this,e)}}(),_init:function(){var t=this,e=this.iks;function r(e){return new c.Line(function(t){var e=new c.BufferGeometry,r=new Float32Array(3*(2+t.links.length));return e.setAttribute("position",new c.BufferAttribute(r,3)),e}(e),t.lineMaterial)}for(var n=0,i=e.length;n<i;n++){var o=e[n];this.add(new c.Mesh(t.sphereGeometry,t.targetSphereMaterial)),this.add(new c.Mesh(t.sphereGeometry,t.effectorSphereMaterial));for(var a=0,s=o.links.length;a<s;a++)this.add(new c.Mesh(t.sphereGeometry,t.linkSphereMaterial));this.add(r(o))}}}),t}();class M{static easeInQuad(t){return t*t}static easeOutQuad(t){return 1-(1-t)*(1-t)}static easeInOutQuad(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}static easeInCubic(t){return t*t*t}static easeOutCubic(t){return 1-Math.pow(1-t,3)}static easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}static easeInQuart(t){return t*t*t*t}static easeOutQuart(t){return 1-Math.pow(1-t,4)}static easeInOutQuart(t){return t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2}static easeInQuint(t){return t*t*t*t*t}static easeOutQuint(t){return 1-Math.pow(1-t,5)}static easeInOutQuint(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2}static easeInSine(t){return 1-Math.cos(t*Math.PI/2)}static easeOutSine(t){return Math.sin(t*Math.PI/2)}static easeInOutSine(t){return-(Math.cos(Math.PI*t)-1)/2}static easeInExpo(t){return 0===t?0:Math.pow(2,10*t-10)}static easeOutExpo(t){return 1===t?1:1-Math.pow(2,-10*t)}static easeInOutExpo(t){return 0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}static easeInCirc(t){return 1-Math.sqrt(1-Math.pow(t,2))}static easeOutCirc(t){return Math.sqrt(1-Math.pow(t-1,2))}static easeInOutCirc(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2}static easeInBack(t){return this._c3*t*t*t-this._c1*t*t}static easeOutBack(t){return 1+this._c3*Math.pow(t-1,3)+this._c1*Math.pow(t-1,2)}static easeInOutBack(t){return t<.5?Math.pow(2*t,2)*(2*(this._c2+1)*t-this._c2)/2:(Math.pow(2*t-2,2)*((this._c2+1)*(2*t-2)+this._c2)+2)/2}static easeInElastic(t){return 0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*this._c4)}static easeOutElastic(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*this._c4)+1}static easeInOutElastic(t){return 0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*this._c5)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*this._c5)/2+1}static _bounceOut(t){const e=7.5625,r=2.75;return t<1/r?e*t*t:t<2/r?e*(t-=1.5/r)*t+.75:t<2.5/r?e*(t-=2.25/r)*t+.9375:e*(t-=2.625/r)*t+.984375}static easeInBounce(t){return 1-this._bounceOut(1-t)}static easeOutBounce(t){return this._bounceOut(t)}static easeInOutBounce(t){return t<.5?(1-this._bounceOut(1-2*t))/2:(1+this._bounceOut(2*t-1))/2}}M._c1=1.70158,M._c2=1.525*M._c1,M._c3=M._c1+1,M._c4=2*Math.PI/3,M._c5=2*Math.PI/4.5;class S{get modelId(){return this._modelId}constructor(t){switch(this.CENTER=0,this.UPPER_BODY=2,this.NECK=3,this.HEAD=4,this.HEAD_TOP=5,this.L_SHOULDER=6,this.L_ARM=7,this.L_ELBOW=8,this.R_SHOULDER=11,this.R_ARM=12,this.R_ELBOW=13,this.LOWER_BODY=16,this.L_FOOT_IK=26,this.R_FOOT_IK=30,this.L_HAIR1=26,this.R_HAIR1=27,this.L_HAIR2=28,this.R_HAIR2=29,this._L_FOOT=18,this._L_KNEE=19,this._L_ANKLE=20,this._R_FOOT=22,this._R_KNEE=23,this._R_ANKLE=24,this.list=[],this._modelId=t,t){case y.MIKU:this.L_FOOT_IK=34,this.R_FOOT_IK=38;break;case y.RIN:this.L_FOOT_IK=30,this.R_FOOT_IK=34;break;default:this.L_FOOT_IK=26,this.R_FOOT_IK=30}if(this.list=[this.CENTER,this.UPPER_BODY,this.NECK,this.HEAD,this.L_SHOULDER,this.L_ARM,this.L_ELBOW,this.R_SHOULDER,this.R_ARM,this.R_ELBOW,this.LOWER_BODY,this.L_FOOT_IK,this.R_FOOT_IK,this._L_FOOT,this._L_KNEE,this._L_ANKLE,this._R_FOOT,this._R_KNEE,this._R_ANKLE],t===y.MIKU)this.list.push(this.L_HAIR1,this.R_HAIR1,this.L_HAIR2,this.R_HAIR2)}}class T{constructor(){this.useRot=!1,this.usePos=!1,this.rotations=[],this.positions=[],this.isHalfRot=!1,this.isHalfPos=!1}addRotations(t,e=!1){this.useRot=!0,this.isHalfRot=e,this.rotations=this._convertList(t)}addPositions(t,e=!1){this.usePos=!0,this.isHalfPos=e,this.positions=this._convertList(t)}reset(){this.useRot=this.usePos=!1,this.rotations=[],this.positions=[]}_convertList(t){var e=1-(_.player.bpm-150)/50*.5;e=(e=1<e?1:e)<.5?.5:e;for(var r=0,n=t.length;r<n;r++)3<=t[r].length&&(t[r]=new c.Vector3(t[r][0]*e,t[r][1]*e,t[r][2]*e));return t}}class A{constructor(t){this.rate=0,this._bones=[],this._boneName=t;for(var e=0,r=t.list.length;e<r;e++){var n=new T;this._bones[t.list[e]]=n}this.rotation=new c.Vector3}init(){}update(t){for(var e=[],r=[],n=this._boneName,i=0,o=n.list.length;i<o;i++){var a=n.list[i],s=this._bones[a];s.useRot&&(e[a]=this._calc(s,t,!0)),s.usePos&&(r[a]=this._calc(s,t,!1))}return[e,r]}_calc(t,e,r=!0){var n,i,o,a,s=r?t.rotations:t.positions,l=r?t.isHalfRot:t.isHalfPos,u=s.length;e<0&&(e=e%u+u),l?(n=Math.floor(2*e)%u,a=(o=e%1)<.5?t=>M.easeInCubic(t):t=>M.easeOutCubic(t),o=2*o%1):(n=Math.floor(e)%u,o=e%1,a=t=>M.easeInOutCubic(t));var h=s[i=n+1<u?n+1:0].x-s[n].x,p=s[i].y-s[n].y,d=s[i].z-s[n].z,f=new c.Vector3;return f.x=s[n].x+a(o)*h,f.y=s[n].y+a(o)*p,f.z=s[n].z+a(o)*d,f}}class C extends A{init(){var t=b.toRad,e=this._boneName;this._bones[e.CENTER].addPositions([[0,0,0],[0,-.6,0]],!0),this._bones[e.NECK].addRotations([[t(-10),0,0],[t(5),0,0]],!0),this._bones[e.UPPER_BODY].addRotations([[0,t(-20),0],[0,t(20),0]],!1),this._bones[e.L_SHOULDER].addRotations([[0,0,t(25)],[0,0,t(-30)]],!0),this._bones[e.R_SHOULDER].addRotations([[0,0,t(-25)],[0,0,t(30)]],!0),e.modelId==y.MIKU&&(this._bones[e.R_HAIR1].addRotations([[0,0,t(-30)],[0,0,t(10)]],!0),this._bones[e.L_HAIR1].addRotations([[0,0,t(30)],[0,0,t(-10)]],!0))}}class P extends A{init(){var t=b.toRad,e=this._boneName;this._bones[e.CENTER].addPositions([[0,0,0],[0,-1,0]],!0),this._bones[e.CENTER].addRotations([[0,0,t(-20)],[0,0,t(20)]]),this._bones[e.NECK].addRotations([[0,0,t(-30)],[0,0,t(30)]]),this._bones[e.L_SHOULDER].addRotations([[0,0,t(-25)]]),this._bones[e.R_SHOULDER].addRotations([[0,0,t(25)]]),e.modelId==y.MIKU&&(this._bones[e.R_HAIR1].addRotations([[0,0,t(-40)],[0,0,t(10)]]),this._bones[e.R_HAIR2].addRotations([[0,0,t(-30)],[0,0,t(0)]]),this._bones[e.L_HAIR1].addRotations([[0,0,t(-10)],[0,0,t(40)]]),this._bones[e.L_HAIR2].addRotations([[0,0,t(0)],[0,0,t(30)]]))}}class O extends A{init(){var t=b.toRad,e=this._boneName;this._bones[e.CENTER].addPositions([[0,0,0],[0,-1,0]],!0),this._bones[e.CENTER].addRotations([[t(20),0,0],[t(-20),0,0]]),this._bones[e.NECK].addRotations([[t(30),0,0],[t(-30),0,0]]),this._bones[e.L_SHOULDER].addRotations([[t(30),0,t(-25)],[t(-30),0,t(-25)]]),this._bones[e.R_SHOULDER].addRotations([[t(30),0,t(25)],[t(-30),0,t(25)]]),this._bones[e.L_ELBOW].addRotations([[t(0),0,0],[t(-60),t(-30),0]]),this._bones[e.R_ELBOW].addRotations([[t(0),0,0],[t(-60),t(30),0]]),e.modelId==y.MIKU&&(this._bones[e.R_HAIR1].addRotations([[t(30),0,0],[t(0),0,0]]),this._bones[e.R_HAIR2].addRotations([[t(10),0,0],[t(-20),0,0]]),this._bones[e.L_HAIR1].addRotations([[t(30),0,0],[t(0),0,0]]),this._bones[e.L_HAIR2].addRotations([[t(10),0,0],[t(-20),0,0]]))}}class R extends A{init(){var t=b.toRad,e=this._boneName;this._bones[e.CENTER].addPositions([[0,0,0],[0,-1,0]],!0),this._bones[e.CENTER].addRotations([[0,t(35),0],[0,t(-35),0]]),this._bones[e.NECK].addRotations([[t(20),0,0],[t(-20),0,0]],!0),this._bones[e.HEAD].addRotations([[0,t(-20),0],[0,t(20),0]]),this._bones[e.L_SHOULDER].addRotations([[t(20),0,0],[t(-60),0,0]]),this._bones[e.R_SHOULDER].addRotations([[t(-60),0,0],[t(20),0,0]]),this._bones[e.L_ELBOW].addRotations([[t(-60),t(-30),0]]),this._bones[e.R_ELBOW].addRotations([[t(-60),t(30),0]]),e.modelId==y.MIKU&&(this._bones[e.R_HAIR1].addRotations([[0,0,t(-40)],[0,0,t(10)]]),this._bones[e.R_HAIR2].addRotations([[0,0,t(-30)],[0,0,t(0)]]),this._bones[e.L_HAIR1].addRotations([[0,0,t(-10)],[0,0,t(40)]]),this._bones[e.L_HAIR2].addRotations([[0,0,t(0)],[0,0,t(30)]]))}}class L extends A{init(){var t=b.toRad,e=this._boneName;this._bones[e.CENTER].addPositions([[0,0,0],[0,-1,0]],!0),this._bones[e.CENTER].addRotations([[t(10),0,0],[t(-10),0,0]]),this._bones[e.NECK].addRotations([[t(-20),0,0],[t(-30),0,0]]),this._bones[e.UPPER_BODY].addRotations([[0,0,0],[t(-10),0,0]]),this._bones[e.L_SHOULDER].addRotations([[0,t(-20),t(30)],[0,t(-10),t(20)]]),this._bones[e.R_SHOULDER].addRotations([[0,t(20),t(-30)],[0,t(10),t(-20)]]),this._bones[e.L_ELBOW].addRotations([[0,t(-30),t(30)],[0,t(20),t(-20)]],!0),this._bones[e.R_ELBOW].addRotations([[0,t(30),t(-30)],[0,t(-20),t(20)]],!0),this._bones[e.R_FOOT_IK].addPositions([[-.3,0,0]]),this._bones[e.L_FOOT_IK].addPositions([[.3,0,0]])}}class I{static getRandom(){return b.randInt(0,4)}}I.PATAPATA=0,I.SAYUU=1,I.ZENGO=2,I.HINERI=3,I.WOW=4;class N{constructor(t,e){this._motions=[],this._motionId=-1,this._defRotations=[],this._defPositions=[],this._mesh=t,this._ikSolver=new E(t,t.geometry.userData.MMD.iks),this._boneName=e,this._motions[I.PATAPATA]=new C(e),this._motions[I.SAYUU]=new P(e),this._motions[I.ZENGO]=new O(e),this._motions[I.HINERI]=new R(e),this._motions[I.WOW]=new L(e);for(var r=this._boneName,n=0,i=r.list.length;n<i;n++){var o=r.list[n],a=this._mesh.skeleton.bones[o];this._defRotations[o]=a.rotation.clone(),this._defPositions[o]=a.position.clone()}this.change(0)}change(t){this._motionId!=t&&(0<=this._motionId&&this._motions[this._motionId]&&(this._motions[this._motionId].rate=0),this._motionId=t,0<=this._motionId&&this._motions[this._motionId]&&(this._motions[this._motionId].init(),this._motions[this._motionId].rate=1))}update(t,e){var r=[];this._mesh.rotation.set(0,0,0);for(var n=this._motions.length,i=0;i<n;i++){var o=this._motions[i];0<o.rate&&(r.push(o.update(t)),this._mesh.rotation.x+=o.rotation.x*e/1e3,this._mesh.rotation.y+=o.rotation.y*e/1e3,this._mesh.rotation.z+=o.rotation.z*e/1e3)}var a=r.length,s=this._mesh.skeleton.bones,l=this._boneName;for(i=0,n=l.list.length;i<n;i++){var c=l.list[i],u=s[c];u.rotation.set(this._defRotations[c].x,this._defRotations[c].y,this._defRotations[c].z),u.position.set(this._defPositions[c].x,this._defPositions[c].y,this._defPositions[c].z);for(var h=0;h<a;h++){var p=r[h];p[0][c]&&(u.rotation.x+=p[0][c].x,u.rotation.y+=p[0][c].y,u.rotation.z+=p[0][c].z),p[1][c]&&(u.position.x+=p[1][c].x,u.position.y+=p[1][c].y,u.position.z+=p[1][c].z)}}this._mesh.updateMatrixWorld(!0),this._ikSolver.update()}}c=o("g71hk");class B{constructor(){this.lat=20,this.lng=90,this.distance=35,this.latMov=0,this.latMovSpeed=2,this.lngMov=0,this.lngMovSpeed=2,this.distanceMov=0,this.distanceMovSpeed=2,this.targetPos=new c.Vector3,this.targetMov=new c.Vector3,this.targetMovSpeed=new c.Vector3(2,2,2),this.camup=new c.Vector3(0,1,0),this.camupMov=new c.Vector3,this.camupMovSpeed=new c.Vector3(2,2,2)}setupLatLng(t,e,r=0,n=0,i=2,o=2){return this.lat=t,this.lng=e,this.latMov=r,this.lngMov=n,this.latMovSpeed=i,this.lngMovSpeed=o,this}setupDistance(t,e=0,r=2){return this.distance=t,this.distanceMov=e,this.distanceMovSpeed=r,this}setupTarget(t,e,r,n=0,i=0,o=0,a=0,s=0,l=0){return this.targetPos.set(t,e,r),this.targetMov.set(n,i,o),this.targetMovSpeed.set(a,s,l),this}setupCamUp(t,e,r,n=0,i=0,o=0,a=0,s=0,l=0){return this.camup.set(t,e,r),this.camupMov.set(n,i,o),this.camupMovSpeed.set(a,s,l),this}}class D{constructor(t){this._seed=0,this._isActive=!1,this._parent=t}init(t,e){return this._cameraMng=t,this._mmdMng=e,this}show(t=null){this._isActive=!0,isNaN(t)&&(t=this._seed),b.seed=this._seed=t}hide(){this._isActive=!1}update(t){this._cameraMng.update(t),this._mmdMng.update(t)}_getRandomCameraMotion(){return(new B).setupLatLng(b.rand(-10,40),b.rand(-40,40)+90,b.rand(10,30),b.rand(10,30),b.rand(1,1.8),b.rand(1,1.8)).setupDistance(b.rand(32,50),10,b.rand(1,2.5)).setupTarget(0,5,0,1,1,1,1,2,3).setupCamUp(b.rand(-1,1),b.rand(0,1),0)}}class k extends D{constructor(t){super(t),this._lines=[],this._total=0,_.player.addParameterUpdateListener(((t,e)=>this._parameterUpdate(t,e)))}_parameterUpdate(t,e){if(this._isActive)switch(t){case"Color1":case"Color2":case"Color3":case"Color4":for(var r=0;r<this._total;r++)this._lines[r].changeColor(this._getColor())}}_getColor(){return _.parameter.colors[b.randInt(0,3)]}show(t=0){super.show(t)}hide(){for(var t=0;t<this._total;t++)this._lines[t].hide();super.hide()}}class U extends k{constructor(t){super(t)}show(t=0){super.show(t),this._cameraMng.setup(this._getRandomCameraMotion()),this._mmdMng.changeMotion(I.getRandom()),this._total=80;for(var e=0;e<this._total;e++){var r;r=this._lines[e]?this._lines[e]:new w(this._parent);for(var n=[],i=0;i<3;i++){var o=(i-2)*b.rand(8,32);n[i]=new c.Vector3(b.rand(-2,2),o,b.rand(-2,2))}r.create({points:n,color:this._getColor(),division:8,width:b.rand(.8,1.2),dashRatio:b.rand(.6,.9),widthCallback:function(t){return.5+2*t}});var a=25;r.x=b.rand(-a,a),r.y=b.rand(-a,a)+5,r.z=b.rand(-a,a),r.show(),this._lines[e]=r}}update(t){super.update(t);for(var e=0;e<this._total;e++)this._lines[e].progress=(t.now+93*e)/600,this._lines[e].y=(t.now+155*e)%5e3/5e3*120-60}}c=o("g71hk");class F{constructor(t){this._tx=0,this._ty=0,this._ratex=0,this._ratey=0,this._camera=t,this._target=new c.Vector3,this._up=new c.Vector3,this._motion=new B,this._initEvents()}_initEvents(){(class{static arrayShuffle(t,e=!1){for(var r=t.length,n=0;n<r;n++){var i=e?b.randInt(0,r-1):Math.floor(Math.random()*r),o=t[n];t[n]=t[i],t[i]=o}}static checkMobile(){var t=navigator.userAgent;return 0<=t.indexOf("iPhone")||0<=t.indexOf("iPod")||0<=t.indexOf("iPad")||0<t.indexOf("Mac OS")&&void 0!==document.ontouchstart||0<=t.indexOf("Android")||0<=t.indexOf("BlackBerry")||0<=t.indexOf("Windows Phone")}}).checkMobile()?(document.getElementById("view").addEventListener("touchmove",(t=>this._touchmove(t))),document.getElementById("view").addEventListener("touchend",(t=>this._touchend(t)))):(document.getElementById("view").addEventListener("mousemove",(t=>this._touchmove(t))),document.getElementById("view").addEventListener("mouseleave",(t=>this._touchend(t))))}_touchmove(t){var e=0,r=0;t.touches?(e=t.touches[0].clientX,r=t.touches[0].clientY):(e=t.clientX,r=t.clientY),this._tx=2*e/_.stw-1,this._ty=2*r/_.sth-1}_touchend(t){this._tx=0,this._ty=0}setup(t){this._motion=t}update(t){var e=this._camera;if(this._ratex+=(this._tx-this._ratex)/10,this._ratey+=(this._ty-this._ratey)/10,this._motion){var r=t.now,n=this._calcCameraPos(r);e.position.set(n.x,n.y,n.z),this._target=this._calcTargetPos(r),this._up=this._calcUpPos(r),e.up.set(this._up.x,this._up.y,this._up.z),e.lookAt(this._target)}}_calcCameraPos(t){if(!this._motion)return new c.Vector3(0,0,0);var e=this._motion,r=b.toRad(e.lat),n=b.toRad(e.lng);0<e.latMov&&(r+=b.toRad(Math.sin(t/(1e3*e.latMovSpeed))*e.latMov)),0<e.lngMov&&(n+=b.toRad(Math.sin(t/(1e3*e.lngMovSpeed))*e.lngMov));var i=e.distance;0<e.distanceMov&&(i+=Math.sin(t/(1e3*e.distanceMovSpeed))*e.distanceMov);var o=-i*Math.cos(r)*Math.cos(n)-4*this._ratex,a=i*Math.sin(r)+4*this._ratey,s=i*Math.cos(r)*Math.sin(n);return new c.Vector3(o,a,s)}_calcTargetPos(t){if(!this._motion)return new c.Vector3(0,0,0);var e=this._motion,r=e.targetPos.x+6*this._ratex,n=e.targetPos.y-6*this._ratey,i=e.targetPos.z;return 0<e.targetMov.x&&(r+=Math.sin(t/(1e3*e.targetMovSpeed.x))*e.targetMov.x),0<e.targetMov.y&&(n+=Math.sin(t/(1e3*e.targetMovSpeed.y))*e.targetMov.y),0<e.targetMov.z&&(i+=Math.sin(t/(1e3*e.targetMovSpeed.z))*e.targetMov.z),new c.Vector3(r,n,i)}_calcUpPos(t){if(!this._motion)return new c.Vector3(0,0,0);var e=this._motion,r=e.camup.x,n=e.camup.y,i=e.camup.z;return 0<e.camupMov.x&&(r+=Math.sin(t/(1e3*e.camupMovSpeed.x))*e.camupMov.x),0<e.camupMov.y&&(n+=Math.sin(t/(1e3*e.camupMovSpeed.y))*e.camupMov.y),0<e.camupMov.z&&(i+=Math.sin(t/(1e3*e.camupMovSpeed.z))*e.camupMov.z),new c.Vector3(r,n,i)}getCameraPos(t=-1){return 0<=t?this._calcCameraPos(t):this._camera.position}getTargetPos(t=-1){return 0<=t?this._calcTargetPos(t):this._target}getUpPos(t=-1){return 0<=t?this._calcUpPos(t):this._up}}c=o("g71hk"),c=o("g71hk"),c=o("g71hk");var j=function(t){c.Loader.call(this,t)};function G(){}function z(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e,this.encoder=new G}function V(){}function H(){}j.prototype=Object.assign(Object.create(c.Loader.prototype),{constructor:j,load:function(t,e,r,n){var i=this,o=new c.Texture,a=new c.FileLoader(this.manager);return a.setResponseType("arraybuffer"),a.setPath(this.path),a.load(t,(function(t){o.image=i.parse(t),o.needsUpdate=!0,void 0!==e&&e(o)}),r,n),o},parse:function(t){var e=0,r=1,n=2,i=3,o=9,a=10,s=11,l=48,c=4,u=0,h=1,p=3;t.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var d=new Uint8Array(t),f=0,m={id_length:d[f++],colormap_type:d[f++],image_type:d[f++],colormap_index:d[f++]|d[f++]<<8,colormap_length:d[f++]|d[f++]<<8,colormap_size:d[f++],origin:[d[f++]|d[f++]<<8,d[f++]|d[f++]<<8],width:d[f++]|d[f++]<<8,height:d[f++]|d[f++]<<8,pixel_size:d[f++],flags:d[f++]};!function(t){switch(t.image_type){case r:case o:(t.colormap_length>256||24!==t.colormap_size||1!==t.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case n:case i:case a:case s:t.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case e:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',t.image_type)}(t.width<=0||t.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==t.pixel_size&&16!==t.pixel_size&&24!==t.pixel_size&&32!==t.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',t.pixel_size)}(m),m.id_length+f>t.length&&console.error("THREE.TGALoader: No data."),f+=m.id_length;var g=!1,v=!1,y=!1;switch(m.image_type){case o:g=!0,v=!0;break;case r:v=!0;break;case a:g=!0;break;case n:break;case s:g=!0,y=!0;break;case i:y=!0}var _="undefined"!=typeof OffscreenCanvas,b=_?new OffscreenCanvas(m.width,m.height):document.createElement("canvas");b.width=m.width,b.height=m.height;var x=b.getContext("2d"),w=x.createImageData(m.width,m.height),E=function(t,e,r,n,i){var o,a,s,l;if(a=r.pixel_size>>3,s=r.width*r.height*a,e&&(l=i.subarray(n,n+=r.colormap_length*(r.colormap_size>>3))),t){var c,u,h;o=new Uint8Array(s);for(var p=0,d=new Uint8Array(a);p<s;)if(u=1+(127&(c=i[n++])),128&c){for(h=0;h<a;++h)d[h]=i[n++];for(h=0;h<u;++h)o.set(d,p+h*a);p+=a*u}else{for(u*=a,h=0;h<u;++h)o[p+h]=i[n++];p+=u}}else o=i.subarray(n,n+=e?r.width*r.height:s);return{pixel_data:o,palettes:l}}(g,v,m,f,d);return function(t,e,r,n,i){var o,a,s,d,f,g;switch((m.flags&l)>>c){default:o=0,s=1,f=e,a=0,d=1,g=r;break;case u:o=0,s=1,f=e,a=r-1,d=-1,g=-1;break;case p:o=e-1,s=-1,f=-1,a=0,d=1,g=r;break;case h:o=e-1,s=-1,f=-1,a=r-1,d=-1,g=-1}if(y)switch(m.pixel_size){case 8:!function(t,e,r,n,i,o,a,s){var l,c,u,h=0,p=m.width;for(u=e;u!==n;u+=r)for(c=i;c!==a;c+=o,h++)l=s[h],t[4*(c+p*u)+0]=l,t[4*(c+p*u)+1]=l,t[4*(c+p*u)+2]=l,t[4*(c+p*u)+3]=255}(t,a,d,g,o,s,f,n);break;case 16:!function(t,e,r,n,i,o,a,s){var l,c,u=0,h=m.width;for(c=e;c!==n;c+=r)for(l=i;l!==a;l+=o,u+=2)t[4*(l+h*c)+0]=s[u+0],t[4*(l+h*c)+1]=s[u+0],t[4*(l+h*c)+2]=s[u+0],t[4*(l+h*c)+3]=s[u+1]}(t,a,d,g,o,s,f,n);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(m.pixel_size){case 8:!function(t,e,r,n,i,o,a,s,l){var c,u,h,p=l,d=0,f=m.width;for(h=e;h!==n;h+=r)for(u=i;u!==a;u+=o,d++)c=s[d],t[4*(u+f*h)+3]=255,t[4*(u+f*h)+2]=p[3*c+0],t[4*(u+f*h)+1]=p[3*c+1],t[4*(u+f*h)+0]=p[3*c+2]}(t,a,d,g,o,s,f,n,i);break;case 16:!function(t,e,r,n,i,o,a,s){var l,c,u,h=0,p=m.width;for(u=e;u!==n;u+=r)for(c=i;c!==a;c+=o,h+=2)l=s[h+0]+(s[h+1]<<8),t[4*(c+p*u)+0]=(31744&l)>>7,t[4*(c+p*u)+1]=(992&l)>>2,t[4*(c+p*u)+2]=(31&l)>>3,t[4*(c+p*u)+3]=32768&l?0:255}(t,a,d,g,o,s,f,n);break;case 24:!function(t,e,r,n,i,o,a,s){var l,c,u=0,h=m.width;for(c=e;c!==n;c+=r)for(l=i;l!==a;l+=o,u+=3)t[4*(l+h*c)+3]=255,t[4*(l+h*c)+2]=s[u+0],t[4*(l+h*c)+1]=s[u+1],t[4*(l+h*c)+0]=s[u+2]}(t,a,d,g,o,s,f,n);break;case 32:!function(t,e,r,n,i,o,a,s){var l,c,u=0,h=m.width;for(c=e;c!==n;c+=r)for(l=i;l!==a;l+=o,u+=4)t[4*(l+h*c)+2]=s[u+0],t[4*(l+h*c)+1]=s[u+1],t[4*(l+h*c)+0]=s[u+2],t[4*(l+h*c)+3]=s[u+3]}(t,a,d,g,o,s,f,n);break;default:console.error("THREE.TGALoader: Format not supported.")}}(w.data,m.width,m.height,E.pixel_data,E.palettes),x.putImageData(w,0,0),_?b.transferToImageBitmap():b}}),G.prototype.s2u=function(t){for(var e=this.s2uTable,r="",n=0;n<t.length;){var i=t[n++];if(!(i>=0&&i<=126||i>=161&&i<=223)&&n<t.length&&(i=i<<8|t[n++]),void 0===e[i])throw"unknown char code "+i+".";r+=String.fromCharCode(e[i])}return r},G.prototype.s2uTable={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:65340,33120:65374,33121:8741,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:65293,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:65504,33170:65505,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:65506,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34624:9312,34625:9313,34626:9314,34627:9315,34628:9316,34629:9317,34630:9318,34631:9319,34632:9320,34633:9321,34634:9322,34635:9323,34636:9324,34637:9325,34638:9326,34639:9327,34640:9328,34641:9329,34642:9330,34643:9331,34644:8544,34645:8545,34646:8546,34647:8547,34648:8548,34649:8549,34650:8550,34651:8551,34652:8552,34653:8553,34655:13129,34656:13076,34657:13090,34658:13133,34659:13080,34660:13095,34661:13059,34662:13110,34663:13137,34664:13143,34665:13069,34666:13094,34667:13091,34668:13099,34669:13130,34670:13115,34671:13212,34672:13213,34673:13214,34674:13198,34675:13199,34676:13252,34677:13217,34686:13179,34688:12317,34689:12319,34690:8470,34691:13261,34692:8481,34693:12964,34694:12965,34695:12966,34696:12967,34697:12968,34698:12849,34699:12850,34700:12857,34701:13182,34702:13181,34703:13180,34704:8786,34705:8801,34706:8747,34707:8750,34708:8721,34709:8730,34710:8869,34711:8736,34712:8735,34713:8895,34714:8757,34715:8745,34716:8746,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081,60736:32394,60737:35100,60738:37704,60739:37512,60740:34012,60741:20425,60742:28859,60743:26161,60744:26824,60745:37625,60746:26363,60747:24389,60748:20008,60749:20193,60750:20220,60751:20224,60752:20227,60753:20281,60754:20310,60755:20370,60756:20362,60757:20378,60758:20372,60759:20429,60760:20544,60761:20514,60762:20479,60763:20510,60764:20550,60765:20592,60766:20546,60767:20628,60768:20724,60769:20696,60770:20810,60771:20836,60772:20893,60773:20926,60774:20972,60775:21013,60776:21148,60777:21158,60778:21184,60779:21211,60780:21248,60781:21255,60782:21284,60783:21362,60784:21395,60785:21426,60786:21469,60787:64014,60788:21660,60789:21642,60790:21673,60791:21759,60792:21894,60793:22361,60794:22373,60795:22444,60796:22472,60797:22471,60798:64015,60800:64016,60801:22686,60802:22706,60803:22795,60804:22867,60805:22875,60806:22877,60807:22883,60808:22948,60809:22970,60810:23382,60811:23488,60812:29999,60813:23512,60814:23532,60815:23582,60816:23718,60817:23738,60818:23797,60819:23847,60820:23891,60821:64017,60822:23874,60823:23917,60824:23992,60825:23993,60826:24016,60827:24353,60828:24372,60829:24423,60830:24503,60831:24542,60832:24669,60833:24709,60834:24714,60835:24798,60836:24789,60837:24864,60838:24818,60839:24849,60840:24887,60841:24880,60842:24984,60843:25107,60844:25254,60845:25589,60846:25696,60847:25757,60848:25806,60849:25934,60850:26112,60851:26133,60852:26171,60853:26121,60854:26158,60855:26142,60856:26148,60857:26213,60858:26199,60859:26201,60860:64018,60861:26227,60862:26265,60863:26272,60864:26290,60865:26303,60866:26362,60867:26382,60868:63785,60869:26470,60870:26555,60871:26706,60872:26560,60873:26625,60874:26692,60875:26831,60876:64019,60877:26984,60878:64020,60879:27032,60880:27106,60881:27184,60882:27243,60883:27206,60884:27251,60885:27262,60886:27362,60887:27364,60888:27606,60889:27711,60890:27740,60891:27782,60892:27759,60893:27866,60894:27908,60895:28039,60896:28015,60897:28054,60898:28076,60899:28111,60900:28152,60901:28146,60902:28156,60903:28217,60904:28252,60905:28199,60906:28220,60907:28351,60908:28552,60909:28597,60910:28661,60911:28677,60912:28679,60913:28712,60914:28805,60915:28843,60916:28943,60917:28932,60918:29020,60919:28998,60920:28999,60921:64021,60922:29121,60923:29182,60924:29361,60992:29374,60993:29476,60994:64022,60995:29559,60996:29629,60997:29641,60998:29654,60999:29667,61e3:29650,61001:29703,61002:29685,61003:29734,61004:29738,61005:29737,61006:29742,61007:29794,61008:29833,61009:29855,61010:29953,61011:30063,61012:30338,61013:30364,61014:30366,61015:30363,61016:30374,61017:64023,61018:30534,61019:21167,61020:30753,61021:30798,61022:30820,61023:30842,61024:31024,61025:64024,61026:64025,61027:64026,61028:31124,61029:64027,61030:31131,61031:31441,61032:31463,61033:64028,61034:31467,61035:31646,61036:64029,61037:32072,61038:32092,61039:32183,61040:32160,61041:32214,61042:32338,61043:32583,61044:32673,61045:64030,61046:33537,61047:33634,61048:33663,61049:33735,61050:33782,61051:33864,61052:33972,61053:34131,61054:34137,61056:34155,61057:64031,61058:34224,61059:64032,61060:64033,61061:34823,61062:35061,61063:35346,61064:35383,61065:35449,61066:35495,61067:35518,61068:35551,61069:64034,61070:35574,61071:35667,61072:35711,61073:36080,61074:36084,61075:36114,61076:36214,61077:64035,61078:36559,61079:64036,61080:64037,61081:36967,61082:37086,61083:64038,61084:37141,61085:37159,61086:37338,61087:37335,61088:37342,61089:37357,61090:37358,61091:37348,61092:37349,61093:37382,61094:37392,61095:37386,61096:37434,61097:37440,61098:37436,61099:37454,61100:37465,61101:37457,61102:37433,61103:37479,61104:37543,61105:37495,61106:37496,61107:37607,61108:37591,61109:37593,61110:37584,61111:64039,61112:37589,61113:37600,61114:37587,61115:37669,61116:37665,61117:37627,61118:64040,61119:37662,61120:37631,61121:37661,61122:37634,61123:37744,61124:37719,61125:37796,61126:37830,61127:37854,61128:37880,61129:37937,61130:37957,61131:37960,61132:38290,61133:63964,61134:64041,61135:38557,61136:38575,61137:38707,61138:38715,61139:38723,61140:38733,61141:38735,61142:38737,61143:38741,61144:38999,61145:39013,61146:64042,61147:64043,61148:39207,61149:64044,61150:39326,61151:39502,61152:39641,61153:39644,61154:39797,61155:39794,61156:39823,61157:39857,61158:39867,61159:39936,61160:40304,61161:40299,61162:64045,61163:40473,61164:40657,61167:8560,61168:8561,61169:8562,61170:8563,61171:8564,61172:8565,61173:8566,61174:8567,61175:8568,61176:8569,61177:65506,61178:65508,61179:65287,61180:65282,61504:57344,61505:57345,61506:57346,61507:57347,61508:57348,61509:57349,61510:57350,61511:57351,61512:57352,61513:57353,61514:57354,61515:57355,61516:57356,61517:57357,61518:57358,61519:57359,61520:57360,61521:57361,61522:57362,61523:57363,61524:57364,61525:57365,61526:57366,61527:57367,61528:57368,61529:57369,61530:57370,61531:57371,61532:57372,61533:57373,61534:57374,61535:57375,61536:57376,61537:57377,61538:57378,61539:57379,61540:57380,61541:57381,61542:57382,61543:57383,61544:57384,61545:57385,61546:57386,61547:57387,61548:57388,61549:57389,61550:57390,61551:57391,61552:57392,61553:57393,61554:57394,61555:57395,61556:57396,61557:57397,61558:57398,61559:57399,61560:57400,61561:57401,61562:57402,61563:57403,61564:57404,61565:57405,61566:57406,61568:57407,61569:57408,61570:57409,61571:57410,61572:57411,61573:57412,61574:57413,61575:57414,61576:57415,61577:57416,61578:57417,61579:57418,61580:57419,61581:57420,61582:57421,61583:57422,61584:57423,61585:57424,61586:57425,61587:57426,61588:57427,61589:57428,61590:57429,61591:57430,61592:57431,61593:57432,61594:57433,61595:57434,61596:57435,61597:57436,61598:57437,61599:57438,61600:57439,61601:57440,61602:57441,61603:57442,61604:57443,61605:57444,61606:57445,61607:57446,61608:57447,61609:57448,61610:57449,61611:57450,61612:57451,61613:57452,61614:57453,61615:57454,61616:57455,61617:57456,61618:57457,61619:57458,61620:57459,61621:57460,61622:57461,61623:57462,61624:57463,61625:57464,61626:57465,61627:57466,61628:57467,61629:57468,61630:57469,61631:57470,61632:57471,61633:57472,61634:57473,61635:57474,61636:57475,61637:57476,61638:57477,61639:57478,61640:57479,61641:57480,61642:57481,61643:57482,61644:57483,61645:57484,61646:57485,61647:57486,61648:57487,61649:57488,61650:57489,61651:57490,61652:57491,61653:57492,61654:57493,61655:57494,61656:57495,61657:57496,61658:57497,61659:57498,61660:57499,61661:57500,61662:57501,61663:57502,61664:57503,61665:57504,61666:57505,61667:57506,61668:57507,61669:57508,61670:57509,61671:57510,61672:57511,61673:57512,61674:57513,61675:57514,61676:57515,61677:57516,61678:57517,61679:57518,61680:57519,61681:57520,61682:57521,61683:57522,61684:57523,61685:57524,61686:57525,61687:57526,61688:57527,61689:57528,61690:57529,61691:57530,61692:57531,61760:57532,61761:57533,61762:57534,61763:57535,61764:57536,61765:57537,61766:57538,61767:57539,61768:57540,61769:57541,61770:57542,61771:57543,61772:57544,61773:57545,61774:57546,61775:57547,61776:57548,61777:57549,61778:57550,61779:57551,61780:57552,61781:57553,61782:57554,61783:57555,61784:57556,61785:57557,61786:57558,61787:57559,61788:57560,61789:57561,61790:57562,61791:57563,61792:57564,61793:57565,61794:57566,61795:57567,61796:57568,61797:57569,61798:57570,61799:57571,61800:57572,61801:57573,61802:57574,61803:57575,61804:57576,61805:57577,61806:57578,61807:57579,61808:57580,61809:57581,61810:57582,61811:57583,61812:57584,61813:57585,61814:57586,61815:57587,61816:57588,61817:57589,61818:57590,61819:57591,61820:57592,61821:57593,61822:57594,61824:57595,61825:57596,61826:57597,61827:57598,61828:57599,61829:57600,61830:57601,61831:57602,61832:57603,61833:57604,61834:57605,61835:57606,61836:57607,61837:57608,61838:57609,61839:57610,61840:57611,61841:57612,61842:57613,61843:57614,61844:57615,61845:57616,61846:57617,61847:57618,61848:57619,61849:57620,61850:57621,61851:57622,61852:57623,61853:57624,61854:57625,61855:57626,61856:57627,61857:57628,61858:57629,61859:57630,61860:57631,61861:57632,61862:57633,61863:57634,61864:57635,61865:57636,61866:57637,61867:57638,61868:57639,61869:57640,61870:57641,61871:57642,61872:57643,61873:57644,61874:57645,61875:57646,61876:57647,61877:57648,61878:57649,61879:57650,61880:57651,61881:57652,61882:57653,61883:57654,61884:57655,61885:57656,61886:57657,61887:57658,61888:57659,61889:57660,61890:57661,61891:57662,61892:57663,61893:57664,61894:57665,61895:57666,61896:57667,61897:57668,61898:57669,61899:57670,61900:57671,61901:57672,61902:57673,61903:57674,61904:57675,61905:57676,61906:57677,61907:57678,61908:57679,61909:57680,61910:57681,61911:57682,61912:57683,61913:57684,61914:57685,61915:57686,61916:57687,61917:57688,61918:57689,61919:57690,61920:57691,61921:57692,61922:57693,61923:57694,61924:57695,61925:57696,61926:57697,61927:57698,61928:57699,61929:57700,61930:57701,61931:57702,61932:57703,61933:57704,61934:57705,61935:57706,61936:57707,61937:57708,61938:57709,61939:57710,61940:57711,61941:57712,61942:57713,61943:57714,61944:57715,61945:57716,61946:57717,61947:57718,61948:57719,62016:57720,62017:57721,62018:57722,62019:57723,62020:57724,62021:57725,62022:57726,62023:57727,62024:57728,62025:57729,62026:57730,62027:57731,62028:57732,62029:57733,62030:57734,62031:57735,62032:57736,62033:57737,62034:57738,62035:57739,62036:57740,62037:57741,62038:57742,62039:57743,62040:57744,62041:57745,62042:57746,62043:57747,62044:57748,62045:57749,62046:57750,62047:57751,62048:57752,62049:57753,62050:57754,62051:57755,62052:57756,62053:57757,62054:57758,62055:57759,62056:57760,62057:57761,62058:57762,62059:57763,62060:57764,62061:57765,62062:57766,62063:57767,62064:57768,62065:57769,62066:57770,62067:57771,62068:57772,62069:57773,62070:57774,62071:57775,62072:57776,62073:57777,62074:57778,62075:57779,62076:57780,62077:57781,62078:57782,62080:57783,62081:57784,62082:57785,62083:57786,62084:57787,62085:57788,62086:57789,62087:57790,62088:57791,62089:57792,62090:57793,62091:57794,62092:57795,62093:57796,62094:57797,62095:57798,62096:57799,62097:57800,62098:57801,62099:57802,62100:57803,62101:57804,62102:57805,62103:57806,62104:57807,62105:57808,62106:57809,62107:57810,62108:57811,62109:57812,62110:57813,62111:57814,62112:57815,62113:57816,62114:57817,62115:57818,62116:57819,62117:57820,62118:57821,62119:57822,62120:57823,62121:57824,62122:57825,62123:57826,62124:57827,62125:57828,62126:57829,62127:57830,62128:57831,62129:57832,62130:57833,62131:57834,62132:57835,62133:57836,62134:57837,62135:57838,62136:57839,62137:57840,62138:57841,62139:57842,62140:57843,62141:57844,62142:57845,62143:57846,62144:57847,62145:57848,62146:57849,62147:57850,62148:57851,62149:57852,62150:57853,62151:57854,62152:57855,62153:57856,62154:57857,62155:57858,62156:57859,62157:57860,62158:57861,62159:57862,62160:57863,62161:57864,62162:57865,62163:57866,62164:57867,62165:57868,62166:57869,62167:57870,62168:57871,62169:57872,62170:57873,62171:57874,62172:57875,62173:57876,62174:57877,62175:57878,62176:57879,62177:57880,62178:57881,62179:57882,62180:57883,62181:57884,62182:57885,62183:57886,62184:57887,62185:57888,62186:57889,62187:57890,62188:57891,62189:57892,62190:57893,62191:57894,62192:57895,62193:57896,62194:57897,62195:57898,62196:57899,62197:57900,62198:57901,62199:57902,62200:57903,62201:57904,62202:57905,62203:57906,62204:57907,62272:57908,62273:57909,62274:57910,62275:57911,62276:57912,62277:57913,62278:57914,62279:57915,62280:57916,62281:57917,62282:57918,62283:57919,62284:57920,62285:57921,62286:57922,62287:57923,62288:57924,62289:57925,62290:57926,62291:57927,62292:57928,62293:57929,62294:57930,62295:57931,62296:57932,62297:57933,62298:57934,62299:57935,62300:57936,62301:57937,62302:57938,62303:57939,62304:57940,62305:57941,62306:57942,62307:57943,62308:57944,62309:57945,62310:57946,62311:57947,62312:57948,62313:57949,62314:57950,62315:57951,62316:57952,62317:57953,62318:57954,62319:57955,62320:57956,62321:57957,62322:57958,62323:57959,62324:57960,62325:57961,62326:57962,62327:57963,62328:57964,62329:57965,62330:57966,62331:57967,62332:57968,62333:57969,62334:57970,62336:57971,62337:57972,62338:57973,62339:57974,62340:57975,62341:57976,62342:57977,62343:57978,62344:57979,62345:57980,62346:57981,62347:57982,62348:57983,62349:57984,62350:57985,62351:57986,62352:57987,62353:57988,62354:57989,62355:57990,62356:57991,62357:57992,62358:57993,62359:57994,62360:57995,62361:57996,62362:57997,62363:57998,62364:57999,62365:58e3,62366:58001,62367:58002,62368:58003,62369:58004,62370:58005,62371:58006,62372:58007,62373:58008,62374:58009,62375:58010,62376:58011,62377:58012,62378:58013,62379:58014,62380:58015,62381:58016,62382:58017,62383:58018,62384:58019,62385:58020,62386:58021,62387:58022,62388:58023,62389:58024,62390:58025,62391:58026,62392:58027,62393:58028,62394:58029,62395:58030,62396:58031,62397:58032,62398:58033,62399:58034,62400:58035,62401:58036,62402:58037,62403:58038,62404:58039,62405:58040,62406:58041,62407:58042,62408:58043,62409:58044,62410:58045,62411:58046,62412:58047,62413:58048,62414:58049,62415:58050,62416:58051,62417:58052,62418:58053,62419:58054,62420:58055,62421:58056,62422:58057,62423:58058,62424:58059,62425:58060,62426:58061,62427:58062,62428:58063,62429:58064,62430:58065,62431:58066,62432:58067,62433:58068,62434:58069,62435:58070,62436:58071,62437:58072,62438:58073,62439:58074,62440:58075,62441:58076,62442:58077,62443:58078,62444:58079,62445:58080,62446:58081,62447:58082,62448:58083,62449:58084,62450:58085,62451:58086,62452:58087,62453:58088,62454:58089,62455:58090,62456:58091,62457:58092,62458:58093,62459:58094,62460:58095,62528:58096,62529:58097,62530:58098,62531:58099,62532:58100,62533:58101,62534:58102,62535:58103,62536:58104,62537:58105,62538:58106,62539:58107,62540:58108,62541:58109,62542:58110,62543:58111,62544:58112,62545:58113,62546:58114,62547:58115,62548:58116,62549:58117,62550:58118,62551:58119,62552:58120,62553:58121,62554:58122,62555:58123,62556:58124,62557:58125,62558:58126,62559:58127,62560:58128,62561:58129,62562:58130,62563:58131,62564:58132,62565:58133,62566:58134,62567:58135,62568:58136,62569:58137,62570:58138,62571:58139,62572:58140,62573:58141,62574:58142,62575:58143,62576:58144,62577:58145,62578:58146,62579:58147,62580:58148,62581:58149,62582:58150,62583:58151,62584:58152,62585:58153,62586:58154,62587:58155,62588:58156,62589:58157,62590:58158,62592:58159,62593:58160,62594:58161,62595:58162,62596:58163,62597:58164,62598:58165,62599:58166,62600:58167,62601:58168,62602:58169,62603:58170,62604:58171,62605:58172,62606:58173,62607:58174,62608:58175,62609:58176,62610:58177,62611:58178,62612:58179,62613:58180,62614:58181,62615:58182,62616:58183,62617:58184,62618:58185,62619:58186,62620:58187,62621:58188,62622:58189,62623:58190,62624:58191,62625:58192,62626:58193,62627:58194,62628:58195,62629:58196,62630:58197,62631:58198,62632:58199,62633:58200,62634:58201,62635:58202,62636:58203,62637:58204,62638:58205,62639:58206,62640:58207,62641:58208,62642:58209,62643:58210,62644:58211,62645:58212,62646:58213,62647:58214,62648:58215,62649:58216,62650:58217,62651:58218,62652:58219,62653:58220,62654:58221,62655:58222,62656:58223,62657:58224,62658:58225,62659:58226,62660:58227,62661:58228,62662:58229,62663:58230,62664:58231,62665:58232,62666:58233,62667:58234,62668:58235,62669:58236,62670:58237,62671:58238,62672:58239,62673:58240,62674:58241,62675:58242,62676:58243,62677:58244,62678:58245,62679:58246,62680:58247,62681:58248,62682:58249,62683:58250,62684:58251,62685:58252,62686:58253,62687:58254,62688:58255,62689:58256,62690:58257,62691:58258,62692:58259,62693:58260,62694:58261,62695:58262,62696:58263,62697:58264,62698:58265,62699:58266,62700:58267,62701:58268,62702:58269,62703:58270,62704:58271,62705:58272,62706:58273,62707:58274,62708:58275,62709:58276,62710:58277,62711:58278,62712:58279,62713:58280,62714:58281,62715:58282,62716:58283,62784:58284,62785:58285,62786:58286,62787:58287,62788:58288,62789:58289,62790:58290,62791:58291,62792:58292,62793:58293,62794:58294,62795:58295,62796:58296,62797:58297,62798:58298,62799:58299,62800:58300,62801:58301,62802:58302,62803:58303,62804:58304,62805:58305,62806:58306,62807:58307,62808:58308,62809:58309,62810:58310,62811:58311,62812:58312,62813:58313,62814:58314,62815:58315,62816:58316,62817:58317,62818:58318,62819:58319,62820:58320,62821:58321,62822:58322,62823:58323,62824:58324,62825:58325,62826:58326,62827:58327,62828:58328,62829:58329,62830:58330,62831:58331,62832:58332,62833:58333,62834:58334,62835:58335,62836:58336,62837:58337,62838:58338,62839:58339,62840:58340,62841:58341,62842:58342,62843:58343,62844:58344,62845:58345,62846:58346,62848:58347,62849:58348,62850:58349,62851:58350,62852:58351,62853:58352,62854:58353,62855:58354,62856:58355,62857:58356,62858:58357,62859:58358,62860:58359,62861:58360,62862:58361,62863:58362,62864:58363,62865:58364,62866:58365,62867:58366,62868:58367,62869:58368,62870:58369,62871:58370,62872:58371,62873:58372,62874:58373,62875:58374,62876:58375,62877:58376,62878:58377,62879:58378,62880:58379,62881:58380,62882:58381,62883:58382,62884:58383,62885:58384,62886:58385,62887:58386,62888:58387,62889:58388,62890:58389,62891:58390,62892:58391,62893:58392,62894:58393,62895:58394,62896:58395,62897:58396,62898:58397,62899:58398,62900:58399,62901:58400,62902:58401,62903:58402,62904:58403,62905:58404,62906:58405,62907:58406,62908:58407,62909:58408,62910:58409,62911:58410,62912:58411,62913:58412,62914:58413,62915:58414,62916:58415,62917:58416,62918:58417,62919:58418,62920:58419,62921:58420,62922:58421,62923:58422,62924:58423,62925:58424,62926:58425,62927:58426,62928:58427,62929:58428,62930:58429,62931:58430,62932:58431,62933:58432,62934:58433,62935:58434,62936:58435,62937:58436,62938:58437,62939:58438,62940:58439,62941:58440,62942:58441,62943:58442,62944:58443,62945:58444,62946:58445,62947:58446,62948:58447,62949:58448,62950:58449,62951:58450,62952:58451,62953:58452,62954:58453,62955:58454,62956:58455,62957:58456,62958:58457,62959:58458,62960:58459,62961:58460,62962:58461,62963:58462,62964:58463,62965:58464,62966:58465,62967:58466,62968:58467,62969:58468,62970:58469,62971:58470,62972:58471,63040:58472,63041:58473,63042:58474,63043:58475,63044:58476,63045:58477,63046:58478,63047:58479,63048:58480,63049:58481,63050:58482,63051:58483,63052:58484,63053:58485,63054:58486,63055:58487,63056:58488,63057:58489,63058:58490,63059:58491,63060:58492,63061:58493,63062:58494,63063:58495,63064:58496,63065:58497,63066:58498,63067:58499,63068:58500,63069:58501,63070:58502,63071:58503,63072:58504,63073:58505,63074:58506,63075:58507,63076:58508,63077:58509,63078:58510,63079:58511,63080:58512,63081:58513,63082:58514,63083:58515,63084:58516,63085:58517,63086:58518,63087:58519,63088:58520,63089:58521,63090:58522,63091:58523,63092:58524,63093:58525,63094:58526,63095:58527,63096:58528,63097:58529,63098:58530,63099:58531,63100:58532,63101:58533,63102:58534,63104:58535,63105:58536,63106:58537,63107:58538,63108:58539,63109:58540,63110:58541,63111:58542,63112:58543,63113:58544,63114:58545,63115:58546,63116:58547,63117:58548,63118:58549,63119:58550,63120:58551,63121:58552,63122:58553,63123:58554,63124:58555,63125:58556,63126:58557,63127:58558,63128:58559,63129:58560,63130:58561,63131:58562,63132:58563,63133:58564,63134:58565,63135:58566,63136:58567,63137:58568,63138:58569,63139:58570,63140:58571,63141:58572,63142:58573,63143:58574,63144:58575,63145:58576,63146:58577,63147:58578,63148:58579,63149:58580,63150:58581,63151:58582,63152:58583,63153:58584,63154:58585,63155:58586,63156:58587,63157:58588,63158:58589,63159:58590,63160:58591,63161:58592,63162:58593,63163:58594,63164:58595,63165:58596,63166:58597,63167:58598,63168:58599,63169:58600,63170:58601,63171:58602,63172:58603,63173:58604,63174:58605,63175:58606,63176:58607,63177:58608,63178:58609,63179:58610,63180:58611,63181:58612,63182:58613,63183:58614,63184:58615,63185:58616,63186:58617,63187:58618,63188:58619,63189:58620,63190:58621,63191:58622,63192:58623,63193:58624,63194:58625,63195:58626,63196:58627,63197:58628,63198:58629,63199:58630,63200:58631,63201:58632,63202:58633,63203:58634,63204:58635,63205:58636,63206:58637,63207:58638,63208:58639,63209:58640,63210:58641,63211:58642,63212:58643,63213:58644,63214:58645,63215:58646,63216:58647,63217:58648,63218:58649,63219:58650,63220:58651,63221:58652,63222:58653,63223:58654,63224:58655,63225:58656,63226:58657,63227:58658,63228:58659,63296:58660,63297:58661,63298:58662,63299:58663,63300:58664,63301:58665,63302:58666,63303:58667,63304:58668,63305:58669,63306:58670,63307:58671,63308:58672,63309:58673,63310:58674,63311:58675,63312:58676,63313:58677,63314:58678,63315:58679,63316:58680,63317:58681,63318:58682,63319:58683,63320:58684,63321:58685,63322:58686,63323:58687,63324:58688,63325:58689,63326:58690,63327:58691,63328:58692,63329:58693,63330:58694,63331:58695,63332:58696,63333:58697,63334:58698,63335:58699,63336:58700,63337:58701,63338:58702,63339:58703,63340:58704,63341:58705,63342:58706,63343:58707,63344:58708,63345:58709,63346:58710,63347:58711,63348:58712,63349:58713,63350:58714,63351:58715,63352:58716,63353:58717,63354:58718,63355:58719,63356:58720,63357:58721,63358:58722,63360:58723,63361:58724,63362:58725,63363:58726,63364:58727,63365:58728,63366:58729,63367:58730,63368:58731,63369:58732,63370:58733,63371:58734,63372:58735,63373:58736,63374:58737,63375:58738,63376:58739,63377:58740,63378:58741,63379:58742,63380:58743,63381:58744,63382:58745,63383:58746,63384:58747,63385:58748,63386:58749,63387:58750,63388:58751,63389:58752,63390:58753,63391:58754,63392:58755,63393:58756,63394:58757,63395:58758,63396:58759,63397:58760,63398:58761,63399:58762,63400:58763,63401:58764,63402:58765,63403:58766,63404:58767,63405:58768,63406:58769,63407:58770,63408:58771,63409:58772,63410:58773,63411:58774,63412:58775,63413:58776,63414:58777,63415:58778,63416:58779,63417:58780,63418:58781,63419:58782,63420:58783,63421:58784,63422:58785,63423:58786,63424:58787,63425:58788,63426:58789,63427:58790,63428:58791,63429:58792,63430:58793,63431:58794,63432:58795,63433:58796,63434:58797,63435:58798,63436:58799,63437:58800,63438:58801,63439:58802,63440:58803,63441:58804,63442:58805,63443:58806,63444:58807,63445:58808,63446:58809,63447:58810,63448:58811,63449:58812,63450:58813,63451:58814,63452:58815,63453:58816,63454:58817,63455:58818,63456:58819,63457:58820,63458:58821,63459:58822,63460:58823,63461:58824,63462:58825,63463:58826,63464:58827,63465:58828,63466:58829,63467:58830,63468:58831,63469:58832,63470:58833,63471:58834,63472:58835,63473:58836,63474:58837,63475:58838,63476:58839,63477:58840,63478:58841,63479:58842,63480:58843,63481:58844,63482:58845,63483:58846,63484:58847,63552:58848,63553:58849,63554:58850,63555:58851,63556:58852,63557:58853,63558:58854,63559:58855,63560:58856,63561:58857,63562:58858,63563:58859,63564:58860,63565:58861,63566:58862,63567:58863,63568:58864,63569:58865,63570:58866,63571:58867,63572:58868,63573:58869,63574:58870,63575:58871,63576:58872,63577:58873,63578:58874,63579:58875,63580:58876,63581:58877,63582:58878,63583:58879,63584:58880,63585:58881,63586:58882,63587:58883,63588:58884,63589:58885,63590:58886,63591:58887,63592:58888,63593:58889,63594:58890,63595:58891,63596:58892,63597:58893,63598:58894,63599:58895,63600:58896,63601:58897,63602:58898,63603:58899,63604:58900,63605:58901,63606:58902,63607:58903,63608:58904,63609:58905,63610:58906,63611:58907,63612:58908,63613:58909,63614:58910,63616:58911,63617:58912,63618:58913,63619:58914,63620:58915,63621:58916,63622:58917,63623:58918,63624:58919,63625:58920,63626:58921,63627:58922,63628:58923,63629:58924,63630:58925,63631:58926,63632:58927,63633:58928,63634:58929,63635:58930,63636:58931,63637:58932,63638:58933,63639:58934,63640:58935,63641:58936,63642:58937,63643:58938,63644:58939,63645:58940,63646:58941,63647:58942,63648:58943,63649:58944,63650:58945,63651:58946,63652:58947,63653:58948,63654:58949,63655:58950,63656:58951,63657:58952,63658:58953,63659:58954,63660:58955,63661:58956,63662:58957,63663:58958,63664:58959,63665:58960,63666:58961,63667:58962,63668:58963,63669:58964,63670:58965,63671:58966,63672:58967,63673:58968,63674:58969,63675:58970,63676:58971,63677:58972,63678:58973,63679:58974,63680:58975,63681:58976,63682:58977,63683:58978,63684:58979,63685:58980,63686:58981,63687:58982,63688:58983,63689:58984,63690:58985,63691:58986,63692:58987,63693:58988,63694:58989,63695:58990,63696:58991,63697:58992,63698:58993,63699:58994,63700:58995,63701:58996,63702:58997,63703:58998,63704:58999,63705:59e3,63706:59001,63707:59002,63708:59003,63709:59004,63710:59005,63711:59006,63712:59007,63713:59008,63714:59009,63715:59010,63716:59011,63717:59012,63718:59013,63719:59014,63720:59015,63721:59016,63722:59017,63723:59018,63724:59019,63725:59020,63726:59021,63727:59022,63728:59023,63729:59024,63730:59025,63731:59026,63732:59027,63733:59028,63734:59029,63735:59030,63736:59031,63737:59032,63738:59033,63739:59034,63740:59035,64064:8560,64065:8561,64066:8562,64067:8563,64068:8564,64069:8565,64070:8566,64071:8567,64072:8568,64073:8569,64074:8544,64075:8545,64076:8546,64077:8547,64078:8548,64079:8549,64080:8550,64081:8551,64082:8552,64083:8553,64084:65506,64085:65508,64086:65287,64087:65282,64088:12849,64089:8470,64090:8481,64091:8757,64092:32394,64093:35100,64094:37704,64095:37512,64096:34012,64097:20425,64098:28859,64099:26161,64100:26824,64101:37625,64102:26363,64103:24389,64104:20008,64105:20193,64106:20220,64107:20224,64108:20227,64109:20281,64110:20310,64111:20370,64112:20362,64113:20378,64114:20372,64115:20429,64116:20544,64117:20514,64118:20479,64119:20510,64120:20550,64121:20592,64122:20546,64123:20628,64124:20724,64125:20696,64126:20810,64128:20836,64129:20893,64130:20926,64131:20972,64132:21013,64133:21148,64134:21158,64135:21184,64136:21211,64137:21248,64138:21255,64139:21284,64140:21362,64141:21395,64142:21426,64143:21469,64144:64014,64145:21660,64146:21642,64147:21673,64148:21759,64149:21894,64150:22361,64151:22373,64152:22444,64153:22472,64154:22471,64155:64015,64156:64016,64157:22686,64158:22706,64159:22795,64160:22867,64161:22875,64162:22877,64163:22883,64164:22948,64165:22970,64166:23382,64167:23488,64168:29999,64169:23512,64170:23532,64171:23582,64172:23718,64173:23738,64174:23797,64175:23847,64176:23891,64177:64017,64178:23874,64179:23917,64180:23992,64181:23993,64182:24016,64183:24353,64184:24372,64185:24423,64186:24503,64187:24542,64188:24669,64189:24709,64190:24714,64191:24798,64192:24789,64193:24864,64194:24818,64195:24849,64196:24887,64197:24880,64198:24984,64199:25107,64200:25254,64201:25589,64202:25696,64203:25757,64204:25806,64205:25934,64206:26112,64207:26133,64208:26171,64209:26121,64210:26158,64211:26142,64212:26148,64213:26213,64214:26199,64215:26201,64216:64018,64217:26227,64218:26265,64219:26272,64220:26290,64221:26303,64222:26362,64223:26382,64224:63785,64225:26470,64226:26555,64227:26706,64228:26560,64229:26625,64230:26692,64231:26831,64232:64019,64233:26984,64234:64020,64235:27032,64236:27106,64237:27184,64238:27243,64239:27206,64240:27251,64241:27262,64242:27362,64243:27364,64244:27606,64245:27711,64246:27740,64247:27782,64248:27759,64249:27866,64250:27908,64251:28039,64252:28015,64320:28054,64321:28076,64322:28111,64323:28152,64324:28146,64325:28156,64326:28217,64327:28252,64328:28199,64329:28220,64330:28351,64331:28552,64332:28597,64333:28661,64334:28677,64335:28679,64336:28712,64337:28805,64338:28843,64339:28943,64340:28932,64341:29020,64342:28998,64343:28999,64344:64021,64345:29121,64346:29182,64347:29361,64348:29374,64349:29476,64350:64022,64351:29559,64352:29629,64353:29641,64354:29654,64355:29667,64356:29650,64357:29703,64358:29685,64359:29734,64360:29738,64361:29737,64362:29742,64363:29794,64364:29833,64365:29855,64366:29953,64367:30063,64368:30338,64369:30364,64370:30366,64371:30363,64372:30374,64373:64023,64374:30534,64375:21167,64376:30753,64377:30798,64378:30820,64379:30842,64380:31024,64381:64024,64382:64025,64384:64026,64385:31124,64386:64027,64387:31131,64388:31441,64389:31463,64390:64028,64391:31467,64392:31646,64393:64029,64394:32072,64395:32092,64396:32183,64397:32160,64398:32214,64399:32338,64400:32583,64401:32673,64402:64030,64403:33537,64404:33634,64405:33663,64406:33735,64407:33782,64408:33864,64409:33972,64410:34131,64411:34137,64412:34155,64413:64031,64414:34224,64415:64032,64416:64033,64417:34823,64418:35061,64419:35346,64420:35383,64421:35449,64422:35495,64423:35518,64424:35551,64425:64034,64426:35574,64427:35667,64428:35711,64429:36080,64430:36084,64431:36114,64432:36214,64433:64035,64434:36559,64435:64036,64436:64037,64437:36967,64438:37086,64439:64038,64440:37141,64441:37159,64442:37338,64443:37335,64444:37342,64445:37357,64446:37358,64447:37348,64448:37349,64449:37382,64450:37392,64451:37386,64452:37434,64453:37440,64454:37436,64455:37454,64456:37465,64457:37457,64458:37433,64459:37479,64460:37543,64461:37495,64462:37496,64463:37607,64464:37591,64465:37593,64466:37584,64467:64039,64468:37589,64469:37600,64470:37587,64471:37669,64472:37665,64473:37627,64474:64040,64475:37662,64476:37631,64477:37661,64478:37634,64479:37744,64480:37719,64481:37796,64482:37830,64483:37854,64484:37880,64485:37937,64486:37957,64487:37960,64488:38290,64489:63964,64490:64041,64491:38557,64492:38575,64493:38707,64494:38715,64495:38723,64496:38733,64497:38735,64498:38737,64499:38741,64500:38999,64501:39013,64502:64042,64503:64043,64504:39207,64505:64044,64506:39326,64507:39502,64508:39641,64576:39644,64577:39797,64578:39794,64579:39823,64580:39857,64581:39867,64582:39936,64583:40304,64584:40299,64585:64045,64586:40473,64587:40657},z.prototype={constructor:z,getInt8:function(){var t=this.dv.getInt8(this.offset);return this.offset+=1,t},getInt8Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getInt8());return e},getUint8:function(){var t=this.dv.getUint8(this.offset);return this.offset+=1,t},getUint8Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getUint8());return e},getInt16:function(){var t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t},getInt16Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getInt16());return e},getUint16:function(){var t=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,t},getUint16Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getUint16());return e},getInt32:function(){var t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t},getInt32Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getInt32());return e},getUint32:function(){var t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t},getUint32Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getUint32());return e},getFloat32:function(){var t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t},getFloat32Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getFloat32());return e},getFloat64:function(){var t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t},getFloat64Array:function(t){for(var e=[],r=0;r<t;r++)e.push(this.getFloat64());return e},getIndex:function(t,e){switch(t){case 1:return!0===e?this.getUint8():this.getInt8();case 2:return!0===e?this.getUint16():this.getInt16();case 4:return this.getInt32();default:throw"unknown number type "+t+" exception."}},getIndexArray:function(t,e,r){for(var n=[],i=0;i<e;i++)n.push(this.getIndex(t,r));return n},getChars:function(t){for(var e="";t>0;){var r=this.getUint8();if(t--,0===r)break;e+=String.fromCharCode(r)}for(;t>0;)this.getUint8(),t--;return e},getSjisStringsAsUnicode:function(t){for(var e=[];t>0;){var r=this.getUint8();if(t--,0===r)break;e.push(r)}for(;t>0;)this.getUint8(),t--;return this.encoder.s2u(new Uint8Array(e))},getUnicodeStrings:function(t){for(var e="";t>0;){var r=this.getUint16();if(t-=2,0===r)break;e+=String.fromCharCode(r)}for(;t>0;)this.getUint8(),t--;return e},getTextBuffer:function(){var t=this.getUint32();return this.getUnicodeStrings(t)}},V.prototype={constructor:V,leftToRightVector3:function(t){t[2]=-t[2]},leftToRightQuaternion:function(t){t[0]=-t[0],t[1]=-t[1]},leftToRightEuler:function(t){t[0]=-t[0],t[1]=-t[1]},leftToRightIndexOrder:function(t){var e=t[2];t[2]=t[0],t[0]=e},leftToRightVector3Range:function(t,e){var r=-e[2];e[2]=-t[2],t[2]=r},leftToRightEulerRange:function(t,e){var r=-e[0],n=-e[1];e[0]=-t[0],e[1]=-t[1],t[0]=r,t[1]=n}},H.prototype.parsePmd=function(t,e){var r={},n=new z(t);r.metadata={},r.metadata.format="pmd",r.metadata.coordinateSystem="left";var i;return function(){var t=r.metadata;if(t.magic=n.getChars(3),"Pmd"!==t.magic)throw"PMD file magic is not Pmd, but "+t.magic;t.version=n.getFloat32(),t.modelName=n.getSjisStringsAsUnicode(20),t.comment=n.getSjisStringsAsUnicode(256)}(),function(){var t,e=r.metadata;e.vertexCount=n.getUint32(),r.vertices=[];for(var i=0;i<e.vertexCount;i++)r.vertices.push((t=void 0,(t={}).position=n.getFloat32Array(3),t.normal=n.getFloat32Array(3),t.uv=n.getFloat32Array(2),t.skinIndices=n.getUint16Array(2),t.skinWeights=[n.getUint8()/100],t.skinWeights.push(1-t.skinWeights[0]),t.edgeFlag=n.getUint8(),t))}(),function(){var t,e=r.metadata;e.faceCount=n.getUint32()/3,r.faces=[];for(var i=0;i<e.faceCount;i++)r.faces.push((t=void 0,(t={}).indices=n.getUint16Array(3),t))}(),function(){var t,e=r.metadata;e.materialCount=n.getUint32(),r.materials=[];for(var i=0;i<e.materialCount;i++)r.materials.push((t=void 0,(t={}).diffuse=n.getFloat32Array(4),t.shininess=n.getFloat32(),t.specular=n.getFloat32Array(3),t.ambient=n.getFloat32Array(3),t.toonIndex=n.getInt8(),t.edgeFlag=n.getUint8(),t.faceCount=n.getUint32()/3,t.fileName=n.getSjisStringsAsUnicode(20),t))}(),function(){var t,e=r.metadata;e.boneCount=n.getUint16(),r.bones=[];for(var i=0;i<e.boneCount;i++)r.bones.push((t=void 0,(t={}).name=n.getSjisStringsAsUnicode(20),t.parentIndex=n.getInt16(),t.tailIndex=n.getInt16(),t.type=n.getUint8(),t.ikIndex=n.getInt16(),t.position=n.getFloat32Array(3),t))}(),function(){var t=function(){var t={};t.target=n.getUint16(),t.effector=n.getUint16(),t.linkCount=n.getUint8(),t.iteration=n.getUint16(),t.maxAngle=n.getFloat32(),t.links=[];for(var e=0;e<t.linkCount;e++){var r={};r.index=n.getUint16(),t.links.push(r)}return t},e=r.metadata;e.ikCount=n.getUint16(),r.iks=[];for(var i=0;i<e.ikCount;i++)r.iks.push(t())}(),function(){var t=function(){var t={};t.name=n.getSjisStringsAsUnicode(20),t.elementCount=n.getUint32(),t.type=n.getUint8(),t.elements=[];for(var e=0;e<t.elementCount;e++)t.elements.push({index:n.getUint32(),position:n.getFloat32Array(3)});return t},e=r.metadata;e.morphCount=n.getUint16(),r.morphs=[];for(var i=0;i<e.morphCount;i++)r.morphs.push(t())}(),function(){var t,e=r.metadata;e.morphFrameCount=n.getUint8(),r.morphFrames=[];for(var i=0;i<e.morphFrameCount;i++)r.morphFrames.push((t=void 0,(t={}).index=n.getUint16(),t))}(),function(){var t,e=r.metadata;e.boneFrameNameCount=n.getUint8(),r.boneFrameNames=[];for(var i=0;i<e.boneFrameNameCount;i++)r.boneFrameNames.push((t=void 0,(t={}).name=n.getSjisStringsAsUnicode(50),t))}(),function(){var t,e=r.metadata;e.boneFrameCount=n.getUint32(),r.boneFrames=[];for(var i=0;i<e.boneFrameCount;i++)r.boneFrames.push((t=void 0,(t={}).boneIndex=n.getInt16(),t.frameIndex=n.getUint8(),t))}(),(i=r.metadata).englishCompatibility=n.getUint8(),i.englishCompatibility>0&&(i.englishModelName=n.getSjisStringsAsUnicode(20),i.englishComment=n.getSjisStringsAsUnicode(256)),function(){var t=r.metadata;if(0!==t.englishCompatibility){r.englishBoneNames=[];for(var e=0;e<t.boneCount;e++)r.englishBoneNames.push((i=void 0,(i={}).name=n.getSjisStringsAsUnicode(20),i));var i}}(),function(){var t=r.metadata;if(0!==t.englishCompatibility){r.englishMorphNames=[];for(var e=0;e<t.morphCount-1;e++)r.englishMorphNames.push((i=void 0,(i={}).name=n.getSjisStringsAsUnicode(20),i));var i}}(),function(){var t=r.metadata;if(0!==t.englishCompatibility){r.englishBoneFrameNames=[];for(var e=0;e<t.boneFrameNameCount;e++)r.englishBoneFrameNames.push((i=void 0,(i={}).name=n.getSjisStringsAsUnicode(50),i));var i}}(),function(){var t;r.toonTextures=[];for(var e=0;e<10;e++)r.toonTextures.push((t=void 0,(t={}).fileName=n.getSjisStringsAsUnicode(100),t))}(),function(){var t,e=r.metadata;e.rigidBodyCount=n.getUint32(),r.rigidBodies=[];for(var i=0;i<e.rigidBodyCount;i++)r.rigidBodies.push((t=void 0,(t={}).name=n.getSjisStringsAsUnicode(20),t.boneIndex=n.getInt16(),t.groupIndex=n.getUint8(),t.groupTarget=n.getUint16(),t.shapeType=n.getUint8(),t.width=n.getFloat32(),t.height=n.getFloat32(),t.depth=n.getFloat32(),t.position=n.getFloat32Array(3),t.rotation=n.getFloat32Array(3),t.weight=n.getFloat32(),t.positionDamping=n.getFloat32(),t.rotationDamping=n.getFloat32(),t.restitution=n.getFloat32(),t.friction=n.getFloat32(),t.type=n.getUint8(),t))}(),function(){var t,e=r.metadata;e.constraintCount=n.getUint32(),r.constraints=[];for(var i=0;i<e.constraintCount;i++)r.constraints.push((t=void 0,(t={}).name=n.getSjisStringsAsUnicode(20),t.rigidBodyIndex1=n.getUint32(),t.rigidBodyIndex2=n.getUint32(),t.position=n.getFloat32Array(3),t.rotation=n.getFloat32Array(3),t.translationLimitation1=n.getFloat32Array(3),t.translationLimitation2=n.getFloat32Array(3),t.rotationLimitation1=n.getFloat32Array(3),t.rotationLimitation2=n.getFloat32Array(3),t.springPosition=n.getFloat32Array(3),t.springRotation=n.getFloat32Array(3),t))}(),!0===e&&this.leftToRightModel(r),r},H.prototype.parsePmx=function(t,e){var r={},n=new z(t);r.metadata={},r.metadata.format="pmx",r.metadata.coordinateSystem="left";return function(){var t=r.metadata;if(t.magic=n.getChars(4),"PMX "!==t.magic)throw"PMX file magic is not PMX , but "+t.magic;if(t.version=n.getFloat32(),2!==t.version&&2.1!==t.version)throw"PMX version "+t.version+" is not supported.";t.headerSize=n.getUint8(),t.encoding=n.getUint8(),t.additionalUvNum=n.getUint8(),t.vertexIndexSize=n.getUint8(),t.textureIndexSize=n.getUint8(),t.materialIndexSize=n.getUint8(),t.boneIndexSize=n.getUint8(),t.morphIndexSize=n.getUint8(),t.rigidBodyIndexSize=n.getUint8(),t.modelName=n.getTextBuffer(),t.englishModelName=n.getTextBuffer(),t.comment=n.getTextBuffer(),t.englishComment=n.getTextBuffer()}(),function(){var t=function(){var t={};t.position=n.getFloat32Array(3),t.normal=n.getFloat32Array(3),t.uv=n.getFloat32Array(2),t.auvs=[];for(var i=0;i<r.metadata.additionalUvNum;i++)t.auvs.push(n.getFloat32Array(4));t.type=n.getUint8();var o=e.boneIndexSize;if(0===t.type)t.skinIndices=n.getIndexArray(o,1),t.skinWeights=[1];else if(1===t.type)t.skinIndices=n.getIndexArray(o,2),t.skinWeights=n.getFloat32Array(1),t.skinWeights.push(1-t.skinWeights[0]);else if(2===t.type)t.skinIndices=n.getIndexArray(o,4),t.skinWeights=n.getFloat32Array(4);else{if(3!==t.type)throw"unsupport bone type "+t.type+" exception.";t.skinIndices=n.getIndexArray(o,2),t.skinWeights=n.getFloat32Array(1),t.skinWeights.push(1-t.skinWeights[0]),t.skinC=n.getFloat32Array(3),t.skinR0=n.getFloat32Array(3),t.skinR1=n.getFloat32Array(3),t.type=1}return t.edgeRatio=n.getFloat32(),t},e=r.metadata;e.vertexCount=n.getUint32(),r.vertices=[];for(var i=0;i<e.vertexCount;i++)r.vertices.push(t())}(),function(){var t,e=r.metadata;e.faceCount=n.getUint32()/3,r.faces=[];for(var i=0;i<e.faceCount;i++)r.faces.push((t=void 0,(t={}).indices=n.getIndexArray(e.vertexIndexSize,3,!0),t))}(),function(){var t=r.metadata;t.textureCount=n.getUint32(),r.textures=[];for(var e=0;e<t.textureCount;e++)r.textures.push(n.getTextBuffer())}(),function(){var t=function(){var t={};if(t.name=n.getTextBuffer(),t.englishName=n.getTextBuffer(),t.diffuse=n.getFloat32Array(4),t.specular=n.getFloat32Array(3),t.shininess=n.getFloat32(),t.ambient=n.getFloat32Array(3),t.flag=n.getUint8(),t.edgeColor=n.getFloat32Array(4),t.edgeSize=n.getFloat32(),t.textureIndex=n.getIndex(r.metadata.textureIndexSize),t.envTextureIndex=n.getIndex(r.metadata.textureIndexSize),t.envFlag=n.getUint8(),t.toonFlag=n.getUint8(),0===t.toonFlag)t.toonIndex=n.getIndex(r.metadata.textureIndexSize);else{if(1!==t.toonFlag)throw"unknown toon flag "+t.toonFlag+" exception.";t.toonIndex=n.getInt8()}return t.comment=n.getTextBuffer(),t.faceCount=n.getUint32()/3,t},e=r.metadata;e.materialCount=n.getUint32(),r.materials=[];for(var i=0;i<e.materialCount;i++)r.materials.push(t())}(),function(){var t=function(){var t={};if(t.name=n.getTextBuffer(),t.englishName=n.getTextBuffer(),t.position=n.getFloat32Array(3),t.parentIndex=n.getIndex(r.metadata.boneIndexSize),t.transformationClass=n.getUint32(),t.flag=n.getUint16(),1&t.flag?t.connectIndex=n.getIndex(r.metadata.boneIndexSize):t.offsetPosition=n.getFloat32Array(3),256&t.flag||512&t.flag){var e={};e.isLocal=0!=(128&t.flag),e.affectRotation=0!=(256&t.flag),e.affectPosition=0!=(512&t.flag),e.parentIndex=n.getIndex(r.metadata.boneIndexSize),e.ratio=n.getFloat32(),t.grant=e}if(1024&t.flag&&(t.fixAxis=n.getFloat32Array(3)),2048&t.flag&&(t.localXVector=n.getFloat32Array(3),t.localZVector=n.getFloat32Array(3)),8192&t.flag&&(t.key=n.getUint32()),32&t.flag){var i={};i.effector=n.getIndex(r.metadata.boneIndexSize),i.target=null,i.iteration=n.getUint32(),i.maxAngle=n.getFloat32(),i.linkCount=n.getUint32(),i.links=[];for(var o=0;o<i.linkCount;o++){var a={};a.index=n.getIndex(r.metadata.boneIndexSize),a.angleLimitation=n.getUint8(),1===a.angleLimitation&&(a.lowerLimitationAngle=n.getFloat32Array(3),a.upperLimitationAngle=n.getFloat32Array(3)),i.links.push(a)}t.ik=i}return t},e=r.metadata;e.boneCount=n.getUint32(),r.bones=[];for(var i=0;i<e.boneCount;i++)r.bones.push(t())}(),function(){var t=function(){var t={};t.name=n.getTextBuffer(),t.englishName=n.getTextBuffer(),t.panel=n.getUint8(),t.type=n.getUint8(),t.elementCount=n.getUint32(),t.elements=[];for(var e=0;e<t.elementCount;e++){if(0===t.type)(i={}).index=n.getIndex(r.metadata.morphIndexSize),i.ratio=n.getFloat32(),t.elements.push(i);else if(1===t.type){(i={}).index=n.getIndex(r.metadata.vertexIndexSize,!0),i.position=n.getFloat32Array(3),t.elements.push(i)}else if(2===t.type){(i={}).index=n.getIndex(r.metadata.boneIndexSize),i.position=n.getFloat32Array(3),i.rotation=n.getFloat32Array(4),t.elements.push(i)}else if(3===t.type){(i={}).index=n.getIndex(r.metadata.vertexIndexSize,!0),i.uv=n.getFloat32Array(4),t.elements.push(i)}else if(4===t.type);else if(5===t.type);else if(6===t.type);else if(7===t.type);else if(8===t.type){var i;(i={}).index=n.getIndex(r.metadata.materialIndexSize),i.type=n.getUint8(),i.diffuse=n.getFloat32Array(4),i.specular=n.getFloat32Array(3),i.shininess=n.getFloat32(),i.ambient=n.getFloat32Array(3),i.edgeColor=n.getFloat32Array(4),i.edgeSize=n.getFloat32(),i.textureColor=n.getFloat32Array(4),i.sphereTextureColor=n.getFloat32Array(4),i.toonColor=n.getFloat32Array(4),t.elements.push(i)}}return t},e=r.metadata;e.morphCount=n.getUint32(),r.morphs=[];for(var i=0;i<e.morphCount;i++)r.morphs.push(t())}(),function(){var t=function(){var t={};t.name=n.getTextBuffer(),t.englishName=n.getTextBuffer(),t.type=n.getUint8(),t.elementCount=n.getUint32(),t.elements=[];for(var e=0;e<t.elementCount;e++){var i={};i.target=n.getUint8(),i.index=0===i.target?n.getIndex(r.metadata.boneIndexSize):n.getIndex(r.metadata.morphIndexSize),t.elements.push(i)}return t},e=r.metadata;e.frameCount=n.getUint32(),r.frames=[];for(var i=0;i<e.frameCount;i++)r.frames.push(t())}(),function(){var t,e=r.metadata;e.rigidBodyCount=n.getUint32(),r.rigidBodies=[];for(var i=0;i<e.rigidBodyCount;i++)r.rigidBodies.push((t=void 0,(t={}).name=n.getTextBuffer(),t.englishName=n.getTextBuffer(),t.boneIndex=n.getIndex(r.metadata.boneIndexSize),t.groupIndex=n.getUint8(),t.groupTarget=n.getUint16(),t.shapeType=n.getUint8(),t.width=n.getFloat32(),t.height=n.getFloat32(),t.depth=n.getFloat32(),t.position=n.getFloat32Array(3),t.rotation=n.getFloat32Array(3),t.weight=n.getFloat32(),t.positionDamping=n.getFloat32(),t.rotationDamping=n.getFloat32(),t.restitution=n.getFloat32(),t.friction=n.getFloat32(),t.type=n.getUint8(),t))}(),function(){var t,e=r.metadata;e.constraintCount=n.getUint32(),r.constraints=[];for(var i=0;i<e.constraintCount;i++)r.constraints.push((t=void 0,(t={}).name=n.getTextBuffer(),t.englishName=n.getTextBuffer(),t.type=n.getUint8(),t.rigidBodyIndex1=n.getIndex(r.metadata.rigidBodyIndexSize),t.rigidBodyIndex2=n.getIndex(r.metadata.rigidBodyIndexSize),t.position=n.getFloat32Array(3),t.rotation=n.getFloat32Array(3),t.translationLimitation1=n.getFloat32Array(3),t.translationLimitation2=n.getFloat32Array(3),t.rotationLimitation1=n.getFloat32Array(3),t.rotationLimitation2=n.getFloat32Array(3),t.springPosition=n.getFloat32Array(3),t.springRotation=n.getFloat32Array(3),t))}(),!0===e&&this.leftToRightModel(r),r},H.prototype.parseVmd=function(t,e){var r={},n=new z(t);r.metadata={},r.metadata.coordinateSystem="left";return function(){var t=r.metadata;if(t.magic=n.getChars(30),"Vocaloid Motion Data 0002"!==t.magic)throw"VMD file magic is not Vocaloid Motion Data 0002, but "+t.magic;t.name=n.getSjisStringsAsUnicode(20)}(),function(){var t,e=r.metadata;e.motionCount=n.getUint32(),r.motions=[];for(var i=0;i<e.motionCount;i++)r.motions.push((t=void 0,(t={}).boneName=n.getSjisStringsAsUnicode(15),t.frameNum=n.getUint32(),t.position=n.getFloat32Array(3),t.rotation=n.getFloat32Array(4),t.interpolation=n.getUint8Array(64),t))}(),function(){var t,e=r.metadata;e.morphCount=n.getUint32(),r.morphs=[];for(var i=0;i<e.morphCount;i++)r.morphs.push((t=void 0,(t={}).morphName=n.getSjisStringsAsUnicode(15),t.frameNum=n.getUint32(),t.weight=n.getFloat32(),t))}(),function(){var t,e=r.metadata;e.cameraCount=n.getUint32(),r.cameras=[];for(var i=0;i<e.cameraCount;i++)r.cameras.push((t=void 0,(t={}).frameNum=n.getUint32(),t.distance=n.getFloat32(),t.position=n.getFloat32Array(3),t.rotation=n.getFloat32Array(3),t.interpolation=n.getUint8Array(24),t.fov=n.getUint32(),t.perspective=n.getUint8(),t))}(),!0===e&&this.leftToRightVmd(r),r},H.prototype.parseVpd=function(t,e){var r={metadata:{}};r.metadata.coordinateSystem="left",r.bones=[];var n=t.replace(/\/\/\w*(\r|\n|\r\n)/g,"").split(/\r|\n|\r\n/);function i(){throw"the file seems not vpd file."}return"Vocaloid Pose Data file"!==n[0]&&i(),n.length<4&&i(),r.metadata.parentFile=n[2],r.metadata.boneCount=parseInt(n[3]),function(){for(var t=/^\s*(Bone[0-9]+)\s*\{\s*(.*)$/,e=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,o=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,a=/^\s*}/,s=r.bones,l=null,c=null,u=null,h=4;h<n.length;h++){var p,d=n[h];null!==(p=d.match(t))&&(null!==l&&i(),l=p[2]),null!==(p=d.match(e))&&(null!==c&&i(),c=[parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])]),null!==(p=d.match(o))&&(null!==u&&i(),u=[parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]),parseFloat(p[4])]),null!==(p=d.match(a))&&(null!==l&&null!==c&&null!==u||i(),s.push({name:l,translation:c,quaternion:u}),l=null,c=null,u=null)}null===l&&null===c&&null===u||i()}(),!0===e&&this.leftToRightVpd(r),r},H.prototype.mergeVmds=function(t){var e={metadata:{}};e.metadata.name=t[0].metadata.name,e.metadata.coordinateSystem=t[0].metadata.coordinateSystem,e.metadata.motionCount=0,e.metadata.morphCount=0,e.metadata.cameraCount=0,e.motions=[],e.morphs=[],e.cameras=[];for(var r=0;r<t.length;r++){var n=t[r];e.metadata.motionCount+=n.metadata.motionCount,e.metadata.morphCount+=n.metadata.morphCount,e.metadata.cameraCount+=n.metadata.cameraCount;for(var i=0;i<n.metadata.motionCount;i++)e.motions.push(n.motions[i]);for(i=0;i<n.metadata.morphCount;i++)e.morphs.push(n.morphs[i]);for(i=0;i<n.metadata.cameraCount;i++)e.cameras.push(n.cameras[i])}return e},H.prototype.leftToRightModel=function(t){if("right"!==t.metadata.coordinateSystem){t.metadata.coordinateSystem="right";for(var e=new V,r=0;r<t.metadata.vertexCount;r++)e.leftToRightVector3(t.vertices[r].position),e.leftToRightVector3(t.vertices[r].normal);for(r=0;r<t.metadata.faceCount;r++)e.leftToRightIndexOrder(t.faces[r].indices);for(r=0;r<t.metadata.boneCount;r++)e.leftToRightVector3(t.bones[r].position);for(r=0;r<t.metadata.morphCount;r++){var n=t.morphs[r];if("pmx"!==t.metadata.format||1===n.type)for(var i=0;i<n.elements.length;i++)e.leftToRightVector3(n.elements[i].position)}for(r=0;r<t.metadata.rigidBodyCount;r++)e.leftToRightVector3(t.rigidBodies[r].position),e.leftToRightEuler(t.rigidBodies[r].rotation);for(r=0;r<t.metadata.constraintCount;r++)e.leftToRightVector3(t.constraints[r].position),e.leftToRightEuler(t.constraints[r].rotation),e.leftToRightVector3Range(t.constraints[r].translationLimitation1,t.constraints[r].translationLimitation2),e.leftToRightEulerRange(t.constraints[r].rotationLimitation1,t.constraints[r].rotationLimitation2)}},H.prototype.leftToRightVmd=function(t){if("right"!==t.metadata.coordinateSystem){t.metadata.coordinateSystem="right";for(var e=new V,r=0;r<t.metadata.motionCount;r++)e.leftToRightVector3(t.motions[r].position),e.leftToRightQuaternion(t.motions[r].rotation);for(r=0;r<t.metadata.cameraCount;r++)e.leftToRightVector3(t.cameras[r].position),e.leftToRightEuler(t.cameras[r].rotation)}},H.prototype.leftToRightVpd=function(t){if("right"!==t.metadata.coordinateSystem){t.metadata.coordinateSystem="right";for(var e=new V,r=0;r<t.bones.length;r++)e.leftToRightVector3(t.bones[r].translation),e.leftToRightQuaternion(t.bones[r].quaternion)}};var W={CharsetEncoder:G,Parser:H},q=function(){function t(t){c.Loader.call(this,t),this.loader=new c.FileLoader(this.manager),this.parser=null,this.meshBuilder=new r(this.manager),this.animationBuilder=new o}t.prototype=Object.assign(Object.create(c.Loader.prototype),{constructor:t,setAnimationPath:function(t){return this.animationPath=t,this},load:function(t,e,r,n){var i,o=this.meshBuilder.setCrossOrigin(this.crossOrigin);i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:c.LoaderUtils.extractUrlBase(t);var a=this._extractExtension(t).toLowerCase();"pmd"===a||"pmx"===a?this["pmd"===a?"loadPMD":"loadPMX"](t,(function(t){e(o.build(t,i,r,n))}),r,n):n&&n(new Error("THREE.MMDLoader: Unknown model file extension ."+a+"."))},loadAnimation:function(t,e,r,n,i){var o=this.animationBuilder;this.loadVMD(t,(function(t){r(e.isCamera?o.buildCameraAnimation(t):o.build(t,e))}),n,i)},loadWithAnimation:function(t,e,r,n,i){var o=this;this.load(t,(function(t){o.loadAnimation(e,t,(function(e){r({mesh:t,animation:e})}),n,i)}),n,i)},loadPMD:function(t,e,r,n){var i=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").load(t,(function(t){e(i.parsePmd(t,!0))}),r,n)},loadPMX:function(t,e,r,n){var i=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").load(t,(function(t){e(i.parsePmx(t,!0))}),r,n)},loadVMD:function(t,e,r,n){var i=Array.isArray(t)?t:[t],o=[],a=i.length,s=this._getParser();this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType("arraybuffer");for(var l=0,c=i.length;l<c;l++)this.loader.load(i[l],(function(t){o.push(s.parseVmd(t,!0)),o.length===a&&e(s.mergeVmds(o))}),r,n)},loadVPD:function(t,e,r,n,i){var o=this._getParser();this.loader.setMimeType(e?void 0:"text/plain; charset=shift_jis").setPath(this.animationPath).setResponseType("text").load(t,(function(t){r(o.parseVpd(t,!0))}),n,i)},_extractExtension:function(t){var e=t.lastIndexOf(".");return e<0?"":t.slice(e+1)},_getParser:function(){if(null===this.parser){if(void 0===W)throw new Error("THREE.MMDLoader: Import MMDParser https://github.com/takahirox/mmd-parser");this.parser=new W.Parser}return this.parser}});var e=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="];function r(t){this.geometryBuilder=new n,this.materialBuilder=new i(t)}function n(){}function i(t){this.manager=t,this.textureLoader=new c.TextureLoader(this.manager),this.tgaLoader=null}function o(){}function a(t,e,r,n,i){c.Interpolant.call(this,t,e,r,n),this.interpolationParams=i}return r.prototype={constructor:r,crossOrigin:"anonymous",setCrossOrigin:function(t){return this.crossOrigin=t,this},build:function(t,e,r,n){var i=this.geometryBuilder.build(t),o=this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(e).build(t,i,r,n),a=new c.SkinnedMesh(i,o),s=new c.Skeleton(function(t){var e,r,n,i,o=t.geometry,a=[];if(o&&void 0!==o.bones){for(n=0,i=o.bones.length;n<i;n++)r=o.bones[n],e=new c.Bone,a.push(e),e.name=r.name,e.position.fromArray(r.pos),e.quaternion.fromArray(r.rotq),void 0!==r.scl&&e.scale.fromArray(r.scl);for(n=0,i=o.bones.length;n<i;n++)-1!==(r=o.bones[n]).parent&&null!==r.parent&&void 0!==a[r.parent]?a[r.parent].add(a[n]):t.add(a[n])}return t.updateMatrixWorld(!0),a}(a));return a.bind(s),a}},n.prototype={constructor:n,build:function(t){for(var e=[],r=[],n=[],i=[],o=[],a=[],s=[],l=[],u=[],h=[],p=[],d=[],f=[],m=[],g=0,v={},y=0;y<t.metadata.vertexCount;y++){for(var _=t.vertices[y],b=0,x=_.position.length;b<x;b++)e.push(_.position[b]);for(b=0,x=_.normal.length;b<x;b++)n.push(_.normal[b]);for(b=0,x=_.uv.length;b<x;b++)r.push(_.uv[b]);for(b=0;b<4;b++)s.push(_.skinIndices.length-1>=b?_.skinIndices[b]:0);for(b=0;b<4;b++)l.push(_.skinWeights.length-1>=b?_.skinWeights[b]:0)}for(y=0;y<t.metadata.faceCount;y++){var w=t.faces[y];for(b=0,x=w.indices.length;b<x;b++)i.push(w.indices[b])}for(y=0;y<t.metadata.materialCount;y++){var E=t.materials[y];o.push({offset:3*g,count:3*E.faceCount}),g+=E.faceCount}for(y=0;y<t.metadata.rigidBodyCount;y++){var M=t.rigidBodies[y],S=v[M.boneIndex];S=void 0===S?M.type:Math.max(M.type,S),v[M.boneIndex]=S}for(y=0;y<t.metadata.boneCount;y++){-1!==(V={parent:(I=t.bones[y]).parentIndex,name:I.name,pos:I.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:void 0!==v[y]?v[y]:-1}).parent&&(V.pos[0]-=t.bones[V.parent].position[0],V.pos[1]-=t.bones[V.parent].position[1],V.pos[2]-=t.bones[V.parent].position[2]),a.push(V)}if("pmd"===t.metadata.format)for(y=0;y<t.metadata.ikCount;y++){var T={target:(A=t.iks[y]).target,effector:A.effector,iteration:A.iteration,maxAngle:4*A.maxAngle,links:[]};for(b=0,x=A.links.length;b<x;b++){(C={}).index=A.links[b].index,C.enabled=!0,t.bones[C.index].name.indexOf("ひざ")>=0&&(C.limitation=new c.Vector3(1,0,0)),T.links.push(C)}p.push(T)}else for(y=0;y<t.metadata.boneCount;y++){var A;if(void 0!==(A=t.bones[y].ik)){for(T={target:y,effector:A.effector,iteration:A.iteration,maxAngle:A.maxAngle,links:[]},b=0,x=A.links.length;b<x;b++){var C;if((C={}).index=A.links[b].index,C.enabled=!0,1===A.links[b].angleLimitation){var P=A.links[b].lowerLimitationAngle,O=A.links[b].upperLimitationAngle,R=-O[0],L=-O[1];O[0]=-P[0],O[1]=-P[1],P[0]=R,P[1]=L,C.rotationMin=(new c.Vector3).fromArray(P),C.rotationMax=(new c.Vector3).fromArray(O)}T.links.push(C)}p.push(T)}}if("pmx"===t.metadata.format){for(y=0;y<t.metadata.boneCount;y++){var I,N=(I=t.bones[y]).grant;if(void 0!==N){T={index:y,parentIndex:N.parentIndex,ratio:N.ratio,isLocal:N.isLocal,affectRotation:N.affectRotation,affectPosition:N.affectPosition,transformationClass:I.transformationClass};d.push(T)}}d.sort((function(t,e){return t.transformationClass-e.transformationClass}))}function B(e,r,n){for(var i=0;i<r.elementCount;i++){var o,a=r.elements[i];o="pmd"===t.metadata.format?t.morphs[0].elements[a.index].index:a.index,e.array[3*o+0]+=a.position[0]*n,e.array[3*o+1]+=a.position[1]*n,e.array[3*o+2]+=a.position[2]*n}}for(y=0;y<t.metadata.morphCount;y++){var D=t.morphs[y],k={name:D.name},U=new c.Float32BufferAttribute(3*t.metadata.vertexCount,3);U.name=D.name;for(b=0;b<3*t.metadata.vertexCount;b++)U.array[b]=e[b];if("pmd"===t.metadata.format)0!==y&&B(U,D,1);else if(0===D.type)for(b=0;b<D.elementCount;b++){var F=t.morphs[D.elements[b].index],j=D.elements[b].ratio;1===F.type&&B(U,F,j)}else 1===D.type?B(U,D,1):2===D.type||3===D.type||4===D.type||5===D.type||6===D.type||7===D.type||D.type;u.push(k),h.push(U)}for(y=0;y<t.metadata.rigidBodyCount;y++){var G=t.rigidBodies[y];k={};for(var z in G)k[z]=G[z];if("pmx"===t.metadata.format&&-1!==k.boneIndex){var V=t.bones[k.boneIndex];k.position[0]-=V.position[0],k.position[1]-=V.position[1],k.position[2]-=V.position[2]}f.push(k)}for(y=0;y<t.metadata.constraintCount;y++){var H=t.constraints[y];k={};for(var z in H)k[z]=H[z];var W=f[k.rigidBodyIndex1],q=f[k.rigidBodyIndex2];0!==W.type&&2===q.type&&-1!==W.boneIndex&&-1!==q.boneIndex&&t.bones[q.boneIndex].parentIndex===W.boneIndex&&(q.type=1),m.push(k)}var Y=new c.BufferGeometry;Y.setAttribute("position",new c.Float32BufferAttribute(e,3)),Y.setAttribute("normal",new c.Float32BufferAttribute(n,3)),Y.setAttribute("uv",new c.Float32BufferAttribute(r,2)),Y.setAttribute("skinIndex",new c.Uint16BufferAttribute(s,4)),Y.setAttribute("skinWeight",new c.Float32BufferAttribute(l,4)),Y.setIndex(i);y=0;for(var X=o.length;y<X;y++)Y.addGroup(o[y].offset,o[y].count,y);return Y.bones=a,Y.morphTargets=u,Y.morphAttributes.position=h,Y.morphTargetsRelative=!1,Y.userData.MMD={bones:a,iks:p,grants:d,rigidBodies:f,constraints:m,format:t.metadata.format},Y.computeBoundingSphere(),Y}},i.prototype={constructor:i,crossOrigin:"anonymous",resourcePath:void 0,setCrossOrigin:function(t){return this.crossOrigin=t,this},setResourcePath:function(t){return this.resourcePath=t,this},build:function(t,e){var r=[],n={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(var i=0;i<t.metadata.materialCount;i++){var o=t.materials[i],a={userData:{}};if(void 0!==o.name&&(a.name=o.name),a.color=(new c.Color).fromArray(o.diffuse),a.opacity=o.diffuse[3],a.specular=(new c.Color).fromArray(o.specular),a.emissive=(new c.Color).fromArray(o.ambient),a.shininess=Math.max(o.shininess,1e-4),a.transparent=1!==a.opacity,a.skinning=e.bones.length>0,a.morphTargets=e.morphTargets.length>0,a.fog=!0,a.blending=c.CustomBlending,a.blendSrc=c.SrcAlphaFactor,a.blendDst=c.OneMinusSrcAlphaFactor,a.blendSrcAlpha=c.SrcAlphaFactor,a.blendDstAlpha=c.DstAlphaFactor,"pmx"===t.metadata.format&&1==(1&o.flag)?a.side=c.DoubleSide:a.side=1===a.opacity?c.FrontSide:c.DoubleSide,"pmd"===t.metadata.format){if(o.fileName){var s=o.fileName.split("*");if(a.map=this._loadTexture(s[0],n),s.length>1){var l=s[1].slice(-4).toLowerCase();a.envMap=this._loadTexture(s[1],n,{sphericalReflectionMapping:!0}),a.combine=".sph"===l?c.MultiplyOperation:c.AddOperation}}var u=-1===o.toonIndex?"toon00.bmp":t.toonTextures[o.toonIndex].fileName;a.gradientMap=this._loadTexture(u,n,{isToonTexture:!0,isDefaultToonTexture:this._isDefaultToonTexture(u)}),a.userData.outlineParameters={thickness:1===o.edgeFlag?.003:0,color:[0,0,0],alpha:1,visible:1===o.edgeFlag}}else{var h;-1!==o.textureIndex&&(a.map=this._loadTexture(t.textures[o.textureIndex],n)),-1===o.envTextureIndex||1!==o.envFlag&&2!=o.envFlag||(a.envMap=this._loadTexture(t.textures[o.envTextureIndex],n,{sphericalReflectionMapping:!0}),a.combine=1===o.envFlag?c.MultiplyOperation:c.AddOperation),-1===o.toonIndex||0!==o.toonFlag?(u="toon"+("0"+(o.toonIndex+1)).slice(-2)+".bmp",h=!0):(u=t.textures[o.toonIndex],h=!1),a.gradientMap=this._loadTexture(u,n,{isToonTexture:!0,isDefaultToonTexture:h}),a.userData.outlineParameters={thickness:o.edgeSize/300,color:o.edgeColor.slice(0,3),alpha:o.edgeColor[3],visible:0!=(16&o.flag)&&o.edgeSize>0}}void 0!==a.map&&(a.transparent||this._checkImageTransparency(a.map,e,i),a.emissive.multiplyScalar(.2)),r.push(new c.MeshToonMaterial(a))}if("pmx"===t.metadata.format){function p(t,e){for(var r=0,n=t.length;r<n;r++){var i=t[r];if(-1!==i.index){var o=e[i.index];o.opacity!==i.diffuse[3]&&(o.transparent=!0)}}}i=0;for(var d=t.morphs.length;i<d;i++){var f=t.morphs[i],m=f.elements;if(0===f.type)for(var g=0,v=m.length;g<v;g++){var y=t.morphs[m[g].index];8===y.type&&p(y.elements,r)}else 8===f.type&&p(m,r)}}return r},_getTGALoader:function(){if(null===this.tgaLoader){if(void 0===j)throw new Error("THREE.MMDLoader: Import TGALoader");this.tgaLoader=new j(this.manager)}return this.tgaLoader},_isDefaultToonTexture:function(t){return 10===t.length&&/toon(10|0[0-9])\.bmp/.test(t)},_loadTexture:function(t,r,n,i,o){var a,s=this;if(!0===(n=n||{}).isDefaultToonTexture){var l;try{l=parseInt(t.match(/toon([0-9]{2})\.bmp$/)[1])}catch(e){console.warn("THREE.MMDLoader: "+t+" seems like a not right default texture path. Using toon00.bmp instead."),l=0}a=e[l]}else a=this.resourcePath+t;if(void 0!==r[a])return r[a];var u=this.manager.getHandler(a);null===u&&(u=".tga"===t.slice(-4).toLowerCase()?this._getTGALoader():this.textureLoader);var h=u.load(a,(function(t){!0===n.isToonTexture&&(t.image=s._getRotatedImage(t.image),t.magFilter=c.NearestFilter,t.minFilter=c.NearestFilter),t.flipY=!1,t.wrapS=c.RepeatWrapping,t.wrapT=c.RepeatWrapping;for(var e=0;e<h.readyCallbacks.length;e++)h.readyCallbacks[e](h);delete h.readyCallbacks}),i,o);return!0===n.sphericalReflectionMapping&&(h.mapping=c.SphericalReflectionMapping),h.readyCallbacks=[],r[a]=h,h},_getRotatedImage:function(t){var e=document.createElement("canvas"),r=e.getContext("2d"),n=t.width,i=t.height;return e.width=n,e.height=i,r.clearRect(0,0,n,i),r.translate(n/2,i/2),r.rotate(.5*Math.PI),r.translate(-n/2,-i/2),r.drawImage(t,0,0),r.getImageData(0,0,n,i)},_checkImageTransparency:function(t,e,r){t.readyCallbacks.push((function(n){function i(t,e){var r=t.width,n=t.height,i=Math.round(e.x*r)%r,o=Math.round(e.y*n)%n;i<0&&(i+=r),o<0&&(o+=n);var a=o*r+i;return t.data[4*a+3]}var o=void 0!==n.image.data?n.image:function(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var r=e.getContext("2d");return r.drawImage(t,0,0),r.getImageData(0,0,e.width,e.height)}(n.image),a=e.groups[r];(function(t,e,r){var n=t.width,o=t.height;if(t.data.length/(n*o)!=4)return!1;for(var a=0;a<r.length;a+=3){for(var s={x:0,y:0},l=0;l<3;l++){var c=r[3*a+l],u={x:e[2*c+0],y:e[2*c+1]};if(i(t,u)<253)return!0;s.x+=u.x,s.y+=u.y}if(s.x/=3,s.y/=3,i(t,s)<253)return!0}return!1})(o,e.attributes.uv.array,e.index.array.slice(a.start,a.start+a.count))&&(t.transparent=!0)}))}},o.prototype={constructor:o,build:function(t,e){for(var r=this.buildSkeletalAnimation(t,e).tracks,n=this.buildMorphAnimation(t,e).tracks,i=0,o=n.length;i<o;i++)r.push(n[i]);return new c.AnimationClip("",-1,r)},buildSkeletalAnimation:function(t,e){function r(t,e,r){t.push(e[r+0]/127),t.push(e[r+8]/127),t.push(e[r+4]/127),t.push(e[r+12]/127)}for(var n=[],i={},o=e.skeleton.bones,a={},s=0,l=o.length;s<l;s++)a[o[s].name]=!0;for(s=0;s<t.metadata.motionCount;s++){var u=t.motions[s],h=u.boneName;void 0!==a[h]&&(i[h]=i[h]||[],i[h].push(u))}for(var p in i){var d=i[p];d.sort((function(t,e){return t.frameNum-e.frameNum}));var f=[],m=[],g=[],v=[],y=[],_=e.skeleton.getBoneByName(p).position.toArray();for(s=0,l=d.length;s<l;s++){var b=d[s].frameNum/30,x=d[s].position,w=d[s].rotation,E=d[s].interpolation;f.push(b);for(var M=0;M<3;M++)m.push(_[M]+x[M]);for(M=0;M<4;M++)g.push(w[M]);for(M=0;M<3;M++)r(v,E,M);r(y,E,3)}var S=".bones["+p+"]";n.push(this._createTrack(S+".position",c.VectorKeyframeTrack,f,m,v)),n.push(this._createTrack(S+".quaternion",c.QuaternionKeyframeTrack,f,g,y))}return new c.AnimationClip("",-1,n)},buildMorphAnimation:function(t,e){for(var r=[],n={},i=e.morphTargetDictionary,o=0;o<t.metadata.morphCount;o++){var a=t.morphs[o],s=a.morphName;void 0!==i[s]&&(n[s]=n[s]||[],n[s].push(a))}for(var l in n){var u=n[l];u.sort((function(t,e){return t.frameNum-e.frameNum}));for(var h=[],p=[],d=(o=0,u.length);o<d;o++)h.push(u[o].frameNum/30),p.push(u[o].weight);r.push(new c.NumberKeyframeTrack(".morphTargetInfluences["+i[l]+"]",h,p))}return new c.AnimationClip("",-1,r)},buildCameraAnimation:function(t){function e(t,e){t.push(e.x),t.push(e.y),t.push(e.z)}function r(t,e,r){t.push(e[4*r+0]/127),t.push(e[4*r+1]/127),t.push(e[4*r+2]/127),t.push(e[4*r+3]/127)}var n=[],i=void 0===t.cameras?[]:t.cameras.slice();i.sort((function(t,e){return t.frameNum-e.frameNum}));for(var o,a,s=[],l=[],u=[],h=[],p=[],d=[],f=[],m=[],g=[],v=new c.Quaternion,y=new c.Euler,_=new c.Vector3,b=new c.Vector3,x=0,w=i.length;x<w;x++){var E=i[x],M=E.frameNum/30,S=E.position,T=E.rotation,A=E.distance,C=E.fov,P=E.interpolation;s.push(M),_.set(0,0,-A),b.set(S[0],S[1],S[2]),y.set(-T[0],-T[1],-T[2]),v.setFromEuler(y),_.add(b),_.applyQuaternion(v),e(l,b),(o=u).push((a=v).x),o.push(a.y),o.push(a.z),o.push(a.w),e(h,_),p.push(C);for(var O=0;O<3;O++)r(d,P,O);r(f,P,3);for(O=0;O<3;O++)r(m,P,4);r(g,P,5)}return(n=[]).push(this._createTrack("target.position",c.VectorKeyframeTrack,s,l,d)),n.push(this._createTrack(".quaternion",c.QuaternionKeyframeTrack,s,u,f)),n.push(this._createTrack(".position",c.VectorKeyframeTrack,s,h,m)),n.push(this._createTrack(".fov",c.NumberKeyframeTrack,s,p,g)),new c.AnimationClip("",-1,n)},_createTrack:function(t,e,r,n,i){if(r.length>2){r=r.slice(),n=n.slice(),i=i.slice();for(var o=n.length/r.length,s=i.length/r.length,l=1,c=2,u=r.length;c<u;c++){for(var h=0;h<o;h++)if(n[l*o+h]!==n[(l-1)*o+h]||n[l*o+h]!==n[c*o+h]){l++;break}if(c>l){r[l]=r[c];for(h=0;h<o;h++)n[l*o+h]=n[c*o+h];for(h=0;h<s;h++)i[l*s+h]=i[c*s+h]}}r.length=l+1,n.length=(l+1)*o,i.length=(l+1)*s}var p=new e(t,r,n);return p.createInterpolant=function(t){return new a(this.times,this.values,this.getValueSize(),t,new Float32Array(i))},p}},a.prototype=Object.assign(Object.create(c.Interpolant.prototype),{constructor:a,interpolate_:function(t,e,r,n){var i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,s=this.interpolationParams,l=t*a,u=l-a,h=n-e<.05?0:(r-e)/(n-e);if(4===a){var p=s[4*t+0],d=s[4*t+1],f=s[4*t+2],m=s[4*t+3],g=this._calculate(p,d,f,m,h);c.Quaternion.slerpFlat(i,0,o,u,o,l,g)}else if(3===a)for(var v=0;v!==a;++v){p=s[12*t+4*v+0],d=s[12*t+4*v+1],f=s[12*t+4*v+2],m=s[12*t+4*v+3],g=this._calculate(p,d,f,m,h);i[v]=o[u+v]*(1-g)+o[l+v]*g}else{p=s[4*t+0],d=s[4*t+1],f=s[4*t+2],m=s[4*t+3],g=this._calculate(p,d,f,m,h);i[0]=o[u]*(1-g)+o[l]*g}return i},_calculate:function(t,e,r,n,i){for(var o,a,s,l=.5,c=l,u=1-c,h=Math,p=0;p<15;p++){var d=(o=3*u*u*c)*t+(a=3*u*c*c)*e+(s=c*c*c)-i;if(h.abs(d)<1e-5)break;l/=2,u=1-(c+=d<0?l:-l)}return o*r+a*n+s}}),t}();c=o("g71hk");class Y{static get(t){return this._data[t]}static add(t,e){return this._data[t]=e,e}}Y._data={};class X{static _initCanvas(t,e=-1){this._can||(this._can=document.createElement("canvas"),this._ctx=this._can.getContext("2d")),0<e?(this._can.width=t,this._can.height=e,this._ctx.clearRect(0,0,t,e)):(this._can.width=this._can.height=t,this._ctx.clearRect(0,0,t,t))}static getTone(t=5){var e="tone_"+t;if(Y.get(e))return Y.get(e);this._initCanvas(t,1);this._can;for(var r=this._ctx,n=0;n<t;n++){var i=Math.ceil(n/(t-1)*105+150).toString(16);i.length<2&&(i="0"+i),r.fillStyle="#"+i+i+i,r.fillRect(n,0,1,1)}r.fill();var o=new c.Texture(r.getImageData(0,0,t,1));return o.minFilter=c.NearestFilter,o.magFilter=c.NearestFilter,o.needsUpdate=!0,Y.add(e,o),o}static getText(t="あ",e="sans-serif"){var r="tex_ly_"+t+"_"+e;if(Y.get(r))return Y.get(r);var n=512;this._initCanvas(n);this._can;var i=this._ctx;i.globalCompositeOperation="source-over",i.clearRect(0,0,n,n),i.textAlign="center",i.fillStyle="#ffffff",i.font="bold 480px "+e,i.fillText(t,256,433.6);var o=new c.Texture(i.getImageData(0,0,n,n));return o.needsUpdate=!0,Y.add(r,o),o}}c=o("g71hk");class J extends class{constructor(t=null,e=null){t||(t=new c.Object3D),this._target=t,e?(this._parent=e,this._parent.add(this._target)):this._parent=t.parent}setPosVec(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}setPos(t,e,r){return this.x=t,this.y=e,this.z=r,this}setRot(t,e,r){return this.rotationX=t,this.rotationY=e,this.rotationZ=r,this}getPos(){return this._target.position.clone()}getRot(){return this._target.rotation}get2D(t,e=null,r=1280,n=720){var i=.5*r,o=.5*n,a=this._target.position.clone();return e&&a.add(e),a.project(t),a.x=Math.round((a.x+1)*i),a.y=Math.round((1-a.y)*o),new c.Vector2(a.x,a.y)}get parent(){return this._parent}get target(){return this._target}get x(){return this._target.position.x}get y(){return this._target.position.y}get z(){return this._target.position.z}get rotationX(){return this._target.rotation.x}get rotationY(){return this._target.rotation.y}get rotationZ(){return this._target.rotation.z}get scale(){return this._target.scale.x}get scaleX(){return this._target.scale.x}get scaleY(){return this._target.scale.y}get scaleZ(){return this._target.scale.z}get visible(){return this._target.visible}set x(t){this._target.position.x=t}set y(t){this._target.position.y=t}set z(t){this._target.position.z=t}set rotationX(t){this._target.rotation.x=t}set rotationY(t){this._target.rotation.y=t}set rotationZ(t){this._target.rotation.z=t}set scale(t){t=this._checkScale(t),this._target.scale.set(t,t,t)}set scaleX(t){t=this._checkScale(t),this._target.scale.x=t}set scaleY(t){t=this._checkScale(t),this._target.scale.y=t}set scaleZ(t){t=this._checkScale(t),this._target.scale.z=t}set visible(t){this._target.visible=t}_checkScale(t){return 0==t&&(t=.001),t}get renderOrder(){return this._target.renderOrder}set renderOrder(t){this._target.renderOrder=t}}{constructor(t,e=null){if(super(t,e),t.geometry)try{this._mesh=t}catch(t){}t.geometry&&(this._geometry=t.geometry),t.material&&(this._material=t.material,this._matTotal=this._material.length,this._matTotal||(this._map=this._material.map,this._color=this._material.color,this._matTotal=1))}centerTrans(t=0,e=0,r=0){this._geometry&&this._geometry.applyMatrix4((new c.Matrix4).makeTranslation(t,e,r))}updateTexture(t,e=!1){if(1<this._matTotal)for(var r=0;r<this._matTotal;r++)this._updateTexture(this._material[r],t,e);else this._updateTexture(this._material,t,e)}_updateTexture(t,e,r=!1){t.map=e,t.needsUpdate=!0,this._map=t.map,t.blending=r?c.AdditiveBlending:c.NormalBlending}get mesh(){return this._mesh}get geometry(){return this._geometry}get material(){return this._material}get texOffsetX(){return this._map.offset.x}get texOffsetY(){return this._map.offset.y}set texOffsetX(t){this._map.offset.x=t}set texOffsetY(t){this._map.offset.y=t}get texRepeatX(){return this._map.repeat.x}get texRepeatY(){return this._map.repeat.y}set texRepeatX(t){this._map.repeat.x=t}set texRepeatY(t){this._map.repeat.y=t}get color(){return this._color.getHex()}set color(t){this._color.setHex(t)}}class Z extends J{constructor(t,e,r=1,n=1,i=1,o=1,a=!0){var s=["Plane",r,n,i,o].join("_"),l=Y.get(s)&&a?Y.get(s):Y.add(s,new c.PlaneBufferGeometry(r,n,i,o)),u=new c.Mesh(l,e);super(u,t),this._mesh=u}}class K extends J{constructor(t,e,r,n,i,o=1,a=1,s=1,l=!0){var u=["Cube",r,n,i,o,a,s].join("_"),h=Y.get(u)&&l?Y.get(u):Y.add(u,new c.BoxBufferGeometry(r,n,i,o,a,s)),p=new c.Mesh(h,e);super(p,t),this._mesh=p}}class Q extends J{constructor(t,e,r,n=8,i=6,o=!0){var a=["Sphere",r,n,i].join("_"),s=Y.get(a)&&o?Y.get(a):Y.add(a,new c.SphereBufferGeometry(r,n,i)),l=new c.Mesh(s,e);super(l,t),this._mesh=l}}class $ extends J{constructor(t,e,r,n,i,o=8,a=1,s=!1,l=!0){var u=["Cylinder",r,n,i,o,a].join("_"),h=Y.get(u)&&l?Y.get(u):Y.add(u,new c.CylinderBufferGeometry(r,n,i,o,a,s)),p=new c.Mesh(h,e);super(p,t),this._mesh=p}}class tt extends J{constructor(t,e,r,n=2,i=8,o=8,a=!0){var s=["Torus",r,n,o,i].join("_"),l=Y.get(s)&&a?Y.get(s):Y.add(s,new c.TorusBufferGeometry(r,n,o,i)),u=new c.Mesh(l,e);super(u,t),this._mesh=u}}class et extends J{constructor(t,e,r,n=0,i=!0){var o=["Tetrahedron",r,n].join("_"),a=Y.get(o)&&i?Y.get(o):Y.add(o,new c.TetrahedronBufferGeometry(r,n)),s=new c.Mesh(a,e);super(s,t),this._mesh=s}}c=o("g71hk");class rt{static getToon(t,e=5){var r="mat_"+t+"_"+e;if(Y.get(r))return Y.get(r);var n=new c.MeshToonMaterial({color:t,gradientMap:X.getTone(e),shininess:0});return Y.add(r,n),n}}class nt{constructor(t){var e=this._mat=rt.getToon(13421789,3);this._updateColor();var r=new tt(t,e,5,.15,6,4);r.rotationX=b.toRad(90),r.y=-.3;var n=new $(t,e,3,3,.2,6,1);n.y=-.2,n.rotationY=b.toRad(36),new $(t,e,1.4,1.4,.1,24,1).y=-.05,this._torus=r,this._cylinder=n,_.player.addParameterUpdateListener(((t,e)=>this._parameterUpdate(t,e)))}_parameterUpdate(t,e){"BgColor"==t&&this._updateColor()}_updateColor(){this._mat.color.set(_.parameter.bgColor);var t=this._mat.color,e=.1<t.r?t.r-.1:t.r+.1,r=.1<t.g?t.g-.1:t.g+.1,n=.1<t.b?t.b-.1:t.b+.1;this._mat.color.setRGB(e,r,n)}update(t){this._torus.rotationZ=t/1e3,this._cylinder.rotationY=t/1e3+b.toRad(36)}}class it{static getLipId(t,e=0){if(!this._txToIdObj){for(var r={},n="あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゐゆゑよわいうえをがぎぐげござじずぜぞだぢづでどばびぶべぼぱぴぷぺぽアイウエオカキクケコサシスセソタチツテトナニヌネノマミムメモヤヰユヱヨワイウエヲガギグゲゴザジズゼゾダヂヅデドバビブベボパピプペポ",i=0,o=n.length;i<o;i++)r[n.charAt(i)]=i%5+this.LIP_A;this._txToIdObj=r}return this._txToIdObj[t]?this._txToIdObj[t]:Math.floor(t.charCodeAt(0)+e)%5+it.LIP_A}}it.LIP_A=9,it.LIP_I=10,it.LIP_U=11,it.LIP_E=12,it.LIP_O=13,it.MABATAKI=1,it.NEKOMIMI=18;class ot{constructor(t){this._modelId=-1,this._loadedFlags=[],this._meshList=[],this._motionMngList=[],this._motionId=-1,this._parent=t,this._modelStand=new nt(t),_.player.addParameterUpdateListener(((t,e)=>this._parameterUpdate(t,e)))}_parameterUpdate(t,e){"Model"==t&&this.load(e)}load(t){if(this._modelId!=t){if(this._modelId=t,this._loadedFlags[t]){if(this._meshList[t]){for(var e=0;e<5;e++)e!=this._modelId&&this._meshList[e]&&(this._meshList[e].visible=!1);this._mesh=this._meshList[t],this._motionMng=this._motionMngList[t],this._mesh.visible=!0,this._motionMng.change(this._motionId)}}else{this._loadedFlags[t]=!0;var r=y.getModelPath(t);(new q).load(r,(e=>this._complete(e,t)),(e=>this._progress(e,t)),(e=>this._error(e,t)))}return this}}update(t){if(this._motionMng){var e=t.beatProgress+t.beat.index+_.player.beatOffset;this._motionMng.update(e,t.now),this._modelStand.update(t.now),this._updateMorph(t),this._lipSync(t)}}_updateMorph(t){if(this._mesh.morphTargetInfluences[it.NEKOMIMI]=_.parameter.nekomimi?1:0,b.seed=t.beat.index+t.beat.startTime+_.parameter.seed,b.random()<.08){var e=t.now-t.beat.startTime,r=1-Math.min(Math.abs(e/150-1),1);this._mesh.morphTargetInfluences[it.MABATAKI]=r}}_lipSync(t){for(var e=_.player.lyric,r=e.list,n=it.LIP_A;n<=it.LIP_A+5;n++)this._mesh.morphTargetInfluences[n]=0;for(n=0;n<e.total;n++){var i=r[n];if(t&&i.startTime<=t.now&&t.now<i.endTime-100){var o=it.getLipId(i.text,i.startTime);this._mesh.morphTargetInfluences[o]=1;break}}}changeMotion(t){this._motionId=t,this._motionMng&&this._motionMng.change(this._motionId)}_complete(t,e){for(var r=t,n=r.material,i=0;i<n.length;i++){var o=n[i],a=new c.MeshToonMaterial({map:o.map,skinning:!0,morphTargets:!0,transparent:!0,gradientMap:X.getTone(5),side:c.DoubleSide,shininess:0});r.material[i]=a}this._parent.add(r);var s=new N(r,new S(e));if(this._meshList[e]=r,this._motionMngList[e]=s,e==this._modelId){for(i=0;i<5;i++)i!=this._modelId&&this._meshList[i]&&(this._meshList[i].visible=!1);this._mesh=r,this._motionMng=s,this._motionMng.change(this._motionId)}else r.visible=!1}_progress(t,e){}_error(t,e){setTimeout((()=>this._retry(e)),2e3)}_retry(t){var e=y.getModelPath(t);(new q).load(e,(e=>this._complete(e,t)),(e=>this._progress(e,t)),(e=>this._error(e,t)))}}c=o("g71hk");class at{constructor(){_.player.addParameterUpdateListener(((t,e)=>this._parameterUpdate(t,e)))}init(t,e,r){if(this._scene=e,!this._mat){var n=this._mat=new c.MeshBasicMaterial({map:X.getText(t.text,_.parameter.fontName),color:_.parameter.fontColor,side:c.DoubleSide,transparent:!0});n.depthTest=!1,this._plane=new Z(e,n,1,1)}this._plane.visible=!1,this._cdata=t,this._cameraMng=r,this._mat.map=X.getText(t.text,_.parameter.fontName),this._mat.needsUpdate=!0,this._line&&this._line.dispose(),this._line=null}_parameterUpdate(t,e){"FontStyle"==t&&(this._mat.map=X.getText(this._cdata.text,_.parameter.fontName),this._mat.needsUpdate=!0),"FontColor"==t&&(this._mat.color.set(_.parameter.fontColor),this._line&&this._line.changeColor(_.parameter.fontColor))}_calcCameraPos(t,e,r,n=null){var i=n;n||(i=this._cdata),b.seed=i.startTime+_.parameter.seed;var o=(t,e)=>b.rand(t,e),a=(t,e)=>b.randInt(t,e),s=1-i.progressHead(t),l=i.progressTail(t),u=i.progress(t),h=.3*(r.x-e.x)+e.x+o(-2,2)+u*o(-2,2)+o(-2,2)*Math.sin(t/a(387,787)),p=.3*(r.z-e.z)+e.z+o(-2,2)+u*o(-2,2)+o(-2,2)*Math.sin(t/a(387,787)),d=.3*(r.y-e.y)+e.y-25*M.easeInQuart(s)+25*M.easeInQuart(l)+12*u-6;return new c.Vector3(h,d,p)}_createLine(t){if(this._cdata.next){var e=this._cdata;if(e.options.start=e.endTime+-600,e.options.end=e.next.startTime+-100,e.options.dtime=e.options.end-e.options.start,!(t<e.options.start||e.options.end<=t||2e3<=e.options.dtime)){var r=e.options.start,n=this._cameraMng.getCameraPos(r),i=this._cameraMng.getTargetPos(r),o=this._calcCameraPos(r,n,i);r=e.options.end,n=this._cameraMng.getCameraPos(r),i=this._cameraMng.getTargetPos(r);for(var a=this._calcCameraPos(r,n,i,e.next),s=a.clone().sub(o),l=[o],u=0;u<3;u++)l.push(new c.Vector3(b.rand(-4,4)+o.x+s.x*u/3,b.rand(-4,4)+o.y+s.y*u/3,b.rand(-4,4)+o.z+s.z*u/3));l.push(a),this._line=new w(this._scene),this._line.create({points:l,color:_.parameter.fontColor,division:48,width:.35,dashRatio:.7})}}}update(t){var e=this._plane,r=this._cdata;if(r.startTime-r.head<=t.now&&t.now<r.endTime+r.tail){e.visible=!0;var n=t.now,i=this._cameraMng.getCameraPos(),o=this._cameraMng.getTargetPos(),a=this._cameraMng.getUpPos(),s=this._calcCameraPos(n,i,o);if(e.setPos(s.x,s.y,s.z),e.target.up.set(a.x,a.y,a.z),e.target.lookAt(i),e.rotationX+=b.rand(-.5,.5)*Math.sin(n/b.randInt(387,787)),e.rotationZ+=b.rand(-.5,.5)*Math.sin(n/b.randInt(387,787)),e.scale=1.35*M.easeOutBack(this._cdata.progressHead(n,2e3)),this._line||this._createLine(n),this._line)if(r.next&&r.options.start<=n&&n<r.options.end){this._line.show();var l=Math.min((n-r.options.start)/r.options.dtime,1);this._line.progress=l}else this._line.hide()}else e.visible=!1,this._line&&this._line.hide()}}class st{constructor(t,e){this._lyrics=[],this._scene=t,this._cameraMng=e}init(){for(var t=_.player.lyric,e=t.list,r=0;r<t.total;r++){this._lyrics[r]||(this._lyrics[r]=new at);var n=e[r];this._lyrics[r].init(n,this._scene,this._cameraMng)}}update(t){for(var e=_.player.lyric,r=(e.list,0);r<e.total;r++){this._lyrics[r].update(t)}}}c=o("g71hk");class lt extends k{constructor(t){super(t)}show(t=0){super.show(t),this._cameraMng.setup(this._getRandomCameraMotion()),this._mmdMng.changeMotion(I.getRandom()),this._total=32;for(var e=0;e<this._total;e++){var r;r=this._lines[e]?this._lines[e]:new w(this._parent);for(var n=[],i=b.toRad(30),o=b.rand(6,32),a=0;a<13;a++){var s=i*a,l=Math.cos(s)*o,u=Math.sin(s)*o;n[a]=new c.Vector3(l,0,u)}r.create({points:n,color:this._getColor(),division:36,width:b.rand(.8,1.2),dashRatio:b.rand(.6,.9),widthCallback:function(t){return 1}});r.x=r.z=0,r.y=b.rand(-30,30)+5,r.rotationY=b.rand(0,b.toRad(360)),r.show(),this._lines[e]=r}}update(t){super.update(t);for(var e=0;e<this._total;e++)this._lines[e].progress=(t.now+95*e)/(400+10*e),this._lines[e].rotationY=(t.now+111*e)/500}}c=o("g71hk");class ct extends k{constructor(t){super(t)}show(t=0){super.show(t),this._cameraMng.setup(this._getRandomCameraMotion()),this._mmdMng.changeMotion(I.getRandom()),this._total=16;for(var e=0;e<this._total;e++){var r;r=this._lines[e]?this._lines[e]:new w(this._parent);for(var n=[],i=b.randInt(5,13),o=b.toRad(360/(i-1)),a=b.rand(6,32),s=0;s<i;s++){var l=o*s,u=Math.cos(l)*a,h=Math.sin(l)*a;n[s]=new c.Vector3(u,0,h)}r.create({points:n,color:this._getColor(),division:i,width:b.rand(1.2,5.6),dashRatio:b.rand(.6,.9),widthCallback:function(t){return 1}});var p=b.rand(3,30);r.x=r.z=0,r.y=b.random()<.5?p+5:5-p,r.rotationY=b.rand(0,b.toRad(360)),r.show(),this._lines[e]=r}}update(t){super.update(t);var e=t.beatProgress+_.player.beatOffset,r=e%1;if(t.beat.duration<=600&&t.beat.length%2==0){var n=t.beat.position;0<_.player.beatOffset&&e<1&&(n+=1),r=(r+n%2)/2}for(var i=0;i<this._total;i++)this._lines[i].progress=M.easeInOutSine(r)}}c=o("g71hk");class ut extends D{constructor(t){super(t),this._objs=[],this._total=0,_.player.addParameterUpdateListener(((t,e)=>this._parameterUpdate(t,e)))}_parameterUpdate(t,e){if(this._isActive)switch(t){case"Color1":case"Color2":case"Color3":case"Color4":for(var r=0;r<this._total;r++)this._objs[r].mesh.material=rt.getToon(this._getColor(),3),this._objs[r].mesh.material.needsUpdate=!0}}_getColor(){return _.parameter.colors[b.randInt(0,3)]}_getRandom(){var t,e=rt.getToon(this._getColor(),3),r=this._parent;switch(b.randInt(0,3)){case 0:t=new K(r,e,2,2,2);break;case 1:t=new Q(r,e,1,12,10);break;case 2:t=new tt(r,e,1,.3,8,b.randInt(3,6));break;case 3:t=new et(r,e,1,0)}return t}show(t=0){this._kill(),super.show(t)}hide(){this._kill(),super.hide()}_kill(){for(var t=0;t<this._total;t++){var e=this._objs[t];e.parent.remove(e.mesh),this._objs[t]=null,delete this._objs[t]}this._objs=[],this._total=0}}class ht extends ut{constructor(t){super(t),this._positions=[]}show(t=0){super.show(t),this._cameraMng.setup(this._getRandomCameraMotion()),this._mmdMng.changeMotion(I.getRandom()),this._total=72;for(var e=0;e<this._total;e++){var r=this._getRandom();r.scale=b.rand(1.2,2.8);var n=b.rand(2,25),i=b.rand(2,25);r.x=n=b.random()<.5?n:-n,r.z=i=b.random()<.5?i:-i,this._positions[e]||(this._positions[e]=new c.Vector3),this._positions[e].set(n,0,i),this._objs[e]=r}}update(t){super.update(t);for(var e=0;e<this._total;e++){this._objs[e].y=(t.now+155*e)%3600/3600*140-70,this._objs[e].x=this._positions[e].x+2*Math.sin((t.now+123*e)/500),this._objs[e].z=this._positions[e].z+2*Math.sin((t.now+111*e)/600),this._objs[e].rotationX=(t.now+111*e)/432,this._objs[e].rotationZ=(t.now+123*e)/489}}}class pt extends ut{constructor(t){super(t),this._posys=[],this._radiuses=[],this._offsetRads=[]}show(t=0){super.show(t),this._cameraMng.setup(this._getRandomCameraMotion()),this._mmdMng.changeMotion(I.getRandom()),this._total=72;for(var e=0;e<this._total;e++){var r=this._getRandom();r.scale=b.rand(.5,2.4);var n=b.rand(2,25);n=b.random()<.5?n:-n;var i=b.rand(6,36);this._radiuses[e]=i,this._posys[e]=n,this._offsetRads[e]=b.rand(0,2*Math.PI),this._objs[e]=r}}update(t){super.update(t);for(var e=0;e<this._total;e++){var r=this._radiuses[e]+2*Math.sin((t.now+97*e)/543),n=(t.now+97*e)/(432+7*e)+this._offsetRads[e],i=Math.cos(n)*r,o=Math.sin(n)*r;this._objs[e].x=i,this._objs[e].z=o,this._objs[e].y=this._posys[e]+3*Math.sin((t.now+111*e)/600),this._objs[e].rotationX=(t.now+111*e)/432,this._objs[e].rotationZ=(t.now+123*e)/489}}}c=o("g71hk");class dt extends ut{constructor(t){super(t),this._positions=[],this._posDiffPres=[],this._posDiffNows=[],this._scales=[]}show(t=0){super.show(t),this._cameraMng.setup(this._getRandomCameraMotion()),this._mmdMng.changeMotion(I.getRandom()),this._total=72;for(var e=0;e<this._total;e++){var r=this._getRandom();this._scales[e]=b.rand(.6,2.8);var n=b.rand(3,25),i=b.rand(3,25),o=b.rand(3,25);n=b.random()<.5?n:-n,i=b.random()<.5?i:-i,o=b.random()<.5?o:-o,this._positions[e]||(this._positions[e]=new c.Vector3,this._posDiffPres[e]=new c.Vector3,this._posDiffNows[e]=new c.Vector3),this._positions[e].set(n,i,o),this._objs[e]=r}}update(t){super.update(t);var e=t.beatProgress+_.player.beatOffset+.45,r=e%1,n=t.beat;0<_.player.beatOffset+.45&&e<1&&n.previous&&(n=n.previous),this._calcPositions(this._posDiffPres,n.previous?n.previous.startTime+12345:12345),this._calcPositions(this._posDiffNows,n.startTime+12345);for(var i=M.easeOutBack(Math.min(1.5*r,1)),o=1-i,a=M.easeOutBack(r),s=n.index,l=o,c=0;c<this._total;c++){var u=this._objs,h=this._positions,p=this._posDiffPres[c],d=this._posDiffNows[c];u[c].x=h[c].x+p.x*o+d.x*i,u[c].y=h[c].y+p.y*o+d.y*i,u[c].z=h[c].z+p.z*o+d.z*i,u[c].rotationX=(a+s)*(.611+.0023*c),u[c].rotationY=(a+s)*(.639+.0011*c),u[c].scale=this._scales[c]+1*l}}_calcPositions(t,e){b.seed=e;for(var r=0;r<this._total;r++){t[r].set(b.rand(-3,3),b.rand(-3,3),b.rand(-3,3))}}}class ft{constructor(t,e){this._nowId=-1,this._sceneIds=[],this._scene=t,this._camera=e,_.player.addParameterUpdateListener(((t,e)=>this._parameterUpdate(t,e)))}load(t){this._cameraMng||(this._cameraMng=new F(this._camera),this._mmdMng=new ot(this._scene),this._lyricMng=new st(this._scene,this._cameraMng)),this._mmdMng.load(t)}ready(){this._scenes||(this._scenes=[new U(this._scene).init(this._cameraMng,this._mmdMng),new lt(this._scene).init(this._cameraMng,this._mmdMng),new ct(this._scene).init(this._cameraMng,this._mmdMng),new ht(this._scene).init(this._cameraMng,this._mmdMng),new pt(this._scene).init(this._cameraMng,this._mmdMng),new dt(this._scene).init(this._cameraMng,this._mmdMng)]),this._lyricMng.init(),this._initSceneIds()}_initSceneIds(){var t;0<=this._nowId&&this._scenes[this._nowId].hide(),this._nowId=-1,t=_.player.video?_.player.video.duration+_.parameter.seed:12345+_.parameter.seed,b.seed=t;for(var e=this._scenes.length,r=_.player.segList.length,n=0;n<r;n++){var i=b.randInt(0,e-1);1<=n&&this._sceneIds[n-1]==i&&e<=++i&&(i=0),this._sceneIds[n]=i}}_parameterUpdate(t,e){"Seed"==t&&0<=this._nowId&&(this._initSceneIds(),this._scenes[this._nowId].show(this._calcSeed()))}update(t){this._data=t;var e=this._sceneIds[t.segId];e!=this._nowId&&(0<=this._nowId&&this._scenes[this._nowId].hide(),this._nowId=e,0<=this._nowId&&this._scenes[this._nowId].show(this._calcSeed())),this._scenes[this._nowId].update(t),this._lyricMng.update(t)}_calcSeed(){return this._data?Math.floor(this._data.segData.startTime+.5*this._data.segData.endTime+_.parameter.seed+12345):_.parameter.seed+12345}}class mt{constructor(){this.RGBShiftShader={uniforms:{tDiffuse:{type:"t",value:null},shiftR:{type:"v2",value:new c.Vector2(0,0)},shiftG:{type:"v2",value:new c.Vector2(0,0)},shiftB:{type:"v2",value:new c.Vector2(0,0)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","uniform vec2 shiftR;","uniform vec2 shiftG;","uniform vec2 shiftB;","void main() {","float r = texture2D(tDiffuse, vUv + shiftR).x;","float g = texture2D(tDiffuse, vUv + shiftG).y;","float b = texture2D(tDiffuse, vUv + shiftB).z;","vec4 tex = vec4(r,g,b,gl_FragColor.w);","gl_FragColor = tex;","}"].join("\n")};var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight,r=new c.PerspectiveCamera(45,t/e,.01,100),n=_.parameter.bgColor,i=new c.Scene;i.background=new c.Color(n),i.fog=new c.Fog(n,50,80);var o=this._view=document.getElementById("view"),a=new c.WebGLRenderer({antialias:!0,alpha:!1});a.setPixelRatio(window.devicePixelRatio),a.setSize(t,e),a.shadowMap.enabled=!0,o.appendChild(a.domElement),this._renderer=a,this._scene=i,this._camera=r;var s=new c.AmbientLight(4473924);i.add(s);var l=new c.DirectionalLight(13421772,1);l.position.set(1,0,1),i.add(l),this._passRGB=new p(this.RGBShiftShader),this._pass=new v(i,r),this._comp=new m(a),this._comp.passes=[this._pass]}getSize(t){var e=this._camera,r=_.stw/_.sth,n=e.position.x-t.x,i=e.position.y-t.y,o=e.position.z-t.z,a=Math.sqrt(n*n+i*i+o*o)*Math.tan(b.toRad(e.fov/2))*2;return{w:r*a,h:a}}ready(){this._sceneMng||(this._sceneMng=new ft(this._scene,this._camera),this._sceneMng.load(_.parameter.modelId),_.player.addParameterUpdateListener(((t,e)=>this._parameterUpdate(t,e)))),this._sceneMng.ready()}_updateEffect(t){var e=0,r=t.now-t.segData.startTime;if((r<0||200<r)&&(r=t.segData.endTime-t.now),0<=r&&r<=200){var n=Math.floor(5*(1-r/200));e=n/50,b.seed=n*(t.segData.startTime+_.parameter.seed+12345)+123}if(e<=0)this._pass.renderToScreen=!0,this._comp.passes=[this._pass];else{this._pass.renderToScreen=!1,this._passRGB.renderToScreen=!0,this._comp.passes=[this._pass,this._passRGB];var i=this._passRGB;i.uniforms.shiftR.value.set(b.random()<.5?e:-e,b.random()<.5?e:-e),i.uniforms.shiftG.value.set(b.random()<.5?e:-e,b.random()<.5?e:-e),i.uniforms.shiftB.value.set(b.random()<.5?e:-e,b.random()<.5?e:-e)}}update(t){if(0==t.segId||t.segId==_.player.segLen-1){var e=1,r=Math.min(2e3,t.segData.duration);if(0===t.segId)e=Math.min((t.now-t.segData.startTime)/r,1);else e=Math.min((t.segData.endTime-t.now)/r,1);this._view.style.opacity=e.toString()}else this._view.style.opacity="1";this._sceneMng.update(t),this._updateEffect(t),this._comp.render()}resize(){var t=_.stw,e=_.sth;this._camera.fov=t<e?56:45,this._camera.aspect=t/e,this._camera.updateProjectionMatrix(),this._renderer.setSize(t,e),this._comp.setSize(t,e),this._comp.render()}_parameterUpdate(t,e){if("BgColor"==t){var r=_.parameter.bgColor;this._scene.fog.color.set(r),this._scene.background.set(r);for(var n=r.toString(16),i=0,o=6-n.length;i<o;i++)n="0"+n;document.body.style.backgroundColor="#"+n}}}function gt(t,e){var r=t.__state.conversionName.toString(),n=Math.round(t.r),i=Math.round(t.g),o=Math.round(t.b),a=t.a,s=Math.round(t.h),l=t.s.toFixed(1),c=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===r||"SIX_CHAR_HEX"===r){for(var u=t.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===r?"rgb("+n+","+i+","+o+")":"CSS_RGBA"===r?"rgba("+n+","+i+","+o+","+a+")":"HEX"===r?"0x"+t.hex.toString(16):"RGB_ARRAY"===r?"["+n+","+i+","+o+"]":"RGBA_ARRAY"===r?"["+n+","+i+","+o+","+a+"]":"RGB_OBJ"===r?"{r:"+n+",g:"+i+",b:"+o+"}":"RGBA_OBJ"===r?"{r:"+n+",g:"+i+",b:"+o+",a:"+a+"}":"HSV_OBJ"===r?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===r?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}var vt=Array.prototype.forEach,yt=Array.prototype.slice,_t={BREAK:{},extend:function(t){return this.each(yt.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(r){this.isUndefined(e[r])||(t[r]=e[r])}.bind(this))}),this),t},defaults:function(t){return this.each(yt.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(r){this.isUndefined(t[r])&&(t[r]=e[r])}.bind(this))}),this),t},compose:function(){var t=yt.call(arguments);return function(){for(var e=yt.call(arguments),r=t.length-1;r>=0;r--)e=[t[r].apply(this,e)];return e[0]}},each:function(t,e,r){if(t)if(vt&&t.forEach&&t.forEach===vt)t.forEach(e,r);else if(t.length===t.length+0){var n,i=void 0;for(i=0,n=t.length;i<n;i++)if(i in t&&e.call(r,t[i],i)===this.BREAK)return}else for(var o in t)if(e.call(r,t[o],o)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,r){var n=void 0;return function(){var i=this,o=arguments;function a(){n=null,r||t.apply(i,o)}var s=r||!n;clearTimeout(n),n=setTimeout(a,e),s&&t.apply(i,o)}},toArray:function(t){return t.toArray?t.toArray():yt.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},bt=[{litmus:_t.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:gt},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:gt},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:gt},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:gt}}},{litmus:_t.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:_t.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:_t.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(_t.isNumber(t.r)&&_t.isNumber(t.g)&&_t.isNumber(t.b)&&_t.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(_t.isNumber(t.r)&&_t.isNumber(t.g)&&_t.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(_t.isNumber(t.h)&&_t.isNumber(t.s)&&_t.isNumber(t.v)&&_t.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(_t.isNumber(t.h)&&_t.isNumber(t.s)&&_t.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],xt=void 0,wt=void 0,Et=function(){wt=!1;var t=arguments.length>1?_t.toArray(arguments):arguments[0];return _t.each(bt,(function(e){if(e.litmus(t))return _t.each(e.conversions,(function(e,r){if(xt=e.read(t),!1===wt&&!1!==xt)return wt=xt,xt.conversionName=r,xt.conversion=e,_t.BREAK})),_t.BREAK})),wt},Mt=void 0,St={hsv_to_rgb:function(t,e,r){var n=Math.floor(t/60)%6,i=t/60-Math.floor(t/60),o=r*(1-e),a=r*(1-i*e),s=r*(1-(1-i)*e),l=[[r,s,o],[a,r,o],[o,r,s],[o,a,r],[s,o,r],[r,o,a]][n];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(t,e,r){var n=Math.min(t,e,r),i=Math.max(t,e,r),o=i-n,a=void 0;return 0===i?{h:NaN,s:0,v:0}:(a=t===i?(e-r)/o:e===i?2+(r-t)/o:4+(t-e)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/i,v:i/255})},rgb_to_hex:function(t,e,r){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,r)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,r){return r<<(Mt=8*e)|t&~(255<<Mt)}},Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},At=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Ct=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Pt=function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(n):void 0},Ot=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},Rt=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},Lt=function(){function t(){if(At(this,t),this.__state=Et.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return Ct(t,[{key:"toString",value:function(){return gt(this)}},{key:"toHexString",value:function(){return gt(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function It(t,e,r){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||Lt.recalculateRGB(this,e,r),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(Lt.recalculateRGB(this,e,r),this.__state.space="RGB"),this.__state[e]=t}})}function Nt(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||Lt.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(Lt.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}Lt.recalculateRGB=function(t,e,r){if("HEX"===t.__state.space)t.__state[e]=St.component_from_hex(t.__state.hex,r);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");_t.extend(t.__state,St.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},Lt.recalculateHSV=function(t){var e=St.rgb_to_hsv(t.r,t.g,t.b);_t.extend(t.__state,{s:e.s,v:e.v}),_t.isNaN(e.h)?_t.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},Lt.COMPONENTS=["r","g","b","h","s","v","hex","a"],It(Lt.prototype,"r",2),It(Lt.prototype,"g",1),It(Lt.prototype,"b",0),Nt(Lt.prototype,"h"),Nt(Lt.prototype,"s"),Nt(Lt.prototype,"v"),Object.defineProperty(Lt.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(Lt.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=St.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var Bt=function(){function t(e,r){At(this,t),this.initialValue=e[r],this.domElement=document.createElement("div"),this.object=e,this.property=r,this.__onChange=void 0,this.__onFinishChange=void 0}return Ct(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),Dt={};_t.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){_t.each(t,(function(t){Dt[t]=e}))}));var kt=/(\d+(\.\d+)?)px/;function Ut(t){if("0"===t||_t.isUndefined(t))return 0;var e=t.match(kt);return _t.isNull(e)?0:parseFloat(e[1])}var Ft={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,r){var n=r,i=e;_t.isUndefined(i)&&(i=!0),_t.isUndefined(n)&&(n=!0),t.style.position="absolute",i&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,r,n){var i=r||{},o=Dt[e];if(!o)throw new Error("Event type "+e+" not supported.");var a=document.createEvent(o);switch(o){case"MouseEvents":var s=i.x||i.clientX||0,l=i.y||i.clientY||0;a.initMouseEvent(e,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=a.initKeyboardEvent||a.initKeyEvent;_t.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(e,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:a.initEvent(e,i.bubbles||!1,i.cancelable||!0)}_t.defaults(a,n),t.dispatchEvent(a)},bind:function(t,e,r,n){var i=n||!1;return t.addEventListener?t.addEventListener(e,r,i):t.attachEvent&&t.attachEvent("on"+e,r),Ft},unbind:function(t,e,r,n){var i=n||!1;return t.removeEventListener?t.removeEventListener(e,r,i):t.detachEvent&&t.detachEvent("on"+e,r),Ft},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var r=t.className.split(/ +/);-1===r.indexOf(e)&&(r.push(e),t.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Ft},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var r=t.className.split(/ +/),n=r.indexOf(e);-1!==n&&(r.splice(n,1),t.className=r.join(" "))}else t.className=void 0;return Ft},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return Ut(e["border-left-width"])+Ut(e["border-right-width"])+Ut(e["padding-left"])+Ut(e["padding-right"])+Ut(e.width)},getHeight:function(t){var e=getComputedStyle(t);return Ut(e["border-top-width"])+Ut(e["border-bottom-width"])+Ut(e["padding-top"])+Ut(e["padding-bottom"])+Ut(e.height)},getOffset:function(t){var e=t,r={left:0,top:0};if(e.offsetParent)do{r.left+=e.offsetLeft,r.top+=e.offsetTop,e=e.offsetParent}while(e);return r},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},jt=function(t){function e(t,r){At(this,e);var n=Rt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),i=n;return n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox"),Ft.bind(n.__checkbox,"change",(function(){i.setValue(!i.__prev)}),!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return Ot(e,t),Ct(e,[{key:"setValue",value:function(t){var r=Pt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),r}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),Pt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Bt),Gt=function(t){function e(t,r,n){At(this,e);var i=Rt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),o=n,a=i;if(i.__select=document.createElement("select"),_t.isArray(o)){var s={};_t.each(o,(function(t){s[t]=t})),o=s}return _t.each(o,(function(t,e){var r=document.createElement("option");r.innerHTML=e,r.setAttribute("value",t),a.__select.appendChild(r)})),i.updateDisplay(),Ft.bind(i.__select,"change",(function(){var t=this.options[this.selectedIndex].value;a.setValue(t)})),i.domElement.appendChild(i.__select),i}return Ot(e,t),Ct(e,[{key:"setValue",value:function(t){var r=Pt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),r}},{key:"updateDisplay",value:function(){return Ft.isActive(this.__select)?this:(this.__select.value=this.getValue(),Pt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(Bt),zt=function(t){function e(t,r){At(this,e);var n=Rt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),i=n;function o(){i.setValue(i.__input.value)}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),Ft.bind(n.__input,"keyup",o),Ft.bind(n.__input,"change",o),Ft.bind(n.__input,"blur",(function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())})),Ft.bind(n.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return Ot(e,t),Ct(e,[{key:"updateDisplay",value:function(){return Ft.isActive(this.__input)||(this.__input.value=this.getValue()),Pt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Bt);function Vt(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var Ht=function(t){function e(t,r,n){At(this,e);var i=Rt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),o=n||{};return i.__min=o.min,i.__max=o.max,i.__step=o.step,_t.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=Vt(i.__impliedStep),i}return Ot(e,t),Ct(e,[{key:"setValue",value:function(t){var r=t;return void 0!==this.__min&&r<this.__min?r=this.__min:void 0!==this.__max&&r>this.__max&&(r=this.__max),void 0!==this.__step&&r%this.__step!=0&&(r=Math.round(r/this.__step)*this.__step),Pt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,r)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=Vt(t),this}}]),e}(Bt);var Wt=function(t){function e(t,r,n){At(this,e);var i=Rt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,n));i.__truncationSuspended=!1;var o=i,a=void 0;function s(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function l(t){var e=a-t.clientY;o.setValue(o.getValue()+e*o.__impliedStep),a=t.clientY}function c(){Ft.unbind(window,"mousemove",l),Ft.unbind(window,"mouseup",c),s()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),Ft.bind(i.__input,"change",(function(){var t=parseFloat(o.__input.value);_t.isNaN(t)||o.setValue(t)})),Ft.bind(i.__input,"blur",(function(){s()})),Ft.bind(i.__input,"mousedown",(function(t){Ft.bind(window,"mousemove",l),Ft.bind(window,"mouseup",c),a=t.clientY})),Ft.bind(i.__input,"keydown",(function(t){13===t.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,s())})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return Ot(e,t),Ct(e,[{key:"updateDisplay",value:function(){var t,r,n;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),r=this.__precision,n=Math.pow(10,r),Math.round(t*n)/n),Pt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Ht);function qt(t,e,r,n,i){return n+(t-e)/(r-e)*(i-n)}var Yt=function(t){function e(t,r,n,i,o){At(this,e);var a=Rt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r,{min:n,max:i,step:o})),s=a;function l(t){t.preventDefault();var e=s.__background.getBoundingClientRect();return s.setValue(qt(t.clientX,e.left,e.right,s.__min,s.__max)),!1}function c(){Ft.unbind(window,"mousemove",l),Ft.unbind(window,"mouseup",c),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function u(t){var e=t.touches[0].clientX,r=s.__background.getBoundingClientRect();s.setValue(qt(e,r.left,r.right,s.__min,s.__max))}function h(){Ft.unbind(window,"touchmove",u),Ft.unbind(window,"touchend",h),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),Ft.bind(a.__background,"mousedown",(function(t){document.activeElement.blur(),Ft.bind(window,"mousemove",l),Ft.bind(window,"mouseup",c),l(t)})),Ft.bind(a.__background,"touchstart",(function(t){if(1!==t.touches.length)return;Ft.bind(window,"touchmove",u),Ft.bind(window,"touchend",h),u(t)})),Ft.addClass(a.__background,"slider"),Ft.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return Ot(e,t),Ct(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",Pt(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Ht),Xt=function(t){function e(t,r,n){At(this,e);var i=Rt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r)),o=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===n?"Fire":n,Ft.bind(i.__button,"click",(function(t){return t.preventDefault(),o.fire(),!1})),Ft.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return Ot(e,t),Ct(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(Bt),Jt=function(t){function e(t,r){At(this,e);var n=Rt(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));n.__color=new Lt(n.getValue()),n.__temp=new Lt(0);var i=n;n.domElement=document.createElement("div"),Ft.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",Ft.bind(n.__input,"keydown",(function(t){13===t.keyCode&&h.call(this)})),Ft.bind(n.__input,"blur",h),Ft.bind(n.__selector,"mousedown",(function(){Ft.addClass(this,"drag").bind(window,"mouseup",(function(){Ft.removeClass(i.__selector,"drag")}))})),Ft.bind(n.__selector,"touchstart",(function(){Ft.addClass(this,"drag").bind(window,"touchend",(function(){Ft.removeClass(i.__selector,"drag")}))}));var o,a=document.createElement("div");function s(t){d(t),Ft.bind(window,"mousemove",d),Ft.bind(window,"touchmove",d),Ft.bind(window,"mouseup",c),Ft.bind(window,"touchend",c)}function l(t){f(t),Ft.bind(window,"mousemove",f),Ft.bind(window,"touchmove",f),Ft.bind(window,"mouseup",u),Ft.bind(window,"touchend",u)}function c(){Ft.unbind(window,"mousemove",d),Ft.unbind(window,"touchmove",d),Ft.unbind(window,"mouseup",c),Ft.unbind(window,"touchend",c),p()}function u(){Ft.unbind(window,"mousemove",f),Ft.unbind(window,"touchmove",f),Ft.unbind(window,"mouseup",u),Ft.unbind(window,"touchend",u),p()}function h(){var t=Et(this.value);!1!==t?(i.__color.__state=t,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function p(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function d(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__saturation_field.getBoundingClientRect(),r=t.touches&&t.touches[0]||t,n=r.clientX,o=r.clientY,a=(n-e.left)/(e.right-e.left),s=1-(o-e.top)/(e.bottom-e.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),i.__color.v=s,i.__color.s=a,i.setValue(i.__color.toOriginal()),!1}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__hue_field.getBoundingClientRect(),r=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return r>1?r=1:r<0&&(r=0),i.__color.h=360*r,i.setValue(i.__color.toOriginal()),!1}return _t.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),_t.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),_t.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),_t.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),_t.extend(a.style,{width:"100%",height:"100%",background:"none"}),Kt(a,"top","rgba(0,0,0,0)","#000"),_t.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(o=n.__hue_field).style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",_t.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),Ft.bind(n.__saturation_field,"mousedown",s),Ft.bind(n.__saturation_field,"touchstart",s),Ft.bind(n.__field_knob,"mousedown",s),Ft.bind(n.__field_knob,"touchstart",s),Ft.bind(n.__hue_field,"mousedown",l),Ft.bind(n.__hue_field,"touchstart",l),n.__saturation_field.appendChild(a),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay(),n}return Ot(e,t),Ct(e,[{key:"updateDisplay",value:function(){var t=Et(this.getValue());if(!1!==t){var e=!1;_t.each(Lt.COMPONENTS,(function(r){if(!_t.isUndefined(t[r])&&!_t.isUndefined(this.__color.__state[r])&&t[r]!==this.__color.__state[r])return e=!0,{}}),this),e&&_t.extend(this.__color.__state,t)}_t.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var r=this.__color.v<.5||this.__color.s>.5?255:0,n=255-r;_t.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+r+","+r+","+r+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Kt(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),_t.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+r+","+r+","+r+")",textShadow:this.__input_textShadow+"rgba("+n+","+n+","+n+",.7)"})}}]),e}(Bt),Zt=["-moz-","-o-","-webkit-","-ms-",""];function Kt(t,e,r,n){t.style.background="",_t.each(Zt,(function(i){t.style.cssText+="background: "+i+"linear-gradient("+e+", "+r+" 0%, "+n+" 100%); "}))}var Qt=function(t,e){var r=e||document,n=document.createElement("style");n.type="text/css",n.innerHTML=t;var i=r.getElementsByTagName("head")[0];try{i.appendChild(n)}catch(t){}},$t='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',te=function(t,e){var r=t[e];return _t.isArray(arguments[2])||_t.isObject(arguments[2])?new Gt(t,e,arguments[2]):_t.isNumber(r)?_t.isNumber(arguments[2])&&_t.isNumber(arguments[3])?_t.isNumber(arguments[4])?new Yt(t,e,arguments[2],arguments[3],arguments[4]):new Yt(t,e,arguments[2],arguments[3]):_t.isNumber(arguments[4])?new Wt(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Wt(t,e,{min:arguments[2],max:arguments[3]}):_t.isString(r)?new zt(t,e):_t.isFunction(r)?new Xt(t,e,""):_t.isBoolean(r)?new jt(t,e):null};var ee=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},re=function(){function t(){At(this,t),this.backgroundElement=document.createElement("div"),_t.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Ft.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),_t.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;Ft.bind(this.backgroundElement,"click",(function(){e.hide()}))}return Ct(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),_t.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",Ft.unbind(t.domElement,"webkitTransitionEnd",e),Ft.unbind(t.domElement,"transitionend",e),Ft.unbind(t.domElement,"oTransitionEnd",e)};Ft.bind(this.domElement,"webkitTransitionEnd",e),Ft.bind(this.domElement,"transitionend",e),Ft.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Ft.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Ft.getHeight(this.domElement)/2+"px"}}]),t}();Qt(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var ne="Default",ie=function(){try{return!!window.localStorage}catch(t){return!1}}(),oe=void 0,ae=!0,se=void 0,le=!1,ce=[],ue=function t(e){var r=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Ft.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=_t.defaults(n,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),n=_t.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),_t.isUndefined(n.load)?n.load={preset:ne}:n.preset&&(n.load.preset=n.preset),_t.isUndefined(n.parent)&&n.hideable&&ce.push(this),n.resizable=_t.isUndefined(n.parent)&&n.resizable,n.autoPlace&&_t.isUndefined(n.scrollable)&&(n.scrollable=!0);var i,o=ie&&"true"===localStorage.getItem(ge(this,"isLocal")),a=void 0,s=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return r.parent?r.getRoot().preset:n.load.preset},set:function(t){r.parent?r.getRoot().preset=t:n.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),r.revert()}},width:{get:function(){return n.width},set:function(t){n.width=t,be(r,t)}},name:{get:function(){return n.name},set:function(t){n.name=t,s&&(s.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(e){n.closed=e,n.closed?Ft.addClass(r.__ul,t.CLASS_CLOSED):Ft.removeClass(r.__ul,t.CLASS_CLOSED),this.onResize(),r.__closeButton&&(r.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return o},set:function(t){ie&&(o=t,t?Ft.bind(window,"unload",a):Ft.unbind(window,"unload",a),localStorage.setItem(ge(r,"isLocal"),t))}}}),_t.isUndefined(n.parent)){if(this.closed=n.closed||!1,Ft.addClass(this.domElement,t.CLASS_MAIN),Ft.makeSelectable(this.domElement,!1),ie&&o){r.useLocalStorage=!0;var l=localStorage.getItem(ge(this,"gui"));l&&(n.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,Ft.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),n.closeOnTop?(Ft.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Ft.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Ft.bind(this.__closeButton,"click",(function(){r.closed=!r.closed}))}else{void 0===n.closed&&(n.closed=!0);var c=document.createTextNode(n.name);Ft.addClass(c,"controller-name"),s=he(r,c);Ft.addClass(this.__ul,t.CLASS_CLOSED),Ft.addClass(s,"title"),Ft.bind(s,"click",(function(t){return t.preventDefault(),r.closed=!r.closed,!1})),n.closed||(this.closed=!1)}n.autoPlace&&(_t.isUndefined(n.parent)&&(ae&&(se=document.createElement("div"),Ft.addClass(se,"dg"),Ft.addClass(se,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(se),ae=!1),se.appendChild(this.domElement),Ft.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||be(r,n.width)),this.__resizeHandler=function(){r.onResizeDebounced()},Ft.bind(window,"resize",this.__resizeHandler),Ft.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Ft.bind(this.__ul,"transitionend",this.__resizeHandler),Ft.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&function(t){var e=void 0;function r(r){return r.preventDefault(),t.width+=e-r.clientX,t.onResize(),e=r.clientX,!1}function n(){Ft.removeClass(t.__closeButton,ue.CLASS_DRAG),Ft.unbind(window,"mousemove",r),Ft.unbind(window,"mouseup",n)}function i(i){return i.preventDefault(),e=i.clientX,Ft.addClass(t.__closeButton,ue.CLASS_DRAG),Ft.bind(window,"mousemove",r),Ft.bind(window,"mouseup",n),!1}t.__resize_handle=document.createElement("div"),_t.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Ft.bind(t.__resize_handle,"mousedown",i),Ft.bind(t.__closeButton,"mousedown",i),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}(this),a=function(){ie&&"true"===localStorage.getItem(ge(r,"isLocal"))&&localStorage.setItem(ge(r,"gui"),JSON.stringify(r.getSaveObject()))},this.saveToLocalStorageIfPossible=a,n.parent||((i=r.getRoot()).width+=1,_t.defer((function(){i.width-=1})))};function he(t,e,r){var n=document.createElement("li");return e&&n.appendChild(e),r?t.__ul.insertBefore(n,r):t.__ul.appendChild(n),t.onResize(),n}function pe(t){Ft.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&Ft.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function de(t,e){var r=t.__preset_select[t.__preset_select.selectedIndex];r.innerHTML=e?r.value+"*":r.value}function fe(t,e){var r=t.getRoot(),n=r.__rememberedObjects.indexOf(e.object);if(-1!==n){var i=r.__rememberedObjectIndecesToControllers[n];if(void 0===i&&(i={},r.__rememberedObjectIndecesToControllers[n]=i),i[e.property]=e,r.load&&r.load.remembered){var o=r.load.remembered,a=void 0;if(o[t.preset])a=o[t.preset];else{if(!o.Default)return;a=o.Default}if(a[n]&&void 0!==a[n][e.property]){var s=a[n][e.property];e.initialValue=s,e.setValue(s)}}}}function me(t,e,r,n){if(void 0===e[r])throw new Error('Object "'+e+'" has no property "'+r+'"');var i=void 0;if(n.color)i=new Jt(e,r);else{var o=[e,r].concat(n.factoryArgs);i=te.apply(t,o)}n.before instanceof Bt&&(n.before=n.before.__li),fe(t,i),Ft.addClass(i.domElement,"c");var a=document.createElement("span");Ft.addClass(a,"property-name"),a.innerHTML=i.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(i.domElement);var l=he(t,s,n.before);return Ft.addClass(l,ue.CLASS_CONTROLLER_ROW),i instanceof Jt?Ft.addClass(l,"color"):Ft.addClass(l,Tt(i.getValue())),function(t,e,r){if(r.__li=e,r.__gui=t,_t.extend(r,{options:function(e){if(arguments.length>1){var n=r.__li.nextElementSibling;return r.remove(),me(t,r.object,r.property,{before:n,factoryArgs:[_t.toArray(arguments)]})}if(_t.isArray(e)||_t.isObject(e)){var i=r.__li.nextElementSibling;return r.remove(),me(t,r.object,r.property,{before:i,factoryArgs:[e]})}},name:function(t){return r.__li.firstElementChild.firstElementChild.innerHTML=t,r},listen:function(){return r.__gui.listen(r),r},remove:function(){return r.__gui.remove(r),r}}),r instanceof Yt){var n=new Wt(r.object,r.property,{min:r.__min,max:r.__max,step:r.__step});_t.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=r[t],i=n[t];r[t]=n[t]=function(){var t=Array.prototype.slice.call(arguments);return i.apply(n,t),e.apply(r,t)}})),Ft.addClass(e,"has-slider"),r.domElement.insertBefore(n.domElement,r.domElement.firstElementChild)}else if(r instanceof Wt){var i=function(e){if(_t.isNumber(r.__min)&&_t.isNumber(r.__max)){var n=r.__li.firstElementChild.firstElementChild.innerHTML,i=r.__gui.__listening.indexOf(r)>-1;r.remove();var o=me(t,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[r.__min,r.__max,r.__step]});return o.name(n),i&&o.listen(),o}return e};r.min=_t.compose(i,r.min),r.max=_t.compose(i,r.max)}else r instanceof jt?(Ft.bind(e,"click",(function(){Ft.fakeEvent(r.__checkbox,"click")})),Ft.bind(r.__checkbox,"click",(function(t){t.stopPropagation()}))):r instanceof Xt?(Ft.bind(e,"click",(function(){Ft.fakeEvent(r.__button,"click")})),Ft.bind(e,"mouseover",(function(){Ft.addClass(r.__button,"hover")})),Ft.bind(e,"mouseout",(function(){Ft.removeClass(r.__button,"hover")}))):r instanceof Jt&&(Ft.addClass(e,"color"),r.updateDisplay=_t.compose((function(t){return e.style.borderLeftColor=r.__color.toString(),t}),r.updateDisplay),r.updateDisplay());r.setValue=_t.compose((function(e){return t.getRoot().__preset_select&&r.isModified()&&de(t.getRoot(),!0),e}),r.setValue)}(t,l,i),t.__controllers.push(i),i}function ge(t,e){return document.location.href+"."+e}function ve(t,e,r){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.__preset_select.appendChild(n),r&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function ye(t,e){e.style.display=t.useLocalStorage?"block":"none"}function _e(t){var e=t.__save_row=document.createElement("li");Ft.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),Ft.addClass(e,"save-row");var r=document.createElement("span");r.innerHTML="&nbsp;",Ft.addClass(r,"button gears");var n=document.createElement("span");n.innerHTML="Save",Ft.addClass(n,"button"),Ft.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",Ft.addClass(i,"button"),Ft.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",Ft.addClass(o,"button"),Ft.addClass(o,"revert");var a=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?_t.each(t.load.remembered,(function(e,r){ve(t,r,r===t.preset)})):ve(t,ne,!1),Ft.bind(a,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(a),e.appendChild(r),e.appendChild(n),e.appendChild(i),e.appendChild(o),ie){var s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(ge(0,"isLocal"))&&l.setAttribute("checked","checked"),ye(t,s),Ft.bind(l,"change",(function(){t.useLocalStorage=!t.useLocalStorage,ye(t,s)}))}var c=document.getElementById("dg-new-constructor");Ft.bind(c,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||oe.hide()})),Ft.bind(r,"click",(function(){c.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),oe.show(),c.focus(),c.select()})),Ft.bind(n,"click",(function(){t.save()})),Ft.bind(i,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),Ft.bind(o,"click",(function(){t.revert()}))}function be(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function xe(t,e){var r={};return _t.each(t.__rememberedObjects,(function(n,i){var o={},a=t.__rememberedObjectIndecesToControllers[i];_t.each(a,(function(t,r){o[r]=e?t.initialValue:t.getValue()})),r[i]=o})),r}function we(t){0!==t.length&&ee.call(window,(function(){we(t)})),_t.each(t,(function(t){t.updateDisplay()}))}ue.toggleHide=function(){le=!le,_t.each(ce,(function(t){t.domElement.style.display=le?"none":""}))},ue.CLASS_AUTO_PLACE="a",ue.CLASS_AUTO_PLACE_CONTAINER="ac",ue.CLASS_MAIN="main",ue.CLASS_CONTROLLER_ROW="cr",ue.CLASS_TOO_TALL="taller-than-window",ue.CLASS_CLOSED="closed",ue.CLASS_CLOSE_BUTTON="close-button",ue.CLASS_CLOSE_TOP="close-top",ue.CLASS_CLOSE_BOTTOM="close-bottom",ue.CLASS_DRAG="drag",ue.DEFAULT_WIDTH=245,ue.TEXT_CLOSED="Close Controls",ue.TEXT_OPEN="Open Controls",ue._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||ue.toggleHide()},Ft.bind(window,"keydown",ue._keydownHandler,!1),_t.extend(ue.prototype,{add:function(t,e){return me(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return me(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;_t.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&se.removeChild(this.domElement);var t=this;_t.each(this.__folders,(function(e){t.removeFolder(e)})),Ft.unbind(window,"keydown",ue._keydownHandler,!1),pe(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var r=new ue(e);this.__folders[t]=r;var n=he(this,r.domElement);return Ft.addClass(n,"folder"),r},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],pe(t);var e=this;_t.each(t.__folders,(function(e){t.removeFolder(e)})),_t.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=Ft.getOffset(t.__ul).top,r=0;_t.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(r+=Ft.getHeight(e))})),window.innerHeight-e-20<r?(Ft.addClass(t.domElement,ue.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(Ft.removeClass(t.domElement,ue.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&_t.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:_t.debounce((function(){this.onResize()}),50),remember:function(){if(_t.isUndefined(oe)&&((oe=new re).domElement.innerHTML=$t),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;_t.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&_e(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&be(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=xe(this)),t.folders={},_t.each(this.__folders,(function(e,r){t.folders[r]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=xe(this),de(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=xe(this,!0)),this.load.remembered[t]=xe(this),this.preset=t,ve(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){_t.each(this.__controllers,(function(e){this.getRoot().load.remembered?fe(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),_t.each(this.__folders,(function(t){t.revert(t)})),t||de(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&we(this.__listening)},updateDisplay:function(){_t.each(this.__controllers,(function(t){t.updateDisplay()})),_t.each(this.__folders,(function(t){t.updateDisplay()}))}});var Ee,Me={color:{Color:Lt,math:St,interpret:Et},controllers:{Controller:Bt,BooleanController:jt,OptionController:Gt,StringController:zt,NumberController:Ht,NumberControllerBox:Wt,NumberControllerSlider:Yt,FunctionController:Xt,ColorController:Jt},dom:{dom:Ft},gui:{GUI:ue},GUI:ue};o.register("60THF",(function(t,e){"use strict";var r=o("78j8V"),n=o("158G9"),i=o("2PMUz"),a=o("4Ipsn");function s(t){var e=new i(t),o=n(i.prototype.request,e);return r.extend(o,i.prototype,e),r.extend(o,e),o}var l=s(o("706XX"));l.Axios=i,l.create=function(t){return s(a(l.defaults,t))},l.Cancel=o("4suIx"),l.CancelToken=o("2rhH3"),l.isCancel=o("4BPKi"),l.all=function(t){return Promise.all(t)},l.spread=o("7rFjq"),l.isAxiosError=o("3uGj3"),t.exports=l,t.exports.default=l})),o.register("78j8V",(function(t,e){"use strict";var r=o("158G9"),n=Object.prototype.toString;function i(t){return"[object Array]"===n.call(t)}function a(t){return void 0===t}function s(t){return null!==t&&"object"==typeof t}function l(t){if("[object Object]"!==n.call(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function c(t){return"[object Function]"===n.call(t)}function u(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),i(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.call(null,t[o],o,t)}t.exports={isArray:i,isArrayBuffer:function(t){return"[object ArrayBuffer]"===n.call(t)},isBuffer:function(t){return null!==t&&!a(t)&&null!==t.constructor&&!a(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:s,isPlainObject:l,isUndefined:a,isDate:function(t){return"[object Date]"===n.call(t)},isFile:function(t){return"[object File]"===n.call(t)},isBlob:function(t){return"[object Blob]"===n.call(t)},isFunction:c,isStream:function(t){return s(t)&&c(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:u,merge:function t(){var e={};function r(r,n){l(e[n])&&l(r)?e[n]=t(e[n],r):l(r)?e[n]=t({},r):i(r)?e[n]=r.slice():e[n]=r}for(var n=0,o=arguments.length;n<o;n++)u(arguments[n],r);return e},extend:function(t,e,n){return u(e,(function(e,i){t[i]=n&&"function"==typeof e?r(e,n):e})),t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t}}})),o.register("158G9",(function(t,e){"use strict";t.exports=function(t,e){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return t.apply(e,r)}}})),o.register("2PMUz",(function(t,e){"use strict";var r=o("78j8V"),n=o("7EcXZ"),i=o("2HljA"),a=o("2JwWd"),s=o("4Ipsn"),l=o("6325B"),c=l.validators;function u(t){this.defaults=t,this.interceptors={request:new i,response:new i}}u.prototype.request=function(t){"string"==typeof t?(t=arguments[1]||{}).url=arguments[0]:t=t||{},(t=s(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var e=t.transitional;void 0!==e&&l.assertOptions(e,{silentJSONParsing:c.transitional(c.boolean,"1.0.0"),forcedJSONParsing:c.transitional(c.boolean,"1.0.0"),clarifyTimeoutError:c.transitional(c.boolean,"1.0.0")},!1);var r=[],n=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(n=n&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var i,o=[];if(this.interceptors.response.forEach((function(t){o.push(t.fulfilled,t.rejected)})),!n){var u=[a,void 0];for(Array.prototype.unshift.apply(u,r),u=u.concat(o),i=Promise.resolve(t);u.length;)i=i.then(u.shift(),u.shift());return i}for(var h=t;r.length;){var p=r.shift(),d=r.shift();try{h=p(h)}catch(t){d(t);break}}try{i=a(h)}catch(t){return Promise.reject(t)}for(;o.length;)i=i.then(o.shift(),o.shift());return i},u.prototype.getUri=function(t){return t=s(this.defaults,t),n(t.url,t.params,t.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(t){u.prototype[t]=function(e,r){return this.request(s(r||{},{method:t,url:e,data:(r||{}).data}))}})),r.forEach(["post","put","patch"],(function(t){u.prototype[t]=function(e,r,n){return this.request(s(n||{},{method:t,url:e,data:r}))}})),t.exports=u})),o.register("7EcXZ",(function(t,e){"use strict";var r=o("78j8V");function n(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(t,e,i){if(!e)return t;var o;if(i)o=i(e);else if(r.isURLSearchParams(e))o=e.toString();else{var a=[];r.forEach(e,(function(t,e){null!=t&&(r.isArray(t)?e+="[]":t=[t],r.forEach(t,(function(t){r.isDate(t)?t=t.toISOString():r.isObject(t)&&(t=JSON.stringify(t)),a.push(n(e)+"="+n(t))})))})),o=a.join("&")}if(o){var s=t.indexOf("#");-1!==s&&(t=t.slice(0,s)),t+=(-1===t.indexOf("?")?"?":"&")+o}return t}})),o.register("2HljA",(function(t,e){"use strict";var r=o("78j8V");function n(){this.handlers=[]}n.prototype.use=function(t,e,r){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},n.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},n.prototype.forEach=function(t){r.forEach(this.handlers,(function(e){null!==e&&t(e)}))},t.exports=n})),o.register("2JwWd",(function(t,e){"use strict";var r=o("78j8V"),n=o("6W6u9"),i=o("4BPKi"),a=o("706XX");function s(t){t.cancelToken&&t.cancelToken.throwIfRequested()}t.exports=function(t){return s(t),t.headers=t.headers||{},t.data=n.call(t,t.data,t.headers,t.transformRequest),t.headers=r.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||a.adapter)(t).then((function(e){return s(t),e.data=n.call(t,e.data,e.headers,t.transformResponse),e}),(function(e){return i(e)||(s(t),e&&e.response&&(e.response.data=n.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))}})),o.register("6W6u9",(function(t,e){"use strict";var r=o("78j8V"),n=o("706XX");t.exports=function(t,e,i){var o=this||n;return r.forEach(i,(function(r){t=r.call(o,t,e)})),t}})),o.register("706XX",(function(t,e){var r=o("3JAaW"),n=o("78j8V"),i=o("2VVZC"),a=o("T3ph1"),s={"Content-Type":"application/x-www-form-urlencoded"};function l(t,e){!n.isUndefined(t)&&n.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var c,u={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==r&&"[object process]"===Object.prototype.toString.call(r))&&(c=o("MvFG7")),c),transformRequest:[function(t,e){return i(e,"Accept"),i(e,"Content-Type"),n.isFormData(t)||n.isArrayBuffer(t)||n.isBuffer(t)||n.isStream(t)||n.isFile(t)||n.isBlob(t)?t:n.isArrayBufferView(t)?t.buffer:n.isURLSearchParams(t)?(l(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):n.isObject(t)||e&&"application/json"===e["Content-Type"]?(l(e,"application/json"),function(t,e,r){if(n.isString(t))try{return(e||JSON.parse)(t),n.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(r||JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional,r=e&&e.silentJSONParsing,i=e&&e.forcedJSONParsing,o=!r&&"json"===this.responseType;if(o||i&&n.isString(t)&&t.length)try{return JSON.parse(t)}catch(t){if(o){if("SyntaxError"===t.name)throw a(t,this,"E_JSON_PARSE");throw t}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(t){return t>=200&&t<300}};u.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],(function(t){u.headers[t]={}})),n.forEach(["post","put","patch"],(function(t){u.headers[t]=n.merge(s)})),t.exports=u})),o.register("3JAaW",(function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var l,c=[],u=!1,h=-1;function p(){u&&l&&(u=!1,l.length?c=l.concat(c):h=-1,c.length&&d())}function d(){if(!u){var t=s(p);u=!0;for(var e=c.length;e;){for(l=c,c=[];++h<e;)l&&l[h].run();h=-1,e=c.length}l=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function m(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new f(t,e)),1!==c.length||u||s(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}})),o.register("2VVZC",(function(t,e){"use strict";var r=o("78j8V");t.exports=function(t,e){r.forEach(t,(function(r,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[n])}))}})),o.register("T3ph1",(function(t,e){"use strict";t.exports=function(t,e,r,n,i){return t.config=e,r&&(t.code=r),t.request=n,t.response=i,t.isAxiosError=!0,t.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},t}})),o.register("MvFG7",(function(t,e){"use strict";var r=o("78j8V"),n=o("3TB7T"),i=o("2lGYW"),a=o("7EcXZ"),s=o("3kgte"),l=o("3Nips"),c=o("2OXVC"),u=o("1kTFN");t.exports=function(t){return new Promise((function(e,o){var h=t.data,p=t.headers,d=t.responseType;r.isFormData(h)&&delete p["Content-Type"];var f=new XMLHttpRequest;if(t.auth){var m=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";p.Authorization="Basic "+btoa(m+":"+g)}var v=s(t.baseURL,t.url);function y(){if(f){var r="getAllResponseHeaders"in f?l(f.getAllResponseHeaders()):null,i={data:d&&"text"!==d&&"json"!==d?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:r,config:t,request:f};n(e,o,i),f=null}}if(f.open(t.method.toUpperCase(),a(v,t.params,t.paramsSerializer),!0),f.timeout=t.timeout,"onloadend"in f?f.onloadend=y:f.onreadystatechange=function(){f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))&&setTimeout(y)},f.onabort=function(){f&&(o(u("Request aborted",t,"ECONNABORTED",f)),f=null)},f.onerror=function(){o(u("Network Error",t,null,f)),f=null},f.ontimeout=function(){var e="timeout of "+t.timeout+"ms exceeded";t.timeoutErrorMessage&&(e=t.timeoutErrorMessage),o(u(e,t,t.transitional&&t.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",f)),f=null},r.isStandardBrowserEnv()){var _=(t.withCredentials||c(v))&&t.xsrfCookieName?i.read(t.xsrfCookieName):void 0;_&&(p[t.xsrfHeaderName]=_)}"setRequestHeader"in f&&r.forEach(p,(function(t,e){void 0===h&&"content-type"===e.toLowerCase()?delete p[e]:f.setRequestHeader(e,t)})),r.isUndefined(t.withCredentials)||(f.withCredentials=!!t.withCredentials),d&&"json"!==d&&(f.responseType=t.responseType),"function"==typeof t.onDownloadProgress&&f.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then((function(t){f&&(f.abort(),o(t),f=null)})),h||(h=null),f.send(h)}))}})),o.register("3TB7T",(function(t,e){"use strict";var r=o("1kTFN");t.exports=function(t,e,n){var i=n.config.validateStatus;n.status&&i&&!i(n.status)?e(r("Request failed with status code "+n.status,n.config,null,n.request,n)):t(n)}})),o.register("1kTFN",(function(t,e){"use strict";var r=o("T3ph1");t.exports=function(t,e,n,i,o){var a=new Error(t);return r(a,e,n,i,o)}})),o.register("2lGYW",(function(t,e){"use strict";var r=o("78j8V");t.exports=r.isStandardBrowserEnv()?{write:function(t,e,n,i,o,a){var s=[];s.push(t+"="+encodeURIComponent(e)),r.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),r.isString(i)&&s.push("path="+i),r.isString(o)&&s.push("domain="+o),!0===a&&s.push("secure"),document.cookie=s.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}})),o.register("3kgte",(function(t,e){"use strict";var r=o("4tOlc"),n=o("1tzfM");t.exports=function(t,e){return t&&!r(e)?n(t,e):e}})),o.register("4tOlc",(function(t,e){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}})),o.register("1tzfM",(function(t,e){"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}})),o.register("3Nips",(function(t,e){"use strict";var r=o("78j8V"),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,i,o,a={};return t?(r.forEach(t.split("\n"),(function(t){if(o=t.indexOf(":"),e=r.trim(t.substr(0,o)).toLowerCase(),i=r.trim(t.substr(o+1)),e){if(a[e]&&n.indexOf(e)>=0)return;a[e]="set-cookie"===e?(a[e]?a[e]:[]).concat([i]):a[e]?a[e]+", "+i:i}})),a):a}})),o.register("2OXVC",(function(t,e){"use strict";var r=o("78j8V");t.exports=r.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(t){var r=t;return e&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return t=i(window.location.href),function(e){var n=r.isString(e)?i(e):e;return n.protocol===t.protocol&&n.host===t.host}}():function(){return!0}})),o.register("4BPKi",(function(t,e){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}})),o.register("4Ipsn",(function(t,e){"use strict";var r=o("78j8V");t.exports=function(t,e){e=e||{};var n={},i=["url","method","data"],o=["headers","auth","proxy","params"],a=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function l(t,e){return r.isPlainObject(t)&&r.isPlainObject(e)?r.merge(t,e):r.isPlainObject(e)?r.merge({},e):r.isArray(e)?e.slice():e}function c(i){r.isUndefined(e[i])?r.isUndefined(t[i])||(n[i]=l(void 0,t[i])):n[i]=l(t[i],e[i])}r.forEach(i,(function(t){r.isUndefined(e[t])||(n[t]=l(void 0,e[t]))})),r.forEach(o,c),r.forEach(a,(function(i){r.isUndefined(e[i])?r.isUndefined(t[i])||(n[i]=l(void 0,t[i])):n[i]=l(void 0,e[i])})),r.forEach(s,(function(r){r in e?n[r]=l(t[r],e[r]):r in t&&(n[r]=l(void 0,t[r]))}));var u=i.concat(o).concat(a).concat(s),h=Object.keys(t).concat(Object.keys(e)).filter((function(t){return-1===u.indexOf(t)}));return r.forEach(h,c),n}})),o.register("6325B",(function(t,e){"use strict";var r=o("5kwm9"),n={};["object","boolean","number","function","string","symbol"].forEach((function(t,e){n[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}}));var i={},a=r.version.split(".");function s(t,e){for(var r=e?e.split("."):a,n=t.split("."),i=0;i<3;i++){if(r[i]>n[i])return!0;if(r[i]<n[i])return!1}return!1}n.transitional=function(t,e,n){var o=e&&s(e);function a(t,e){return"[Axios v"+r.version+"] Transitional option '"+t+"'"+e+(n?". "+n:"")}return function(r,n,s){if(!1===t)throw new Error(a(n," has been removed in "+e));return o&&!i[n]&&(i[n]=!0,console.warn(a(n," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(r,n,s)}},t.exports={isOlderVersion:s,assertOptions:function(t,e,r){if("object"!=typeof t)throw new TypeError("options must be an object");for(var n=Object.keys(t),i=n.length;i-- >0;){var o=n[i],a=e[o];if(a){var s=t[o],l=void 0===s||a(s,o,t);if(!0!==l)throw new TypeError("option "+o+" must be "+l)}else if(!0!==r)throw Error("Unknown option "+o)}},validators:n}})),o.register("5kwm9",(function(t,e){t.exports=JSON.parse('{"_from":"axios@^0.21.1","_id":"axios@0.21.4","_inBundle":false,"_integrity":"sha512-ut5vewkiu8jjGBdqpM44XxjuCjq9LAKeHVmoVfHVzy8eHgxxq8SbAVQNovDA8mVi05kP0Ea/n/UzcSHcTJQfNg==","_location":"/axios","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"axios@^0.21.1","name":"axios","escapedName":"axios","rawSpec":"^0.21.1","saveSpec":null,"fetchSpec":"^0.21.1"},"_requiredBy":["/textalive-app-api"],"_resolved":"https://registry.npmjs.org/axios/-/axios-0.21.4.tgz","_shasum":"c67b90dc0568e5c1cf2b0b858c43ba28e2eda575","_spec":"axios@^0.21.1","_where":"C:\\\\Users\\\\arc\\\\Documents\\\\Source\\\\arcatdmz\\\\textalive-app-dance\\\\node_modules\\\\textalive-app-api","author":{"name":"Matt Zabriskie"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"bugs":{"url":"https://github.com/axios/axios/issues"},"bundleDependencies":false,"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}],"dependencies":{"follow-redirects":"^1.14.0"},"deprecated":false,"description":"Promise based HTTP client for the browser and node.js","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"homepage":"https://axios-http.com","jsdelivr":"dist/axios.min.js","keywords":["xhr","http","ajax","promise","node"],"license":"MIT","main":"index.js","name":"axios","repository":{"type":"git","url":"git+https://github.com/axios/axios.git"},"scripts":{"build":"NODE_ENV=production grunt build","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","examples":"node ./examples/server.js","fix":"eslint --fix lib/**/*.js","postversion":"git push && git push --tags","preversion":"npm test","start":"node ./sandbox/server.js","test":"grunt test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json"},"typings":"./index.d.ts","unpkg":"dist/axios.min.js","version":"0.21.4"}')})),o.register("4suIx",(function(t,e){"use strict";function r(t){this.message=t}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,t.exports=r})),o.register("2rhH3",(function(t,e){"use strict";var r=o("4suIx");function n(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise((function(t){e=t}));var n=this;t((function(t){n.reason||(n.reason=new r(t),e(n.reason))}))}n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var t;return{token:new n((function(e){t=e})),cancel:t}},t.exports=n})),o.register("7rFjq",(function(t,e){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}})),o.register("3uGj3",(function(t,e){"use strict";t.exports=function(t){return"object"==typeof t&&!0===t.isAxiosError}})),Ee=o("60THF");var Se,Te,Ae,Ce=(Se=(Ae={path:void 0,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&Ae.path)}}).exports,(Te=Se).sortedIndex=function(t,e,r){for(var n=r&&"number"!=typeof e?r(e):e,i=0,o=t.length;i<o;){var a=i+o>>>1;(r?r(t[a]):t[a])<n?i=a+1:o=a}return i},void Object.defineProperty(Te,"__esModule",{value:!0}),Ae.exports),Pe={NONE:0,PHRASE:1,WORD:2,CHAR:4,GRAPHIC:8,ALL:63,PUBLIC:64},Oe=/^https?:\/\/uploader\.ongaaccel\.jp\/files\?guid=([a-zA-Z0-9]+)/i,Re=/^https?:\/\/songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i,Le=/^uploaded:([a-zA-Z0-9]+)$/i,Ie=/^songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i,Ne=/^https?:\/\/piapro\.jp\/t\/([^/]+)(\/[0-9]+)?$/i,Be={getSongPathFromUrl:function(t){if(Be.isUploaderUrl(t)){var e=Re.exec(t);if(e)return"songle.jp/uploads/"+e[1]+".mp3";var r=Oe.exec(t);if(r)return"songle.jp/uploads/"+r[1]+".mp3"}return/https?:\/\/(.+)/.exec(t)[1]},isUploaderUrl:function(t){return Re.test(t)||Oe.test(t)},isUploaderPath:function(t){return Ie.test(t)||Le.test(t)},getUploaderGuid:function(t){var e=Ie.exec(t);if(e)return e[1];var r=Le.exec(t);return r?r[1]:null},getSongUrlFromUploaderGuid:function(t){return t?"https://songle.jp/uploads/"+t+".mp3":null},getAltSongUrlFromUploaderGuid:function(t){return t?"https://api.textalive.jp/songle/me/uploads/"+t:null},getSongUrlFromPath:function(t){var e=Be.getUploaderGuid(t);return e?Be.getSongUrlFromUploaderGuid(e):"https://"+t},isYouTubeUrl:function(t){return/^https?:\/\/((www|m)\.)?youtube\.com/i.test(t)},isNicovideoUrl:function(t){return/^https?:\/\/(www\.)?nicovideo.jp/i.test(t)},isVideoSiteUrl:function(t){return Be.isYouTubeUrl(t)||Be.isNicovideoUrl(t)},isPiaproUrl:function(t){return Ne.test(t)}},De=/^https:\/\/songle\.jp\/api\/v[0-9]+\/users\/(.+)\/uploads\/(.+)$/,ke=function(t){return De.test(t)},Ue=function(){function t(){}return t.prototype.isLicenseLoading=function(t){return!t||!t.song||void 0===t.lyrics||void 0===t.backgroundImage},t.prototype.checkLicenses=function(t){return!this.isLicenseLoading(t)&&this.checkLicense(t.song)&&this.checkLicense(t.lyrics)&&this.checkLicense(t.backgroundImage)},t.prototype.checkLicense=function(t){return null===t||(1===t.contentType?this.checkMusicLicense(t.license):2===t.contentType?this.checkTextLicense(t.license):0===t.contentType&&(!!this.isBackgroundColorAsset(t)||this.checkBackgroundImageLicense(t.license)))},t.prototype.checkMusicLicense=function(t){return t.condition&&t.condition.uploader||!(!t.condition||t.condition.ns||t.condition.nc||t.condition.org||t.condition.clb)},t.prototype.checkTextLicense=function(t){return t.condition&&t.condition.uploader||!(!t.condition||t.condition.ns||t.condition.org||t.condition.clb)},t.prototype.checkBackgroundImageLicense=function(t){return!(!t.condition||t.condition.ns||t.condition.nc||t.condition.org||t.condition.clb)},t.prototype.isUploaderAsset=function(t){return t&&t.url&&(Be.isUploaderUrl(t.url)||ke(t.url))},t.prototype.isPiaproAsset=function(t){return t&&t.url&&Be.isPiaproUrl(t.url)},t.prototype.isBlankBackgroundAsset=function(t){return!t||!t.originalUrl},t.prototype.isBackgroundColorAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return/^#[0-9a-fA-F]{3,6}$/.test(e)},t.prototype.isBackgroundPiaproImageAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return Be.isPiaproUrl(e)},t.prototype.isBackgroundSpecialImageAsset=function(t){var e=t&&t.originalUrl?t.originalUrl:"";return/^snowmiku2016-([0-9]{2})$/.test(e)},t.prototype.getQueryParameter=function(t){return!t||t.license&&!this.checkBackgroundImageLicense(t.license)?null:t.originalUrl},t}(),Fe=function(t,e){return(Fe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},je=function(){return(je=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function Ge(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))}function ze(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o}var Ve={fallback:{protocol:"https"},songle:{domain:"songle.jp"},textalive:{domain:"api.textalive.jp"},content:{domain:"content.textalive.jp"},client:{version:"0.10.0"}};function He(t,e,n){var i,o;return Ge(this,void 0,void 0,(function(){var a;return ze(this,(function(s){switch(s.label){case 0:a={responseType:(null==n?void 0:n.responseType)||"json"},e&&(a.params=e),(null==n?void 0:n.auth)&&(a.auth={username:null===(i=n.auth)||void 0===i?void 0:i.username,password:null===(o=n.auth)||void 0===o?void 0:o.password}),(null==n?void 0:n.withCredentials)&&(a.withCredentials=!0),a.headers={},0===t.indexOf(Ve.textalive.server)&&(Ve.textalive.appToken&&(a.headers["x-ta-app-token"]=Ve.textalive.appToken),Ve.textalive.authUser&&Ve.textalive.authToken&&(a.headers["x-ta-auth-user"]=Ve.textalive.authUser,a.headers["x-ta-auth-token"]=Ve.textalive.authToken)),(null==n?void 0:n.headers)&&(a.headers=je(je({},a.headers),n.headers)),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,r(Ee).get(t,a)];case 2:return[2,s.sent()];case 3:return s.sent(),[2,null];case 4:return[2]}}))}))}function We(t){var e,r,n=0;if(0===t.length)return n;for(e=0,r=t.length;e<r;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}Ve.songle.protocol=Ve.songle.protocol||Ve.fallback.protocol,Ve.songle.server=Ve.songle.protocol+"://"+Ve.songle.domain,Ve.textalive.protocol=Ve.textalive.protocol||Ve.fallback.protocol,Ve.textalive.server=Ve.textalive.protocol+"://"+Ve.textalive.domain,Ve.textalive.appToken=null,Ve.content.protocol=Ve.content.protocol||Ve.fallback.protocol,Ve.content.server=Ve.content.protocol+"://"+Ve.content.domain;var qe=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return function(t,e){function r(){this.constructor=t}Fe(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),Object.defineProperty(e.prototype,"endpoint",{get:function(){return Ve.textalive.server+"/etc/license"},enumerable:!1,configurable:!0}),e.prototype.read=function(t,e){var r;return void 0===e&&(e=!0),Ge(this,void 0,void 0,(function(){var n,i;return ze(this,(function(o){switch(o.label){case 0:return[4,He(this.endpoint,{url:t,token:We("ta"+t),skipOptoutCheck:!!e||void 0})];case 1:return!(n=o.sent())||200!==n.status||(null===(r=n.data)||void 0===r?void 0:r.error)?[2,{originalUrl:null,license:{code:n?n.status:404}}]:((i=n.data).license.code=n.status,0===i.contentType&&(i.css='url("'+i.contentUrl+'")'),[2,i])}}))}))},e}(Ue));function Ye(t,e,n){return Ge(this,void 0,void 0,(function(){var i;return ze(this,(function(o){switch(o.label){case 0:e||(e={}),i={responseType:(null==n?void 0:n.responseType)||"json"},(null==n?void 0:n.withCredentials)&&(i.withCredentials=!0),i.headers={},0===t.indexOf(Ve.textalive.server)&&(Ve.textalive.appToken&&(i.headers["x-ta-app-token"]=Ve.textalive.appToken),Ve.textalive.authUser&&Ve.textalive.authToken&&(i.headers["x-ta-auth-user"]=Ve.textalive.authUser,i.headers["x-ta-auth-token"]=Ve.textalive.authToken)),(null==n?void 0:n.postToken)&&(i.headers["x-ta-post-token"]=n.postToken),(null==n?void 0:n.headers)&&(i.headers||(i.headers={}),i.headers=je(je({},i.headers),n.headers)),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,r(Ee).post(t,e,i)];case 2:return[2,o.sent()];case 3:return o.sent(),[2,null];case 4:return[2]}}))}))}function Xe(t){return"string"==typeof t&&0===t.indexOf("data:text/plain;base64,")}function Je(t){if(!Xe(t))return null;var e=t.split(",")[1];return decodeURIComponent(atob(e).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""))}function Ze(t,e,r,n,i){var o=void 0===window.screenLeft?screen.left:window.screenLeft,a=void 0===window.screenTop?screen.top:window.screenTop,s=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-r/2+o,l=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-n/2+a,c=window.open(t,e,"width="+r+",height="+n+",top="+l+",left="+s+(i?","+i:""));return window.focus&&c.focus(),c}var Ke=new(function(){function t(){this.listeners=[],this.pollingTimeout=null}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return Ve.textalive.server+"/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songleEndpoint",{get:function(){return Ve.songle.server+"/"},enumerable:!1,configurable:!0}),t.prototype.isLoading=function(){return!!this.userProfile},t.prototype.spoof=function(t){this.userProfile=t},t.prototype.getServerStatus=function(){return Ge(this,void 0,void 0,(function(){return ze(this,(function(t){return[2,this.serverStatus||this.doGetServerStatus()]}))}))},t.prototype.doGetServerStatus=function(){return Ge(this,void 0,void 0,(function(){var t;return ze(this,(function(e){switch(e.label){case 0:return this.serverStatusRequest||(this.serverStatusRequest=He(this.endpoint,null,{withCredentials:!0})),[4,this.serverStatusRequest];case 1:return t=e.sent(),this.serverStatusRequest=null,t&&200===t.status?(this.serverStatus=t.data,[2,this.serverStatus]):[2,null]}}))}))},t.prototype.getProfile=function(){return Ge(this,void 0,void 0,(function(){return ze(this,(function(t){return[2,this.userProfile||this.doGetProfile()]}))}))},t.prototype.doGetProfile=function(){return Ge(this,void 0,void 0,(function(){var t;return ze(this,(function(e){switch(e.label){case 0:return this.userProfileRequest||(this.userProfileRequest=He(this.endpoint+"profile",null,{withCredentials:!0})),[4,this.userProfileRequest];case 1:return t=e.sent(),this.userProfileRequest=null,t&&200===t.status?(this.emitUserProfile(t.data),this.userProfile=t.data,[2,this.userProfile]):[2,null]}}))}))},t.prototype.getMergingUsers=function(){return Ge(this,void 0,void 0,(function(){var t;return ze(this,(function(e){switch(e.label){case 0:return[4,He(this.endpoint+"profile/merge",null,{withCredentials:!0})];case 1:return(t=e.sent())&&200===t.status&&t.data?[2,[t.data.user,t.data.mergeWith]]:[2,[null,null]]}}))}))},t.prototype.mergeUsers=function(){var t;return Ge(this,void 0,void 0,(function(){var e,r,n,i,o,a;return ze(this,(function(s){switch(s.label){case 0:return[4,this.getToken()];case 1:return e=s.sent(),[4,Ye(this.endpoint+"profile/merge",null,{postToken:e,withCredentials:!0})];case 2:if(!(r=s.sent())||200!==r.status||!(null===(t=r.data)||void 0===t?void 0:t.success))return[2,null];for(n=r.data.user,i=0,o=this.listeners;i<o.length;i++)(a=o[i]).onUserMerged&&a.onUserMerged(n);return[2,n]}}))}))},t.prototype.updateUser=function(t){var e;return Ge(this,void 0,void 0,(function(){var r,n,i;return ze(this,(function(o){switch(o.label){case 0:return[4,this.getToken()];case 1:return r=o.sent(),[4,Ye(this.endpoint+"profile",t,{postToken:r,withCredentials:!0})];case 2:return(n=o.sent())&&200===n.status&&(null===(e=n.data)||void 0===e?void 0:e.success)?(i=n.data.user,this.emitUserProfile(i),[2,i]):[2,null]}}))}))},t.prototype.isYouTubeUser=function(t){return t&&t.user&&"string"==typeof t.user.youtubeIdString},t.prototype.isPiaproUser=function(t){return t&&t.user&&"string"==typeof t.user.piaproIdString},t.prototype.isSongleUser=function(t){return t&&t.user&&("number"==typeof t.user.songleUserId&&t.user.songleUserId>=0||"string"==typeof t.user.songleAccessToken)},t.prototype.isSpoofingSongleUser=function(t){return this.isSongleUser(t)&&("number"!=typeof t.user.id||t.user.id<0)},t.prototype.addListener=function(t){t&&this.listeners.push(t)},t.prototype.removeListener=function(t){this.listeners=this.listeners.filter((function(e){return e!==t}))},t.prototype.emitUserProfile=function(t){this.userProfile=t;for(var e=0,r=this.listeners;e<r.length;e++){var n=r[e];n.onUserProfileUpdated&&n.onUserProfileUpdated(t),this.userProfile.user?n.onUserLoggedIn&&n.onUserLoggedIn(t.user):n.onUserLoggedOut&&n.onUserLoggedOut()}},t.prototype.authenticate=function(t,e){return Ge(this,void 0,void 0,(function(){var r;return ze(this,(function(n){switch(n.label){case 0:return[4,He(this.endpoint+"profile/logins/basic",null,{auth:{username:String(t),password:e},withCredentials:!0})];case 1:return(r=n.sent())&&200===r.status&&r.data?[2,r.data]:[2,null]}}))}))},t.prototype.loginTwitter=function(t){return this.login(t,"twitter")},t.prototype.loginGitHub=function(t){return this.login(t,"github")},t.prototype.loginYouTube=function(t){return this.login(t,"youtube")},t.prototype.loginPiapro=function(t){return this.login(t,"piapro")},t.prototype.loginSongle=function(t){return this.login(t,"songle")},t.prototype.login=function(t,e){return t&&t.preventDefault(),!!e&&(Ze(this.endpoint+"profile/logins/"+e,"TextAliveAuth",600,480,"status=no,toolbar=no,menubar=no"),this.startMonitoringAuthState(),!1)},t.prototype.logoutTwitter=function(t){return this.logout(t,"twitter")},t.prototype.logoutGitHub=function(t){return this.logout(t,"github")},t.prototype.logoutYouTube=function(t){return this.logout(t,"youtube")},t.prototype.logoutPiapro=function(t){return this.logout(t,"piapro")},t.prototype.logoutSongle=function(t){return this.logout(t,"songle")},t.prototype.logout=function(t,e){return void 0===e&&(e=null),t&&t.preventDefault(),Ze(this.endpoint+"profile/logouts/"+(e||"all"),"TextAliveAuth",600,480,"status=no,toolbar=no,menubar=no"),this.startMonitoringAuthState(),!1},t.prototype.startMonitoringAuthState=function(){var t=this;this.pollingTimeout&&(clearTimeout(this.pollingTimeout),this.pollingTimeout=null);var e=function(r){if(r.data&&r.data.textalive){if(r.source.postMessage("close",r.origin),r.data.merge)return t.getMergingUsers().then((function(e){for(var r=e[0],n=e[1],i=0,o=t.listeners;i<o.length;i++){var a=o[i];a.onUserMergeRequired&&a.onUserMergeRequired(r,n)}})).catch((function(){})),void window.removeEventListener("message",e);t.doGetProfile(),window.removeEventListener("message",e)}};window.addEventListener("message",e)},t.prototype.getToken=function(){return Ge(this,void 0,void 0,(function(){return ze(this,(function(t){return this.userProfile?[2,this.userProfile.status.token]:this.token?[2,this.token]:[2,this.doGetToken()]}))}))},t.prototype.doGetToken=function(){var t;return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return[4,He(this.endpoint+"profile/token",null,{withCredentials:!0})];case 1:return e=r.sent(),(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.token)&&(this.token=e.data.token),[2,this.token]}}))}))},t}()),Qe=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return Ve.textalive.server+"/text-parser/"},enumerable:!1,configurable:!0}),t.prototype.parse=function(t){return Ge(this,void 0,void 0,(function(){var e,r;return ze(this,(function(n){switch(n.label){case 0:return[4,Ke.getToken()];case 1:return e=n.sent(),[4,Ye(this.endpoint,{text:t},{postToken:e,withCredentials:!0})];case 2:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t}()),$e=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return Ve.content.server+"/fonts"},enumerable:!1,configurable:!0}),t.prototype.listAvailableFonts=function(){return Ge(this,void 0,void 0,(function(){var t=this;return ze(this,(function(e){switch(e.label){case 0:return this.data?[3,2]:[4,this.fetchInfo()];case 1:e.sent(),e.label=2;case 2:return this.data&&this.data.fontFamilies?[2,Object.keys(this.data.fontFamilies).map((function(e){return je({key:e},t.data.fontFamilies[e])}))]:[2,[]]}}))}))},t.prototype.getFrequentChars=function(){return Ge(this,void 0,void 0,(function(){return ze(this,(function(t){switch(t.label){case 0:return this.data?[3,2]:[4,this.fetchInfo()];case 1:t.sent(),t.label=2;case 2:return[2,this.data&&this.data.frequentChars||""]}}))}))},t.prototype.fetchInfo=function(){return Ge(this,void 0,void 0,(function(){var t,e,r,n;return ze(this,(function(i){switch(i.label){case 0:return[4,He(this.endpoint+"/index.json")];case 1:if(!(t=i.sent())||200!==t.status||!t.data)return this.data=null,[2,null];for(r in this.data=t.data,e=this.data.fontUrlPrefix,this.data.fontFamilies)(n=this.data.fontFamilies[r]).typesquare||n.typekit||n.google||n.url||(n.url=e+"/"+r+"-all.css",n.compactUrl=e+"/"+r+".css");return[2]}}))}))},t}()),tr=new RegExp("\\b([CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*(?:[CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*)*\\-){2}");function er(t,e,r){return!tr.test(t)&&!t.match(/[（(].+(?:転載|書き起こし).*[）)]/)&&(!t.match(/(作詞|作曲).+(作詞|作曲)/)||0!==e&&e!==r.length-2)}function rr(t){return!t.match(new RegExp("[（(]?※"))}var nr={},ir={};function or(t,e,r){var n,i=this;return"undefined"==typeof window||!(null===(n=null===window||void 0===window?void 0:window.navigator)||void 0===n?void 0:n.userAgent)||window.navigator.userAgent.includes("Node.js")||window.navigator.userAgent.includes("jsdom")?function(t,e,r){return r&&console.log("parse lyrics: loading on Node.js",t),new Promise((function(r,n){He(t,{responseType:"text"}).then((function(t){var i=t.data,o=new Function("let g=global;global={};"+i+";let res=global;global=g"),a={};try{o.bind(a)(),r(e(a))}catch(t){n(t)}})).catch(n)}))}(t,e,r):(r&&console.log("parse lyrics: loading",t),new Promise((function(n,o){try{var a=document.createElement("script"),s=null;window.module&&(s=window.module,delete window.module),a.src=t,a.onload=function(){return Ge(i,void 0,void 0,(function(){var i,l;return ze(this,(function(c){switch(c.label){case 0:document.body.removeChild(a),r&&console.log("parse lyrics: load",t),window.Songle&&window.Songle.Utils&&window.Songle.Utils.url2Lyric||(s&&(window.module=s),o("url2Lyric not found")),c.label=1;case 1:return c.trys.push([1,3,4,5]),i=n,[4,e(window)];case 2:return i.apply(void 0,[c.sent()]),[3,5];case 3:return l=c.sent(),o(l),[3,5];case 4:return s&&(window.module=s),[7];case 5:return[2]}}))}))},a.onerror=function(t){return o(t.message)},document.body.appendChild(a)}catch(e){console.error("failed to call lyrics parser",t,e)}})))}var ar=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return Ve.songle.server+"/lyrics/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localLyricsEndpoint",{get:function(){return Ve.textalive.server+"/etc/lyrics"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timingEndpoint",{get:function(){return Ve.songle.server+"/songs/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsParserEndpoint",{get:function(){return Ve.songle.server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsPostEndpoint",{get:function(){return Ve.songle.server},enumerable:!1,configurable:!0}),t.prototype.isUploaderUrl=function(t){return ke(t)},t.prototype.parseUploaderUrl=function(t){return function(t){var e=De.exec(t);return e?{user:e[1],identifier:e[2]}:{user:null,identifier:null}}(t)},t.prototype.getRecentlySynchronizedCount=function(){return Ge(this,void 0,void 0,(function(){var t;return ze(this,(function(e){switch(e.label){case 0:return[4,He(this.endpoint+"recently_synchronized_count.json")];case 1:return(t=e.sent())&&200===t.status&&t.data?[2,t.data.count]:[2,-1]}}))}))},t.prototype.getRecentlySynchronizedList=function(t,e){return void 0===t&&(t=1),Ge(this,void 0,void 0,(function(){var r;return ze(this,(function(n){switch(n.label){case 0:return[4,He(this.endpoint+"recently_synchronized.json",je({page:t},e))];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t.prototype.load=function(t){return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return[4,He(this.timingEndpoint+t+"/lyrics.json")];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.loadDetail=function(t,e){return Ge(this,void 0,void 0,(function(){var r,n;return ze(this,(function(i){switch(i.label){case 0:return nr[t]&&nr[t][e]?[2,nr[t][e]]:[4,He(this.timingEndpoint+t+"/lyrics/"+(e<0?"latest":e)+".json")];case 1:return(r=i.sent())&&200===r.status?(n=r.data,nr[t]||(nr[t]={}),nr[t][n.id]=n,e<0&&(nr[t][-1]=n),[2,n]):[2,null]}}))}))},t.prototype.loadDiffs=function(t,e){return Ge(this,void 0,void 0,(function(){var r;return ze(this,(function(n){switch(n.label){case 0:return[4,He(this.timingEndpoint+t+"/lyrics/"+e+"/diffs.json")];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t.prototype.loadDiff=function(t,e,r){return Ge(this,void 0,void 0,(function(){return ze(this,(function(n){switch(n.label){case 0:return[4,He(this.timingEndpoint+t+"/lyrics/"+e+(r<0?"":0===r?"/original":"/diffs/"+r+"/lyrics")+".json")];case 1:return[2,n.sent().data]}}))}))},t.prototype.loadAllRevisionsForSong=function(t){return Ge(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,l,c,u;return ze(this,(function(h){switch(h.label){case 0:return[4,this.load(t)];case 1:if(!(e=h.sent()))return[2,null];r=[],n=0,i=e.lyrics,h.label=2;case 2:return n<i.length?(o=i[n],[4,this.loadDetail(t,o.id)]):[3,6];case 3:return a=h.sent(),[4,this.loadDiffs(t,a.id)];case 4:if(s=h.sent(),r.push({lyrics:a,updated_at:new Date(a.created_at)}),Array.isArray(s))for(l=0,c=s;l<c.length;l++)u=c[l],r.push({diff_id:u.id,source_id:u.source_id,lyrics:a,updated_at:new Date(u.updated_at)});h.label=5;case 5:return n++,[3,2];case 6:return[2,r.sort((function(t,e){var r=e.updated_at.getTime()-t.updated_at.getTime();return 0===r?e.diff_id-t.diff_id:r}))]}}))}))},t.prototype.getLatestRevision=function(t){return t.filter((function(t){return!(t.lyrics.processing||t.lyrics.failed)}))[0]},t.prototype.fetchLocalLyricBody=function(t){return Ge(this,void 0,void 0,(function(){var e,r,n,i;return ze(this,(function(o){switch(o.label){case 0:return this.verbose&&("string"==typeof t?console.log("load locally-stored lyrics for song code",t):console.log("load locally-stored lyrics for lyric id",t)),e={},"string"==typeof t?e.code=t:e.lyricId=t,[4,He(this.localLyricsEndpoint+"/token",e)];case 1:return!(r=o.sent())||200!==r.status||r.data.error?[2,null]:(n=r.data.token,e.token=n,[4,He(this.localLyricsEndpoint,e)]);case 2:return(i=o.sent())&&200===i.status?(this.verbose&&console.log("loaded locally-stored lyrics with params",e),[2,i.data]):[2,null]}}))}))},t.prototype.fetchSongleLyricBody=function(t,e){return Ge(this,void 0,void 0,(function(){var r,n,i,o,a,s,l,c,u,h,p;return ze(this,(function(d){switch(d.label){case 0:if(!(r=this.parseUploaderUrl(t)).identifier)throw new Error("unsupported lyrics url "+t);return[4,Ke.getProfile()];case 1:if(n=d.sent(),!Ke.isSongleUser(n))throw new Error("Songle authentication is required");return ir[i=t+"//"+e]?[2,ir[i]]:(Ke.isSpoofingSongleUser(n)&&(a=n.user,s=a.songleUserId,l=a.songleAccessToken,c=a.songleRefreshToken,o={songleUserId:s,songleAccessToken:l,songleRefreshToken:c}),[4,He(Ve.textalive.server+"/songle/users/"+r.user+"/uploads/"+r.identifier,o,{withCredentials:!0,responseType:"text"})]);case 2:return u=d.sent(),h=null==u?void 0:u.data,p=h?{text:h,url:t}:null,h&&(ir[i]=p),[2,p]}}))}))},t.prototype.fetchPiaproLyricBody=function(t,e){return Ge(this,void 0,void 0,(function(){var r,n,i,o,a;return ze(this,(function(s){switch(s.label){case 0:if(!Be.isPiaproUrl(t))throw new Error("unsupported lyrics url "+t);return ir[r=t+"//"+e]?[2,ir[r]]:[4,qe.read(t,!0)];case 1:if(n=s.sent(),!qe.isPiaproAsset(n))throw new Error("unsupported piapro lyrics url "+t);return i=Je(n.contentUrl),[4,this.parseLyricBody(i,e)];case 2:return o=s.sent(),(a=o?{text:o,artist:{name:n.authorName,url:n.authorPath?"https://piapro.jp"+n.authorPath:null},name:n.name,url:t}:null)&&(ir[r]=a),[2,a]}}))}))},t.prototype.fetchInternalLyricBody=function(t,e){return Ge(this,void 0,void 0,(function(){var r;return ze(this,(function(n){if(r=new URL(t),"undefined"==typeof location||location.protocol!==r.protocol||location.hostname!==r.hostname)throw new Error("direct access not supported for lyrics url "+t);return[2,this.fetchCrossOriginLyricBody(t,e)]}))}))},t.prototype.fetchCrossOriginLyricBody=function(t,e){return Ge(this,void 0,void 0,(function(){var r,n,i,o,a;return ze(this,(function(s){switch(s.label){case 0:return ir[r=t+"//"+e]?[2,ir[r]]:[4,He(t,null,{responseType:"text"})];case 1:return n=s.sent(),i=null==n?void 0:n.data,n&&200===n.status&&i?[4,this.parseLyricBody(i,e)]:(this.verbose&&console.error("direct access not supported for lyrics url "+t),[2,this.fetchProxiedLyricBody(t,e)]);case 2:return o=s.sent(),(a=o?{text:o,url:t}:null)&&(ir[r]=a),[2,a]}}))}))},t.prototype.fetchProxiedLyricBody=function(t,e){return Ge(this,void 0,void 0,(function(){var r,n,i;return ze(this,(function(o){switch(o.label){case 0:return ir[r=t+"//"+e]?[2,ir[r]]:(this.verbose&&console.log("load lyrics from the external server",t),[4,or(this.lyricsParserEndpoint+e,(function(e){return new Promise((function(r,n){e.Songle.Utils.url2Lyric(t,(function(t){return r(t)}),(function(t){return n(t)}))}))}),this.verbose)]);case 1:return n=o.sent(),(i=n?{text:n,url:t}:null)&&(ir[r]=i),[2,i]}}))}))},t.prototype.parseLyricBody=function(t,e){return Ge(this,void 0,void 0,(function(){var r;return ze(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,or(this.lyricsParserEndpoint+e,(function(e){return e.Songle.Utils.parseLyric(t)}),this.verbose)];case 1:return r=n.sent(),[3,3];case 2:return n.sent(),i=t.replace(/^\ufeff/,"").replace(/\r/,"").split(/\n/).filter(er).filter((function(t){return!t.match(/^#/)})).join("\n").replace(/^\s+/,""),r=(i=function(t){var e=new RegExp("[\\u4E00-\\u9FAF|\\uFF66-\\uFF9D|\\u31F0-\\u31FF]+[（\\(]([\\u3041-\\u3096\\u309D-\\u309F]+)[\\)）]","g");return t.replace(e,(function(t,e){return e}))}(i=function(t){for(var e,r,n,i,o,a=new RegExp("[（(]?(.)繰り返し[)）]?","g");null!==(r=a.exec(t));)n=r[1],i=new RegExp("^("+n+"[\\s\\S]+?)(?=\\n\\n[^\\u3000|\\s])","m"),null!==(o=t.match(i))&&(e=o[1].replace(new RegExp("^"+n,"m"),"").replace(new RegExp("^\\n"),"").replace(new RegExp("^\\u3000","mg"),""),t=(t=t.replace(i,(function(){return e}))).replace(new RegExp("[（\\(]?"+n+"繰り返し[\\)）]?","g"),e).replace(new RegExp("^"+n,"m"),""));return t}(i=(o=i,s=o.split(/\n/),s.forEach((function(t,e){t.match(/^\S+：\S+$/m)&&(a=e)})),i=void 0!==a&&a<5?s.slice(a+1).join("\n"):o).split(/\n/).filter(er).join("\n")))).split(/\n/).filter(rr).join("\n").replace(/\n\n+/g,"\n\n").replace(/\n+$/g,"\n"),[3,3];case 3:return[2,r]}var i,o,a,s}))}))},t.prototype.fetchLyricBody=function(t,e){var r,n,i=e.parserPath,o=e.directAccess;return Ge(this,void 0,void 0,(function(){var e,a;return ze(this,(function(s){switch(s.label){case 0:if(Xe(t))return this.verbose&&console.log("load lyrics from the data url",t),[2,{text:Je(t)}];if(this.isUploaderUrl(t))return[2,this.fetchSongleLyricBody(t,i)];if(Be.isPiaproUrl(t))return[2,this.fetchPiaproLyricBody(t,i)];s.label=1;case 1:return s.trys.push([1,5,,6]),e=new URL(t),o||"undefined"!=typeof location&&location.protocol!==e.protocol&&"https:"!==e.protocol?[3,4]:"undefined"!=typeof location&&location.hostname!==e.hostname?[3,2]:(o=!0,[3,4]);case 2:return[4,He(this.localLyricsEndpoint+"/cors",{url:t})];case 3:a=s.sent(),o=a&&200===a.status&&(null===(n=null===(r=a.data)||void 0===r?void 0:r.data)||void 0===n?void 0:n.enabled),s.label=4;case 4:return o?(this.verbose&&console.log("load lyrics directly",t),[2,this.fetchCrossOriginLyricBody(t,i)]):[3,6];case 5:return s.sent(),[3,6];case 6:return[2,this.fetchProxiedLyricBody(t,i)]}}))}))},t.prototype.post=function(t){return Ge(this,void 0,void 0,(function(){var e,r;return ze(this,(function(n){switch(n.label){case 0:return e=t.forceUpdate?{url:t.lyricsUrl,force_create:"true"}:{url:t.lyricsUrl},[4,Ye(this.lyricsPostEndpoint+"/songs/"+t.songId+"/lyrics.json",e)];case 1:return(r=n.sent())&&200===r.status&&r.data?[2,{success:!0,lyricsId:r.data.id}]:[2,{success:!1,error:"failed to update lyrics url"}]}}))}))},t.prototype.postPrivate=function(t){return Ge(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,l,c,u,h;return ze(this,(function(p){switch(p.label){case 0:return[4,Ke.getProfile()];case 1:if(e=p.sent(),!Ke.isSongleUser(e))throw new Error("Songle authentication is required");return Ke.isSpoofingSongleUser(e)?(n=e.user,i=n.songleUserId,o=n.songleAccessToken,a=n.songleRefreshToken,s={songleUserId:i,songleAccessToken:o,songleRefreshToken:a},r="?"+Object.keys(s).map((function(t){return t+"="+encodeURIComponent(s[t])})).join("&")):r="",l=t.songId,c=t.lyricsText,(u=new FormData).append("text",c),[4,Ye(Ve.textalive.server+"/songle/me/songs/"+l+"/lyrics.json"+r,u,{withCredentials:!0})];case 2:return(h=p.sent())&&200===h.status&&h.data?[2,{success:!0,lyrics:h.data.data.lyric}]:[2,{success:!1,error:"failed to post lyrics text"}]}}))}))},t.prototype.update=function(t){var e;return Ge(this,void 0,void 0,(function(){var r;return ze(this,(function(n){switch(n.label){case 0:return[4,Ye(this.lyricsPostEndpoint+"/songs/"+t.songCode+"/lyrics/"+t.lyricsId+"/diffs.json",t.lyricsData?{lyric:JSON.stringify(t.lyricsData)}:{source_diff_id:t.lyricsDiffId})];case 1:return r=n.sent(),[2,(null===(e=null==r?void 0:r.data)||void 0===e?void 0:e.lyric_diff)?{success:200===r.status,lyricsId:r.data.lyric_diff.lyric_id,lyricsDiffId:r.data.lyric_diff.id}:{success:200===r.status}]}}))}))},t}()),sr={},lr={},cr=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return Ve.textalive.server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songleEndpoint",{get:function(){return Ve.songle.server},enumerable:!1,configurable:!0}),t.prototype.getSongPathFromUrl=function(t){return Be.getSongPathFromUrl(t)},t.prototype.isUploaderUrl=function(t){return Be.isUploaderUrl(t)},t.prototype.isUploaderPath=function(t){return Be.isUploaderPath(t)},t.prototype.getUploaderGuid=function(t){return Be.getUploaderGuid(t)},t.prototype.getAltSongUrlFromUploaderGuid=function(t){return Be.getAltSongUrlFromUploaderGuid(t)},t.prototype.getSongUrlFromUploaderGuid=function(t){return Be.getSongUrlFromUploaderGuid(t)},t.prototype.getSongUrlFromPath=function(t){return Be.getSongUrlFromPath(t)},t.prototype.isYouTubeUrl=function(t){return Be.isYouTubeUrl(t)},t.prototype.isNicovideoUrl=function(t){return Be.isNicovideoUrl(t)},t.prototype.isVideoSiteUrl=function(t){return Be.isVideoSiteUrl(t)},t.prototype.isPiaproUrl=function(t){return Be.isPiaproUrl(t)},t.prototype.load=function(t){return Ge(this,void 0,void 0,(function(){var e,r;return ze(this,(function(n){switch(n.label){case 0:return e=t.code||"number"==typeof t.id&&String(t.id)||encodeURIComponent(t.songPath),sr[e]?[2,sr[e]]:(sr[e]=this.doLoad(e),[4,sr[e]]);case 1:return r=n.sent(),this.use(r),[2,r]}}))}))},t.prototype.use=function(t){if(t){var e=String(t.song.id),r=t.song.code,n=this.getSongPathFromUrl(t.song.permalink);sr[e]=sr[r]=sr[n]=Promise.resolve(t)}},t.prototype.clearCache=function(){sr={},lr={}},t.prototype.doLoad=function(t){var e;return Ge(this,void 0,void 0,(function(){var r,n,i;return ze(this,(function(o){switch(o.label){case 0:return[4,He(this.songleEndpoint+"/songs/"+t+"?format=json")];case 1:return(r=o.sent())&&200===r.status?(n=r.data,this.isUploaderUrl(null===(e=null==n?void 0:n.song)||void 0===e?void 0:e.permalink)?[4,this.doLoadPrivateSong(n.song.id)]:[3,3]):[2,null];case 2:return(i=o.sent())?[2,je(je({},n),{song:i})]:[2,null];case 3:return[2,n]}}))}))},t.prototype.doLoadPrivateSong=function(t){var e,r;return Ge(this,void 0,void 0,(function(){var n,i,o,a,s,l,c;return ze(this,(function(u){switch(u.label){case 0:return[4,Ke.getProfile()];case 1:return n=u.sent(),Ke.isSongleUser(n)?(Ke.isSpoofingSongleUser(n)&&(o=n.user,a=o.songleUserId,s=o.songleAccessToken,l=o.songleRefreshToken,i={songleUserId:a,songleAccessToken:s,songleRefreshToken:l}),[4,He(this.endpoint+"/songle/me/songs/"+t+".json",i,{withCredentials:!0})]):[2,null];case 2:return(c=u.sent())&&200===c.status&&(null===(r=null===(e=c.data)||void 0===e?void 0:e.data)||void 0===r?void 0:r.song)?[2,c.data.data.song]:[2,null]}}))}))},t.prototype.loadInfo=function(t,e){return Ge(this,void 0,void 0,(function(){var r;return ze(this,(function(n){return r=this.cacheKey(t,e),lr[r]||(lr[r]=this.doLoadInfo(t,{min:!0,revisions:null==e?void 0:e.revisions})),[2,lr[r]]}))}))},t.prototype.loadDetailInfo=function(t,e){return Ge(this,void 0,void 0,(function(){var r;return ze(this,(function(n){return r=this.cacheKey(t,e)+"/dt",lr[r]||(lr[r]=this.doLoadInfo(t,{min:!1,revisions:null==e?void 0:e.revisions})),[2,lr[r]]}))}))},t.prototype.cacheKey=function(t,e){var r=String(t);return(null==e?void 0:e.revisions)&&("number"==typeof e.revisions.chord&&(r+="/cd"+e.revisions.chord),"number"==typeof e.revisions.beat&&(r+="/bt"+e.revisions.beat),"number"==typeof e.revisions.chorus&&(r+="/cr"+e.revisions.chorus)),r},t.prototype.doLoadInfo=function(t,e){var r=void 0===e?{min:!0}:e,n=r.min,i=r.revisions;return Ge(this,void 0,void 0,(function(){var e,r;return ze(this,(function(o){switch(o.label){case 0:return e={min:n?1:0},"number"==typeof(null==i?void 0:i.chord)&&(e.chord_revision_id=i.chord),"number"==typeof(null==i?void 0:i.beat)&&(e.beat_revision_id=i.beat),"number"==typeof(null==i?void 0:i.chorus)&&(e.chorus_revision_id=i.chorus),[4,He(this.songleEndpoint+"/songs/"+t+"/info.json",e)];case 1:return(r=o.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t.prototype.loadVocalAmplitude=function(t){return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return[4,He(this.songleEndpoint+"/songs/"+t+"/vamplitude.json")];case 1:return(e=r.sent())&&200===e.status&&e.data?[2,e.data]:[2,null]}}))}))},t.prototype.loadValenceArousal=function(t){return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return[4,He(this.songleEndpoint+"/songs/"+t+"/av.json")];case 1:return(e=r.sent())&&200===e.status&&e.data?[2,e.data]:[2,null]}}))}))},t.prototype.list=function(t){return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return void 0===t&&(t={}),[4,He(this.endpoint+"/songs",t)];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.listPrivate=function(){return Ge(this,void 0,void 0,(function(){var t,e,r,n,i,o,a;return ze(this,(function(s){switch(s.label){case 0:return[4,Ke.getProfile()];case 1:return t=s.sent(),Ke.isSongleUser(t)?(Ke.isSpoofingSongleUser(t)&&(r=t.user,n=r.songleUserId,i=r.songleAccessToken,o=r.songleRefreshToken,e={songleUserId:n,songleAccessToken:i,songleRefreshToken:o}),[4,He(this.endpoint+"/songle/me/songs.json",je(je({},e),{private:!0}),{withCredentials:!0})]):[2,{data:null,error:"Songle authentication is required"}];case 2:return(a=s.sent())&&200===a.status?[2,a.data]:[2,{data:null,error:"private songs not found"}]}}))}))},t.prototype.create=function(t){return Ge(this,void 0,void 0,(function(){return ze(this,(function(e){return[2,this.doCreate(t,!1)]}))}))},t.prototype.createPrivate=function(t){return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return[4,Ke.getProfile()];case 1:return e=r.sent(),Ke.isSongleUser(e)?[2,this.doCreate(t,!0)]:[2,{success:!1,song:null,error:"Songle authentication is required"}]}}))}))},t.prototype.doCreate=function(t,e){var r,n;return Ge(this,void 0,void 0,(function(){var i,o,a,s,l;return ze(this,(function(c){switch(c.label){case 0:return i=t.url,o=t.name,a=t.artistName,[4,Ke.getToken()];case 1:return s=c.sent(),[4,Ye(e?this.endpoint+"/etc/songs/private":this.endpoint+"/etc/songs",{url:i,name:o,artist:a},{postToken:s,withCredentials:!0})];case 2:return(l=c.sent())&&200===l.status?e?[2,{success:!0,song:l.data.data.song}]:[2,{success:!0,song:l.data.song}]:[2,{success:!1,error:((null===(r=null==l?void 0:l.data)||void 0===r?void 0:r.data)?l.data.data.message:null===(n=null==l?void 0:l.data)||void 0===n?void 0:n.message)||"failed to register a song"}]}}))}))},t.prototype.uploadPrivate=function(t){return Ge(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,l,c;return ze(this,(function(u){switch(u.label){case 0:return[4,Ke.getProfile()];case 1:if(e=u.sent(),!Ke.isSongleUser(e))throw new Error("Songle authentication is required");return Ke.isSpoofingSongleUser(e)?(n=e.user,i=n.songleUserId,o=n.songleAccessToken,a=n.songleRefreshToken,s={songleUserId:i,songleAccessToken:o,songleRefreshToken:a},r="?"+Object.keys(s).map((function(t){return t+"="+encodeURIComponent(s[t])})).join("&")):r="",(l=new FormData).append("file",t),[4,Ye(this.endpoint+"/songle/me/uploads.json"+r,l,{withCredentials:!0})];case 2:return(c=u.sent())&&200===c.status&&c.data?[2,c.data.data]:[2,null]}}))}))},t.prototype.search=function(t,e){return void 0===e&&(e=!0),Ge(this,void 0,void 0,(function(){var r;return ze(this,(function(n){switch(n.label){case 0:return[4,He(this.songleEndpoint+"/songs/search.json",{q:t,lyrics:e?1:0})];case 1:return(r=n.sent())&&200===r.status&&r.data?[2,{success:!0,data:r.data}]:[2,{success:!1}]}}))}))},t.prototype.copySongMap=function(t){var e;return Ge(this,void 0,void 0,(function(){var r,n,i,o;return ze(this,(function(a){switch(a.label){case 0:return r=t.sourceId,n=t.destinationId,i=t.types||["beat","chord","chorus","melody"],[4,Ye(this.endpoint+"/songle/me/songs/"+n+"/actions/copy_music_map.json",{source_id:r,types:i},{withCredentials:!0})];case 1:return(o=a.sent())&&(null===(e=o.data)||void 0===e?void 0:e.success)?[2,{success:!0}]:[2,{success:!1,error:null==o?void 0:o.data}]}}))}))},t.prototype.createStage=function(){var t;return Ge(this,void 0,void 0,(function(){var e,r;return ze(this,(function(n){switch(n.label){case 0:return[4,Ke.getProfile()];case 1:return e=n.sent(),[4,Ye(this.endpoint+"/etc/songs/stage",null,{postToken:null===(t=null==e?void 0:e.status)||void 0===t?void 0:t.token,withCredentials:!0})];case 2:return[2,(null==(r=n.sent())?void 0:r.data)||null]}}))}))},t}()),ur=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return Ve.textalive.server+"/templates/"},enumerable:!1,configurable:!0}),t.prototype.list=function(t){return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return[4,He(""+this.endpoint,t)];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.load=function(t){return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return[4,He(""+(this.endpoint+t))];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.loadByName=function(t){return Ge(this,void 0,void 0,(function(){var e,r,n;return ze(this,(function(i){switch(i.label){case 0:return r="latest",t&&(e=t.match(/(.+)@([0-9]+)/))&&(t=e[1],r=e[2]),[4,He(this.endpoint+t+"/"+r)];case 1:return(n=i.sent())&&200===n.status?[2,n.data]:"latest"!==r?[2,this.loadByName(t)]:[2,null]}}))}))},t.prototype.loadForVideo=function(t,e){return void 0===e&&(e={script:!0,withoutAuthors:!0}),Ge(this,void 0,void 0,(function(){var r;return ze(this,(function(n){switch(n.label){case 0:return[4,He(this.endpoint+"for/"+t,e)];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t.prototype.create=function(t){return Ge(this,void 0,void 0,(function(){var e,r,n;return ze(this,(function(i){switch(i.label){case 0:return[4,Ke.getToken()];case 1:return e=i.sent(),[4,Ye(this.endpoint,t,{postToken:e,withCredentials:!0})];case 2:return(r=i.sent())?200!==r.status||Array.isArray(r.data)||r.data.error?(n=Array.isArray(r.data)?{parseErrors:r.data}:r.data,[2,je(je({},n),{success:!1})]):[2,je(je({},r.data),{success:!0})]:[2,{success:!1}]}}))}))},t.prototype.listContributors=function(t,e){return Ge(this,void 0,void 0,(function(){var r;return ze(this,(function(n){switch(n.label){case 0:return[4,He(""+this.endpoint+t+"/"+e+"/contributors")];case 1:return(r=n.sent())&&200===r.status?[2,r.data]:[2,null]}}))}))},t}()),hr=new(function(){function t(){}return Object.defineProperty(t.prototype,"endpoint",{get:function(){return Ve.textalive.server+"/videos/"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendererEndpoint",{get:function(){return Ve.textalive.server+"/renderer/"},enumerable:!1,configurable:!0}),t.prototype.list=function(t){return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return[4,He(""+this.endpoint,t)];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.load=function(t){return Ge(this,void 0,void 0,(function(){var e,r,n,i,o,a,s;return ze(this,(function(l){switch(l.label){case 0:return e={},[4,Ke.getProfile()];case 1:return r=l.sent(),Ke.isSpoofingSongleUser(r)&&(n=r.user,i=n.songleUserId,o=n.songleAccessToken,a=n.songleRefreshToken,e={songleUserId:i,songleAccessToken:o,songleRefreshToken:a}),[4,He(""+(this.endpoint+t),e,{withCredentials:!0})];case 2:return(s=l.sent())&&200===s.status?[2,s.data]:[2,null]}}))}))},t.prototype.create=function(t){return Ge(this,void 0,void 0,(function(){var e,r;return ze(this,(function(n){switch(n.label){case 0:return[4,Ke.getToken()];case 1:return e=n.sent(),[4,Ye(this.endpoint,t,{postToken:e,withCredentials:!0})];case 2:return(r=n.sent())?200!==r.status||r.data.error?[2,je(je({},r.data),{success:!1})]:[2,je(je({},r.data),{success:!0})]:[2,{success:!1}]}}))}))},t.prototype.delete=function(t){return Ge(this,void 0,void 0,(function(){var e,r;return ze(this,(function(n){switch(n.label){case 0:return[4,Ke.getToken()];case 1:return e=n.sent(),[4,Ye(this.endpoint+"delete",{id:t},{postToken:e,withCredentials:!0})];case 2:return(r=n.sent())&&200===r.status?[2,{success:!0,video:r.data}]:[2,{success:!1,video:null}]}}))}))},t.prototype.listContributors=function(t){return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return[4,He(""+this.endpoint+t+"/contributors",null,{withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.listRenderings=function(t){return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return[4,He(this.rendererEndpoint+"list",{videoId:t},{withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.getRenderingStatus=function(t){return Ge(this,void 0,void 0,(function(){var e;return ze(this,(function(r){switch(r.label){case 0:return[4,He(this.rendererEndpoint+"status",{id:t},{withCredentials:!0})];case 1:return(e=r.sent())&&200===e.status?[2,e.data]:[2,null]}}))}))},t.prototype.render=function(t,e,r){return Ge(this,void 0,void 0,(function(){var n,i,o;return ze(this,(function(a){switch(a.label){case 0:return[4,Ke.getToken()];case 1:return n=a.sent(),i={token:n,videoId:t,quality:e},r&&(i.authentication=!0),[4,Ye(this.rendererEndpoint+"render",i,{withCredentials:!0})];case 2:return(o=a.sent())&&200===o.status?[2,o.data]:[2,null]}}))}))},t.prototype.getDownloadInfo=function(){return Ge(this,void 0,void 0,(function(){var t;return ze(this,(function(e){switch(e.label){case 0:return t={endpoint:this.rendererEndpoint+"download"},[4,Ke.getToken()];case 1:return[2,(t.token=e.sent(),t)]}}))}))},t}()),pr={asset:qe,endpoint:Ve,lyrics:ar,song:cr,template:ur,text:Qe,font:$e,user:Ke,video:hr},dr=function(t,e){return(dr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function fr(t,e){function r(){this.constructor=t}dr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var mr=function(){function t(){this._parent=null,this._children=[],this._previous=null,this._next=null,this._runtime=null,this._templates=[]}return Object.defineProperty(t.prototype,"video",{get:function(){return this.parent&&this.parent.video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this._data?this._data.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return this._data?this._data.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.endTime-this.startTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendering",{get:function(){return this._runtime?this._runtime.rendering:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this._runtime?this._runtime.graphics:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templates",{get:function(){return this._templates.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templateCount",{get:function(){return this._templates.length},enumerable:!1,configurable:!0}),t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?(t-this.startTime)/this.duration:-1},t.prototype.maximize=function(){var t=!1,e=this.endTime,r=Math.max(null===this._parent?0:this._parent.startTime,null===this._previous?0:this._previous.endTime);r!==this.startTime&&(this.moveWithChildren(r-this.startTime),t=!0);var n=Math.min(null===this._parent?this.video.duration:this._parent.endTime,null===this._next?this.video.duration:this._next.startTime);return n!==this.endTime&&(this._data.endTime=n,t=e!==n),t},t.prototype.moveWithChildren=function(t){var e=[];for(e.push(this);e.length>0;){var r=e.pop();null!=r._children&&r._children.forEach((function(t){return e.push(t)})),r._data.startTime+=t,r._data.endTime+=t}},t.prototype.getTemplate=function(t){return void 0===t&&(t=0),t<0||t>=this._templates.length?null:this._templates[t]},t.prototype.addTemplateAt=function(t,e){this._templates.splice(e,0,t),t.assignedUnit=this},t.prototype.addTemplate=function(t){this._templates.push(t),t.assignedUnit=this},t.prototype.removeTemplates=function(){for(var t=this._templates.slice();this._templates.length>0;)this._templates.pop();return t},t.prototype.removeTemplateAt=function(t){if(t<0||t>=this._templates.length)return null;var e=this._templates.splice(t,1)[0];return e.assignedUnit=null,e},t.prototype.removeTemplate=function(t){for(var e=0;e<this._templates.length;e++){var r=this._templates[e];if(r===t)return this._templates.splice(e,1),t.assignedUnit=null,r}return null},t.prototype.getType=function(){return Pe.NONE},t.prototype.toString=function(){return"RenderingUnit"},t}();function gr(t,e){return"number"==typeof e&&!isNaN(e)&&e>t?e:t}function vr(t,e){return"number"==typeof e&&!isNaN(e)&&e<t?e:t}var yr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return fr(e,t),Object.defineProperty(e.prototype,"text",{get:function(){var t="";return this.children.forEach((function(e){t+=e.text})),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.children.reduce((function(t,e){return null===t?e.color:void 0===t||t.eq(e.color)?t:void 0}),null)},set:function(t){null!==t&&this.children.forEach((function(e){e.color=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{set:function(t){null!==t&&this.children.forEach((function(e){e.font=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this.children.reduce((function(t,e){var r=e.fontFamily;return void 0===t||null!==t&&t!==r?void 0:r}),null)},set:function(t){this.children.forEach((function(e){e.fontFamily=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this.children.reduce((function(t,e){var r=e.fontStyle;return void 0===t||null!==t&&t!==r?void 0:r}),null)},set:function(t){this.children.forEach((function(e){e.fontStyle=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.children.length<=0?0:this.children.reduce((function(t,e){return t+e.fontSize}),0)/this.children.length},set:function(t){this.children.forEach((function(e){e.fontSize=t}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"advance",{get:function(){return this.children.reduce((function(t,e){return t+e.advance}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ascent",{get:function(){return this.children.reduce((function(t,e){return Math.max(t,e.ascent)}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this.children.reduce((function(t,e){return Math.max(t,e.descent)}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.ascent+this.descent},enumerable:!1,configurable:!0}),e.prototype.expandTime=function(t){return{startTime:vr(this.startTime,t.startTime),endTime:gr(this.endTime,t.endTime)}},e.prototype.toString=function(){return this.text},e}(mr),_r=function(){function t(t){this.a=0,this.r=0,this.g=0,this.b=0,this.from(t)}return Object.defineProperty(t.prototype,"value",{get:function(){return(((this.a<<8)+this.r<<8)+this.g<<8)+this.b},set:function(t){this.fromNumber(t,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgb",{get:function(){return"rgb("+this.r+","+this.g+","+this.b+")"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rgba",{get:function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a/255+")"},enumerable:!1,configurable:!0}),t.prototype.eq=function(e){return typeof this==typeof e&&e instanceof t&&this.value===e.value},t.prototype.toString=function(t){return void 0===t&&(t=!0),t?this.rgba:this.rgb},t.prototype.from=function(t){if(void 0===t&&(t="#000"),"object"==typeof t){if(!t)return;return"number"==typeof t.value?void(this.value=t.value):"number"==typeof t.r&&"number"==typeof t.g&&"number"==typeof t.b?(this.a="number"==typeof t.a?t.a:255,this.r=t.r,this.g=t.g,void(this.b=t.b)):void 0}"string"==typeof t?this.fromString(t):"number"==typeof t&&this.fromNumber(t)},t.prototype.fromString=function(t){if(t){if("#"===t.charAt(0)&&(t=t.substr(1)),4===t.length){var e=t.charAt(0),r=t.charAt(1),n=t.charAt(2),i=t.charAt(3);t=""+e+e+r+r+n+n+i+i}3===t.length&&(r=t.charAt(0),n=t.charAt(1),i=t.charAt(2),t=""+r+r+n+n+i+i);var o=parseInt(t,16);this.fromNumber(o,8===t.length)}},t.prototype.fromNumber=function(t,e){void 0===e&&(e=!0),isNaN(t)||(this.a=e?t>>24&255:255,this.r=t>>16&255,this.g=t>>8&255,this.b=255&t)},t}(),br=function(){function t(t,e,r){void 0===t&&(t="Noto Sans Japanese"),void 0===e&&(e=40),void 0===r&&(r=""),this._family=t,this._size=e,this._style=r}return Object.defineProperty(t.prototype,"family",{get:function(){return this._family},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},enumerable:!1,configurable:!0}),t.prototype.deriveFamily=function(e){return new t(e,this._size,this._style)},t.prototype.deriveStyle=function(e){return new t(this._family,this._size,e)},t.prototype.deriveSize=function(e){return new t(this._family,e,this._style)},t.prototype.clone=function(){return new t(this._family,this._size,this._style)},t.prototype.eq=function(t){return this._family===t._family&&this._size===t._size&&this._style===t._style},t.prototype.toString=function(t){void 0===t&&(t=1);var e,r=function(t){if(!t||t.length<=0)return[];for(var e=[],r="",n=!1,i=!1,o=!1,a=0,s=t;a<s.length;a++){var l=s[a];if(i?o?o=!1:"\\"===l?o=!0:l===i&&(i=!1):'"'===l||"'"===l?i=l:","===l&&(n=!0),n){var c=r.trim();""!==c&&e.push(c),r="",n=!1}else r+=l}var u=r.trim();return""!==u&&e.push(u),e}(this._family);return e=r.length<1?"":r.length>1?" "+r.join(", "):(e=r[0]).length>1&&e[0]!==e[e.length-1]||"'"!==e[0]&&'"'!==e[0]?" '"+e+"'":" "+e,this._style+(this._style.length>0?" ":"")+this._size*t+"px"+e},t}(),xr=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r._font=new br(e&&e.fontFamily,e&&e.fontSize,e&&e.fontStyle),r._color=new _r,r}return fr(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._data&&this._data.char||"?"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"advance",{get:function(){return this._runtime?this._runtime.advance:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ascent",{get:function(){return this._runtime?this._runtime.ascent:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"descent",{get:function(){return this._runtime?this._runtime.descent:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this._font},set:function(t){null===t||this.font.eq(t)||(this._font=t.clone(),this._data.fontFamily=t.family,this._data.fontSize=t.size,this._data.fontStyle=t.style,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this.font.family},set:function(t){this.font.family!==t&&(this._font=this.font.deriveFamily(t),this._data.fontFamily=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this.font.style},set:function(t){this.font.style!==t&&(this._font=this.font.deriveStyle(t),this._data.fontStyle=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.font.size},set:function(t){isNaN(t)||this.font.size===t||(this._font=this.font.deriveSize(t),this._data.fontSize=t,this._runtime&&this._runtime.onFontUpdate(this.font))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){t&&!t.eq(this.color)&&(this._color=t,this._runtime&&this._runtime.onColorUpdate(t))},enumerable:!1,configurable:!0}),e.prototype.getType=function(){return Pe.CHAR},e}(yr),wr=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r}return fr(e,t),e.prototype.getType=function(){return Pe.GRAPHIC},e.prototype.toString=function(){return"Graphic"},e}(mr),Er=function(t){function e(e){var r=t.call(this)||this;return r._data=e,r}return fr(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.firstChar?this.firstChar.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.lastChar?this.lastChar.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._data&&this._data.pos||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawPos",{get:function(){return this._data&&this._data.rawPoS||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"language",{get:function(){return this._data&&this._data.language||""},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"countDown",{get:function(){return this._data?this._data.countDown:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"countUp",{get:function(){return this._data?this._data.countUp:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"initialCount",{get:function(){return this._data?this._data.initialCount:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"charCount",{get:function(){return this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChar",{get:function(){return this._children.length<=0?null:this._children[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChar",{get:function(){return this._children.length<=0?null:this._children[this._children.length-1]},enumerable:!1,configurable:!0}),e.prototype.addChar=function(t){if(t){this._children.length>0&&(t._previous=this.lastChar,this.lastChar._next=t),this._children.push(t),t._parent=this;var e=this.expandTime(t),r=e.startTime,n=e.endTime;this._data.startTime=r,this._data.endTime=n}},e.prototype.findIndex=function(t){return t instanceof xr?this._children.indexOf(t):-1},e.prototype.getType=function(){return Pe.WORD},e}(yr),Mr=function(t){function e(e,r){var n=t.call(this)||this;return n._video=e,n._data=r,n.createUnits(),n}return fr(e,t),e.prototype.createUnits=function(){var t=this,e=this._data;e&&Array.isArray(e.words)&&e.words.forEach((function(e){if(e){var r=new Er(e);Array.isArray(e.characters)&&e.characters.forEach((function(t){return r.addChar(new xr(t))})),t.addWord(r)}}))},Object.defineProperty(e.prototype,"children",{get:function(){return this._children.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"next",{get:function(){return this._next},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.firstChar?this.firstChar.startTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.lastChar?this.lastChar.endTime:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wordCount",{get:function(){return this._children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"charCount",{get:function(){return this._children.reduce((function(t,e){return t+e.charCount}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstWord",{get:function(){return this._children.length<=0?null:this._children[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastWord",{get:function(){return this._children.length<=0?null:this._children[this._children.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstChar",{get:function(){var t=this.firstWord;return null===t?null:t.firstChar},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastChar",{get:function(){var t=this.lastWord;return null===t?null:t.lastChar},enumerable:!1,configurable:!0}),e.prototype.getWord=function(t){return t<0||t>=this._children.length?null:this._children[t]},e.prototype.getChar=function(t){if(t<0)return null;for(var e=0,r=this.firstWord;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},e.prototype.addWord=function(t){if(t){this._children.length>0&&(t._previous=this.lastWord,t._previous._next=t,t.firstChar._previous=t._previous.lastChar,t._previous.lastChar._next=t.firstChar),this._children.push(t),t._parent=this;var e=this.expandTime(t),r=e.startTime,n=e.endTime;this._data.startTime=r,this._data.endTime=n}},e.prototype.findIndex=function(t){if(t instanceof Er)return this._children.indexOf(t);if(t instanceof xr){for(var e=0,r=!1,n=0,i=this._children;n<i.length;n++){var o=i[n],a=o.findIndex(t);if(!(a<0)){e+=a,r=!0;break}e+=o.charCount}return r?e:-1}return-1},e.prototype.getType=function(){return Pe.PHRASE},e}(yr);function Sr(t,e,r){if(!t||t.length<=0)return null;var n=Ce.sortedIndex(t,e,(function(t){return t.endTime}));if(n<0)return null;if("number"==typeof(null==r?void 0:r.endTime)){n>=t.length&&(n=t.length-1);var i=e,o=r.endTime;return t[n].overlaps(i,o)?t[n]:n<1?null:t[n-1].overlaps(i,o)?t[n-1]:null}return n>=t.length?null:(null==r?void 0:r.loose)||t[n].contains(e)?t[n]:null}var Tr=function(){function t(t){this._credits=[],this._phrases=[],this._graphics=[],this.data=t||{},this.createUnits()}return Object.defineProperty(t.prototype,"credits",{get:function(){return this._credits.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"phrases",{get:function(){return this._phrases.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this._graphics.slice()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rendering",{get:function(){return this._runtime.rendering},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.data.duration||0},set:function(t){this.data.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"startTime",{get:function(){return this.data.startTime||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endTime",{get:function(){return this.data.endTime||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"creditCount",{get:function(){return this._credits.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"phraseCount",{get:function(){return this._phrases.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphicCount",{get:function(){return this._graphics.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wordCount",{get:function(){return this._phrases.reduce((function(t,e){return t+e.wordCount}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"charCount",{get:function(){return this._phrases.reduce((function(t,e){return t+e.charCount}),0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstCredit",{get:function(){return this._credits.length<=0?null:this._credits[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastCredit",{get:function(){return this._credits.length<=0?null:this._credits[this._credits.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstPhrase",{get:function(){return this._phrases.length<=0?null:this._phrases[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastPhrase",{get:function(){return this._phrases.length<=0?null:this._phrases[this._phrases.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstWord",{get:function(){var t;return(null===(t=this.firstPhrase)||void 0===t?void 0:t.firstWord)||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastWord",{get:function(){var t;return(null===(t=this.lastPhrase)||void 0===t?void 0:t.lastWord)||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstChar",{get:function(){var t;return(null===(t=this.firstWord)||void 0===t?void 0:t.firstChar)||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChar",{get:function(){var t;return(null===(t=this.lastWord)||void 0===t?void 0:t.lastChar)||null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"firstGraphic",{get:function(){return this._graphics.length<=0?null:this._graphics[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastGraphic",{get:function(){return this._graphics.length<=0?null:this._graphics[this._graphics.length-1]},enumerable:!1,configurable:!0}),t.prototype.createUnits=function(){var t,e,r=this;Array.isArray(this.data.credits)?(this.data.credits.sort(Ar),this.data.credits.forEach((function(t){return r.doAddCredit(new Mr(r,t),!1)})),this.organizeTimings(null===(t=this.firstCredit)||void 0===t?void 0:t.firstChar)):this.data.credits=[],Array.isArray(this.data.phrases)?(this.data.phrases.sort(Ar),this.data.phrases.forEach((function(t){return r.doAddPhrase(new Mr(r,t),!1)})),this.organizeTimings(null===(e=this.firstPhrase)||void 0===e?void 0:e.firstChar)):this.data.phrases=[],Array.isArray(this.data.graphics)?(this.data.graphics.sort(Ar),this.data.graphics.forEach((function(t){return r.doAddGraphic(new wr(t),!1)}))):this.data.graphics=[]},t.prototype.organizeTimings=function(t){for(;t;)t.startTime===t.endTime&&t.maximize(),t=t.next},t.prototype.exportData=function(e){this.updateTemplateData(e);for(var r=t.exportUnitData(this.data.credits,!0),n=r.units,i=r.templateClasses,o=t.exportUnitData(this.data.phrases,!1),a=o.units,s=o.templateClasses,l=t.exportUnitData(this.data.graphics,!0),c=l.units,u=l.templateClasses,h=i.concat(s,u).filter((function(t,e,r){return r.indexOf(t)===e})),p={};h.length>0;){var d=h.shift(),f=e.getByName(d);if(f){p[d]=f.id;for(var m=0,g=e.getRequiredTemplates(f.script);m<g.length;m++){var v=g[m];p[v]||h.push(v)}}else console.log("template class not found",d)}return{credits:n,phrases:a,graphics:c,templateClasses:p}},t.exportUnitData=function(e,r){if(void 0===r&&(r=!1),!e)return{units:[],templateClasses:[]};for(var n=[],i=[],o=0,a=e;o<a.length;o++){var s=a[o],l={templates:s.templates?s.templates.map((function(t){var e=t.type;i.push(e);var r={};return Object.keys(t.value).forEach((function(e){var n=t.value[e];r[e]="object"==typeof n?Object.assign({},n):n})),{type:e,value:r}})):[]},c=void 0;if(s.words){var u=s,h=t.exportUnitData(u.words);l.words=h.units,c=h.templateClasses}else if(s.characters){var p=s,d=t.exportUnitData(p.characters);l.characters=d.units,c=d.templateClasses}else{for(var f=0,m=["fontFamily","fontSize","fontStyle"];f<m.length;f++){var g=m[f];s[g]&&(l[g]=s[g])}c=[]}r&&(l.startTime=s.startTime,l.endTime=s.endTime),n.push(l),i=i.concat(c)}return{units:n,templateClasses:i=i.filter((function(t,e,r){return r.indexOf(t)===e}))}},t.prototype.updateTemplateData=function(e){t.updateTemplateDataForUnits(e,this.firstCredit,this.data.credits),t.updateTemplateDataForUnits(e,this.firstPhrase,this.data.phrases),t.updateTemplateDataForUnits(e,this.firstGraphic,this.data.graphics)},t.updateTemplateDataForUnits=function(e,r,n){if(r&&n)for(var i=0,o=n;i<o.length;i++){var a=o[i];a.templates=[];for(var s=0;s<r.templateCount;s++){var l=r.getTemplate(s),c=e.exportInstance(l);a.templates.push(c)}if(a.words){var u=a;t.updateTemplateDataForUnits(e,r.children[0],u.words)}else if(a.characters){var h=a;t.updateTemplateDataForUnits(e,r.children[0],h.characters)}r=r.next}},t.prototype.addCredit=function(t){this.doAddCredit(t,!0)},t.prototype.doAddCredit=function(t,e){var r=this.addRenderingUnit(this._credits,t);e&&this.data.credits.splice(r,0,t._data),this._runtime&&this._runtime.addCredit(t)},t.prototype.addPhrase=function(t){this.doAddPhrase(t,!0)},t.prototype.doAddPhrase=function(t,e){var r=this.addRenderingUnit(this._phrases,t);e&&this.data.phrases.splice(r,0,t._data),this._runtime&&this._runtime.addPhrase(t)},t.prototype.addGraphic=function(t){this.doAddGraphic(t,!0)},t.prototype.doAddGraphic=function(t,e){if(t){var r=this.addRenderingUnit(this._graphics,t);e&&this.data.graphics.splice(r,0,t._data),this._runtime&&this._runtime.addGraphic(t)}},t.prototype.addRenderingUnit=function(t,e){if(e){var r=Ce.sortedIndex(t,e,Cr),n=r>0?t[r-1]:null,i=r<t.length?t[r]:null;if(t.splice(r,0,e),n&&(e._previous=n,e._previous._next=e),i&&(i._previous=e,e._next=i),e instanceof Mr&&e.wordCount>0){for(var o=n;o&&!o.lastWord;)o=o.previous;for(var a=i;a&&!a.firstWord;)a=a.next;if(o&&(e.firstWord._previous=o.lastWord,o.lastWord._next=e.firstWord),a&&(e.lastWord._next=a.firstWord,a.firstWord._previous=e.lastWord),e.charCount>0){for(var s=null==o?void 0:o.lastWord;s&&null===s.lastChar;)s=s.previous;for(var l=null==a?void 0:a.firstWord;l&&null===l.firstChar;)l=l.next;s&&(e.firstChar._previous=s.lastChar,s.lastChar._next=e.firstChar),l&&(e.lastChar._next=l.firstChar,l.firstChar._previous=e.lastChar)}}return this.updateStartAndEndTime(),r}},t.prototype.removeCredit=function(t){var e=this.removeRenderingUnit(this._credits,t);return!(e<0||(this.data.credits.splice(e,1),this._runtime&&this._runtime.removeCredit(t),0))},t.prototype.removeCredits=function(){var t=this;this._runtime&&this._credits.forEach((function(e){return t._runtime.removeCredit(e)})),this._credits=[],this.data.credits.splice(0,this.data.credits.length)},t.prototype.removePhrase=function(t){var e=this.removeRenderingUnit(this._phrases,t);return!(e<0||(this.data.phrases.splice(e,1),this._runtime&&this._runtime.removePhrase(t),0))},t.prototype.removePhrases=function(){var t=this;this._runtime&&this._phrases.forEach((function(e){return t._runtime.removePhrase(e)})),this._phrases=[],this.data.phrases.splice(0,this.data.phrases.length)},t.prototype.removeGraphic=function(t){var e=this.removeRenderingUnit(this._graphics,t);return!(e<0||(this.data.graphics.splice(e,1),this._runtime&&this._runtime.removeGraphic(t),0))},t.prototype.removeGraphics=function(){var t=this;this._runtime&&this._graphics.forEach((function(e){return t._runtime.removeGraphic(e)})),this._graphics=[],this.data.graphics.splice(0,this.data.graphics.length),this.rendering.reset()},t.prototype.removeRenderingUnit=function(t,e){var r=Ce.sortedIndex(t,e,Cr);if(r<0||t[r]!==e)return-1;if(t.splice(r,1),e instanceof Mr){if(e.charCount>0){for(var n=e._previous;n&&null===n.lastChar;)n=n.previous;for(var i=e._next;i&&null===i.firstChar;)i=i.next;n&&i?(n.lastChar._next=i.firstChar,i.firstChar._previous=n.lastChar):n?n.lastChar._next=null:i&&(i.firstChar._previous=null)}if(e.wordCount>0){for(n=e._previous;n&&null===n.lastWord;)n=n.previous;for(i=e._next;i&&null===i.firstWord;)i=i.next;n&&i?(n.lastWord._next=i.firstWord,i.firstWord._previous=n.lastWord):n?n.lastWord._next=null:i&&(i.firstWord._previous=null)}}e._previous&&(e._previous._next=e._next),e._next&&(e._next._previous=e._previous),this.updateStartAndEndTime()},t.prototype.updateStartAndEndTime=function(){var t,e,r,n,i,o,a,s;this.data.endTime=Math.max((null===(e=null===(t=this.lastCredit)||void 0===t?void 0:t.lastChar)||void 0===e?void 0:e.endTime)||0,(null===(r=this.lastChar)||void 0===r?void 0:r.endTime)||0,(null===(n=this.lastGraphic)||void 0===n?void 0:n.endTime)||0);var l=null===(o=null===(i=this.firstCredit)||void 0===i?void 0:i.firstChar)||void 0===o?void 0:o.startTime,c=null===(a=this.firstChar)||void 0===a?void 0:a.startTime,u=null===(s=this.firstGraphic)||void 0===s?void 0:s.startTime;this.data.startTime=Math.min("number"==typeof l?l:Number.MAX_VALUE,"number"==typeof c?c:Number.MAX_VALUE,"number"==typeof u?u:Number.MAX_VALUE,this.data.endTime)},t.prototype.findIndex=function(t){if(t instanceof Mr)return(e=this._phrases.indexOf(t))>=0?e:this._credits.indexOf(t);if(t instanceof Er){for(var e=0,r=!1,n=0,i=this._phrases;n<i.length;n++){if(!((l=(s=i[n]).findIndex(t))<0)){e+=l,r=!0;break}e+=s.wordCount}return r?e:-1}if(t instanceof xr){e=0,r=!1;for(var o=0,a=this._phrases;o<a.length;o++){var s,l;if(!((l=(s=a[o]).findIndex(t))<0)){e+=l,r=!0;break}e+=s.charCount}return r?e:-1}return t instanceof wr?this._graphics.indexOf(t):-1},t.prototype.getCredit=function(t){return t<0||t>=this._credits.length?null:this._credits[t]},t.prototype.getPhrase=function(t){return t<0||t>=this._phrases.length?null:this._phrases[t]},t.prototype.getWord=function(t){if(t<0)return null;for(var e=0,r=this.firstPhrase;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},t.prototype.getChar=function(t){if(t<0)return null;for(var e=0,r=this.firstWord;;){if(!r)return null;if(e+r.children.length>t)break;e+=r.children.length,r=r.next}return r.children[t-e]},t.prototype.getGraphic=function(t){return t<0||t>=this._graphics.length?null:this._graphics[t]},t.prototype.findCredit=function(t,e){return Sr(this._credits,t,e)},t.prototype.findPhrase=function(t,e){return Sr(this._phrases,t,e)},t.prototype.findWord=function(t,e){var r=this.findPhrase(t,e);return r?Sr(r._children,t,e):null},t.prototype.findChar=function(t,e){var r=this.findWord(t,e);return r?Sr(r._children,t,e):null},t.prototype.findGraphic=function(t,e){return Sr(this._graphics,t,e)},t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?(t-this.startTime)/this.duration:-1},t}();function Ar(t,e){return t.startTime-e.startTime}function Cr(t){return t.startTime}var Pr=function(){function t(t,e,r,n,i,o){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),this.setValues(t,e,r,n,i,o)}return t.prototype.setValues=function(t,e,r,n,i,o){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=o,this},t.prototype.append=function(t,e,r,n,i,o){var a=this.a,s=this.b,l=this.c,c=this.d;return 1==t&&0==e&&0==r&&1==n||(this.a=a*t+l*e,this.b=s*t+c*e,this.c=a*r+l*n,this.d=s*r+c*n),this.tx=a*i+l*o+this.tx,this.ty=s*i+c*o+this.ty,this},t.prototype.prepend=function(t,e,r,n,i,o){var a=this.a,s=this.c,l=this.tx;return this.a=t*a+r*this.b,this.b=e*a+n*this.b,this.c=t*s+r*this.d,this.d=e*s+n*this.d,this.tx=t*l+r*this.ty+i,this.ty=e*l+n*this.ty+o,this},t.prototype.appendMatrix=function(t){return this.append(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.prependMatrix=function(t){return this.prepend(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.appendTransform=function(e,r,n,i,o,a,s,l,c){var u,h,p;return o%360?(u=o*t.DEG_TO_RAD,h=Math.cos(u),p=Math.sin(u)):(h=1,p=0),a||s?(a*=t.DEG_TO_RAD,s*=t.DEG_TO_RAD,this.append(Math.cos(s),Math.sin(s),-Math.sin(a),Math.cos(a),e,r),this.append(h*n,p*n,-p*i,h*i,0,0)):this.append(h*n,p*n,-p*i,h*i,e,r),(l||c)&&(this.tx-=l*this.a+c*this.c,this.ty-=l*this.b+c*this.d),this},t.prototype.prependTransform=function(e,r,n,i,o,a,s,l,c){var u,h,p;return o%360?(u=o*t.DEG_TO_RAD,h=Math.cos(u),p=Math.sin(u)):(h=1,p=0),(l||c)&&(this.tx-=l,this.ty-=c),a||s?(a*=t.DEG_TO_RAD,s*=t.DEG_TO_RAD,this.prepend(h*n,p*n,-p*i,h*i,0,0),this.prepend(Math.cos(s),Math.sin(s),-Math.sin(a),Math.cos(a),e,r)):this.prepend(h*n,p*n,-p*i,h*i,e,r),this},t.prototype.rotate=function(e){e*=t.DEG_TO_RAD;var r=Math.cos(e),n=Math.sin(e),i=this.a,o=this.b;return this.a=i*r+this.c*n,this.b=o*r+this.d*n,this.c=-i*n+this.c*r,this.d=-o*n+this.d*r,this},t.prototype.skew=function(e,r){return e*=t.DEG_TO_RAD,r*=t.DEG_TO_RAD,this.append(Math.cos(r),Math.sin(r),-Math.sin(e),Math.cos(e),0,0),this},t.prototype.scale=function(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this},t.prototype.translate=function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,n=this.d,i=this.tx,o=t*n-e*r;return this.a=n/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-n*i)/o,this.ty=-(t*this.ty-e*i)/o,this},t.prototype.isIdentity=function(){return 0===this.tx&&0===this.ty&&1===this.a&&0===this.b&&0===this.c&&1===this.d},t.prototype.equals=function(t){return this.tx===t.tx&&this.ty===t.ty&&this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d},t.prototype.transformPoint=function(t,e,r){return r.x=t*this.a+e*this.c+this.tx,r.y=t*this.b+e*this.d+this.ty,r},t.prototype.decompose=function(e){void 0===e&&(e={}),e.x=this.tx,e.y=this.ty,e.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),e.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var r=Math.atan2(-this.c,this.d),n=Math.atan2(this.b,this.a);return Math.abs(1-r/n)<1e-5?(e.rotation=n/t.DEG_TO_RAD,this.a<0&&this.d>=0&&(e.rotation+=e.rotation<=0?180:-180),e.skewX=e.skewY=0):(e.skewX=r/t.DEG_TO_RAD,e.skewY=n/t.DEG_TO_RAD),e},t.prototype.copy=function(t){return this.setValues(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.clone=function(){return new t(this.a,this.b,this.c,this.d,this.tx,this.ty)},t.prototype.toString=function(){return"["+this.constructor.name+" (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},t.DEG_TO_RAD=Math.PI/180,t.identity=new t,t}(),Or=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.setValues(t,e)}return t.prototype.setValues=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e,this},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.toString=function(){return"["+this.constructor.name+" (x="+this.x+" y="+this.y+")]"},t}(),Rr=function(){function t(){this.tx=new Pr,this.alpha=0,this.composite="",this.visible=!0}return t.prototype.reset=function(){},t}(),Lr=function(){function t(){this.rendering=new Rr}return t.prototype.addCredit=function(t){this.doAddPhrase(t)},t.prototype.removeCredit=function(t){t._runtime=null},t.prototype.addPhrase=function(t){this.doAddPhrase(t)},t.prototype.removePhrase=function(t){t._runtime=null},t.prototype.doAddPhrase=function(t){t._runtime={graphics:{clear:function(){}},rendering:new Rr,update:function(){}};for(var e=t.firstWord;e;){e._runtime={graphics:{clear:function(){}},rendering:new Rr,update:function(){}};for(var r=e.firstChar;r&&(r._runtime={graphics:{clear:function(){}},rendering:new Rr,update:function(){},advance:0,ascent:0,descent:0,onFontUpdate:function(){},onColorUpdate:function(){}},r!==e.lastChar);)r=r.next;if(e===t.lastWord)break;e=e.next}},t.prototype.addGraphic=function(t){t._runtime={graphics:{clear:function(){}},rendering:new Rr,update:function(){}}},t.prototype.removeGraphic=function(t){t._runtime=null},t}(),Ir=function(){function t(){this.wrapperTable={}}return t.prototype.isGraphics=function(){return!1},t.prototype.setCanvas=function(){return Promise.resolve()},t.prototype.createRuntime=function(t){return function(t,e,r,n){return new(r||(r=Promise))((function(e,i){function o(t){try{s(n.next(t))}catch(t){i(t)}}function a(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(t){t(n)}))).then(o,a)}s((n=n.apply(t,[])).next())}))}(this,0,void 0,(function(){var e,r,n;return function(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o}(this,(function(i){for(this.video=t,t._runtime=new Lr,e=t.firstCredit;e;)t._runtime.addCredit(e),e=e.next;for(r=t.firstPhrase;r;)t._runtime.addPhrase(r),r=r.next;for(n=t.firstGraphic;n;)t._runtime.addGraphic(n),n=n.next;return[2,t._runtime]}))}))},t.prototype.reset=function(){var t,e;this.resetTextUnitsFrom(this.video.firstCredit),this.resetTextUnitsFrom(null===(t=this.video.firstCredit)||void 0===t?void 0:t.firstWord),this.resetTextUnitsFrom(null===(e=this.video.firstCredit)||void 0===e?void 0:e.firstChar),this.resetTextUnitsFrom(this.video.firstPhrase),this.resetTextUnitsFrom(this.video.firstWord),this.resetTextUnitsFrom(this.video.firstChar),this.video._runtime.rendering.reset()},t.prototype.resetTextUnitsFrom=function(t){for(;t;)t.rendering.reset(),t.graphics.clear(),t=t.next},t.prototype.update=function(){var t,e;this.updateCharsFrom(null===(t=this.video.firstCredit)||void 0===t?void 0:t.firstChar),this.updateCharsFrom(null===(e=this.video.firstPhrase)||void 0===e?void 0:e.firstChar)},t.prototype.updateCharsFrom=function(t){for(;t;)t._runtime.update(),t=t.next},t.prototype.updateStageTx=function(){},t}();function Nr(t){var e=parseFloat(t);return isNaN(e)?0:e}function Br(t){var e;if(!(null===(e=null===window||void 0===window?void 0:window.location)||void 0===e?void 0:e.search))return null;for(var r=0,n=window.location.search.substring(1).split("&");r<n.length;r++){var i=n[r].split("=");if(decodeURIComponent(i[0])===t)return decodeURIComponent(i[1])}return null}Object.freeze({__proto__:null,cancelIdleCallback:function(t){return window.cancelIdleCallback?window.cancelIdleCallback(t):clearTimeout(t)},requestIdleCallback:function(t,e){if(window.requestIdleCallback)return window.requestIdleCallback(t,e);var r=Date.now(),n=e?e.timeout:50;return setTimeout((function(){t({didTimeout:!1,timeRemaining:function(){return Math.max(0,n-(Date.now()-r))}})}),1)},getNumber:Nr,getQueryVariable:Br});var Dr=function(t,e){return(Dr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function kr(t,e){function r(){this.constructor=t}Dr(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var Ur=function(){return(Ur=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function Fr(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function s(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}l((n=n.apply(t,e||[])).next())}))}function jr(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o}function Gr(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}var zr,Vr=[0,0,0,0],Hr=function(){function t(){this._position=0,this._wait=50,this.update=this.update.bind(this)}return Object.defineProperty(t.prototype,"wait",{get:function(){return this._wait},set:function(t){this._wait=t,this._isPlaying&&this.start()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){if(!this.isPlaying)return this._position;var t=this.basePosition.position+(Date.now()-this.basePosition.time);return Math.min(t,this.player.video.duration)},enumerable:!1,configurable:!0}),t.prototype.initialize=function(t){var e=t.player,r=t.updater,n=t.emitter;return Fr(this,void 0,void 0,(function(){return jr(this,(function(t){return this.player=e,this.updateMediaPosition=r,this.emitter=n,[2]}))}))},t.prototype.play=function(){this.start(),this.emitter.onPlay()},t.prototype.stop=function(){this.clearInterval(),this._isPlaying=!1,this.seek(0),this.pause(),this.emitter.onStop()},t.prototype.pause=function(){this.clearInterval(),this._isPlaying=!1,this.emitter.onPause()},t.prototype.seek=function(t){var e=this;this._position=t,this.updateMediaPosition(t).then((function(){e.emitter.onSeek(t)})),this.isPlaying&&this.start()},t.prototype.dispose=function(){this.clearInterval()},t.prototype.clearInterval=function(){window.clearInterval(this.intervalId)},t.prototype.start=function(){this.clearInterval(),this._isPlaying=!0,this.basePosition={time:Date.now(),position:this._position},this.intervalId=window.setInterval(this.update,this.wait)},t.prototype.update=function(){this.player.video||this.stop();var t=this.basePosition.position+(Date.now()-this.basePosition.time);this._position=Math.min(t,this.player.video.duration),this.updateMediaPosition(this.position),this._position>=this.player.video.duration&&this.stop()},t}();function Wr(){return Fr(this,void 0,void 0,(function(){return jr(this,(function(t){return zr&&zr.Player?[2,zr]:"undefined"==typeof window?[2,o("23ROJ")]:window.Songle&&window.Songle.Player?[2,window.Songle]:[2,new Promise((function(t){var e=!1;window.onSongleAPIReady=function(r){e=!0,t(zr=r)},setTimeout((function(){if(!e){var t=[];document.querySelectorAll("script").forEach((function(e){var r=e.getAttribute("src");r&&r.indexOf("songle.jp/v2/api.js")>=0&&t.push(e)})),t.forEach((function(t){return t.parentElement.removeChild(t)}));var r=document.createElement("script");r.src="https://api.songle.jp/v2/api.js",document.head.appendChild(r)}}),1e3)}))]}))}))}o.register("23ROJ",(function(t,e){t.exports=o("6dgSG")(o("2c4dZ").getBundleURL()+o("6SpJm")("52rwg","1kyaB")).then((()=>o("11wwW")))})),o.register("6dgSG",(function(t,e){var r=o("7CaZe");t.exports=r((function(t){return new Promise((function(e,r){let n=document.getElementsByTagName("script");if([].concat(n).some((function(e){return e.src===t})))e();else{var i=document.createElement("script");i.async=!0,i.type="text/javascript",i.charset="utf-8",i.src=t,i.onerror=function(t){i.onerror=i.onload=null,i.remove(),r(t)},i.onload=function(){i.onerror=i.onload=null,e()},document.getElementsByTagName("head")[0].appendChild(i)}}))}))})),o.register("7CaZe",(function(t,e){"use strict";let r={},n={},i={};function o(t){switch(t){case"preload":return n;case"prefetch":return i;default:return r}}t.exports=function(t,e){return function(r){let n=o(e);return n[r]?n[r]:n[r]=t.apply(null,arguments).catch((function(t){throw delete n[r],t}))}}})),o.register("2c4dZ",(function(e,r){var n;t(e.exports,"getBundleURL",(()=>n),(t=>n=t));var i=null;function o(t){return(""+t).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}n=function(){return i||(i=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return o(t[0])}return"/"}()),i}})),o.register("6SpJm",(function(t,e){"use strict";var r=o("1oNCw").resolve;function n(t){if(""===t)return".";var e="/"===t[t.length-1]?t.slice(0,t.length-1):t,r=e.lastIndexOf("/");return-1===r?".":e.slice(0,r)}function i(t,e){if(t===e)return"";var r=t.split("/");"."===r[0]&&r.shift();var n,i,o=e.split("/");for("."===o[0]&&o.shift(),n=0;(n<o.length||n<r.length)&&null==i;n++)r[n]!==o[n]&&(i=n);var a=[];for(n=0;n<r.length-i;n++)a.push("..");return o.length>i&&a.push.apply(a,o.slice(i)),a.join("/")}t.exports=function(t,e){return i(n(r(t)),r(e))},t.exports._dirname=n,t.exports._relative=i}));var qr=function(){function t(t){void 0===t&&(t={}),this.options=t,this.wait=50,this.lastPosition=0,this.lastTime=0,this.elapsedTimes=[],this.volumeListener={onVolumeUpdate:this.onVolumeUpdate.bind(this)}}return Object.defineProperty(t.prototype,"songlePlayer",{get:function(){return this._songlePlayer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return!!this._songlePlayer&&this._songlePlayer.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){if(!this._songlePlayer)return 0;if(!this.handler)return this.lastPosition;var t=this.lastTime,e=this.lastPosition,r=Date.now()-t;return e>0?e+r:this._songlePlayer.positionTime},enumerable:!1,configurable:!0}),t.prototype.initialize=function(t){var e,r,n,i=t.player,o=t.updater,a=t.emitter,s=t.altSourceUrl;return Fr(this,void 0,void 0,(function(){var t,l,c;return jr(this,(function(u){switch(u.label){case 0:return this.player&&this.player.removeListener(this.volumeListener),this.player=i,this.player.addListener(this.volumeListener),this.updateMediaPosition=o,this.emitter=a,this._songlePlayer?[3,2]:[4,this.initializeSonglePlayer()];case 1:u.sent(),u.label=2;case 2:return t=this.options.headless,l=s||this.options.altSourceUrls&&(null===(e=this.player.data.song)||void 0===e?void 0:e.permalink)&&this.options.altSourceUrls[null===(r=this.player.data.song)||void 0===r?void 0:r.permalink]||void 0,Be.isUploaderUrl(l)&&(l=Be.getAltSongUrlFromUploaderGuid(Be.getUploaderGuid(Be.getSongPathFromUrl(l)))),(c=(null===(n=this.player.data.song)||void 0===n?void 0:n.permalink)||l)===l&&(l=void 0),[4,this._songlePlayer.useMedia(c,{headless:t,altSourceUrl:l})];case 3:return u.sent(),this._songlePlayer.volume=0*(1-this.player.volume/100)+100*this.player.volume/100,this._songlePlayer.play(),this._songlePlayer.stop(),[2]}}))}))},t.prototype.initializeSonglePlayer=function(){var t;return Fr(this,void 0,void 0,(function(){var e,r,n,i,o,a,s,l=this;return jr(this,(function(c){switch(c.label){case 0:return e=this.options,r=e.accessToken,n=e.secretToken,(o=this.options.songle)?[3,2]:[4,Wr()];case 1:o=c.sent(),c.label=2;case 2:return(i=o).System&&(i.System.showLicense=!1),a=r||n,s=null===(t=this.options)||void 0===t?void 0:t.autoUseMedia,this._songlePlayer=a?new i.SyncPlayer({mediaElement:this.player.mediaSourceElement,accessToken:r,secretToken:n,autoUseMedia:s}):new i.Player({mediaElement:this.player.mediaSourceElement}),this._songlePlayer.on("play",(function(){l.handler||(l.startPolling(),l.emitter.onPlay())})),this._songlePlayer.on("pause",(function(){l.stopPolling(),l.emitter.onPause(),l.stopping&&(l.stopping=!1,l.emitter.onStop())})),this._songlePlayer.on("finish",(function(){l.handler&&(l.stopPolling(),l.emitter.onStop())})),this._songlePlayer.on("seek",(function(){l.updateMediaPosition(l._songlePlayer.positionTime)})),a&&(this._songlePlayer.on("mediaPlay",(function(){l.handler||(l.startPolling(),l.emitter.onPlay())})),this._songlePlayer.on("mediaFinish",(function(){l.handler&&(l.stopPolling(),l.emitter.onStop())}))),[2]}}))}))},t.prototype.play=function(){if(this._songlePlayer)return this._songlePlayer.play();this.emitter.onPlay()},t.prototype.stop=function(){if(this._songlePlayer)return this.stopping=this._songlePlayer.isPlaying,this._songlePlayer.stop();this.emitter.onStop()},t.prototype.pause=function(){if(this._songlePlayer)return this.stopping=!1,this._songlePlayer.pause();this.emitter.onPause()},t.prototype.seek=function(t){var e=this;this._songlePlayer?(this._songlePlayer.seekTo(t),this.emitter.onSeek(t)):this.updateMediaPosition(t).then((function(){e.emitter.onSeek(t)}))},t.prototype.startPolling=function(){var t,e=this;if(this.lastTime>0){var r=Date.now()-this.lastTime;t=Math.max(0,this.wait-r)}else t=this.wait;this.handler=setTimeout((function(){return Fr(e,void 0,void 0,(function(){var e,r,n,i,o,a;return jr(this,(function(s){switch(s.label){case 0:return r=(e=this).lastTime,n=e.lastPosition,i=r>0?Date.now()-r:t,o=n>0?n+i:this._songlePlayer.positionTime,Math.abs(this._songlePlayer.positionTime-o)>2*this.wait?this.lastPosition=this._songlePlayer.positionTime:this.lastPosition<=this._songlePlayer.positionTime&&(this.lastPosition=.8*o+.2*this._songlePlayer.positionTime),this.lastTime=Date.now(),this.elapsedTimes.unshift(i),this.elapsedTimes=this.elapsedTimes.slice(0,10),this.elapsedTimes.length>=10&&((a=this.elapsedTimes.reduce((function(t,e){return t+e}))/10)>5*this.wait&&(this.player.stageScale=Math.max(.25,.9*this.player.stageScale),this.elapsedTimes=[]),a<1.2*this.wait&&this.player.stageScale<1&&(this.player.stageScale=Math.min(1,this.player.stageScale/.9),this.elapsedTimes=[])),[4,this.updateMediaPosition(o)];case 1:return s.sent(),this.handler&&this.startPolling(),[2]}}))}))}),t)},t.prototype.stopPolling=function(){this.handler&&(clearTimeout(this.handler),this.lastTime=0,this._songlePlayer&&(this.lastPosition=this._songlePlayer.positionTime)),this.handler=null},t.prototype.dispose=function(){this.player&&this.player.removeListener(this.volumeListener),this._songlePlayer&&(this._songlePlayer.stop(),this._songlePlayer=null)},t.prototype.onVolumeUpdate=function(t){this._songlePlayer&&(this._songlePlayer.volume=t)},t}(),Yr=function(){function t(t){this.listeners=[],this.throttleInterval=t&&t.throttleInterval?Number(t.throttleInterval):100}return t.prototype.onVideoLoad=function(t,e){this.listeners.forEach((function(r){return r.onVideoLoad&&r.onVideoLoad(t,e)}))},t.prototype.onSongLoad=function(t,e){this.listeners.forEach((function(r){return r.onSongLoad&&r.onSongLoad(t,e)}))},t.prototype.onSongMapLoad=function(t,e){this.listeners.forEach((function(r){return r.onSongMapLoad&&r.onSongMapLoad(t,e)}))},t.prototype.onSongInfoLoad=function(t,e){var r=!1;this.listeners.forEach((function(n){n.onSongInfoLoad&&(n.onSongInfoLoad(t,e),r=!0)})),r&&console.warn('[TextAlive API] "onSongInfoLoad" event is deprecated; use "onSongMapLoad" event instead')},t.prototype.onVocalAmplitudeLoad=function(t,e){this.listeners.forEach((function(r){return r.onVocalAmplitudeLoad&&r.onVocalAmplitudeLoad(t,e)}))},t.prototype.onValenceArousalLoad=function(t,e){this.listeners.forEach((function(r){return r.onValenceArousalLoad&&r.onValenceArousalLoad(t,e)}))},t.prototype.onLyricsLoad=function(t,e){this.listeners.forEach((function(r){return r.onLyricsLoad&&r.onLyricsLoad(t,e)}))},t.prototype.onTextLoad=function(t,e){this.listeners.forEach((function(r){return r.onTextLoad&&r.onTextLoad(t,e)}))},t.prototype.onAppConnected=function(t){this.listeners.forEach((function(e){return e.onAppConnected&&e.onAppConnected(t)}))},t.prototype.onAppReady=function(t){this.listeners.forEach((function(e){return e.onAppReady&&e.onAppReady(t)}))},t.prototype.onAppParameterUpdate=function(t,e){this.listeners.forEach((function(r){return r.onAppParameterUpdate&&r.onAppParameterUpdate(t,e)}))},t.prototype.onAppMediaChange=function(t,e){this.listeners.forEach((function(r){return r.onAppMediaChange&&r.onAppMediaChange(t,e)}))},t.prototype.onTemplateUpdate=function(t){this.listeners.forEach((function(e){return e.onTemplateUpdate&&e.onTemplateUpdate(t)}))},t.prototype.onTemplateCommit=function(t){this.listeners.forEach((function(e){return e.onTemplateCommit&&e.onTemplateCommit(t)}))},t.prototype.onTemplatesLoad=function(t,e){this.listeners.forEach((function(r){return r.onTemplatesLoad&&r.onTemplatesLoad(t,e)}))},t.prototype.onFontsLoad=function(t,e){this.listeners.forEach((function(r){return r.onFontsLoad&&r.onFontsLoad(t,e)}))},t.prototype.onVideoReady=function(t){this.listeners.forEach((function(e){return e.onVideoReady&&e.onVideoReady(t)}))},t.prototype.onTimerReady=function(t){this.listeners.forEach((function(e){return e.onTimerReady&&e.onTimerReady(t)}))},t.prototype.onStageElementSet=function(t){this.listeners.forEach((function(e){return e.onStageElementSet&&e.onStageElementSet(t)}))},t.prototype.onMediaElementSet=function(t){this.listeners.forEach((function(e){return e.onMediaElementSet&&e.onMediaElementSet(t)}))},t.prototype.onTimeUpdate=function(t){var e=this;this.listeners.forEach((function(e){return e.onTimeUpdate&&e.onTimeUpdate(t)})),this.position=t,this.throttledTimeUpdate||(this.throttledTimeUpdate=new Promise((function(t,r){setTimeout((function(){e.onThrottledTimeUpdate(e.position),e.throttledTimeUpdate=null,t()}),e.throttleInterval)})))},t.prototype.onThrottledTimeUpdate=function(t){this.listeners.forEach((function(e){return e.onThrottledTimeUpdate&&e.onThrottledTimeUpdate(t)}))},t.prototype.onBackgroundGraphicsUpdate=function(t){this.listeners.forEach((function(e){return e.onBackgroundGraphicsUpdate&&e.onBackgroundGraphicsUpdate(t)}))},t.prototype.onMediaSeek=function(t){this.listeners.forEach((function(e){return e.onMediaSeek&&e.onMediaSeek(t)}))},t.prototype.onVideoSeekStart=function(){this.listeners.forEach((function(t){return t.onVideoSeekStart&&t.onVideoSeekStart()}))},t.prototype.onVideoSeekEnd=function(){this.listeners.forEach((function(t){return t.onVideoSeekEnd&&t.onVideoSeekEnd()}))},t.prototype.onVideoSeek=function(t){this.listeners.forEach((function(e){return e.onVideoSeek&&e.onVideoSeek(t)}))},t.prototype.onPlay=function(){this.listeners.forEach((function(t){return t.onPlay&&t.onPlay()}))},t.prototype.onPause=function(){this.listeners.forEach((function(t){return t.onPause&&t.onPause()}))},t.prototype.onSeek=function(t){this.listeners.forEach((function(e){return e.onSeek&&e.onSeek(t)}))},t.prototype.onStop=function(){this.listeners.forEach((function(t){return t.onStop&&t.onStop()}))},t.prototype.onDispose=function(){this.listeners.forEach((function(t){return t.onDispose&&t.onDispose()}))},t.prototype.onResize=function(t){this.listeners.forEach((function(e){return e.onResize&&e.onResize(t)}))},t.prototype.onVolumeUpdate=function(t){this.listeners.forEach((function(e){return e.onVolumeUpdate&&e.onVolumeUpdate(t)}))},t.prototype.addListener=function(t){!t||this.listeners.indexOf(t)>=0||this.listeners.push(t)},t.prototype.removeListener=function(t){var e=!1;return this.listeners=this.listeners.filter((function(r){var n=r===t;return e=e||n,!n})),e},t}(),Xr=function(){function t(t,e,r){var n=this;this.player=t,this.manager=e,this.emitter=r,this._defaultBackgroundCss=null,this._background=null,t.addListener({onStageElementSet:function(t){return n.doUpdateBackground(n.background)}})}return Object.defineProperty(t.prototype,"background",{get:function(){return this._background},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultBackgroundCss",{get:function(){return this._defaultBackgroundCss?this._defaultBackgroundCss:""},set:function(t){this._defaultBackgroundCss=t,this.updateBackground(this._background)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return null!==this._background},enumerable:!1,configurable:!0}),t.prototype.settingBackground=function(t){return Fr(this,void 0,void 0,(function(){return jr(this,(function(e){switch(e.label){case 0:return[4,this.doSetBackground(t)];case 1:return[2,e.sent()&&this.doUpdateBackground(t)]}}))}))},t.prototype.setBackground=function(t){return Fr(this,void 0,void 0,(function(){var e;return jr(this,(function(r){switch(r.label){case 0:return[4,this.doSetBackground(t)];case 1:return[2,(e=r.sent())&&this.updateBackground(e)]}}))}))},t.prototype.doSetBackground=function(t){return Fr(this,void 0,void 0,(function(){var e,r,n;return jr(this,(function(i){switch(i.label){case 0:return e=t&&t.originalUrl?t.originalUrl:"",this.manager.isBackgroundColorAsset(t)?[2,{css:e,originalUrl:e}]:this.manager.isBackgroundPiaproImageAsset(t)?[4,this.manager.read(e)]:[3,2];case 1:return(r=i.sent())&&r.url&&this.manager.checkBackgroundImageLicense(r.license)?(r.originalUrl=e,t&&(r.x=t.x,r.y=t.y),[2,r]):[2,{css:"",originalUrl:e,x:t?t.x:void 0,y:t?t.y:void 0,license:r?r.license:void 0}];case 2:return this.manager.isBackgroundSpecialImageAsset(t)?[2,{css:'url("https://api.textalive.jp/images/backgrounds/snowmiku2016/'+(n=/^snowmiku2016-([0-9]{2})$/.exec(e))[1]+'.jpg")',contentUrl:"https://api.textalive.jp/images/backgrounds/snowmiku2016/"+n[1]+".jpg",url:"https://snowmiku.com/2016/info_chara.html",name:"SNOW MIKU 2016",authorName:"豆の素",originalUrl:e,x:t?t.x:void 0,y:t?t.y:void 0,defaultY:0}]:[2,{originalUrl:null,css:"",x:t?t.x:void 0,y:t?t.y:void 0}]}}))}))},t.prototype.updateBackground=function(t){return!!this.doUpdateBackground(t)&&(this.emitter&&this.emitter.onBackgroundGraphicsUpdate&&this.emitter.onBackgroundGraphicsUpdate(t),!0)},t.prototype.doUpdateBackground=function(t){if(!this.player.stageElement||!t)return!1;var e=this.player.stageElement.style;return t.css.length<=0?e.background=this.defaultBackgroundCss:e.background=t.css,"number"==typeof t.x||this._background&&"number"==typeof this._background.x?("number"!=typeof t.x&&(t.x=this._background.x),e.backgroundPositionX=e.backgroundPositionX+"%"):e.backgroundPositionX="number"==typeof t.defaultX?t.defaultX+"%":"center","number"==typeof t.y||this._background&&"number"==typeof this._background.y?("number"!=typeof t.y&&(t.y=this._background.y),e.backgroundPositionY=e.backgroundPositionY+"%"):e.backgroundPositionY="number"==typeof t.defaultY?t.defaultY+"%":"center",e.backgroundSize="cover",this._background=t,!0},t.prototype.export=function(){if(!this.background)return null;var t={originalUrl:this.background.originalUrl};return void 0!==this.background.x&&(t.x=this.background.x),void 0!==this.background.y&&(t.y=this.background.y),t},t.prototype.exportPartialVideoEntry=function(t){return{background:this.export()}},t}();function Jr(t,e,r){return Fr(this,void 0,void 0,(function(){var n,i,a,s,l,c,u,h,p,d,f,m,g,v;return jr(this,(function(y){switch(y.label){case 0:if(n={loaded:[],failed:[]},"undefined"==typeof window||!window.document||!window.document.head)return n.failed=t.slice(),[2,n];for(i=r.split("").filter((function(t,e,r){return r.indexOf(t)===e})).sort(),a=!0,s=0,i.forEach((function(t){var r=e.indexOf(t,s);a=a&&r>=0,s=r})),l=window.document.head,c=[],u=0;u<l.children.length;u++)"link"===(h=l.children.item(u)).tagName.toLowerCase()&&"stylesheet"===h.getAttribute("rel")&&c.push(h.getAttribute("href"));p=[],d=[],f=[],t.forEach((function(t){if(t.google)f.push(t.key);else{var e=a&&t.compactUrl||t.url;c.includes(e)||(d.push(t.en),p.push(e))}})),m={classes:!1,active:null,inactive:null,fontactive:function(e){n.loaded.push(t.find((function(t){return t.en===e}))),n.failed=n.failed.filter((function(t){return t.en!==e}))},fontinactive:function(e){n.failed.push(t.find((function(t){return t.en===e})))},timeout:5e3},f.length>0&&(m.google={families:f}),d.length>0&&(m.custom={families:d,urls:p}),y.label=1;case 1:return y.trys.push([1,5,,6]),(v="undefined"!=typeof window&&(null===window||void 0===window?void 0:window.WebFont))?[3,3]:[4,o("74fzP")];case 2:v=y.sent(),y.label=3;case 3:return g=v,[4,new Promise((function(t){m.active=m.inactive=t,g.load(m)}))];case 4:case 5:return y.sent(),[3,6];case 6:return[2,n]}}))}))}function Zr(t,e){return Fr(this,void 0,void 0,(function(){var r,n,i,o,a,s,l,c;return jr(this,(function(u){switch(u.label){case 0:if(r={loaded:[],failed:[]},!("undefined"!=typeof window&&window.document&&window.document.head&&window.Ts&&window.Ts.loadFontAsync))return r.failed=t.slice(),[2,r];for(n=window.document.head,i={},o=function(t){var e=n.children.item(t);if("style"!==e.tagName.toLowerCase()||"text/css"!==e.getAttribute("type")||"stylesheet"!==e.getAttribute("rel")||!e.hasAttribute("data-cssName"))return"continue";var r=e.getAttribute("data-cssName");if(void 0===i[r])return i[r]=new Set(e.getAttribute("data-text")),{value:void 0};e.getAttribute("data-text").split("").forEach((function(t){return i[r].add(t)}))},a=0;a<n.children.length;a++)if("object"==typeof(s=o(a)))return[2,s.value];return l=window.Ts,c=[],t.forEach((function(t){var n=new Set(e+t.en+t.ja);i[t.en]&&i[t.en].forEach((function(t){return n.delete(t)})),n.size<=0?r.loaded.push(t):c.push(new Promise((function(e){return i=l,o=t,a=r,s=Array.from(n.values()).join(""),c=e,u=o.en,void i.loadFontAsync({cssName:u,text:s,outputType:"json",callback:function(t){try{e=u,r=s,n=t.data,i=JSON.parse(n),l=JSON.parse(i.res),(h=document.createElement("style")).setAttribute("data-cssName",e),h.setAttribute("data-text",r),h.setAttribute("type","text/css"),h.setAttribute("rel","stylesheet"),h.innerHTML="@font-face {font-family: '"+l.fontFamily+"';font-weight: "+l["font-weight"]+";src: url(data:font/woff;base64,"+l.src+");}",document.head.appendChild(h),a.loaded.push(o)}catch(e){a.failed.push(o)}var e,r,n,i,l,h;c()}});var i,o,a,s,c,u})))})),[4,Promise.all(c)];case 1:return u.sent(),[2,r]}}))}))}o.register("74fzP",(function(t,e){t.exports=o("6dgSG")(o("2c4dZ").getBundleURL()+o("6SpJm")("52rwg","MzzjL")).then((()=>o("1ZZg9")))}));var Kr=function(t){function e(e,r){var n=this.constructor,i=t.call(this,e)||this;return i.fonts=r,Object.setPrototypeOf(i,n.prototype),i}return kr(e,t),e}(Error),Qr=function(){function t(t,e,r){this.fontInfoManager=t,this.textFetcher=e,this.listener=r,this._failed=[],this._loaded=[]}return Object.defineProperty(t.prototype,"failed",{get:function(){return this._failed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),t.prototype.loadAll=function(){return Fr(this,void 0,void 0,(function(){var t;return jr(this,(function(e){switch(e.label){case 0:return[4,this.listAvailableFonts()];case 1:return t=e.sent(),[2,this.loadFonts(t)]}}))}))},t.prototype.loadForVideo=function(t){return Fr(this,void 0,void 0,(function(){var e,r;return jr(this,(function(n){switch(n.label){case 0:return(e=this.listFontFamiliesInVideo(t))?[4,this.listAvailableFonts()]:(this.listener&&this.listener.onFontsLoad&&this.listener.onFontsLoad(this.loaded),[2,Promise.resolve(this.loaded)]);case 1:return r=n.sent(),[2,this.loadFonts(r.filter((function(t){return e.indexOf(t.en)>=0})))]}}))}))},t.prototype.listFontFamiliesInVideo=function(t){if(!t||!t.phrases)return null;var e=[];return t.phrases.forEach((function(t){return t.words.forEach((function(t){return t.characters.forEach((function(t){return e.push(t.fontFamily)}))}))})),e.filter((function(t,e,r){return r.indexOf(t)===e}))},t.prototype.listAvailableFonts=function(){return Fr(this,void 0,void 0,(function(){return jr(this,(function(t){return[2,this.fontInfoManager.listAvailableFonts()]}))}))},t.prototype.isLoading=function(){return!!this.queue},t.prototype.load=function(t){return Fr(this,void 0,void 0,(function(){var e,r;return jr(this,(function(n){switch(n.label){case 0:return e=[],r=[],t.forEach((function(t){"string"==typeof t?e.push(t):r.push(t)})),[4,this.fontInfoManager.listAvailableFonts()];case 1:return n.sent().forEach((function(t){e.indexOf(t.key)>=0&&r.push(t)})),[2,this.loadFonts(r)]}}))}))},t.prototype.loadFonts=function(t){return Fr(this,void 0,void 0,(function(){var e=this;return jr(this,(function(r){return this.queue?(this.listener&&this.listener.onFontsLoad&&this.listener.onFontsLoad(null,new Kr("Failed to load some fonts because there is an ongoing font loding process",this.failed.slice())),[2,this.loaded]):(this.queue=this.doLoad(t).then((function(t){return e.queue=null,t})),[2,this.queue])}))}))},t.prototype.doLoad=function(t){return Fr(this,void 0,void 0,(function(){var e,r,n,i,o=this;return jr(this,(function(a){switch(a.label){case 0:return e=[],r=[],[4,this.fontInfoManager.getFrequentChars()];case 1:return n=a.sent(),t.forEach((function(t){t.typesquare||t.typekit||e.push(t),t.typesquare&&r.push(t)})),i=(this.textFetcher&&this.textFetcher()||"").split("").filter((function(t,e,r){return r.indexOf(t)===e})).sort().join(""),[2,Promise.all([Jr(e,n,i),Zr(r,i)]).then((function(t){var e=t[0],r=t[1],n=e.loaded.concat(r.loaded);if(o.addLoadedFonts(n),e.failed.length>0||r.failed.length>0){var i=e.failed.concat(r.failed);o.addFailedFonts(i),o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(null,new Kr("Failed to load some fonts",o.failed.slice()))}else o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(n);return o.loaded})).catch((function(t){return o.listener&&o.listener.onFontsLoad&&o.listener.onFontsLoad(null,new Kr(t,o.failed.slice())),o.loaded}))]}}))}))},t.prototype.addLoadedFonts=function(t){var e=this;this._loaded=this.loaded.concat(t.filter((function(t){return e.failed.findIndex((function(e){return e.key===t.key}))<0})))},t.prototype.addFailedFonts=function(t){var e=this;this._failed=this.failed.concat(t.filter((function(t){return e.failed.findIndex((function(e){return e.key===t.key}))<0})))},t}(),$r=function(){function t(){}return Object.defineProperty(t.prototype,"duration",{get:function(){return this.endTime-this.startTime},enumerable:!1,configurable:!0}),t.prototype.contains=function(t){return t>=this.startTime&&t<=this.endTime},t.prototype.overlaps=function(t,e){return this.contains(t)||this.contains(e)||this.startTime<=t&&this.endTime>=e},t.prototype.progress=function(t){return this.contains(t)?this.startTime===this.endTime?0:(t-this.startTime)/(this.endTime-this.startTime):-1},t}(),tn=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return kr(e,t),Object.defineProperty(e.prototype,"endTime",{get:function(){return this.next?this.next.startTime:this.startTime},enumerable:!1,configurable:!0}),e}($r),en=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return kr(e,t),e}($r),rn=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return kr(e,t),e}($r),nn=function(t){function e(){var e=t.call(this)||this;return e.previous=e.next=null,e}return kr(e,t),e}($r),on=function(){function t(t){var e=t.analysis,r=t.info;this.beats=[],this.chords=[],this.segments=[],this.voice=[],this._revisions={beatId:r.beatRevisionId,chordId:r.chordRevisionId,repetitiveSegmentId:r.chorusRevisionId},this.parseBeats(e.beats),this.parseSegments(e.repetitive_segment),this.parseChords(e.chords),e.voice&&this.parseVoice(e.voice)}return Object.defineProperty(t.prototype,"revisions",{get:function(){return this._revisions},enumerable:!1,configurable:!0}),t.prototype.parseBeats=function(t){var e=this;if(Array.isArray(t)&&Array.isArray(t[0])){var r=null,n=0;t[0].forEach((function(t){var i=new tn;i.startTime=1e3*t[0],i.length=t[2],i.position=t[3],i.previous=r,null!==r&&(r.next=i),i.index=n++,e.beats.push(i),r=i})),null!==r&&(r.next=null)}},t.prototype.parseChords=function(t){var e=this;if(Array.isArray(t)){var r=null,n=0;t.forEach((function(t){var i=new en;i.startTime=1e3*t[0],i.endTime=1e3*t[1],i.name=t[2],i.previous=r,null!==r&&(r.next=i),i.index=n++,e.chords.push(i),r=i})),null!==r&&(r.next=null)}},t.prototype.parseSegments=function(t){var e=this;Array.isArray(t)&&t.forEach((function(t){var r={chorus:!!t.chorus,duration:10*t.segment_length,segments:null},n=null,i=0;r.segments=t.start_frames.map((function(t){var e=new rn;return e.startTime=10*t,e.endTime=e.startTime+r.duration,e.previous=n,null!==n&&(n.next=e),e.index=i++,n=e,e})),null!==n&&(n.next=null),e.segments.push(r)}))},t.prototype.parseVoice=function(t){var e=this;Array.isArray(t)&&t.forEach((function(t){var r=[],n=null,i=0,o=0;t.forEach((function(t){var e=new nn;e.startTime=o,e.endTime=e.startTime+10*t[1],e.f0=t[0][0],e.initialF0=t[0][1],e.previous=n,null!==n&&(n.next=e),e.index=i++,r.push(e),n=e,o=e.endTime})),null!==n&&(n.next=null),e.voice.push(r)}))},t}();function an(t,e,r){for(var n=r&&"number"!=typeof e?r(e):e,i=0,o=t.length;i<o;){var a=i+o>>>1;(r?r(t[a]):t[a])<n?i=a+1:o=a}return i}var sn=function(){function t(t){var e=t.song,r=t.analysis,n=t.vocalAmplitude,i=t.maxVocalAmplitude,o=t.valenceArousal;this._song=e,this._analysis=r,this._vocalAmplitude=n,this._maxVocalAmplitude=i,this._valenceArousal=o}return Object.defineProperty(t.prototype,"song",{get:function(){return this._song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analysis",{get:function(){return this._analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vocalAmplitude",{get:function(){return this._vocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxVocalAmplitude",{get:function(){return this._maxVocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valenceArousal",{get:function(){return this._valenceArousal},enumerable:!1,configurable:!0}),t.prototype.getChoruses=function(){var t;if(!this._analysis)return[];var e=this._analysis.segments.filter((function(t){return t.chorus}));return e.length<=0?[]:(null===(t=e[0].segments)||void 0===t?void 0:t.slice())||[]},t.prototype.findChorus=function(t,e){var r=[];if(this._analysis){var n=this._analysis.segments.filter((function(t){return t.chorus}));if(n.length<=0)return null;r=n[0].segments}return Sr(r,t,e)},t.prototype.findChorusBetween=function(t,e){return this.findChorus(t,{endTime:e})},t.prototype.getBeats=function(){var t;return this._analysis&&(null===(t=this._analysis.beats)||void 0===t?void 0:t.slice())||[]},t.prototype.findBeat=function(t,e){return this._analysis?Sr(this._analysis.beats,t,e):null},t.prototype.getChords=function(){var t;return this._analysis&&(null===(t=this._analysis.chords)||void 0===t?void 0:t.slice())||[]},t.prototype.findChord=function(t,e){return this._analysis?Sr(this._analysis.chords,t,e):null},t.prototype.getVocalFrequency=function(t){var e;if(!Array.isArray(null===(e=this._analysis)||void 0===e?void 0:e.voice))return-1;var r=this._analysis.voice[0];if(r.length<=0)return-1;var n=an(r,t,(function(t){return t.endTime}));return r[n].contains(t)?r[n].f0:-1},t.prototype.getVocalAmplitude=function(t){var e=this._vocalAmplitude,r=Math.round(t/10);return!Array.isArray(this._vocalAmplitude)||r<0||r>=e.length?-1:this._vocalAmplitude[r]},t.prototype.getMaxVocalAmplitude=function(){return"number"==typeof this._maxVocalAmplitude?this._maxVocalAmplitude:-1},t.prototype.getValenceArousal=function(t){var e=this._valenceArousal;if(!e)return null;var r=an(e.seq,t,(function(t){return 1e3*t.t[1]}));if(r<0)return{a:e.seq[0].a,v:e.seq[0].v};if(r>=e.seq.length||t<1e3*e.seq[r+1].t[0])return{a:e.seq[Math.min(r,e.seq.length-1)].a,v:e.seq[Math.min(r,e.seq.length-1)].v};var n=e.seq[r],i=e.seq[r+1],o=t/1e3,a=i.t[0],s=n.t[1],l=s-a;return{a:(n.a*(s-o)+i.a*(o-a))/l,v:(n.v*(s-o)+i.v*(o-a))/l}},t.prototype.getMedianValenceArousal=function(){var t=this._valenceArousal;return t?t.stats.median:null},t}(),ln=function(){function t(t,e,r){this.songManager=t,this.options=r,this.listener=e}return Object.defineProperty(t.prototype,"song",{get:function(){return this._song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"analysis",{get:function(){return this._analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vocalAmplitude",{get:function(){return this._vocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxVocalAmplitude",{get:function(){return this._maxVocalAmplitude},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valenceArousal",{get:function(){return this._valenceArousal},enumerable:!1,configurable:!0}),t.prototype.loadSong=function(t,e){var r,n,i;return Fr(this,void 0,void 0,(function(){var o,a;return jr(this,(function(s){switch(s.label){case 0:return"number"==typeof t&&t<0||!t?(this.onSongLoad(null,new Error("Neither Songle ID or code provided")),[2,null]):[4,this.songManager.load("number"==typeof t?{id:t}:{code:t})];case 1:return o=s.sent(),this.onSongLoad(o,o?void 0:new Error("Song data not found")),o?(a={chord:null==e?void 0:e.chordId,beat:null==e?void 0:e.beatId,chorus:null==e?void 0:e.repetitiveSegmentId},[4,Promise.all([(null===(r=this.options)||void 0===r?void 0:r.vocalFrequencyEnabled)?this.loadSongDetailInfo(o.song.code,{revisions:a}):this.loadSongInfo(o.song.code,{revisions:a}),(null===(n=this.options)||void 0===n?void 0:n.vocalAmplitudeEnabled)?this.loadVocalAmplitude(o.song.code):Promise.resolve(null),(null===(i=this.options)||void 0===i?void 0:i.valenceArousalEnabled)?this.loadValenceArousal(o.song.code):Promise.resolve(null)])]):[2,null];case 2:return s.sent(),[2,new sn(this)]}}))}))},t.prototype.onSongLoad=function(t,e){this._song=t,this.listener&&this.listener.onSongLoad&&this.listener.onSongLoad(t,e)},t.prototype.loadSongInfo=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,this.songManager.loadInfo(String(t),e)];case 1:return r=n.sent(),this.onSongMapLoad(r,r?void 0:new Error("Song analysis data not found")),[2,r]}}))}))},t.prototype.loadSongDetailInfo=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,this.songManager.loadDetailInfo(String(t),e)];case 1:return r=n.sent(),this.onSongMapLoad(r,r?void 0:new Error("Song analysis data not found")),[2,r]}}))}))},t.prototype.mockSongInfo=function(t){var e=function(t){for(var e=t.beat,r=t.chorusSegment,n=t.duration,i=[],o=0;60*o/e.bpm<n/1e3;)i.push([60*o/e.bpm,1,e.length,o%e.length+1,1]),o++;return{beats:[i],chords:null,repetitive_segment:[{chorus:!0,index:0,segment_length:r.duration/10,start_frames:r.startTimes.map((function(t){return t/10}))}],voice:null}}(t);return this._song=null,this.onSongMapLoad({analysis:e,info:null}),new sn(this)},t.prototype.onSongMapLoad=function(t,e){var r,n;this._analysis=new on(t),(null===(r=this.listener)||void 0===r?void 0:r.onSongMapLoad)&&this.listener.onSongMapLoad(this._analysis,e),(null===(n=this.listener)||void 0===n?void 0:n.onSongInfoLoad)&&this.listener.onSongInfoLoad(t,e)},t.prototype.loadVocalAmplitude=function(t){var e;return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return r=this,[4,this.songManager.loadVocalAmplitude(String(t))];case 1:return r._vocalAmplitude=n.sent(),this._maxVocalAmplitude=Math.max.apply(Math,this._vocalAmplitude),(null===(e=this.listener)||void 0===e?void 0:e.onVocalAmplitudeLoad)&&this.listener.onVocalAmplitudeLoad(this._vocalAmplitude,this._vocalAmplitude?void 0:new Error("Vocal amplitude data not found")),[2,this._vocalAmplitude]}}))}))},t.prototype.loadValenceArousal=function(t){var e;return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return r=this,[4,this.songManager.loadValenceArousal(String(t))];case 1:return r._valenceArousal=n.sent(),(null===(e=this.listener)||void 0===e?void 0:e.onValenceArousalLoad)&&this.listener.onValenceArousalLoad(this._valenceArousal,this._valenceArousal?void 0:new Error("Valence arousal data not found")),[2,this._valenceArousal]}}))}))},t}(),cn=function(){function t(t,e,r){this.managers=t,this.listener=e,this.options=r}return t.prototype.loadRawText=function(t){var e;return e=!t.phrases||t.phrases.length<0?"":t.phrases.map((function(t){return t.words.map((function(t){return t.characters.map((function(t){return t.char})).join("")})).join("")})).join(""),this.onTextLoad({text:e}),{lyricsId:-1,lyrics:null,lyricsBody:{text:e,artist:null,name:null,url:null}}},t.prototype.loadLyrics=function(t){var e=t.songCode,r=t.lyricId,n=void 0===r?-1:r,i=t.lyricDiffId,o=void 0===i?-1:i,a=t.altLyricsUrl,s=t.directAccess;return Fr(this,void 0,void 0,(function(){var t,r,i,l;return jr(this,(function(c){switch(c.label){case 0:return n<=0?(0===n?this.onLyricsLoad(null,new Error("Lyrics not loaded")):this.onLyricsLoad(null,new Error("Lyrics not found")),[2,null]):[4,this.managers.lyrics.loadDiff(e,n,o)];case 1:return(null==(t=c.sent())?void 0:t.data)?(r=Ur(Ur({},t),{processing:!1,failed:!1,id:n,diff:{id:o}}),this.onLyricsLoad(r),a||s?[3,3]:[4,this.managers.lyrics.fetchLocalLyricBody(n)]):(this.onLyricsLoad(null,new Error("Lyrics timing information not found")),[2,null]);case 2:i=c.sent(),c.label=3;case 3:if(null==i?void 0:i.text)return[3,7];c.label=4;case 4:return c.trys.push([4,6,,7]),[4,this.loadLyricsText(t,{altLyricsUrl:a,directAccess:s})];case 5:return i=c.sent(),[3,7];case 6:return l=c.sent(),this.onTextLoad(null,l),[3,7];case 7:return i&&this.onTextLoad(i),[2,{lyricsId:r.id,lyrics:r,lyricsBody:i}]}}))}))},t.prototype.loadLyricsText=function(t,e){var r=void 0===e?{}:e,n=r.altLyricsUrl,i=r.directAccess;return Fr(this,void 0,void 0,(function(){var e,r,o=this;return jr(this,(function(a){switch(a.label){case 0:return e=this.options&&"number"==typeof this.options.lyricsFetchTimeout&&this.options.lyricsFetchTimeout>=0,r=this.managers.lyrics.fetchLyricBody(n||t.url,{parserPath:t.parser_path,directAccess:i}),[4,e?Promise.race([r,new Promise((function(t,e){return setTimeout((function(){return e(new Error("Fetching lyrics text timeout"))}),o.options.lyricsFetchTimeout)}))]):r];case 1:return[2,a.sent()]}}))}))},t.prototype.onLyricsLoad=function(t,e){this.listener&&this.listener.onLyricsLoad&&this.listener.onLyricsLoad(t,e)},t.prototype.onTextLoad=function(t,e){this.listener&&this.listener.onTextLoad&&this.listener.onTextLoad(t,e)},t}(),un=function(){function t(t){var e=t.video;this._video=e}return Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._video.json},enumerable:!1,configurable:!0}),t}(),hn=function(){function t(t,e){this.managers=t,this.listener=e,this.listener=e}return Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),t.prototype.onVideoLoad=function(t,e){var r=t?Object.assign(t,e):null;return r&&("string"==typeof r.json?r.json=JSON.parse(r.json):"object"==typeof r.json&&null!==r.json||(r.json={}),"string"==typeof r.config?r.config=JSON.parse(r.config):"object"==typeof r.config&&null!==r.config||(r.config={})),this._video=r,this.listener&&this.listener.onVideoLoad&&this.listener.onVideoLoad(r),new un({video:r})},t.prototype.createFromVideoId=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,this.managers.video.load(t)];case 1:return r=n.sent(),[2,this.onVideoLoad(r,e)]}}))}))},t.prototype.createFromVideo=function(t,e){return this.onVideoLoad(t,e)},t.prototype.createFromSongUrl=function(t,e){return Fr(this,void 0,void 0,(function(){return jr(this,(function(r){return[2,this.createFromSongPath(this.managers.song.getSongPathFromUrl(t),e)]}))}))},t.prototype.createFromSongPath=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,this.managers.song.load({songPath:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}}))}))},t.prototype.createFromSongId=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,this.managers.song.load({id:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}}))}))},t.prototype.createFromSongCode=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,this.managers.song.load({code:t})];case 1:return(r=n.sent())?[2,this.createFromSong(r.song,e)]:[2,null]}}))}))},t.prototype.createFromSong=function(t,e){var r;return Fr(this,void 0,void 0,(function(){var n,i,o,a,s,l;return jr(this,(function(c){switch(c.label){case 0:return n=null==e?void 0:e.lyricId,i=null==e?void 0:e.lyricDiffId,"number"!=typeof n||n<0?[4,this.managers.lyrics.load(t.code)]:[3,4];case 1:return o=c.sent(),(s=o&&!o.status.failed&&!o.status.processing&&Array.isArray(o.lyrics)&&o.lyrics.length>0)?[4,this.managers.lyrics.loadDetail(t.code,o.lyrics[0].id)]:[3,3];case 2:s=c.sent(),c.label=3;case 3:(a=s)&&(n=a.id,i=null===(r=a.diff)||void 0===r?void 0:r.id),c.label=4;case 4:return"number"!=typeof n&&(n=-1),"number"!=typeof i&&(i=-1),l={id:-1,sourceId:-1,sourceOriginId:-1,songleId:t.id,songleCode:t.code,lyricId:n,lyricDiffId:i,title:null,log:null,background:null,config:null,json:null,synthJson:null,author:null,createdDate:null,accessCount:-1,altUrl:null},[2,this.onVideoLoad(l,e)]}}))}))},t.prototype.createFromText=function(t,e){return Fr(this,void 0,void 0,(function(){var r,n,i,o,a,s;return jr(this,(function(l){switch(l.label){case 0:return[4,this.managers.text.parse(t)];case 1:return r=l.sent(),n=r&&"success"===r.status?this.createVideoDataFromParsedText(r,t):this.createVideoDataFromText(t),i=n[n.length-1],o=i&&i.words[i.words.length-1],a=o&&o.characters[o.characters.length-1],s=a?a.endTime:0,[2,this.createFromJSON({phrases:n,startTime:0,endTime:s,duration:s},e)]}}))}))},t.prototype.createFromJSON=function(t,e){var r={id:-1,sourceId:-1,sourceOriginId:-1,songleId:-1,lyricId:-1,lyricDiffId:-1,title:null,log:null,background:null,config:null,json:t,synthJson:null,author:null,createdDate:null,accessCount:-1,altUrl:null};return this.onVideoLoad(r,e)},t.prototype.createVideoDataFromParsedText=function(t,e){var r=0,n=e.split(/\r\n|[\n\v\f\r\x85\u2028\u2029]/);return t.result.map((function(t,e){return{words:t.map((function(t){return{characters:n[e].substr(t.startPosition,t.wordLength).split("").map((function(t){return{char:t,startTime:300*r,endTime:300*++r}})),pos:t.PoS,rawPoS:t.rawPoS,language:t.language}})),templates:[{type:"DefaultAlignment"}]}}))},t.prototype.createVideoDataFromText=function(t){for(var e,r={characters:[]},n={words:[r],templates:[{type:"DefaultAlignment"}]},i=0,o=[n],a=0;a<t.length;a++){var s=t.charAt(a);"\n"!==s?" "!==s?(e={char:s,startTime:300*i,endTime:300*++i},r.characters.push(e)):(r={characters:[]},n.words.push(r)):(n={words:[r={characters:[]}],templates:[{type:"DefaultAlignment"}]},o.push(n))}return r.characters.length<=0&&n.words.pop(),n.words.length<=0&&o.pop(),o},t}(),pn=function(){function t(t,e,r){var n=this;void 0===e&&(e=null),this.managers=t,this.listener=e,this.options=r,this.fontLoader=new Qr(t.font,(function(){return n.text}),e)}return Object.defineProperty(t.prototype,"permalink",{get:function(){var t;return"https://textalive.jp"+((null===(t=this.song)||void 0===t?void 0:t.permalink)?"/songs/"+encodeURIComponent(Be.getSongPathFromUrl(this.song.permalink)):"")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"video",{get:function(){var t;return null===(t=this.videoProvider)||void 0===t?void 0:t.video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"song",{get:function(){var t,e;return null===(e=null===(t=this.songProvider)||void 0===t?void 0:t.song)||void 0===e?void 0:e.song},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songStatus",{get:function(){var t,e;return null===(e=null===(t=this.songProvider)||void 0===t?void 0:t.song)||void 0===e?void 0:e.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songMap",{get:function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.analysis},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsId",{get:function(){var t,e;return null===(e=null===(t=this.textProvider)||void 0===t?void 0:t.lyrics)||void 0===e?void 0:e.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyrics",{get:function(){var t;return null===(t=this.textProvider)||void 0===t?void 0:t.lyrics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lyricsBody",{get:function(){var t;return null===(t=this.textProvider)||void 0===t?void 0:t.lyricsBody},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){var t,e;return null===(e=null===(t=this.textProvider)||void 0===t?void 0:t.lyricsBody)||void 0===e?void 0:e.text},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fonts",{get:function(){return this.fontLoader},enumerable:!1,configurable:!0}),t.prototype.createFromVideoId=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return r=this,[4,new hn(this.managers,this.listener).createFromVideoId(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromVideo=function(t,e){return this.videoProvider=new hn(this.managers,this.listener).createFromVideo(t,e),this.videoProvider},t.prototype.createFromSongUrl=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return r=this,[4,new hn(this.managers,this.listener).createFromSongUrl(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromSongPath=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return r=this,[4,new hn(this.managers,this.listener).createFromSongPath(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromSongId=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return r=this,[4,new hn(this.managers,this.listener).createFromSongId(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromSongCode=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return r=this,[4,new hn(this.managers,this.listener).createFromSongCode(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromText=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return r=this,[4,new hn(this.managers,this.listener).createFromText(t,e)];case 1:return r.videoProvider=n.sent(),[2,this.videoProvider]}}))}))},t.prototype.createFromJSON=function(t,e){return this.videoProvider=new hn(this.managers,this.listener).createFromJSON(t,e),this.videoProvider},t.prototype.finalize=function(t){return Fr(this,void 0,void 0,(function(){return jr(this,(function(e){switch(e.label){case 0:return this.video?[4,this.loadSong()]:[2,null];case 1:return e.sent(),[4,this.loadText(t)];case 2:return e.sent(),[4,this.loadFonts()];case 3:return e.sent(),[2]}}))}))},t.prototype.mockSongInfo=function(t){this.songProvider=new ln(this.managers.song,this.listener,this.options).mockSongInfo(t)},t.prototype.loadSong=function(){return Fr(this,void 0,void 0,(function(){var t;return jr(this,(function(e){switch(e.label){case 0:return t=this,[4,new ln(this.managers.song,this.listener,this.options).loadSong(this.video.songleCode||this.video.songleId,this.video)];case 1:return t.songProvider=e.sent(),[2]}}))}))},t.prototype.loadText=function(t){var e,r;return Fr(this,void 0,void 0,(function(){var n,i,o,a,s,l,c,u;return jr(this,(function(h){switch(h.label){case 0:return n=this.video,i=n.lyricId,o=n.lyricDiffId,a=this.song?this.song.code:null,s=new cn(this.managers,this.listener,this.options),!a&&i<0?(l=s.loadRawText(null===(e=this.videoProvider)||void 0===e?void 0:e.data),[3,3]):[3,1];case 1:return c=(null==t?void 0:t.altLyricsUrl)||void 0,u=(null==t?void 0:t.lyricsDirectAccess)||void 0,[4,s.loadLyrics({songCode:a,lyricId:i,lyricDiffId:o,altLyricsUrl:c,directAccess:u})];case 2:l=h.sent(),h.label=3;case 3:return this.textProvider=l,(null==l?void 0:l.lyrics)&&(null===(r=null==l?void 0:l.lyricsBody)||void 0===r?void 0:r.text)&&this.importLyrics(),[2]}}))}))},t.prototype.loadFonts=function(){var t,e,r;return Fr(this,void 0,void 0,(function(){return jr(this,(function(n){return"number"==typeof this.video.id&&this.video.id>=0?(this.fontLoader.loadForVideo(null===(t=this.videoProvider)||void 0===t?void 0:t.data),[2]):Array.isArray(null===(e=this.options)||void 0===e?void 0:e.fontFamilies)?(this.fontLoader.load(this.options.fontFamilies),[2]):null===(null===(r=this.options)||void 0===r?void 0:r.fontFamilies)?(this.fontLoader.loadAll(),[2]):[2]}))}))},t.prototype.importLyrics=function(){var t=this.text.replace(/[\s\r\n]/g,""),e=0,r={phrases:this.lyrics.data.map((function(r){return{words:r.map((function(r){return{characters:r.map((function(r){return{char:t.charAt(e++),startTime:1e3*r.start_time,endTime:1e3*r.end_time}}))}}))}}))};this.video.json&&Array.isArray(this.video.json.phrases)?this.video.json.phrases.forEach((function(t,e){t.words.forEach((function(t,n){t.characters.forEach((function(t,i){var o=r.phrases[e].words[n].characters[i];t.char=o.char,t.startTime=o.startTime,t.endTime=o.endTime}))}))})):this.video.json=r},t.prototype.getChoruses=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getChoruses()},t.prototype.findChorus=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findChorus(t,e)},t.prototype.findChorusBetween=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findChorusBetween(t,e)},t.prototype.getBeats=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getBeats()},t.prototype.findBeat=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findBeat(t,e)},t.prototype.getChords=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getChords()},t.prototype.findChord=function(t,e){var r;return null===(r=this.songProvider)||void 0===r?void 0:r.findChord(t,e)},t.prototype.getVocalFrequency=function(t){var e;return null===(e=this.songProvider)||void 0===e?void 0:e.getVocalFrequency(t)},t.prototype.getVocalAmplitude=function(t){var e;return null===(e=this.songProvider)||void 0===e?void 0:e.getVocalAmplitude(t)},t.prototype.getMaxVocalAmplitude=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getMaxVocalAmplitude()},t.prototype.getValenceArousal=function(t){var e;return null===(e=this.songProvider)||void 0===e?void 0:e.getValenceArousal(t)},t.prototype.getMedianValenceArousal=function(){var t;return null===(t=this.songProvider)||void 0===t?void 0:t.getMedianValenceArousal()},t}(),dn=function(){function t(t,e){this.player=t,this.listener=e,this.initialize()}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options?Ur({},this._options):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"author",{get:function(){return this._author},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"server",{get:function(){return this._server},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"managed",{get:function(){return!!this._host},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"host",{get:function(){return this._host},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songUrl",{get:function(){return this._songUrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"songOptions",{get:function(){return this._songOptions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parameters",{get:function(){return this._parameters},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isConnecting",{get:function(){return!!this.connecting},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var t,e,r,n;return Fr(this,void 0,void 0,(function(){return jr(this,(function(i){switch(i.label){case 0:return this._options=null===(e=null===(t=this.player)||void 0===t?void 0:t.options)||void 0===e?void 0:e.app,this._options&&(this._options=Ur({},this._options),this._name=null===(r=this._options)||void 0===r?void 0:r.appName,this._author=null===(n=this._options)||void 0===n?void 0:n.appAuthor,this._options.token&&(Ve.textalive.appToken=this._options.token)),this._parameters={},this.parseQueryString(),this.initializeServerConnection(),"undefined"!=typeof window&&this._options?[4,this.connect()]:[3,2];case 1:i.sent(),this.initializePlayerListener(),this.initializeMessageListener(),i.label=2;case 2:return this._songUrl&&this.createFromSongUrl(),[2]}}))}))},t.prototype.initializeServerConnection=function(){var t,e,r,n;return Fr(this,void 0,void 0,(function(){var i,o,a,s;return jr(this,(function(l){switch(l.label){case 0:return[4,Ke.getServerStatus()];case 1:return i=l.sent(),o="ja"===(null==i?void 0:i.lang),Ve.textalive.appToken&&(null==i?void 0:i.app)&&(i.app.data&&(this._name=null===(t=i.app.data)||void 0===t?void 0:t.name,this._author=null===(r=null===(e=i.app)||void 0===e?void 0:e.data)||void 0===r?void 0:r.author),this._server={version:i.version,message:i.app.message,error:i.app.error},!this._server.error)?(a=this._server.message?"\n"+this._server.message:"",o?console.info("[TextAlive API] クライアント v"+Ve.client.version+" でサーバ v"+(this._server.version||"0.0.0")+" に接続"+a):console.info("[TextAlive API] App API client v"+Ve.client.version+" connected to server v"+(this._server.version||"0.0.0")+a),[2]):(s=(null===(n=this._server)||void 0===n?void 0:n.error)?"\n"+this._server.error:"",o?console.warn("[TextAlive API] このアプリはトークンが正しく指定されていないため動作しません。 https://developer.textalive.jp からトークンを入手して指定してください。"+s):console.warn("[TextAlive API] This app requires a valid app token to run properly. You could get a token from https://developer.textalive.jp."+s),[2])}}))}))},t.prototype.initializePlayerListener=function(){var t=this;this.playerListener={onVideoReady:function(e){t._host&&window.parent.postMessage({kind:"ta_video",options:{lyrics:!!t.player.data.lyrics,duration:t.player.video.duration}},"*")},onThrottledTimeUpdate:function(e){t._host&&window.parent.postMessage({kind:"ta_position",options:{position:e}},"*")},onPlay:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"play"}},"*")},onPause:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"pause"}},"*")},onStop:function(){t._host&&window.parent.postMessage({kind:"ta_status",options:{status:"stop"}},"*")},onDispose:function(){t.dispose()}},this.player.addListener(this.playerListener)},t.prototype.initializeMessageListener=function(){var t=this;this.messageListener=function(e){if(e.data.kind&&/^ta_/.test(e.data.kind)){var r=t.player;switch(e.data.kind.substring(3)){case"status":switch(e.data.options.status){case"play":r.requestPlay();break;case"pause":r.requestPause();break;case"stop":r.requestStop()}break;case"seek":r.requestMediaSeek(e.data.options.position);break;case"parameter":var n=e.data.options,i=n.name,o=n.value;t.parameters[i]=o,t.listener.onAppParameterUpdate(i,o);break;case"media":t._songUrl=e.data.options.url,t._songOptions=e.data.options.options||{},r.requestStop();var a=t.createFromSongUrl();t.listener.onAppMediaChange(t._songUrl,a)}}},window.addEventListener("message",this.messageListener)},t.prototype.createFromSongUrl=function(){var t,e=this._songOptions;return e&&(t={video:{}},e.altLyricsUrl&&(t.altLyricsUrl=e.altLyricsUrl),e.lyricsDirectAccess&&(t.lyricsDirectAccess=e.lyricsDirectAccess),e.lyricId&&(t.video.lyricId=e.lyricId),e.lyricDiffId&&(t.video.lyricDiffId=e.lyricDiffId),e.chordId&&(t.video.chordId=e.chordId),e.beatId&&(t.video.beatId=e.beatId),e.repetitiveSegmentId&&(t.video.repetitiveSegmentId=e.repetitiveSegmentId)),this.player.createFromSongUrl(this._songUrl,t)},t.prototype.parseQueryString=function(){var t=Br("ta_app_token");t&&(Ve.textalive.appToken=t),this._songUrl=Br("ta_song_url"),this._songOptions={};var e=Br("ta_lyric_id");e&&(this._songOptions.lyricId=parseInt(e),isNaN(this._songOptions.lyricId)&&delete this._songOptions.lyricId);var r=Br("ta_lyric_diff_id");r&&(this._songOptions.lyricDiffId=parseInt(r),isNaN(this._songOptions.lyricDiffId)&&delete this._songOptions.lyricDiffId);var n=Br("ta_alt_lyrics_url");n&&(this._songOptions.altLyricsUrl=n);var i=Br("ta_lyrics_direct_access");i&&(this._songOptions.lyricsDirectAccess="true"===i,this._songOptions.lyricsDirectAccess||delete this._songOptions.lyricsDirectAccess);var o=Br("ta_chord_id");o&&(this._songOptions.chordId=parseInt(o),isNaN(this._songOptions.chordId)&&delete this._songOptions.chordId);var a=Br("ta_beat_id");a&&(this._songOptions.beatId=parseInt(a),isNaN(this._songOptions.beatId)&&delete this._songOptions.beatId);var s=Br("ta_repetitive_segment_id");s&&(this._songOptions.repetitiveSegmentId=parseInt(s),isNaN(this._songOptions.repetitiveSegmentId)&&delete this._songOptions.repetitiveSegmentId)},t.prototype.connect=function(){return Fr(this,void 0,void 0,(function(){var t,e=this;return jr(this,(function(r){switch(r.label){case 0:return this.connecting?[2,this.connecting]:"undefined"!=typeof window&&this.options&&window.parent&&window!==window.parent?[3,2]:[4,new Promise((function(t){return setTimeout(t,1)}))];case 1:return r.sent(),this.listener.onAppReady(this),[2,!1];case 2:return this.connecting=Promise.race([new Promise((function(r){t=function(n){n.data.kind&&/^ta_/.test(n.data.kind)&&"ack"===n.data.kind.substring(3)&&(window.removeEventListener("message",t),e._host=n.data.options,r(!0))},window.addEventListener("message",t)})),Fr(e,void 0,void 0,(function(){var e;return jr(this,(function(r){switch(r.label){case 0:e=0,r.label=1;case 1:return e<5?(window.parent.postMessage({kind:"ta_connect",options:this.options},"*"),[4,new Promise((function(t){return setTimeout(t,200)}))]):[3,4];case 2:if(r.sent(),this._host)return[3,4];r.label=3;case 3:return e++,[3,1];case 4:return!this._host&&t&&window.removeEventListener("message",t),[2,!!this._host]}}))}))]),this.connecting.finally((function(){e.connecting=null,e.listener.onAppReady(e)})),[2,this.connecting]}}))}))},t.prototype.dispose=function(){"undefined"!=typeof window&&this.options&&(this.player.removeListener(this.playerListener),window.removeEventListener("message",this.messageListener)),this._host=null,this.player=null},t}();function fn(t){return t}function mn(t){return t<-1?t=-1:t>1&&(t=1),function(e){return 0==t?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}function gn(t){return function(e){return Math.pow(e,t)}}function vn(t){return function(e){return 1-Math.pow(1-e,t)}}function yn(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}var _n=gn(2),bn=vn(2),xn=yn(2),wn=gn(3),En=vn(3),Mn=yn(3),Sn=gn(4),Tn=vn(4),An=yn(4),Cn=gn(5),Pn=vn(5),On=yn(5);function Rn(t){return 1-Math.cos(t*Math.PI/2)}function Ln(t){return Math.sin(t*Math.PI/2)}function In(t){return-.5*(Math.cos(Math.PI*t)-1)}function Nn(t){return function(e){return e*e*((t+1)*e-t)}}var Bn=Nn(1.7);function Dn(t){return function(e){return--e*e*((t+1)*e+t)+1}}var kn=Dn(1.7);function Un(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}var Fn=Un(1.7);function jn(t){return-(Math.sqrt(1-t*t)-1)}function Gn(t){return Math.sqrt(1- --t*t)}function zn(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function Vn(t){return 1-Hn(1-t)}function Hn(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Wn(t){return t<.5?.5*Vn(2*t):.5*Hn(2*t-1)+.5}function qn(t,e){var r=2*Math.PI;return function(n){if(0==n||1==n)return n;var i=e/r*Math.asin(1/t);return-t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*r/e)}}var Yn=qn(1,.3);function Xn(t,e){var r=2*Math.PI;return function(n){if(0==n||1==n)return n;var i=e/r*Math.asin(1/t);return t*Math.pow(2,-10*n)*Math.sin((n-i)*r/e)+1}}var Jn=Xn(1,.3);function Zn(t,e){var r=2*Math.PI;return function(n){var i=e/r*Math.asin(1/t);return(n*=2)<1?t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*r/e)*-.5:t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*r/e)*.5+1}}var Kn,Qn,$n,ti,ei,ri,ni,ii,oi,ai,si,li,ci,ui,hi,pi,di,fi,mi,gi,vi=Zn(1,.3*1.5),yi=Object.freeze({__proto__:null,linear:fn,get:mn,getPowIn:gn,getPowOut:vn,getPowInOut:yn,quadIn:_n,quadOut:bn,quadInOut:xn,cubicIn:wn,cubicOut:En,cubicInOut:Mn,quartIn:Sn,quartOut:Tn,quartInOut:An,quintIn:Cn,quintOut:Pn,quintInOut:On,sineIn:Rn,sineOut:Ln,sineInOut:In,getBackIn:Nn,backIn:Bn,getBackOut:Dn,backOut:kn,getBackInOut:Un,backInOut:Fn,circIn:jn,circOut:Gn,circInOut:zn,bounceIn:Vn,bounceOut:Hn,bounceInOut:Wn,getElasticIn:qn,elasticIn:Yn,getElasticOut:Xn,elasticOut:Jn,getElasticInOut:Zn,elasticInOut:vi}),_i=(function(){function t(){}t.linear=fn,t.get=mn,t.getPowIn=gn,t.getPowOut=vn,t.getPowInOut=yn,t.quadIn=_n,t.quadOut=bn,t.quadInOut=xn,t.cubicIn=wn,t.cubicOut=En,t.cubicInOut=Mn,t.quartIn=Sn,t.quartOut=Tn,t.quartInOut=An,t.quintIn=Cn,t.quintOut=Pn,t.quintInOut=On,t.sineIn=Rn,t.sineOut=Ln,t.sineInOut=In,t.getBackIn=Nn,t.backIn=Bn,t.getBackOut=Dn,t.backOut=kn,t.getBackInOut=Un,t.backInOut=Fn,t.circIn=jn,t.circOut=Gn,t.circInOut=zn,t.bounceIn=Vn,t.bounceOut=Hn,t.bounceInOut=Wn,t.getElasticIn=qn,t.elasticIn=Yn,t.getElasticOut=Xn,t.elasticOut=Jn,t.getElasticInOut=Zn,t.elasticInOut=vi}(),function(){function t(){this.cursor=-1,this.widgets=[],this.instances=[],this.model={id:-1,type:Pe.NONE,sourceId:-1,author:null,originalAuthor:null,className:null,createdDate:null}}return Object.defineProperty(t.prototype,"id",{get:function(){return this.model?this.model.id:-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"script",{get:function(){return this.model?this.model.script:null},enumerable:!1,configurable:!0}),t}()),bi=function(){},xi=function(){function t(t,e){this.onTemplateLoad=e,this._emitter=null,this._loaded=null,this._loading=null,this.verbose=!1,this._emitter=t,this.clear()}return Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loading",{get:function(){return this._loading},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this._loaded={},this._loading={}},t.prototype.loadLatest=function(t){return void 0===t&&(t=100),Fr(this,void 0,void 0,(function(){var e;return jr(this,(function(r){switch(r.label){case 0:return[4,ur.list({maxResults:t,withoutAuthors:!0,withoutOriginalAuthors:!0,script:!0})];case 1:return(e=r.sent())&&e.list?(this.verbose&&console.log("--- loading template classes ---"),[2,this.registerMany(e.list)]):[2]}}))}))},t.prototype.loadForVideo=function(t){return Fr(this,void 0,void 0,(function(){var e,r=this;return jr(this,(function(n){switch(n.label){case 0:return[4,ur.loadForVideo(t)];case 1:return(e=n.sent())&&e.list?(this.verbose&&console.log("--- loading template classes for vid:"+t+" ---"),[4,this.registerMany(e.list)]):[2,null];case 2:return[2,n.sent().map((function(t){return t?r.getByName(t):null}))]}}))}))},t.prototype.loadByNames=function(t){return Fr(this,void 0,void 0,(function(){var e,r=this;return jr(this,(function(n){switch(n.label){case 0:return!Array.isArray(t)||t.length<=0?[2,[]]:(this.verbose&&console.log("--- loading template classes ---"),[4,Promise.all(t.map((function(t){return r.doLoadByName(t)})))]);case 1:return(e=n.sent())&&this._emitter.onTemplatesLoad(e.filter((function(t){return!!t})).map((function(t){return t.className}))),[2,e]}}))}))},t.prototype.loadByName=function(t){return Fr(this,void 0,void 0,(function(){var e,r;return jr(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.doLoadByName(t)];case 1:return e=n.sent(),this._emitter.onTemplatesLoad([e.className]),[2,e];case 2:return r=n.sent(),this._emitter.onTemplatesLoad(null,r),[2,null];case 3:return[2]}}))}))},t.prototype.doLoadByName=function(t){return Fr(this,void 0,void 0,(function(){var e,r,n=this;return jr(this,(function(i){return null!==(e=this.getByName(t))?[2,e]:this._loading[t]?[2,this._loading[t]]:(r=new Promise((function(e){return ur.loadByName(t).then((function(t){return n.onTemplateLoad(t)})).then(e)})),this._loading[t]=r,r.finally((function(){return delete n._loading[t]})),[2,r])}))}))},t.prototype.loadById=function(t){return Fr(this,void 0,void 0,(function(){var e,r,n;return jr(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.doLoadById(t)];case 1:return e=i.sent(),r=null,[3,3];case 2:return n=i.sent(),r=n,[3,3];case 3:return this._emitter.onTemplatesLoad(e?[e.className]:null,r),[2,e]}}))}))},t.prototype.doLoadById=function(t){return Fr(this,void 0,void 0,(function(){var e,r,n=this;return jr(this,(function(i){return(e=this.getById(t))?[2,e]:this._loading[t]?[2,this._loading[t]]:(r=new Promise((function(e){return ur.load(t).then((function(t){return n.onTemplateLoad(t)})).then(e)})),this._loading[t]=r,r.finally((function(){return delete n._loading[t]})),[2,r])}))}))},t.prototype.registerMany=function(t){return Fr(this,void 0,void 0,(function(){var e,r,n=this;return jr(this,(function(i){switch(i.label){case 0:return e=t.map((function(t){var e=n.onTemplateLoad(t);return n._loading[t.className]=e,n._loading[t.className+"@"+t.id]=e,e})),[4,Promise.all(e.map((function(t){return t.then((function(t){return t.className})).catch((function(t){return null}))})))];case 1:return r=i.sent().filter((function(t){return!!t})),this._emitter.onTemplatesLoad(r),[2,r]}}))}))},t.prototype.commit=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,ur.create({sourceId:t.model.sourceId,script:t.model.script,log:e})];case 1:return(r=n.sent()).success&&(t.model.id=r.id,this._emitter.onTemplateCommit(t.className)),[2,r]}}))}))},t.prototype.getByName=function(t,e){var r;if(void 0===e&&(e=!1),t&&(r=t.match(/(.+)@([0-9]+)/))){t=r[1];var n=parseInt(r[2]);if(!this._loaded[t])return null;var i=this._loaded[t].model;if(i.id!==n){if(!e)return null;this.verbose&&console.log("[warning] template "+t+" version "+n+" is requested but "+i.id+" is used")}}return this._loaded[t]?this._loaded[t]:null},t.prototype.getById=function(t){var e=null;for(var r in this._loaded)if(this._loaded[r].model.id===t){e=this._loaded[r];break}return e},t}(),wi=function(t,e){return Qn=String(t),$n=Qn.length,function(t){for(var e in Kn=t||{},Ei)Object.prototype.hasOwnProperty.call(Kn,e)||(Kn[e]=Ei[e]);ti=Kn.sourceFile||null}(e),ci=1,ei=ui=0,li=!0,Ko(),function(t){hi=pi=ei,Kn.locations&&(di=new Yo),fi=gi=null,mi=[],Qo();var e=t||ua(),r=!0;for(t||(e.body=[]);ai!==Oi;){var n=wa();e.body.push(n),r&&da(n)&&sa(!0),r=!1}return pa(e,"Program")}(Kn.program)},Ei={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null};function Mi(t,e){var r=function(t,e){for(var r=1,n=0;;){Ho.lastIndex=n;var i=Ho.exec(t);if(!(i&&i.index<e))break;++r,n=i.index+i[0].length}return{line:r,column:e-n}}(Qn,t);e+=" ("+r.line+":"+r.column+")";var n=new SyntaxError(e);throw n.pos=t,n.loc=r,n.raisedAt=ei,n}var Si=[],Ti={type:"num"},Ai={type:"regexp"},Ci={type:"string"},Pi={type:"name"},Oi={type:"eof"},Ri={keyword:"break"},Li={keyword:"case",beforeExpr:!0},Ii={keyword:"catch"},Ni={keyword:"continue"},Bi={keyword:"debugger"},Di={keyword:"default"},ki={keyword:"do",isLoop:!0},Ui={keyword:"else",beforeExpr:!0},Fi={keyword:"finally"},ji={keyword:"for",isLoop:!0},Gi={keyword:"function"},zi={keyword:"if"},Vi={keyword:"return",beforeExpr:!0},Hi={keyword:"switch"},Wi={keyword:"throw",beforeExpr:!0},qi={keyword:"try"},Yi={keyword:"var"},Xi={keyword:"while",isLoop:!0},Ji={keyword:"with"},Zi={keyword:"new",beforeExpr:!0},Ki={keyword:"this"},Qi={keyword:"null",atomValue:null},$i={keyword:"true",atomValue:!0},to={keyword:"false",atomValue:!1},eo={keyword:"in",binop:7,beforeExpr:!0},ro={break:Ri,case:Li,catch:Ii,continue:Ni,debugger:Bi,default:Di,do:ki,else:Ui,finally:Fi,for:ji,function:Gi,if:zi,return:Vi,switch:Hi,throw:Wi,try:qi,var:Yi,while:Xi,with:Ji,null:Qi,true:$i,false:to,new:Zi,in:eo,instanceof:{keyword:"instanceof",binop:7,beforeExpr:!0},this:Ki,typeof:{keyword:"typeof",prefix:!0,beforeExpr:!0},void:{keyword:"void",prefix:!0,beforeExpr:!0},delete:{keyword:"delete",prefix:!0,beforeExpr:!0}},no={type:"[",beforeExpr:!0},io={type:"]"},oo={type:"{",beforeExpr:!0},ao={type:"}"},so={type:"(",beforeExpr:!0},lo={type:")"},co={type:",",beforeExpr:!0},uo={type:";",beforeExpr:!0},ho={type:":",beforeExpr:!0},po={type:"."},fo={type:"?",beforeExpr:!0},mo={binop:10,beforeExpr:!0},go={isAssign:!0,beforeExpr:!0},vo={isAssign:!0,beforeExpr:!0},yo={postfix:!0,prefix:!0,isUpdate:!0},_o={prefix:!0,beforeExpr:!0},bo={binop:1,beforeExpr:!0},xo={binop:2,beforeExpr:!0},wo={binop:3,beforeExpr:!0},Eo={binop:4,beforeExpr:!0},Mo={binop:5,beforeExpr:!0},So={binop:6,beforeExpr:!0},To={binop:7,beforeExpr:!0},Ao={binop:8,beforeExpr:!0},Co={binop:9,prefix:!0,beforeExpr:!0},Po={binop:10,beforeExpr:!0},Oo={bracketL:no,bracketR:io,braceL:oo,braceR:ao,parenL:so,parenR:lo,comma:co,semi:uo,colon:ho,dot:po,question:fo,slash:mo,eq:go,name:Pi,eof:Oi,num:Ti,regexp:Ai,string:Ci};for(var Ro in ro)Oo["_"+Ro]=ro[Ro];function Lo(t){t=t.split(" ");var e="",r=[];t:for(var n=0;n<t.length;++n){for(var i=0;i<r.length;++i)if(r[i][0].length==t[n].length){r[i].push(t[n]);continue t}r.push([t[n]])}function o(t){if(1==t.length)return e+="return str === "+JSON.stringify(t[0])+";";e+="switch(str){";for(var r=0;r<t.length;++r)e+="case "+JSON.stringify(t[r])+":";e+="return true}return false;"}if(r.length>3){for(r.sort((function(t,e){return e.length-t.length})),e+="switch(str.length){",n=0;n<r.length;++n){var a=r[n];e+="case "+a[0].length+":",o(a)}e+="}"}else o(t);return new Function("str",e)}var Io,No=Lo("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),Bo=Lo("class enum extends super const export import"),Do=Lo("implements interface let package private protected public static yield"),ko=Lo("eval arguments"),Uo=Lo("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Fo=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,jo="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",Go=new RegExp("["+jo+"]"),zo=new RegExp("["+jo+"̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿]"),Vo=/[\n\r\u2028\u2029]/,Ho=/\r\n|[\n\r\u2028\u2029]/g,Wo=function(t){return t<65?36===t:t<91||(t<97?95===t:t<123||t>=170&&Go.test(String.fromCharCode(t)))},qo=function(t){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||t>=170&&zo.test(String.fromCharCode(t))))};function Yo(){this.line=ci,this.column=ei-ui}function Xo(t,e){ni=ei,Kn.locations&&(oi=new Yo),ai=t,Ko(),si=e,li=t.beforeExpr}function Jo(){var t,e=Kn.onComment&&Kn.locations&&new Yo,r=ei,n=Qn.indexOf("*/",ei+=2);if(-1===n&&Mi(ei-2,"Unterminated comment"),ei=n+2,Kn.locations)for(Ho.lastIndex=r;(t=Ho.exec(Qn))&&t.index<ei;)++ci,ui=t.index+t[0].length;Kn.onComment&&Kn.onComment(!0,Qn.slice(r+2,n),r,ei,e,Kn.locations&&new Yo)}function Zo(){for(var t=ei,e=Kn.onComment&&Kn.locations&&new Yo,r=Qn.charCodeAt(ei+=2);ei<$n&&10!==r&&13!==r&&8232!==r&&8233!==r;)++ei,r=Qn.charCodeAt(ei);Kn.onComment&&Kn.onComment(!1,Qn.slice(t+2,ei),t,ei,e,Kn.locations&&new Yo)}function Ko(){for(;ei<$n;){var t=Qn.charCodeAt(ei);if(32===t)++ei;else if(13===t)++ei,10===(e=Qn.charCodeAt(ei))&&++ei,Kn.locations&&(++ci,ui=ei);else if(10===t||8232===t||8233===t)++ei,Kn.locations&&(++ci,ui=ei);else if(t>8&&t<14)++ei;else if(47===t){var e;if(42===(e=Qn.charCodeAt(ei+1)))Jo();else{if(47!==e)break;Zo()}}else if(160===t)++ei;else{if(!(t>=5760&&Fo.test(String.fromCharCode(t))))break;++ei}}}function Qo(t){if(t?ei=ri+1:ri=ei,Kn.locations&&(ii=new Yo),t)return ta();if(ei>=$n)return Xo(Oi);var e=Qn.charCodeAt(ei);if(Wo(e)||92===e)return oa();var r=function(t){switch(t){case 46:return(n=Qn.charCodeAt(ei+1))>=48&&n<=57?ra(!0):(++ei,Xo(po));case 40:return++ei,Xo(so);case 41:return++ei,Xo(lo);case 59:return++ei,Xo(uo);case 44:return++ei,Xo(co);case 91:return++ei,Xo(no);case 93:return++ei,Xo(io);case 123:return++ei,Xo(oo);case 125:return++ei,Xo(ao);case 58:return++ei,Xo(ho);case 63:return++ei,Xo(fo);case 48:var e=Qn.charCodeAt(ei+1);if(120===e||88===e)return function(){ei+=2;var t=ea(16);return null==t&&Mi(ri+2,"Expected hexadecimal number"),Wo(Qn.charCodeAt(ei))&&Mi(ei,"Identifier directly after number"),Xo(Ti,t)}();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return ra(!1);case 34:case 39:return function(t){ei++;for(var e="";;){ei>=$n&&Mi(ri,"Unterminated string constant");var r=Qn.charCodeAt(ei);if(r===t)return++ei,Xo(Ci,e);if(92===r){r=Qn.charCodeAt(++ei);var n=/^[0-7]+/.exec(Qn.slice(ei,ei+3));for(n&&(n=n[0]);n&&parseInt(n,8)>255;)n=n.slice(0,-1);if("0"===n&&(n=null),++ei,n)gi&&Mi(ei-2,"Octal literal in strict mode"),e+=String.fromCharCode(parseInt(n,8)),ei+=n.length-1;else switch(r){case 110:e+="\n";break;case 114:e+="\r";break;case 120:e+=String.fromCharCode(na(2));break;case 117:e+=String.fromCharCode(na(4));break;case 85:e+=String.fromCharCode(na(8));break;case 116:e+="\t";break;case 98:e+="\b";break;case 118:e+="\v";break;case 102:e+="\f";break;case 48:e+="\0";break;case 13:10===Qn.charCodeAt(ei)&&++ei;case 10:Kn.locations&&(ui=ei,++ci);break;default:e+=String.fromCharCode(r)}}else 13!==r&&10!==r&&8232!==r&&8233!==r||Mi(ri,"Unterminated string constant"),e+=String.fromCharCode(r),++ei}}(t);case 47:return r=Qn.charCodeAt(ei+1),li?(++ei,ta()):61===r?$o(vo,2):$o(mo,1);case 37:case 42:return 61===Qn.charCodeAt(ei+1)?$o(vo,2):$o(Po,1);case 124:case 38:return function(t){var e=Qn.charCodeAt(ei+1);return e===t?$o(124===t?bo:xo,2):61===e?$o(vo,2):$o(124===t?wo:Mo,1)}(t);case 94:return 61===Qn.charCodeAt(ei+1)?$o(vo,2):$o(Eo,1);case 43:case 45:return function(t){var e=Qn.charCodeAt(ei+1);return e===t?45==e&&62==Qn.charCodeAt(ei+2)&&Vo.test(Qn.slice(pi,ei))?(ei+=3,Zo(),Ko(),Qo()):$o(yo,2):61===e?$o(vo,2):$o(Co,1)}(t);case 60:case 62:return function(t){var e=Qn.charCodeAt(ei+1),r=1;return e===t?(r=62===t&&62===Qn.charCodeAt(ei+2)?3:2,61===Qn.charCodeAt(ei+r)?$o(vo,r+1):$o(Ao,r)):33==e&&60==t&&45==Qn.charCodeAt(ei+2)&&45==Qn.charCodeAt(ei+3)?(ei+=4,Zo(),Ko(),Qo()):(61===e&&(r=61===Qn.charCodeAt(ei+2)?3:2),$o(To,r))}(t);case 61:case 33:return function(t){return 61===Qn.charCodeAt(ei+1)?$o(So,61===Qn.charCodeAt(ei+2)?3:2):$o(61===t?go:_o,1)}(t);case 126:return $o(_o,1)}var r,n;return!1}(e);if(!1===r){var n=String.fromCharCode(e);if("\\"===n||Go.test(n))return oa();Mi(ei,"Unexpected character '"+n+"'")}return r}function $o(t,e){var r=Qn.slice(ei,ei+e);ei+=e,Xo(t,r)}function ta(){for(var t,e,r=ei;;){ei>=$n&&Mi(r,"Unterminated regular expression");var n=Qn.charAt(ei);if(Vo.test(n)&&Mi(r,"Unterminated regular expression"),t)t=!1;else{if("["===n)e=!0;else if("]"===n&&e)e=!1;else if("/"===n&&!e)break;t="\\"===n}++ei}var i=Qn.slice(r,ei);++ei;var o=ia();return o&&!/^[gmsiy]*$/.test(o)&&Mi(r,"Invalid regexp flag"),Xo(Ai,new RegExp(i,o))}function ea(t,e){for(var r=ei,n=0,i=0,o=null==e?1/0:e;i<o;++i){var a,s=Qn.charCodeAt(ei);if((a=s>=97?s-97+10:s>=65?s-65+10:s>=48&&s<=57?s-48:1/0)>=t)break;++ei,n=n*t+a}return ei===r||null!=e&&ei-r!==e?null:n}function ra(t){var e=ei,r=!1,n=48===Qn.charCodeAt(ei);t||null!==ea(10)||Mi(e,"Invalid number"),46===Qn.charCodeAt(ei)&&(++ei,ea(10),r=!0);var i=Qn.charCodeAt(ei);69!==i&&101!==i||(43!==(i=Qn.charCodeAt(++ei))&&45!==i||++ei,null===ea(10)&&Mi(e,"Invalid number"),r=!0),Wo(Qn.charCodeAt(ei))&&Mi(ei,"Identifier directly after number");var o,a=Qn.slice(e,ei);return r?o=parseFloat(a):n&&1!==a.length?/[89]/.test(a)||gi?Mi(e,"Invalid number"):o=parseInt(a,8):o=parseInt(a,10),Xo(Ti,o)}function na(t){var e=ea(16,t);return null===e&&Mi(ri,"Bad character escape sequence"),e}function ia(){Io=!1;for(var t,e=!0,r=ei;;){var n=Qn.charCodeAt(ei);if(qo(n))Io&&(t+=Qn.charAt(ei)),++ei;else{if(92!==n)break;Io||(t=Qn.slice(r,ei)),Io=!0,117!=Qn.charCodeAt(++ei)&&Mi(ei,"Expecting Unicode escape sequence \\uXXXX"),++ei;var i=na(4),o=String.fromCharCode(i);o||Mi(ei-1,"Invalid Unicode escape"),(e?Wo(i):qo(i))||Mi(ei-4,"Invalid Unicode escape"),t+=o}e=!1}return Io?t:Qn.slice(r,ei)}function oa(){var t=ia(),e=Pi;return Io||(Uo(t)?e=ro[t]:(Kn.forbidReserved&&(3===Kn.ecmaVersion?No:Bo)(t)||gi&&Do(t))&&Mi(ri,"The keyword '"+t+"' is reserved")),Xo(e,t)}function aa(){hi=ri,pi=ni,di=oi,Qo()}function sa(t){if(gi=t,ei=pi,Kn.locations)for(;ei<ui;)ui=Qn.lastIndexOf("\n",ui-2)+1,--ci;Ko(),Qo()}function la(){this.type=null,this.start=ri,this.end=null}function ca(){this.start=ii,this.end=null,null!==ti&&(this.source=ti)}function ua(){var t=new la;return Kn.locations&&(t.loc=new ca),Kn.directSourceFile&&(t.sourceFile=Kn.directSourceFile),Kn.ranges&&(t.range=[ri,0]),t}function ha(t){var e=new la;return e.start=t.start,Kn.locations&&(e.loc=new ca,e.loc.start=t.loc.start),Kn.ranges&&(e.range=[t.range[0],0]),e}function pa(t,e){return t.type=e,t.end=pi,Kn.locations&&(t.loc.end=di),Kn.ranges&&(t.range[1]=pi),t}function da(t){return Kn.ecmaVersion>=5&&"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"use strict"===t.expression.value}function fa(t){if(ai===t)return aa(),!0}function ma(){return!Kn.strictSemicolons&&(ai===Oi||ai===ao||Vo.test(Qn.slice(pi,ri)))}function ga(){fa(uo)||ma()||ya()}function va(t){ai===t?aa():ya()}function ya(){Mi(ri,"Unexpected token")}function _a(t){"Identifier"!==t.type&&"MemberExpression"!==t.type&&Mi(t.start,"Assigning to rvalue"),gi&&"Identifier"===t.type&&ko(t.name)&&Mi(t.start,"Assigning to "+t.name+" in strict mode")}var ba={kind:"loop"},xa={kind:"switch"};function wa(){(ai===mo||ai===vo&&"/="==si)&&Qo(!0);var t=ai,e=ua();switch(t){case Ri:case Ni:aa();var r=t===Ri;fa(uo)||ma()?e.label=null:ai!==Pi?ya():(e.label=Da(),ga());for(var n=0;n<mi.length;++n){var i=mi[n];if(null==e.label||i.name===e.label.name){if(null!=i.kind&&(r||"loop"===i.kind))break;if(e.label&&r)break}}return n===mi.length&&Mi(e.start,"Unsyntactic "+t.keyword),pa(e,r?"BreakStatement":"ContinueStatement");case Bi:return aa(),ga(),pa(e,"DebuggerStatement");case ki:return aa(),mi.push(ba),e.body=wa(),mi.pop(),va(Xi),e.test=Ea(),ga(),pa(e,"DoWhileStatement");case ji:if(aa(),mi.push(ba),va(so),ai===uo)return Sa(e,null);if(ai===Yi){var o=ua();return aa(),Aa(o,!0),pa(o,"VariableDeclaration"),1===o.declarations.length&&fa(eo)?Ta(e,o):Sa(e,o)}return o=Ca(!1,!0),fa(eo)?(_a(o),Ta(e,o)):Sa(e,o);case Gi:return aa(),Na(e,!0);case zi:return aa(),e.test=Ea(),e.consequent=wa(),e.alternate=fa(Ui)?wa():null,pa(e,"IfStatement");case Vi:return fi||Mi(ri,"'return' outside of function"),aa(),fa(uo)||ma()?e.argument=null:(e.argument=Ca(),ga()),pa(e,"ReturnStatement");case Hi:aa(),e.discriminant=Ea(),e.cases=[],va(oo),mi.push(xa);for(var a,s;ai!=ao;)if(ai===Li||ai===Di){var l=ai===Li;a&&pa(a,"SwitchCase"),e.cases.push(a=ua()),a.consequent=[],aa(),l?a.test=Ca():(s&&Mi(hi,"Multiple default clauses"),s=!0,a.test=null),va(ho)}else a||ya(),a.consequent.push(wa());return a&&pa(a,"SwitchCase"),aa(),mi.pop(),pa(e,"SwitchStatement");case Wi:return aa(),Vo.test(Qn.slice(pi,ri))&&Mi(pi,"Illegal newline after throw"),e.argument=Ca(),ga(),pa(e,"ThrowStatement");case qi:if(aa(),e.block=Ma(),e.handler=null,ai===Ii){var c=ua();aa(),va(so),c.param=Da(),gi&&ko(c.param.name)&&Mi(c.param.start,"Binding "+c.param.name+" in strict mode"),va(lo),c.guard=null,c.body=Ma(),e.handler=pa(c,"CatchClause")}return e.guardedHandlers=Si,e.finalizer=fa(Fi)?Ma():null,e.handler||e.finalizer||Mi(e.start,"Missing catch or finally clause"),pa(e,"TryStatement");case Yi:return aa(),Aa(e),ga(),pa(e,"VariableDeclaration");case Xi:return aa(),e.test=Ea(),mi.push(ba),e.body=wa(),mi.pop(),pa(e,"WhileStatement");case Ji:return gi&&Mi(ri,"'with' in strict mode"),aa(),e.object=Ea(),e.body=wa(),pa(e,"WithStatement");case oo:return Ma();case uo:return aa(),pa(e,"EmptyStatement");default:var u=si,h=Ca();if(t===Pi&&"Identifier"===h.type&&fa(ho)){for(n=0;n<mi.length;++n)mi[n].name===u&&Mi(h.start,"Label '"+u+"' is already declared");var p=ai.isLoop?"loop":ai===Hi?"switch":null;return mi.push({name:u,kind:p}),e.body=wa(),mi.pop(),e.label=h,pa(e,"LabeledStatement")}return e.expression=h,ga(),pa(e,"ExpressionStatement")}}function Ea(){va(so);var t=Ca();return va(lo),t}function Ma(t){var e,r=ua(),n=!0,i=!1;for(r.body=[],va(oo);!fa(ao);){var o=wa();r.body.push(o),n&&t&&da(o)&&(e=i,sa(i=!0)),n=!1}return i&&!e&&sa(!1),pa(r,"BlockStatement")}function Sa(t,e){return t.init=e,va(uo),t.test=ai===uo?null:Ca(),va(uo),t.update=ai===lo?null:Ca(),va(lo),t.body=wa(),mi.pop(),pa(t,"ForStatement")}function Ta(t,e){return t.left=e,t.right=Ca(),va(lo),t.body=wa(),mi.pop(),pa(t,"ForInStatement")}function Aa(t,e){for(t.declarations=[],t.kind="var";;){var r=ua();if(r.id=Da(),gi&&ko(r.id.name)&&Mi(r.id.start,"Binding "+r.id.name+" in strict mode"),r.init=fa(go)?Ca(!0,e):null,t.declarations.push(pa(r,"VariableDeclarator")),!fa(co))break}return t}function Ca(t,e){var r=Pa(e);if(!t&&ai===co){var n=ha(r);for(n.expressions=[r];fa(co);)n.expressions.push(Pa(e));return pa(n,"SequenceExpression")}return r}function Pa(t){var e=function(t){var e,r=(e=t,function t(e,r,n){var i=ai.binop;if(null!=i&&(!n||ai!==eo)&&i>r){var o=ha(e);o.left=e,o.operator=si;var a=ai;return aa(),o.right=t(Oa(),i,n),t(pa(o,a===bo||a===xo?"LogicalExpression":"BinaryExpression"),r,n)}return e}(Oa(),-1,e));if(fa(fo)){var n=ha(r);return n.test=r,n.consequent=Ca(!0),va(ho),n.alternate=Ca(!0,t),pa(n,"ConditionalExpression")}return r}(t);if(ai.isAssign){var r=ha(e);return r.operator=si,r.left=e,aa(),r.right=Pa(t),_a(e),pa(r,"AssignmentExpression")}return e}function Oa(){if(ai.prefix){var t=ua(),e=ai.isUpdate;return t.operator=si,t.prefix=!0,li=!0,aa(),t.argument=Oa(),e?_a(t.argument):gi&&"delete"===t.operator&&"Identifier"===t.argument.type&&Mi(t.start,"Deleting local variable in strict mode"),pa(t,e?"UpdateExpression":"UnaryExpression")}for(var r=Ra(La());ai.postfix&&!ma();)(t=ha(r)).operator=si,t.prefix=!1,t.argument=r,_a(r),aa(),r=pa(t,"UpdateExpression");return r}function Ra(t,e){var r;return fa(po)?((r=ha(t)).object=t,r.property=Da(!0),r.computed=!1,Ra(pa(r,"MemberExpression"),e)):fa(no)?((r=ha(t)).object=t,r.property=Ca(),r.computed=!0,va(io),Ra(pa(r,"MemberExpression"),e)):!e&&fa(so)?((r=ha(t)).callee=t,r.arguments=Ba(lo,!1),Ra(pa(r,"CallExpression"),e)):t}function La(){switch(ai){case Ki:var t=ua();return aa(),pa(t,"ThisExpression");case Pi:return Da();case Ti:case Ci:case Ai:return(t=ua()).value=si,t.raw=Qn.slice(ri,ni),aa(),pa(t,"Literal");case Qi:case $i:case to:return(t=ua()).value=ai.atomValue,t.raw=ai.keyword,aa(),pa(t,"Literal");case so:var e=ii,r=ri;aa();var n=Ca();return n.start=r,n.end=ni,Kn.locations&&(n.loc.start=e,n.loc.end=oi),Kn.ranges&&(n.range=[r,ni]),va(lo),n;case no:return t=ua(),aa(),t.elements=Ba(io,!0,!0),pa(t,"ArrayExpression");case oo:return function(){var t=ua(),e=!0,r=!1;for(t.properties=[],aa();!fa(ao);){if(e)e=!1;else if(va(co),Kn.allowTrailingCommas&&fa(ao))break;var n,i={key:Ia()},o=!1;if(fa(ho)?(i.value=Ca(!0),n=i.kind="init"):Kn.ecmaVersion>=5&&"Identifier"===i.key.type&&("get"===i.key.name||"set"===i.key.name)?(o=r=!0,n=i.kind=i.key.name,i.key=Ia(),ai!==so&&ya(),i.value=Na(ua(),!1)):ya(),"Identifier"===i.key.type&&(gi||r))for(var a=0;a<t.properties.length;++a){var s=t.properties[a];if(s.key.name===i.key.name){var l=n==s.kind||o&&"init"===s.kind||"init"===n&&("get"===s.kind||"set"===s.kind);l&&!gi&&"init"===n&&"init"===s.kind&&(l=!1),l&&Mi(i.key.start,"Redefinition of property")}}t.properties.push(i)}return pa(t,"ObjectExpression")}();case Gi:return t=ua(),aa(),Na(t,!1);case Zi:return i=ua(),aa(),i.callee=Ra(La(),!0),fa(so)?i.arguments=Ba(lo,!1):i.arguments=Si,pa(i,"NewExpression");default:ya()}var i}function Ia(){return ai===Ti||ai===Ci?La():Da(!0)}function Na(t,e){ai===Pi?t.id=Da():e?ya():t.id=null,t.params=[];var r=!0;for(va(so);!fa(lo);)r?r=!1:va(co),t.params.push(Da());var n=fi,i=mi;if(fi=!0,mi=[],t.body=Ma(!0),fi=n,mi=i,gi||t.body.body.length&&da(t.body.body[0]))for(var o=t.id?-1:0;o<t.params.length;++o){var a=o<0?t.id:t.params[o];if((Do(a.name)||ko(a.name))&&Mi(a.start,"Defining '"+a.name+"' in strict mode"),o>=0)for(var s=0;s<o;++s)a.name===t.params[s].name&&Mi(a.start,"Argument name clash in strict mode")}return pa(t,e?"FunctionDeclaration":"FunctionExpression")}function Ba(t,e,r){for(var n=[],i=!0;!fa(t);){if(i)i=!1;else if(va(co),e&&Kn.allowTrailingCommas&&fa(t))break;r&&ai===co?n.push(null):n.push(Ca(!0))}return n}function Da(t){var e=ua();return e.name=ai===Pi?si:t&&!Kn.forbidReserved&&ai.keyword||ya(),li=!1,aa(),pa(e,"Identifier")}var ka=function(){function t(e,r){var n,i="string"==typeof e?wi(e,t.PARSE_OPTIONS):e;this.ast=i,this.initFunc_=r,this.paused_=!1,this.polyfills_=[],this.functionCounter_=0,this.stepFunctions_=Object.create(null);for(var o,a=/^step([A-Z]\w*)$/,s=Object.getOwnPropertyNames(t.prototype),l=0;l<s.length;l++){var c=s[l];"function"==typeof t.prototype[c]&&(o=c.match(a))&&(this.stepFunctions_[o[1]]=t.prototype[c].bind(this))}this.global=this.createScope(this.ast,null),this.ast=wi(this.polyfills_.join("\n"),t.PARSE_OPTIONS),this.polyfills_=void 0,this.stripLocations_(this.ast,void 0,void 0),(n=new Fa(this.ast,this.global)).done=!1,this.stateStack=[n],this.run(),this.value=void 0,this.ast=i,(n=new Fa(this.ast,this.global)).done=!1,this.stateStack.length=0,this.stateStack[0]=n,this.nodeConstructor=n.node.constructor,this.stateStack=this.stateStack,this.OBJECT=this.OBJECT,this.OBJECT_PROTO=this.OBJECT_PROTO,this.FUNCTION=this.FUNCTION,this.FUNCTION_PROTO=this.FUNCTION_PROTO,this.ARRAY=this.ARRAY,this.ARRAY_PROTO=this.ARRAY_PROTO,this.REGEXP=this.REGEXP,this.REGEXP_PROTO=this.REGEXP_PROTO,this.UNDEFINED=void 0,this.NULL=null,this.NAN=NaN,this.TRUE=!0,this.FALSE=!1,this.STRING_EMPTY="",this.NUMBER_ZERO=0,this.NUMBER_ONE=1}return t.prototype.wrap=function(t){return t},t.prototype.unwrap=function(t,e){return t},t.prototype.appendCode=function(e){var r=this.stateStack[0];if(!r||"Program"!==r.node.type)throw Error("Expecting original AST to start with a Program node.");var n="string"==typeof e?wi(e,t.PARSE_OPTIONS):e;if(!n||"Program"!==n.type)throw Error("Expecting new AST to start with a Program node.");this.populateScope_(n,r.scope);for(var i,o=0;i=n.body[o];o++)r.node.body.push(i);r.done=!1},t.prototype.step=function(){var e=this.stateStack,r=e[e.length-1];if(!r)return!1;var n=r.node,i=n.type;if("Program"===i&&r.done)return!1;if(this.paused_)return!0;try{var o=this.stepFunctions_[i](e,r,n)}catch(e){if(e!==t.STEP_ERROR)throw e}return o&&e.push(o),!!n.end||this.step()},t.prototype.run=function(){for(;!this.paused_&&this.step(););return this.paused_},t.prototype.initGlobalScope=function(e){this.setProperty(e,"NaN",NaN,t.READONLY_DESCRIPTOR),this.setProperty(e,"Infinity",1/0,t.READONLY_DESCRIPTOR),this.setProperty(e,"undefined",void 0,t.READONLY_DESCRIPTOR),this.setProperty(e,"window",e,t.READONLY_DESCRIPTOR),this.setProperty(e,"this",e,t.READONLY_DESCRIPTOR),this.setProperty(e,"self",e),this.OBJECT_PROTO=new Ua(null),this.FUNCTION_PROTO=new Ua(this.OBJECT_PROTO),this.initFunction(e),this.initObject(e),e.proto=this.OBJECT_PROTO,this.setProperty(e,"constructor",this.OBJECT),this.initArray(e),this.initString(e),this.initBoolean(e),this.initNumber(e),this.initDate(e),this.initRegExp(e),this.initError(e),this.initMath(e),this.initJSON(e);var r=this,n=this.createNativeFunction((function(t){throw EvalError("Can't happen")}),!1);n.eval=!0,this.setProperty(e,"eval",n),this.setProperty(e,"parseInt",this.createNativeFunction(parseInt,!1)),this.setProperty(e,"parseFloat",this.createNativeFunction(parseFloat,!1)),this.setProperty(e,"isNaN",this.createNativeFunction(isNaN,!1)),this.setProperty(e,"isFinite",this.createNativeFunction(isFinite,!1));for(var i=[[escape,"escape"],[unescape,"unescape"],[decodeURI,"decodeURI"],[decodeURIComponent,"decodeURIComponent"],[encodeURI,"encodeURI"],[encodeURIComponent,"encodeURIComponent"]],o=0;o<i.length;o++){var a=function(t){return function(e){try{return t(e)}catch(t){r.throwException(r.URI_ERROR,t.message)}}}(i[o][0]);this.setProperty(e,i[o][1],this.createNativeFunction(a,!1),t.NONENUMERABLE_DESCRIPTOR)}this.initFunc_&&this.initFunc_(this,e)},t.prototype.initFunction=function(e){var r,n=this,i=/^[A-Za-z_$][\w$]*$/;(r=function(e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.FUNCTION_PROTO);if(arguments.length)var o=String(arguments[arguments.length-1]);else o="";for(var a=[],s=0;s<arguments.length-1;s++){var l=String(arguments[s]);l.match(i)||n.throwException(n.SYNTAX_ERROR,"Invalid function argument: "+l),a.push(l)}a=a.join(", "),r.parentScope=n.global;try{var c=wi("$ = function("+a+") {"+o+"};",t.PARSE_OPTIONS)}catch(t){n.throwException(n.SYNTAX_ERROR,"Invalid code: "+t.message)}return 1!==c.body.length&&n.throwException(n.SYNTAX_ERROR,"Invalid code in function body."),r.node=c.body[0].expression.right,n.setProperty(r,"length",r.node.length,t.READONLY_DESCRIPTOR),r}).id=this.functionCounter_++,this.FUNCTION=this.createObjectProto(this.FUNCTION_PROTO),this.setProperty(e,"Function",this.FUNCTION),this.setProperty(this.FUNCTION,"prototype",this.FUNCTION_PROTO),this.FUNCTION.nativeFunc=r,this.setProperty(this.FUNCTION_PROTO,"constructor",this.FUNCTION,t.NONENUMERABLE_DESCRIPTOR),this.FUNCTION_PROTO.nativeFunc=function(){},this.FUNCTION_PROTO.nativeFunc.id=this.functionCounter_++,this.setProperty(this.FUNCTION_PROTO,"length",0,t.READONLY_DESCRIPTOR);var o=function(t){if(!(t&&t.isObject||n.getScope().strict))if(null==t)t=n.global;else{var e=n.createObjectProto(n.getPrototype(t));e.data=t,t=e}return t};r=function(t,e){var r=n.stateStack[n.stateStack.length-1];r.func_=this,r.funcThis_=o(t),r.arguments_=[],null!=e&&(e.isObject?r.arguments_=n.pseudoToNative(e):n.throwException(n.TYPE_ERROR,"CreateListFromArrayLike called on non-object")),r.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"apply",r),r=function(t,e){var r=n.stateStack[n.stateStack.length-1];r.func_=this,r.funcThis_=o(t),r.arguments_=[];for(var i=1;i<arguments.length;i++)r.arguments_.push(arguments[i]);r.doneExec_=!1},this.setNativeFunctionPrototype(this.FUNCTION,"call",r),this.polyfills_.push("Object.defineProperty(Function.prototype, 'bind',","{configurable: true, writable: true, value:","function(oThis) {","if (typeof this !== 'function') {","throw TypeError('What is trying to be bound is not callable');","}","var aArgs   = Array.prototype.slice.call(arguments, 1),","fToBind = this,","fNOP    = function() {},","fBound  = function() {","return fToBind.apply(this instanceof fNOP","? this",": oThis,","aArgs.concat(Array.prototype.slice.call(arguments)));","};","if (this.prototype) {","fNOP.prototype = this.prototype;","}","fBound.prototype = new fNOP();","return fBound;","}","});",""),r=function(){return this.toString()},this.setNativeFunctionPrototype(this.FUNCTION,"toString",r),this.setProperty(this.FUNCTION,"toString",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(){return this.valueOf()},this.setNativeFunctionPrototype(this.FUNCTION,"valueOf",r),this.setProperty(this.FUNCTION,"valueOf",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.initObject=function(e){var r,n=this;r=function(t){if(null==t)return n.calledWithNew()?this:n.createObjectProto(n.OBJECT_PROTO);if(!t.isObject){var e=n.createObjectProto(n.getPrototype(t));return e.data=t,e}return t},this.OBJECT=this.createNativeFunction(r,!0),this.setProperty(this.OBJECT,"prototype",this.OBJECT_PROTO),this.setProperty(this.OBJECT_PROTO,"constructor",this.OBJECT),this.setProperty(e,"Object",this.OBJECT);var i=function(t){null==t&&n.throwException(n.TYPE_ERROR,"Cannot convert '"+t+"' to object")};r=function(t){i(t);var e=t.isObject?t.properties:t;return n.nativeToPseudo(Object.getOwnPropertyNames(e))},this.setProperty(this.OBJECT,"getOwnPropertyNames",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return i(t),t.isObject?n.nativeToPseudo(Object.keys(t.properties)):n.nativeToPseudo(Object.keys(t))},this.setProperty(this.OBJECT,"keys",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return null===t?n.createObjectProto(null):(void 0!==t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object prototype may only be an Object or null"),n.createObjectProto(t))},this.setProperty(this.OBJECT,"create",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var create_ = Object.create;","Object.create = function(proto, props) {","var obj = create_(proto);","props && Object.defineProperties(obj, props);","return obj;","};","})();",""),r=function(t,e,r){return e=String(e),t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object.defineProperty called on non-object"),r&&r.isObject||n.throwException(n.TYPE_ERROR,"Property description must be an object"),!t.properties[e]&&t.preventExtensions&&n.throwException(n.TYPE_ERROR,"Can't define property '"+e+"', object is not extensible"),n.setProperty(t,e,ReferenceError,r.properties),t},this.setProperty(this.OBJECT,"defineProperty",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.polyfills_.push("(function() {","var defineProperty_ = Object.defineProperty;","Object.defineProperty = function(obj, prop, d1) {","var d2 = {};","if ('configurable' in d1) d2.configurable = d1.configurable;","if ('enumerable' in d1) d2.enumerable = d1.enumerable;","if ('writable' in d1) d2.writable = d1.writable;","if ('value' in d1) d2.value = d1.value;","if ('get' in d1) d2.get = d1.get;","if ('set' in d1) d2.set = d1.set;","return defineProperty_(obj, prop, d2);","};","})();","Object.defineProperty(Object, 'defineProperties',","{configurable: true, writable: true, value:","function(obj, props) {","var keys = Object.keys(props);","for (var i = 0; i < keys.length; i++) {","Object.defineProperty(obj, keys[i], props[keys[i]]);","}","return obj;","}","});",""),r=function(t,e){if(t&&t.isObject||n.throwException(n.TYPE_ERROR,"Object.getOwnPropertyDescriptor called on non-object"),(e=String(e))in t.properties){var r=Object.getOwnPropertyDescriptor(t.properties,e),i=t.getter[e],o=t.setter[e];(i||o)&&(r.get=i,r.set=o,delete r.value,delete r.writable);var a=n.nativeToPseudo(r);return"value"in r&&n.setProperty(a,"value",r.value),a}},this.setProperty(this.OBJECT,"getOwnPropertyDescriptor",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return i(t),n.getPrototype(t)},this.setProperty(this.OBJECT,"getPrototypeOf",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return Boolean(t)&&!t.preventExtensions},this.setProperty(this.OBJECT,"isExtensible",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(t){return t&&t.isObject&&(t.preventExtensions=!0),t},this.setProperty(this.OBJECT,"preventExtensions",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),this.setNativeFunctionPrototype(this.OBJECT,"toString",Ua.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"toLocaleString",Ua.prototype.toString),this.setNativeFunctionPrototype(this.OBJECT,"valueOf",Ua.prototype.valueOf),r=function(t){return i(this),this.isObject?String(t)in this.properties:this.hasOwnProperty(t)},this.setNativeFunctionPrototype(this.OBJECT,"hasOwnProperty",r),r=function(t){return i(this),Object.prototype.propertyIsEnumerable.call(this.properties,t)},this.setNativeFunctionPrototype(this.OBJECT,"propertyIsEnumerable",r),r=function(t){for(;;){if(!(t=n.getPrototype(t)))return!1;if(t===this)return!0}},this.setNativeFunctionPrototype(this.OBJECT,"isPrototypeOf",r)},t.prototype.initArray=function(e){var r,n=this;r=function(e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.ARRAY_PROTO);var i=arguments[0];if(1===arguments.length&&"number"==typeof i)isNaN(t.legalArrayLength(i))&&n.throwException(n.RANGE_ERROR,"Invalid array length"),r.properties.length=i;else{for(var o=0;o<arguments.length;o++)r.properties[o]=arguments[o];r.properties.length=o}return r},this.ARRAY=this.createNativeFunction(r,!0),this.ARRAY_PROTO=this.ARRAY.properties.prototype,this.setProperty(e,"Array",this.ARRAY),r=function(t){return t&&"Array"===t.class},this.setProperty(this.ARRAY,"isArray",this.createNativeFunction(r,!1),t.NONENUMERABLE_DESCRIPTOR),r=function(){return Array.prototype.pop.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"pop",r),r=function(t){return Array.prototype.push.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"push",r),r=function(){return Array.prototype.shift.call(this.properties)},this.setNativeFunctionPrototype(this.ARRAY,"shift",r),r=function(t){return Array.prototype.unshift.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"unshift",r),r=function(){return Array.prototype.reverse.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"reverse",r),r=function(t,e){var r=Array.prototype.splice.apply(this.properties,arguments);return n.unwrap&&(r=r.map(n.unwrap)),n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.ARRAY,"splice",r),r=function(t,e){var r=Array.prototype.slice.call(this.properties,t,e);return n.unwrap&&(r=r.map(n.unwrap)),n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.ARRAY,"slice",r),r=function(t){return Array.prototype.join.call(this.properties,t)},this.setNativeFunctionPrototype(this.ARRAY,"join",r),r=function(t){for(var e=[],r=0,i=n.getProperty(this,"length"),o=0;o<i;o++){if(n.hasProperty(this,o)){var a=n.getProperty(this,o);e[r]=a}r++}for(o=0;o<arguments.length;o++){var s=arguments[o];if(n.isa(s,n.ARRAY))for(var l=n.getProperty(s,"length"),c=0;c<l;c++)n.hasProperty(s,c)&&(e[r]=n.getProperty(s,c)),r++;else e[r]=s}return n.unwrap&&(e=e.map(n.unwrap)),n.nativeToPseudo(e)},this.setNativeFunctionPrototype(this.ARRAY,"concat",r),r=function(t,e){return Array.prototype.indexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"indexOf",r),r=function(t,e){return Array.prototype.lastIndexOf.apply(this.properties,arguments)},this.setNativeFunctionPrototype(this.ARRAY,"lastIndexOf",r),r=function(){return Array.prototype.sort.call(this.properties),this},this.setNativeFunctionPrototype(this.ARRAY,"sort",r),this.polyfills_.push("Object.defineProperty(Array.prototype, 'every',","{configurable: true, writable: true, value:","function(callbackfn, thisArg) {","if (!this || typeof callbackfn !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O && !callbackfn.call(T, O[k], k, O)) return false;","k++;","}","return true;","}","});","Object.defineProperty(Array.prototype, 'filter',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (this === void 0 || this === null || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var res = [];","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t) {","var val = t[i];","if (fun.call(thisArg, val, i, t)) res.push(val);","}","}","return res;","}","});","Object.defineProperty(Array.prototype, 'forEach',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') throw TypeError();","var T, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","k = 0;","while (k < len) {","if (k in O) callback.call(T, O[k], k, O);","k++;","}","}","});","Object.defineProperty(Array.prototype, 'map',","{configurable: true, writable: true, value:","function(callback, thisArg) {","if (!this || typeof callback !== 'function') new TypeError;","var T, A, k;","var O = Object(this);","var len = O.length >>> 0;","if (arguments.length > 1) T = thisArg;","A = new Array(len);","k = 0;","while (k < len) {","if (k in O) A[k] = callback.call(T, O[k], k, O);","k++;","}","return A;","}","});","Object.defineProperty(Array.prototype, 'reduce',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (!this || typeof callback !== 'function') throw TypeError();","var t = Object(this), len = t.length >>> 0, k = 0, value;","if (arguments.length === 2) {","value = arguments[1];","} else {","while (k < len && !(k in t)) k++;","if (k >= len) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k++];","}","for (; k < len; k++) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'reduceRight',","{configurable: true, writable: true, value:","function(callback /*, initialValue*/) {","if (null === this || 'undefined' === typeof this || 'function' !== typeof callback) throw TypeError();","var t = Object(this), len = t.length >>> 0, k = len - 1, value;","if (arguments.length >= 2) {","value = arguments[1];","} else {","while (k >= 0 && !(k in t)) k--;","if (k < 0) {","throw TypeError('Reduce of empty array with no initial value');","}","value = t[k--];","}","for (; k >= 0; k--) {","if (k in t) value = callback(value, t[k], k, t);","}","return value;","}","});","Object.defineProperty(Array.prototype, 'some',","{configurable: true, writable: true, value:","function(fun/*, thisArg*/) {","if (!this || typeof fun !== 'function') throw TypeError();","var t = Object(this);","var len = t.length >>> 0;","var thisArg = arguments.length >= 2 ? arguments[1] : void 0;","for (var i = 0; i < len; i++) {","if (i in t && fun.call(thisArg, t[i], i, t)) {","return true;","}","}","return false;","}","});","(function() {","var sort_ = Array.prototype.sort;","Array.prototype.sort = function(opt_comp) {","if (typeof opt_comp !== 'function') {","return sort_.call(this);","}","for (var i = 0; i < this.length; i++) {","var changes = 0;","for (var j = 0; j < this.length - i - 1; j++) {","if (opt_comp(this[j], this[j + 1]) > 0) {","var swap = this[j];","this[j] = this[j + 1];","this[j + 1] = swap;","changes++;","}","}","if (!changes) break;","}","return this;","};","})();","Object.defineProperty(Array.prototype, 'toLocaleString',","{configurable: true, writable: true, value:","function() {","var out = [];","for (var i = 0; i < this.length; i++) {","out[i] = (this[i] === null || this[i] === undefined) ? '' : this[i].toLocaleString();","}","return out.join(',');","}","});","")},t.prototype.initString=function(e){var r,n=this;r=function(t){return t=String(t),n.calledWithNew()?(this.data=t,this):t},this.STRING=this.createNativeFunction(r,!0),this.setProperty(e,"String",this.STRING),this.setProperty(this.STRING,"fromCharCode",this.createNativeFunction(String.fromCharCode,!1),t.NONENUMERABLE_DESCRIPTOR);for(var i=["trim","toLowerCase","toUpperCase","toLocaleLowerCase","toLocaleUpperCase","charAt","charCodeAt","substring","slice","substr","indexOf","lastIndexOf","concat"],o=0;o<i.length;o++)this.setNativeFunctionPrototype(this.STRING,i[o],String.prototype[i[o]]);r=function(t,e,r){return e=e?n.pseudoToNative(e):void 0,r=r?n.pseudoToNative(r):void 0,String(this).localeCompare(t,e,r)},this.setNativeFunctionPrototype(this.STRING,"localeCompare",r),r=function(t,e){n.isa(t,n.REGEXP)&&(t=t.data);var r=String(this).split(t,e);return n.nativeToPseudo(r)},this.setNativeFunctionPrototype(this.STRING,"split",r),r=function(t){t=t?t.data:void 0;var e=String(this).match(t);return e?n.nativeToPseudo(e):null},this.setNativeFunctionPrototype(this.STRING,"match",r),r=function(t){return n.isa(t,n.REGEXP)&&(t=t.data),String(this).search(t)},this.setNativeFunctionPrototype(this.STRING,"search",r),r=function(t,e){return String(this).replace(t.data||t,e)},this.setNativeFunctionPrototype(this.STRING,"replace",r),this.polyfills_.push("(function() {","var replace_ = String.prototype.replace;","String.prototype.replace = function(substr, newSubstr) {","if (typeof newSubstr !== 'function') {","return replace_.call(this, substr, newSubstr);","}","var str = this;","if (substr instanceof RegExp) {","var subs = [];","var m = substr.exec(str);","while (m) {","m.push(m.index, str);","var inject = newSubstr.apply(null, m);","subs.push([m.index, m[0].length, inject]);","m = substr.global ? substr.exec(str) : null;","}","for (var i = subs.length - 1; i >= 0; i--) {","str = str.substring(0, subs[i][0]) + subs[i][2] + str.substring(subs[i][0] + subs[i][1]);","}","} else {","var i = str.indexOf(substr);","if (i !== -1) {","var inject = newSubstr(str.substr(i, substr.length), i, str);","str = str.substring(0, i) + inject + str.substring(i + substr.length);","}","}","return str;","};","})();","")},t.prototype.initBoolean=function(t){var e,r=this;e=function(t){return t=Boolean(t),r.calledWithNew()?(this.data=t,this):t},this.BOOLEAN=this.createNativeFunction(e,!0),this.setProperty(t,"Boolean",this.BOOLEAN)},t.prototype.initNumber=function(e){var r,n=this;r=function(t){return t=Number(t),n.calledWithNew()?(this.data=t,this):t},this.NUMBER=this.createNativeFunction(r,!0),this.setProperty(e,"Number",this.NUMBER);for(var i=["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"],o=0;o<i.length;o++)this.setProperty(this.NUMBER,i[o],Number[i[o]],t.READONLY_NONENUMERABLE_DESCRIPTOR);r=function(t){try{return Number(this).toExponential(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toExponential",r),r=function(t){try{return Number(this).toFixed(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toFixed",r),r=function(t){try{return Number(this).toPrecision(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toPrecision",r),r=function(t){try{return Number(this).toString(t)}catch(t){n.throwException(n.ERROR,t.message)}},this.setNativeFunctionPrototype(this.NUMBER,"toString",r),r=function(t,e){return t=t?n.pseudoToNative(t):void 0,e=e?n.pseudoToNative(e):void 0,Number(this).toLocaleString(t,e)},this.setNativeFunctionPrototype(this.NUMBER,"toLocaleString",r)},t.prototype.initDate=function(e){var r,n=this;r=function(t,e){if(!n.calledWithNew())return Date();var r=[null].concat([].slice.call(arguments));return this.data=new(Function.prototype.bind.apply(Date,r)),this},this.DATE=this.createNativeFunction(r,!0),this.setProperty(e,"Date",this.DATE),this.setProperty(this.DATE,"now",this.createNativeFunction(Date.now,!1),t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"parse",this.createNativeFunction(Date.parse,!1),t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.DATE,"UTC",this.createNativeFunction(Date.UTC,!1),t.NONENUMERABLE_DESCRIPTOR);for(var i=["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toISOString","toJSON","toGMTString","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString"],o=0;o<i.length;o++)r=function(t){return function(e){for(var r=[],i=0;i<arguments.length;i++)r[i]=n.pseudoToNative(arguments[i]);return this.data[t].apply(this.data,r)}}(i[o]),this.setNativeFunctionPrototype(this.DATE,i[o],r)},t.prototype.initRegExp=function(e){var r,n=this;r=function(t,e){if(n.calledWithNew())var r=this;else r=n.createObjectProto(n.REGEXP_PROTO);return t=t?t.toString():"",e=e?e.toString():"",n.populateRegExp(r,new RegExp(t,e)),r},this.REGEXP=this.createNativeFunction(r,!0),this.REGEXP_PROTO=this.REGEXP.properties.prototype,this.setProperty(e,"RegExp",this.REGEXP),this.setProperty(this.REGEXP.properties.prototype,"global",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"ignoreCase",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"multiline",void 0,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(this.REGEXP.properties.prototype,"source","(?:)",t.READONLY_NONENUMERABLE_DESCRIPTOR),r=function(t){return this.data.test(t)},this.setNativeFunctionPrototype(this.REGEXP,"test",r),r=function(t){t=t.toString(),this.data.lastIndex=Number(n.getProperty(this,"lastIndex"));var e=this.data.exec(t);if(n.setProperty(this,"lastIndex",this.data.lastIndex),e){for(var r=n.createObjectProto(n.ARRAY_PROTO),i=0;i<e.length;i++)n.setProperty(r,i,e[i]);return n.setProperty(r,"index",e.index),n.setProperty(r,"input",e.input),r}return null},this.setNativeFunctionPrototype(this.REGEXP,"exec",r)},t.prototype.initError=function(e){var r=this;this.ERROR=this.createNativeFunction((function(e){if(r.calledWithNew())var n=this;else n=r.createObject(r.ERROR);return e&&r.setProperty(n,"message",String(e),t.NONENUMERABLE_DESCRIPTOR),n}),!0),this.setProperty(e,"Error",this.ERROR),this.setProperty(this.ERROR.properties.prototype,"message","",t.NONENUMERABLE_DESCRIPTOR),this.setProperty(this.ERROR.properties.prototype,"name","Error",t.NONENUMERABLE_DESCRIPTOR);var n=function(n){var i=r.createNativeFunction((function(e){if(r.calledWithNew())var n=this;else n=r.createObject(i);return e&&r.setProperty(n,"message",String(e),t.NONENUMERABLE_DESCRIPTOR),n}),!0);return r.setProperty(i,"prototype",r.createObject(r.ERROR)),r.setProperty(i.properties.prototype,"name",n,t.NONENUMERABLE_DESCRIPTOR),r.setProperty(e,n,i),i};this.EVAL_ERROR=n("EvalError"),this.RANGE_ERROR=n("RangeError"),this.REFERENCE_ERROR=n("ReferenceError"),this.SYNTAX_ERROR=n("SyntaxError"),this.TYPE_ERROR=n("TypeError"),this.URI_ERROR=n("URIError")},t.prototype.initMath=function(e){var r=this.createObjectProto(this.OBJECT_PROTO);this.setProperty(e,"Math",r);for(var n=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"],i=0;i<n.length;i++)this.setProperty(r,n[i],Math[n[i]],t.READONLY_NONENUMERABLE_DESCRIPTOR);var o=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"];for(i=0;i<o.length;i++)this.setProperty(r,o[i],this.createNativeFunction(Math[o[i]],!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.initJSON=function(t){var e=this,r=e.createObjectProto(this.OBJECT_PROTO);this.setProperty(t,"JSON",r);var n=function(t){try{var r=JSON.parse(t.toString())}catch(t){e.throwException(e.SYNTAX_ERROR,t.message)}return e.nativeToPseudo(r)};this.setProperty(r,"parse",this.createNativeFunction(n,!1)),n=function(t){var r=e.pseudoToNative(t);try{var n=JSON.stringify(r)}catch(t){e.throwException(e.TYPE_ERROR,t.message)}return n},this.setProperty(r,"stringify",this.createNativeFunction(n,!1))},t.prototype.isa=function(t,e){if(null==t||!e)return!1;var r=e.properties.prototype;if(t===r)return!0;for(var n=this.getPrototype(t);n;){if(n===r)return!0;n=n.proto}return!1},t.legalArrayLength=function(t){var e=t>>>0;return e===Number(t)?e:NaN},t.legalArrayIndex=function(t){var e=t>>>0;return String(e)===String(t)&&4294967295!==e?e:NaN},t.prototype.createObject=function(t){return this.createObjectProto(t&&t.properties.prototype)},t.prototype.createObjectProto=function(t){var e=new Ua(t);return this.isa(e,this.FUNCTION)&&(this.setProperty(e,"prototype",this.createObjectProto(this.OBJECT_PROTO||null)),e.class="Function"),this.isa(e,this.ARRAY)&&(this.setProperty(e,"length",0,{configurable:!1,enumerable:!1,writable:!0}),e.class="Array"),this.isa(e,this.ERROR)&&(e.class="Error"),e},t.prototype.populateRegExp=function(e,r){e.data=r,this.setProperty(e,"lastIndex",r.lastIndex,t.NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"source",r.source,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"global",r.global,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"ignoreCase",r.ignoreCase,t.READONLY_NONENUMERABLE_DESCRIPTOR),this.setProperty(e,"multiline",r.multiline,t.READONLY_NONENUMERABLE_DESCRIPTOR)},t.prototype.createFunction=function(e,r){var n=this.createObjectProto(this.FUNCTION_PROTO);return n.parentScope=r,n.node=e,this.setProperty(n,"length",n.node.params.length,t.READONLY_DESCRIPTOR),n},t.prototype.createNativeFunction=function(e,r){var n=this.createObjectProto(this.FUNCTION_PROTO);return n.nativeFunc=e,e.id=this.functionCounter_++,this.setProperty(n,"length",e.length,t.READONLY_DESCRIPTOR),r?this.setProperty(n.properties.prototype,"constructor",n,t.NONENUMERABLE_DESCRIPTOR):!1===r&&(n.illegalConstructor=!0,this.setProperty(n,"prototype",void 0)),n},t.prototype.createAsyncFunction=function(e){var r=this.createObjectProto(this.FUNCTION_PROTO);return r.asyncFunc=e,e.id=this.functionCounter_++,this.setProperty(r,"length",e.length,t.READONLY_DESCRIPTOR),r},t.prototype.nativeToPseudo=function(t){if("boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t)return t;if(t instanceof RegExp){var e=this.createObjectProto(this.REGEXP_PROTO);return this.populateRegExp(e,t),e}if(t instanceof Function){var r=this;return this.createNativeFunction((function(){return r.nativeToPseudo(t.apply(r,Array.prototype.slice.call(arguments).map((function(t){return r.pseudoToNative(t)}))))}),void 0)}var n;if(Array.isArray(t)){n=this.createObjectProto(this.ARRAY_PROTO);for(var i=0;i<t.length;i++)i in t&&this.setProperty(n,i,this.wrap?this.wrap(t[i]):this.nativeToPseudo(t[i]))}else for(var o in n=this.createObjectProto(this.OBJECT_PROTO),t)this.setProperty(n,o,this.wrap?this.wrap(t[i]):this.nativeToPseudo(t[i]));return n},t.prototype.pseudoToNative=function(t,e){if("boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t)return t;if(this.isa(t,this.REGEXP))return t.data;var r,n=e||{pseudo:[],native:[]};if(-1!==(o=n.pseudo.indexOf(t)))return n.native[o];if(n.pseudo.push(t),this.isa(t,this.ARRAY)){r=[],n.native.push(r);for(var i=this.getProperty(t,"length"),o=0;o<i;o++)this.hasProperty(t,o)&&(r[o]=this.unwrap?this.unwrap(this.getProperty(t,o),n):this.pseudoToNative(this.getProperty(t,o),n))}else{if(t._native)return t._native;var a;for(var s in r={},n.native.push(r),t.properties)a=t.properties[s],r[s]=this.unwrap?this.unwrap(a,n):this.pseudoToNative(a,n)}return n.pseudo.pop(),n.native.pop(),r},t.prototype.getPrototype=function(t){switch(typeof t){case"number":return this.NUMBER.properties.prototype;case"boolean":return this.BOOLEAN.properties.prototype;case"string":return this.STRING.properties.prototype}return t?t.proto:null},t.prototype.getProperty=function(e,r){if(r=String(r),null==e&&this.throwException(this.TYPE_ERROR,"Cannot read property '"+r+"' of "+e),"length"===r){if(this.isa(e,this.STRING))return String(e).length}else if(r.charCodeAt(0)<64&&this.isa(e,this.STRING)){var n=t.legalArrayIndex(r);if(!isNaN(n)&&n<String(e).length)return String(e)[n]}do{var i=e;if(i.properties&&r in i.properties){var o=i.getter[r];return o?(o.isGetter=!0,o):i.properties[r]}if(void 0!==i._native&&"_"!==r.charAt(0)&&"function"!=typeof i._native[r])return this.wrap?this.wrap(i._native[r]):i._native[r]}while(e=this.getPrototype(e))},t.prototype.hasProperty=function(e,r){if(!e.isObject)throw TypeError("Primitive data type has no properties");if("length"===(r=String(r))&&this.isa(e,this.STRING))return!0;if(this.isa(e,this.STRING)){var n=t.legalArrayIndex(r);if(!isNaN(n)&&n<String(e).length)return!0}do{var i=e;if(i.properties&&r in i.properties)return!0;if(void 0!==i._native&&"_"!=r.charAt(0)){var o=typeof i._native[r];return"function"!==o&&("undefined"!==o||ja(i._native.constructor,r))}}while(e=this.getPrototype(e));return!1},t.prototype.setProperty=function(e,r,n,i){r=String(r),null==e&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of "+e),i&&("get"in i||"set"in i)&&("value"in i||"writable"in i)&&this.throwException(this.TYPE_ERROR,"Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");var o=!this.stateStack||this.getScope().strict;if(e.isObject){if(this.isa(e,this.STRING)){var a=t.legalArrayIndex(r);if("length"===r||!isNaN(a)&&a<String(e).length)return void(o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of String '"+e.data+"'"))}if("Array"===e.class){var s,l=e.properties.length;if("length"===r){if(n=t.legalArrayLength(n),isNaN(n)&&this.throwException(this.RANGE_ERROR,"Invalid array length"),n<l)for(s in e.properties)s=t.legalArrayIndex(s),!isNaN(s)&&n<=s&&delete e.properties[s]}else isNaN(s=t.legalArrayIndex(r))||(e.properties.length=Math.max(l,s+1))}if(!e.preventExtensions||r in e.properties)if(i){"get"in i&&(i.get?e.getter[r]=i.get:delete e.getter[r]),"set"in i&&(i.set?e.setter[r]=i.set:delete e.setter[r]);var c={};"configurable"in i&&(c.configurable=i.configurable),"enumerable"in i&&(c.enumerable=i.enumerable),"writable"in i&&(c.writable=i.writable,delete e.getter[r],delete e.setter[r]),"value"in i?(c.value=i.value,delete e.getter[r],delete e.setter[r]):n!==ReferenceError&&(c.value=n,delete e.getter[r],delete e.setter[r]);try{Object.defineProperty(e.properties,r,c)}catch(t){this.throwException(this.TYPE_ERROR,"Cannot redefine property: "+r)}}else{if(n===ReferenceError)throw ReferenceError("Value not specified.");if(void 0!==e._native&&"_"!=r.charAt(0)){var u=typeof e._native[r];if("function"!==u&&("undefined"!==u||ja(e._native.constructor,r))){var h=this.unwrap?this.unwrap(n):n;return void(e._native[r]=h)}}for(var p=e;!(r in p.properties);)if(!(p=this.getPrototype(p))){p=e;break}if(p.setter&&p.setter[r])return p.setter[r];if(p.getter&&p.getter[r])o&&this.throwException(this.TYPE_ERROR,"Cannot set property '"+r+"' of object '"+e+"' which only has a getter");else try{e.properties[r]=n}catch(t){o&&this.throwException(this.TYPE_ERROR,"Cannot assign to read only property '"+r+"' of object '"+e+"'")}}else o&&this.throwException(this.TYPE_ERROR,"Can't add property '"+r+"', object is not extensible")}else o&&this.throwException(this.TYPE_ERROR,"Can't create property '"+r+"' on '"+e+"'")},t.prototype.setNativeFunctionPrototype=function(e,r,n){this.setProperty(e.properties.prototype,r,this.createNativeFunction(n,!1),t.NONENUMERABLE_DESCRIPTOR)},t.prototype.getScope=function(){var t=this.stateStack[this.stateStack.length-1].scope;if(!t)throw Error("No scope found.");return t},t.prototype.createScope=function(t,e){var r=this.createObjectProto(null);if(r.parentScope=e,e||this.initGlobalScope(r),this.populateScope_(t,r),r.strict=!1,e&&e.strict)r.strict=!0;else{var n=t.body&&t.body[0];n&&n.expression&&"Literal"===n.expression.type&&"use strict"===n.expression.value&&(r.strict=!0)}return r},t.prototype.createSpecialScope=function(t,e){if(!t)throw Error("parentScope required");var r=e||this.createObjectProto(null);return r.parentScope=t,r.strict=t.strict,r},t.prototype.getValueFromScope=function(t){for(var e=this.getScope();e&&e!==this.global;){if(t in e.properties)return e.properties[t];e=e.parentScope}if(e===this.global&&this.hasProperty(e,t))return this.getProperty(e,t);var r=this.stateStack[this.stateStack.length-1].node;"UnaryExpression"===r.type&&"typeof"===r.operator||this.throwException(this.REFERENCE_ERROR,t+" is not defined")},t.prototype.setValueToScope=function(t,e){for(var r=this.getScope(),n=r.strict;r&&r!==this.global;){if(t in r.properties)return void(r.properties[t]=e);r=r.parentScope}if(r===this.global&&(!n||this.hasProperty(r,t)))return this.setProperty(r,t,e);this.throwException(this.REFERENCE_ERROR,t+" is not defined")},t.prototype.populateScope_=function(e,r){if("VariableDeclaration"===e.type)for(var n=0;n<e.declarations.length;n++)this.setProperty(r,e.declarations[n].id.name,void 0,t.VARIABLE_DESCRIPTOR);else{if("FunctionDeclaration"===e.type)return void this.setProperty(r,e.id.name,this.createFunction(e,r),t.VARIABLE_DESCRIPTOR);if("FunctionExpression"===e.type)return;if("ExpressionStatement"===e.type)return}var i=e.constructor;for(var o in e){var a=e[o];if(a&&"object"==typeof a)if(Array.isArray(a))for(n=0;n<a.length;n++)a[n]&&a[n].constructor===i&&this.populateScope_(a[n],r);else a.constructor===i&&this.populateScope_(a,r)}},t.prototype.stripLocations_=function(t,e,r){for(var n in e?t.start=e:delete t.start,r?t.end=r:delete t.end,t)if(t.hasOwnProperty(n)){var i=t[n];i&&"object"==typeof i&&this.stripLocations_(i,e,r)}},t.prototype.calledWithNew=function(){return this.stateStack[this.stateStack.length-1].isConstructor},t.prototype.getValue=function(e){return e[0]===t.SCOPE_REFERENCE?this.getValueFromScope(e[1]):this.getProperty(e[0],e[1])},t.prototype.setValue=function(e,r){return e[0]===t.SCOPE_REFERENCE?this.setValueToScope(e[1],r):this.setProperty(e[0],e[1],r)},t.prototype.throwException=function(e,r){if(void 0===r)var n=e;else n=this.createObject(e),this.setProperty(n,"message",r,t.NONENUMERABLE_DESCRIPTOR);throw this.executeException(n),t.STEP_ERROR},t.prototype.executeException=function(t){var e,r=this.stateStack.slice();do{this.stateStack.pop();var n=this.stateStack[this.stateStack.length-1];if("TryStatement"===n.node.type)return void(n.throwValue=t)}while(n&&"Program"!==n.node.type);if(this.isa(t,this.ERROR)){var i={EvalError:EvalError,RangeError:RangeError,ReferenceError:ReferenceError,SyntaxError:SyntaxError,TypeError:TypeError,URIError:URIError},o=this.getProperty(t,"name").toString(),a=this.getProperty(t,"message").valueOf();e=(i[o]||Error)(a)}else e=t.toString();throw this.stateStack=r,e},t.prototype.createGetter_=function(t,e){var r=Array.isArray(e)?e[0]:e,n=new this.nodeConstructor;n.type="CallExpression";var i=new Fa(n,this.stateStack[this.stateStack.length-1].scope);return i.doneCallee_=!0,i.funcThis_=r,i.func_=t,i.doneArgs_=!0,i.arguments_=[],i},t.prototype.createSetter_=function(t,e,r){var n=Array.isArray(e)?e[0]:this.global,i=new this.nodeConstructor;i.type="CallExpression";var o=new Fa(i,this.stateStack[this.stateStack.length-1].scope);return o.doneCallee_=!0,o.funcThis_=n,o.func_=t,o.doneArgs_=!0,o.arguments_=[r],o},t.prototype.stepArrayExpression=function(t,e,r){var n=r.elements,i=e.n_||0;for(e.array_?(this.setProperty(e.array_,i,e.value),i++):(e.array_=this.createObjectProto(this.ARRAY_PROTO),e.array_.properties.length=n.length);i<n.length;){if(n[i])return e.n_=i,new Fa(n[i],e.scope);i++}t.pop(),t[t.length-1].value=e.array_},t.prototype.stepAssignmentExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n=new Fa(r.left,e.scope);return n.components=!0,n}if(!e.doneRight_){if(e.leftReference_||(e.leftReference_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_&&"="!==r.operator){var i=this.getValue(e.leftReference_);if(e.leftValue_=i,i&&"object"==typeof i&&i.isGetter){i.isGetter=!1,e.doneGetter_=!0;var o=i;return this.createGetter_(o,e.leftReference_)}}return e.doneRight_=!0,new Fa(r.right,e.scope)}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.doneSetter_);var a=e.leftValue_,s=e.value;switch(r.operator){case"=":a=s;break;case"+=":a+=s;break;case"-=":a-=s;break;case"*=":a*=s;break;case"/=":a/=s;break;case"%=":a%=s;break;case"<<=":a<<=s;break;case">>=":a>>=s;break;case">>>=":a>>>=s;break;case"&=":a&=s;break;case"^=":a^=s;break;case"|=":a|=s;break;default:throw SyntaxError("Unknown assignment expression: "+r.operator)}var l=this.setValue(e.leftReference_,a);if(l)return e.doneSetter_=a,this.createSetter_(l,e.leftReference_,a);t.pop(),t[t.length-1].value=a},t.prototype.stepBinaryExpression=function(t,e,r){if(!e.doneLeft_)return e.doneLeft_=!0,new Fa(r.left,e.scope);if(!e.doneRight_)return e.doneRight_=!0,e.leftValue_=e.value,new Fa(r.right,e.scope);t.pop();var n,i=e.leftValue_,o=e.value;switch(r.operator){case"==":n=i==o;break;case"!=":n=i!=o;break;case"===":n=i===o;break;case"!==":n=i!==o;break;case">":n=i>o;break;case">=":n=i>=o;break;case"<":n=i<o;break;case"<=":n=i<=o;break;case"+":n=i+o;break;case"-":n=i-o;break;case"*":n=i*o;break;case"/":n=i/o;break;case"%":n=i%o;break;case"&":n=i&o;break;case"|":n=i|o;break;case"^":n=i^o;break;case"<<":n=i<<o;break;case">>":n=i>>o;break;case">>>":n=i>>>o;break;case"in":o&&o.isObject||this.throwException(this.TYPE_ERROR,"'in' expects an object, not '"+o+"'"),n=this.hasProperty(o,i);break;case"instanceof":this.isa(o,this.FUNCTION)||this.throwException(this.TYPE_ERROR,"Right-hand side of instanceof is not an object"),n=!!i.isObject&&this.isa(i,o);break;default:throw SyntaxError("Unknown binary operator: "+r.operator)}t[t.length-1].value=n},t.prototype.stepBlockStatement=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.n_=n+1,new Fa(i,e.scope);t.pop()},t.prototype.stepBreakStatement=function(t,e,r){t.pop();var n=null;for(r.label&&(n=r.label.name);e&&"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if(n){if(e.labels&&-1!==e.labels.indexOf(n))return}else if(e.isLoop||e.isSwitch)return;e=t.pop()}throw SyntaxError("Illegal break statement")},t.prototype.stepCallExpression=function(e,r,n){if(!r.doneCallee_){r.doneCallee_=1;var i=new Fa(n.callee,r.scope);return i.components=!0,i}if(1===r.doneCallee_){r.doneCallee_=2;var o=r.value;if(Array.isArray(o)){if(r.func_=this.getValue(o),o[0]!==t.SCOPE_REFERENCE&&(r.funcThis_=o[0]),(o=r.func_)&&"object"==typeof o&&o.isGetter)return o.isGetter=!1,r.doneCallee_=1,this.createGetter_(o,r.value)}else r.func_=o;r.arguments_=[],r.n_=0}if(o=r.func_,!r.doneArgs_){if(0!==r.n_&&r.arguments_.push(r.value),n.arguments[r.n_])return new Fa(n.arguments[r.n_++],r.scope);"NewExpression"===n.type?(o.illegalConstructor&&this.throwException(this.TYPE_ERROR,o+" is not a constructor"),r.funcThis_=this.createObject(o),r.isConstructor=!0):void 0===r.funcThis_&&(r.funcThis_=r.scope.strict?void 0:this.global),r.doneArgs_=!0}if(r.doneExec_)e.pop(),r.isConstructor&&"object"!=typeof r.value?e[e.length-1].value=r.funcThis_:e[e.length-1].value=r.value;else{r.doneExec_=!0,o&&o.isObject||(console.log("non-function called",o,r),this.throwException(this.TYPE_ERROR,o+" is not a function"));var a=o.node;if(a){for(var s=this.createScope(a.body,o.parentScope),l=0;l<a.params.length;l++){var c=a.params[l].name,u=r.arguments_.length>l?r.arguments_[l]:void 0;this.setProperty(s,c,u)}var h=this.createObjectProto(this.ARRAY_PROTO);for(l=0;l<r.arguments_.length;l++)this.setProperty(h,l,r.arguments_[l]);this.setProperty(s,"arguments",h);var p=a.id&&a.id.name;return p&&this.setProperty(s,p,o),this.setProperty(s,"this",r.funcThis_,t.READONLY_DESCRIPTOR),r.value=void 0,new Fa(a.body,s)}if(o.eval){var d=r.arguments_[0];if("string"==typeof d){try{var f=wi(d.toString(),t.PARSE_OPTIONS)}catch(t){this.throwException(this.SYNTAX_ERROR,"Invalid code: "+t.message)}var m=new this.nodeConstructor;return m.type="EvalProgram_",m.body=f.body,this.stripLocations_(m,n.start,n.end),(s=r.scope).strict?s=this.createScope(f,s):this.populateScope_(f,s),this.value=void 0,new Fa(m,s)}r.value=d}else if(o.nativeFunc)void 0!==r.funcThis_&&void 0!==r.funcThis_._native?r.value=o.nativeFunc.call(r.funcThis_,r.arguments_):r.value=o.nativeFunc.apply(r.funcThis_,r.arguments_);else{if(o.asyncFunc){var g=this,v=r.arguments_.concat((function(t){r.value=t,g.paused_=!1}));return this.paused_=!0,void o.asyncFunc.apply(r.funcThis_,v)}this.throwException(this.TYPE_ERROR,o.class+" is not a function")}}},t.prototype.stepCatchClause=function(t,e,r){if(!e.done_){e.done_=!0;var n=this.createSpecialScope(e.scope);return this.setProperty(n,r.param.name,e.throwValue),new Fa(r.body,n)}t.pop()},t.prototype.stepConditionalExpression=function(t,e,r){var n=e.mode_||0;if(0===n)return e.mode_=1,new Fa(r.test,e.scope);if(1===n){e.mode_=2;var i=Boolean(e.value);if(i&&r.consequent)return new Fa(r.consequent,e.scope);if(!i&&r.alternate)return new Fa(r.alternate,e.scope);this.value=void 0}t.pop(),"ConditionalExpression"===r.type&&(t[t.length-1].value=e.value)},t.prototype.stepContinueStatement=function(t,e,r){t.pop();var n=null;for(r.label&&(n=r.label.name),e=t[t.length-1];e&&"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if(e.isLoop&&(!n||e.labels&&-1!==e.labels.indexOf(n)))return;t.pop(),e=t[t.length-1]}throw SyntaxError("Illegal continue statement")},t.prototype.stepDebuggerStatement=function(t,e,r){t.pop()},t.prototype.stepDoWhileStatement=function(t,e,r){if("DoWhileStatement"===r.type&&void 0===e.test_&&(e.value=!0,e.test_=!0),!e.test_)return e.test_=!0,new Fa(r.test,e.scope);if(e.value){if(r.body)return e.test_=!1,e.isLoop=!0,new Fa(r.body,e.scope)}else t.pop()},t.prototype.stepEmptyStatement=function(t,e,r){t.pop()},t.prototype.stepEvalProgram_=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.n_=n+1,new Fa(i,e.scope);t.pop(),t[t.length-1].value=this.value},t.prototype.stepExpressionStatement=function(t,e,r){if(!e.done_)return e.done_=!0,new Fa(r.expression,e.scope);t.pop(),this.value=e.value},t.prototype.stepForInStatement=function(e,r,n){if(!r.doneInit_&&(r.doneInit_=!0,n.left.declarations&&n.left.declarations[0].init))return r.scope.strict&&this.throwException(this.SYNTAX_ERROR,"for-in loop variable declaration may not have an initializer."),new Fa(n.left,r.scope);if(!r.doneObject_)return r.doneObject_=!0,r.variable_||(r.variable_=r.value),new Fa(n.right,r.scope);if(r.isLoop||(r.isLoop=!0,r.object_=r.value,r.visited_=Object.create(null)),void 0===r.name_){t:do{if(r.object_&&r.object_.isObject){r.props_||(r.props_=Object.getOwnPropertyNames(r.object_.properties));do{var i=r.props_.shift()}while(i&&(r.visited_[i]||!Object.prototype.hasOwnProperty.call(r.object_.properties,i)));if(i&&(r.visited_[i]=!0,Object.prototype.propertyIsEnumerable.call(r.object_.properties,i))){r.name_=i;break t}}else if(null!==r.object_){r.props_||(r.props_=Object.getOwnPropertyNames(r.object_));do{i=r.props_.shift()}while(i&&r.visited_[i]);if(i){r.visited_[i]=!0,r.name_=i;break t}}r.object_=this.getPrototype(r.object_),r.props_=null}while(null!==r.object_);if(null===r.object_)return void e.pop()}if(!r.doneVariable_){r.doneVariable_=!0;var o=n.left;if("VariableDeclaration"!==o.type){r.variable_=null;var a=new Fa(o,r.scope);return a.components=!0,a}r.variable_=[t.SCOPE_REFERENCE,o.declarations[0].id.name]}if(r.variable_||(r.variable_=r.value),!r.doneSetter_){r.doneSetter_=!0;var s=r.name_,l=this.setValue(r.variable_,s);if(l)return this.createSetter_(l,r.variable_,s)}return r.name_=void 0,r.doneVariable_=!1,r.doneSetter_=!1,n.body?new Fa(n.body,r.scope):void 0},t.prototype.stepForStatement=function(t,e,r){var n=e.mode_||0;if(0===n){if(e.mode_=1,r.init)return new Fa(r.init,e.scope)}else if(1===n){if(e.mode_=2,r.test)return new Fa(r.test,e.scope)}else if(2===n){if(e.mode_=3,!r.test||e.value)return e.isLoop=!0,new Fa(r.body,e.scope);t.pop()}else if(3===n&&(e.mode_=1,r.update))return new Fa(r.update,e.scope)},t.prototype.stepFunctionDeclaration=function(t,e,r){t.pop()},t.prototype.stepFunctionExpression=function(t,e,r){t.pop(),t[t.length-1].value=this.createFunction(r,e.scope)},t.prototype.stepIdentifier=function(e,r,n){if(e.pop(),r.components)e[e.length-1].value=[t.SCOPE_REFERENCE,n.name];else{var i=this.getValueFromScope(n.name);if(i&&"object"==typeof i&&i.isGetter){i.isGetter=!1;for(var o=r.scope;!this.hasProperty(o,n.name);)o=o.parentScope;var a=i;return this.createGetter_(a,this.global)}e[e.length-1].value=i}},t.prototype.stepIfStatement=function(t,e,r){return this.stepConditionalExpression(t,e,r)},t.prototype.stepLabeledStatement=function(t,e,r){t.pop();var n=e.labels||[];n.push(r.label.name);var i=new Fa(r.body,e.scope);return i.labels=n,i},t.prototype.stepLiteral=function(t,e,r){t.pop();var n=r.value;if(n instanceof RegExp){var i=this.createObjectProto(this.REGEXP_PROTO);this.populateRegExp(i,n),n=i}t[t.length-1].value=n},t.prototype.stepLogicalExpression=function(t,e,r){if("&&"!==r.operator&&"||"!==r.operator)throw SyntaxError("Unknown logical operator: "+r.operator);if(!e.doneLeft_)return e.doneLeft_=!0,new Fa(r.left,e.scope);if(e.doneRight_)t.pop(),t[t.length-1].value=e.value;else{if(!("&&"===r.operator&&!e.value||"||"===r.operator&&e.value))return e.doneRight_=!0,new Fa(r.right,e.scope);t.pop(),t[t.length-1].value=e.value}},t.prototype.stepMemberExpression=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new Fa(r.object,e.scope);var n;if(r.computed){if(!e.doneProperty_)return e.object_=e.value,e.doneProperty_=!0,new Fa(r.property,e.scope);n=e.value}else e.object_=e.value,n=r.property.name;if(t.pop(),e.components)t[t.length-1].value=[e.object_,n];else{var i=this.getProperty(e.object_,n);if(i&&"object"==typeof i&&i.isGetter){i.isGetter=!1;var o=i;return this.createGetter_(o,e.object_)}t[t.length-1].value=i}},t.prototype.stepNewExpression=function(t,e,r){return this.stepCallExpression(t,e,r)},t.prototype.stepObjectExpression=function(t,e,r){var n=e.n_||0,i=r.properties[n];if(e.object_){var o=i.key;if("Identifier"===o.type)var a=o.name;else{if("Literal"!==o.type)throw SyntaxError("Unknown object structure: "+o.type);a=o.value}e.properties_[a]||(e.properties_[a]={}),e.properties_[a][i.kind]=e.value,e.n_=++n,i=r.properties[n]}else e.object_=this.createObjectProto(this.OBJECT_PROTO),e.properties_=Object.create(null);if(i)return new Fa(i.value,e.scope);for(var s in e.properties_){var l=e.properties_[s];if("get"in l||"set"in l){var c={configurable:!0,enumerable:!0,get:l.get,set:l.set};this.setProperty(e.object_,s,null,c)}else this.setProperty(e.object_,s,l.init)}t.pop(),t[t.length-1].value=e.object_},t.prototype.stepProgram=function(t,e,r){var n=e.n_||0,i=r.body[n];if(i)return e.done=!1,e.n_=n+1,new Fa(i,e.scope);e.done=!0},t.prototype.stepReturnStatement=function(t,e,r){if(r.argument&&!e.done_)return e.done_=!0,new Fa(r.argument,e.scope);var n=e.value,i=t.length-1;for(e=t[i];"CallExpression"!==e.node.type&&"NewExpression"!==e.node.type;){if("TryStatement"!==e.node.type&&t.splice(i,1),--i<0)throw SyntaxError("Illegal return statement");e=t[i]}e.value=n},t.prototype.stepSequenceExpression=function(t,e,r){var n=e.n_||0,i=r.expressions[n];if(i)return e.n_=n+1,new Fa(i,e.scope);t.pop(),t[t.length-1].value=e.value},t.prototype.stepSwitchStatement=function(t,e,r){if(!e.test_)return e.test_=1,new Fa(r.discriminant,e.scope);for(1===e.test_&&(e.test_=2,e.switchValue_=e.value);;){var n=e.index_||0,i=r.cases[n];if(e.matched_||!i||i.test)if(i||e.matched_||!e.defaultCase_){if(!i)return void t.pop();if(!e.matched_&&!e.tested_&&i.test)return e.tested_=!0,new Fa(i.test,e.scope);if(e.matched_||e.value===e.switchValue_){e.matched_=!0;var o=e.n_||0;if(i.consequent[o])return e.isSwitch=!0,e.n_=o+1,new Fa(i.consequent[o],e.scope)}e.tested_=!1,e.n_=0,e.index_=n+1}else e.matched_=!0,e.index_=e.defaultCase_;else e.defaultCase_=n,e.index_=n+1}},t.prototype.stepThisExpression=function(t,e,r){t.pop(),t[t.length-1].value=this.getValueFromScope("this")},t.prototype.stepThrowStatement=function(t,e,r){if(!e.done_)return e.done_=!0,new Fa(r.argument,e.scope);this.throwException(e.value)},t.prototype.stepTryStatement=function(t,e,r){if(!e.doneBlock_)return e.doneBlock_=!0,new Fa(r.block,e.scope);if(e.throwValue&&!e.doneHandler_&&r.handler){e.doneHandler_=!0;var n=new Fa(r.handler,e.scope);return n.throwValue=e.throwValue,e.throwValue=null,n}if(!e.doneFinalizer_&&r.finalizer)return e.doneFinalizer_=!0,new Fa(r.finalizer,e.scope);e.throwValue?this.executeException(e.throwValue):t.pop()},t.prototype.stepUnaryExpression=function(e,r,n){if(!r.done_){r.done_=!0;var i=new Fa(n.argument,r.scope);return i.components="delete"===n.operator,i}e.pop();var o=r.value;if("-"===n.operator)o=-o;else if("+"===n.operator)o=+o;else if("!"===n.operator)o=!o;else if("~"===n.operator)o=~o;else if("delete"===n.operator){var a=!0;if(Array.isArray(o)){var s=o[0];s===t.SCOPE_REFERENCE&&(s=r.scope);var l=String(o[1]);try{delete s.properties[l]}catch(t){r.scope.strict?this.throwException(this.TYPE_ERROR,"Cannot delete property '"+l+"' of '"+s+"'"):a=!1}}o=a}else if("typeof"===n.operator)o=o&&"Function"===o.class?"function":typeof o;else{if("void"!==n.operator)throw SyntaxError("Unknown unary operator: "+n.operator);o=void 0}e[e.length-1].value=o},t.prototype.stepUpdateExpression=function(t,e,r){if(!e.doneLeft_){e.doneLeft_=!0;var n=new Fa(r.argument,e.scope);return n.components=!0,n}if(e.leftSide_||(e.leftSide_=e.value),e.doneGetter_&&(e.leftValue_=e.value),!e.doneGetter_){var i=this.getValue(e.leftSide_);if(e.leftValue_=i,i&&"object"==typeof i&&i.isGetter){i.isGetter=!1,e.doneGetter_=!0;var o=i;return this.createGetter_(o,e.leftSide_)}}if(e.doneSetter_)return t.pop(),void(t[t.length-1].value=e.doneSetter_);var a;if(i=Number(e.leftValue_),"++"===r.operator)a=i+1;else{if("--"!==r.operator)throw SyntaxError("Unknown update expression: "+r.operator);a=i-1}var s=r.prefix?a:i,l=this.setValue(e.leftSide_,a);if(l)return e.doneSetter_=s,this.createSetter_(l,e.leftSide_,a);t.pop(),t[t.length-1].value=s},t.prototype.stepVariableDeclaration=function(t,e,r){var n=r.declarations,i=e.n_||0,o=n[i];for(e.init_&&o&&(this.setValueToScope(o.id.name,e.value),e.init_=!1,o=n[++i]);o;){if(o.init)return e.n_=i,e.init_=!0,new Fa(o.init,e.scope);o=n[++i]}t.pop()},t.prototype.stepWithStatement=function(t,e,r){if(!e.doneObject_)return e.doneObject_=!0,new Fa(r.object,e.scope);if(!e.doneBody_){e.doneBody_=!0;var n=this.createSpecialScope(e.scope,e.value);return new Fa(r.body,n)}t.pop()},t.prototype.stepWhileStatement=function(t,e,r){return this.stepDoWhileStatement(t,e,r)},t.PARSE_OPTIONS={ecmaVersion:5},t.READONLY_DESCRIPTOR={configurable:!0,enumerable:!0,writable:!1},t.NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!0},t.READONLY_NONENUMERABLE_DESCRIPTOR={configurable:!0,enumerable:!1,writable:!1},t.VARIABLE_DESCRIPTOR={configurable:!1,enumerable:!0,writable:!0},t.STEP_ERROR={},t.SCOPE_REFERENCE={},t.toStringCycles_=[],t}(),Ua=function(){function t(t){this.proto=null,this.isObject=!0,this.class="Object",this.data=null,this._native=void 0,this.getter=Object.create(null),this.setter=Object.create(null),this.properties=Object.create(null),this.proto=t}return t.prototype.toString=function(){if("Array"===this.class){(n=ka.toStringCycles_).push(this);try{for(var t=[],e=0;e<this.properties.length;e++){var r=this.properties[e];t[e]=r&&r.isObject&&-1!==n.indexOf(r)?"...":r}}finally{n.pop()}return t.join(",")}if("Error"===this.class){var n,i,o;if(-1!==(n=ka.toStringCycles_).indexOf(this))return"[object Error]";var a=this;do{if("name"in a.properties){i=a.properties.name;break}}while(a=a.proto);a=this;do{if("message"in a.properties){o=a.properties.message;break}}while(a=a.proto);n.push(this);try{i=i&&i.toString(),o=o&&o.toString()}finally{n.pop()}return o?i+": "+o:String(i)}return null!==this.data?String(this.data):"[object "+this.class+"]"},t.prototype.valueOf=function(){return void 0===this.data||null===this.data||this.data instanceof RegExp?this:this.data instanceof Date?this.data.valueOf():this.data},t}(),Fa=function(t,e){this.node=t,this.scope=e},ja=function(t,e){for(var r=t;r&&r.prototype;){if(Object.getOwnPropertyNames(r.prototype).indexOf(e)>=0)return!0;r=Object.getPrototypeOf(r)}return!1};function Ga(t,e){var r={},n=wi(t,{locations:!0,onComment:function(t,e,n,i,o,a){r[a.line]=e}});if("Program"!==n.type||1!==n.body.length||"FunctionDeclaration"!==n.body[0].type)throw new Error("this function does not follow the definition rule.");var i=n.body[0].body.body,o=[],a=[];return i.forEach((function(t){if("ExpressionStatement"===t.type){var n=t.expression;if("AssignmentExpression"===n.type&&"="===n.operator&&"MemberExpression"===n.left.type&&"ThisExpression"===n.left.object.type&&"Identifier"===n.left.property.type){for(var i=[],s=n.loc.start.line-1;s>=0&&void 0!==r[s];s--)i.push(r[s]);if(!(i.length<=0)){var l=n.left.property.name;if(!(Array.isArray(e)&&e.indexOf(l)>=0)&&"FunctionExpression"!==n.right.type){var c=function(t,e,r){var n={name:t,title:{},className:null,proposed:!1,initialValue:null};if(e.forEach((function(t){var e=t.indexOf("@ui ");if(e>=0)n.description=t.substring(e+4).trim();else{var r=t.indexOf("@title ");if(r>=0){var i=t.substring(r+7).trim();0===i.indexOf("@ja ")?n.title.ja=i.substring(4).trim():n.title.default=i}else if(t.indexOf("@proposed")>=0)n.proposed=!0;else{var o=t.indexOf("@comment ");if(o>=0){var a=t.substring(o+9).trim();return n.comment||(n.comment={}),void(0===a.indexOf("@ja ")?n.comment.ja=a.substring(4).trim():n.comment.default=a)}}}})),!n.description&&!n.comment)return null;if(n.proposed||n.comment)return n;var i=n.description.indexOf("("),o=n.description.indexOf(")",i);if(!(i<0||o<0)){n.className=n.description.substr(0,i);try{var a=new ka("["+n.description.substr(i+1,o-i-1)+"]"),s=Date.now();for(a.unwrap=null,a.wrap=null;a.step()&&!(Date.now()-s>100););n.params=a.pseudoToNative(a.value)}catch(t){}return n.params||(n.params=[]),n}}(l,i);a.push(n),c&&o.push(c)}}}}})),{widgets:o,fields:a,ast:n}}function za(t,e){if(void 0===e&&(e=-1),!t)return{dependencyAtCursor:null,dependencies:[]};for(var r=[],n=null,i=("string"==typeof t?wi(t,ka.PARSE_OPTIONS):t).body[0].body.body.slice(0);i.length>0;){var o=i.shift();if(null!=o)if("CallExpression"!==o.type)o.expression&&i.push(o.expression),o.object&&i.push(o.object),o.property&&i.push(o.property),o.name&&"string"!=typeof name&&i.push(o.name),o.left&&i.push(o.left),o.right&&i.push(o.right),o.id&&i.push(o.id),o.init&&i.push(o.init),o.callee&&i.push(o.callee),o.body&&Array.isArray(o.body)&&i.push.apply(i,o.body),o.declarations&&Array.isArray(o.declarations)&&i.push.apply(i,o.declarations),o.arguments&&Array.isArray(o.arguments)&&i.push.apply(i,o.arguments),o.params&&Array.isArray(o.params)&&i.push.apply(i,o.params);else if(o.callee.name&&"require"===o.callee.name){var a=o.arguments;if(a&&Array.isArray(a)&&1===a.length){var s=a[0];if("Literal"===s.type){var l=s.value;r.push(l),o.start&&o.end&&o.start<=e&&o.end>=e&&(n=l)}}}}return{dependencyAtCursor:n,dependencies:r}}function Va(t,e){if("object"!=typeof t||null===t)return t;if(t.type&&e[t.type]){var r;if("Color"===t.type){var n=new _r;n.r=Number(t.value.r),n.g=Number(t.value.g),n.b=Number(t.value.b),n.a=Number(t.value.a),r=n}else{for(var i=new e[t.type],o=0,a=Object.keys(t.value);o<a.length;o++){var s=a[o];i[s]=t.value[s]}r=i}return r}}function Ha(t){if(void 0!==t&&"function"!=typeof t){if("object"!=typeof t)return t;if(null===t)return null;if(t instanceof _r)return{type:"Color",value:{r:t.r,g:t.g,b:t.b,a:t.a}};throw new Error}}function Wa(t){return"boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t}ka.Object=Ua,ka.State=Fa;var qa={type:"ExpressionStatement",start:null,end:null,expression:{type:"CallExpression",start:null,end:null,expression:null,arguments:null},arguments:null},Ya=function(){function t(t,e,r){this.verbose=!1,this.wrapperTable=t,this.ignoredPropNames=e,this.isGraphics=r,this.initialize()}return t.prototype.initialize=function(){var t=this,e=new ka("",(function(e,r){t.globalScope=r}));this.interpreter=e,this.interpreter.wrap=function(e){return t.wrap(e)},this.interpreter.unwrap=function(e,r){return t.unwrap(e,r)},this.wrappers={},Object.keys(this.wrapperTable).forEach((function(e){return t.wrapClass(t.wrapperTable[e],e)}))},t.prototype.createGlobalFunction=function(t,e){var r,n=this,i=e.func,o=e.raw,a=e.isConstructor,s=e.async,l=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=i(o?t:t.map((function(e,r){return r<t.length-1||!s?n.unwrap(e):e})));return o?r:n.wrap(r)};r=s?this.interpreter.createAsyncFunction(l):this.interpreter.createNativeFunction(l,a),this.interpreter.setProperty(this.globalScope,t,r)},t.prototype.attachGetAssignedUnitMethod=function(t){var e=this,r=this.interpreter.createNativeFunction((function(){return e.wrap(t.assignedUnit)}));this.interpreter.setProperty(t.templateInstance,"getAssignedUnit",r)},t.prototype.setSizeProperties=function(t,e,r){this.interpreter.setProperty(this.globalScope,"width",t),this.interpreter.setProperty(this.globalScope,"height",e),this.interpreter.setProperty(this.globalScope,"margin",this.interpreter.wrap(r))},t.prototype.setDurationProperty=function(t){this.interpreter.setProperty(this.globalScope,"duration",t)},t.prototype.setProperty=function(t,e,r){this.interpreter.setProperty(t,e,this.wrap(r))},t.prototype.getProperty=function(t,e){return this.unwrap(this.interpreter.getProperty(t,e))},t.prototype.getRawProperty=function(t,e){return this.interpreter.getProperty(t,e)},t.prototype.prepareRun=function(t){var e;e="string"==typeof t?wi(t,ka.PARSE_OPTIONS):t;var r=this.interpreter.createScope(e,this.globalScope);return this.interpreter.stateStack=[{node:e,scope:r,done:!1}],r},t.prototype.newStatementFor=function(t){return wi("new "+t+"();",ka.PARSE_OPTIONS)},t.prototype.prepareNewInstance=function(t,e){var r=this.interpreter.createScope(wi("",ka.PARSE_OPTIONS),e);return this.interpreter.stateStack=[{node:t,scope:r,thisExpression:r}],r},t.prototype.exec=function(t,e,r,n){var i=this,o=this.interpreter;qa.expression.arguments=[];var a=[];return r.forEach((function(t){qa.expression.arguments.push(null),a.push(i.wrap(t))})),o.stateStack=[{node:{type:"Program",body:[qa]},scope:this.globalScope,done:!0,n_:1},{node:qa,scope:this.globalScope,done_:!0},{node:qa.expression,doneCallee_:2,doneArgs_:!0,arguments_:a,funcThis_:t,func_:o.getProperty(t,e),scope:t,n_:a.length,value:[t,e]}],this.run(700,"call a method ("+t.className+"."+e+(n?" assigned to "+n.toString():"")+")")},t.prototype.run=function(t,e){var r=this.interpreter,n=Date.now(),i=!1;try{for(;r.step();)if(Date.now()-n>t){i=!0;break}}catch(o){throw this.verbose&&console.log(r.stateStack),"string"==typeof o&&(o=new Error(o)),r.stateStack.length>0&&(o.node=r.stateStack[r.stateStack.length-1].node),o}if(i){var o=new Error("timeout: spent too long time (> "+t+"ms) to "+e);throw r.stateStack.length>0&&(o.node=r.stateStack[0].node),o}return this.interpreter.value},t.prototype.getPrimitiveProperty=function(t,e){return"object"==typeof t&&"object"==typeof t.properties&&Wa(t.properties[e])?t.properties[e]:null},t.prototype.cleanupProperties=function(t){if(!t)return null;for(var e in this.ignoredPropNames.forEach((function(e){void 0!==t.properties[e]&&delete t.properties[e]})),t.properties)this.cleanupProperty(t.properties[e])||delete t.properties[e];return t.properties},t.prototype.cleanupProperty=function(t){if(Wa(t))return!0;var e=t;if(e._native)return!0;var r=this.globalScope.properties;if(e.parent===r.Array){for(var n=e.length,i=0;i<e.length;i++)this.cleanupProperty(e.properties[i])||(delete e.properties[i],n--);return e.length=n,n>0}if(e.parent===r.Object){var o=!0;for(var a in e.properties)this.cleanupProperty(e.properties[a])?o=!1:delete e.properties[a];return!o}return!1},t.prototype.restoreProperties=function(t,e){e&&(t.properties=Ur(Ur({},t.properties),e))},t.prototype.wrap=function(t){if("object"==typeof t&&null!==t&&void 0!==t.constructor&&"string"==typeof t.constructor.className){var e=t.constructor.className,r=this.wrappers[e];if(void 0===r)return;var n=this.interpreter.createObject(r);return n._native=t,n}return this.verbose&&(Wa(t)||Array.isArray(t)||console.log("wrap complex obj:",String(t))),this.interpreter.nativeToPseudo(t)},t.prototype.unwrap=function(t,e){return"object"==typeof t&&null!==t&&t._native?t._native:this.interpreter.pseudoToNative(t,e)},t.prototype.wrapClass=function(t,e){this.verbose&&console.log("--- wrapping "+e+" ---"),t.className=e;var r=this,n=this.interpreter.createNativeFunction((function(e){var i,o;if(i=r.interpreter.calledWithNew()?this:r.interpreter.createObjectProto(n.properties.prototype),void 0!==e)if(Array.isArray(e))for(var a=0;a<e.length;a++)o[a]=r.unwrap(e[a]);else o=r.unwrap(e);if(t){var s=Object.create(t.prototype),l=t.apply(s,[null].concat(o).splice(1));i._native=null!==l&&"object"==typeof l?l:s}return i}));return this.interpreter.setProperty(this.globalScope,e,n),this.wrapStaticMembers(n,t),this.wrapInstanceMembers(n,t),this.wrappers[e]=n,n},t.prototype.wrapStaticMembers=function(t,e){var r=this,n=function(n){var o=n;if(i.interpreter.setProperty(t,n,ReferenceError,{get:function(){return r.wrap(e[o])},set:function(t){return e[o]=r.unwrap(t)}}),i.verbose){var a=void 0;try{a=typeof e[o]}catch(t){a="not accessible"}console.log("static "+o+" ("+a+")")}},i=this;for(var o in e)n(o)},t.prototype.wrapInstanceMembers=function(t,e){for(var r,n=new e,i=this.isGraphics(t),o=0,a=Gr(Object.keys(n),function(t){for(var e=t,r=[];e&&e.prototype;)r=Gr(r,Object.getOwnPropertyNames(e.prototype)),e=Object.getPrototypeOf(e);return r}(e)).filter((function(t,e,r){return r.indexOf(t)===e}));o<a.length;o++){var s=a[o];if("constructor"!==s&&!this.interpreter.hasProperty(t,s)&&!this.interpreter.hasProperty(t.properties.prototype,s)&&"_"!==s.charAt(0)){if(this.verbose){var l=void 0;try{l=typeof n[s]}catch(t){l="not accessible"}r=s+" ("+l+")"}try{var c;if("function"==typeof n[s])c=i?function(t,e){return function(r){var n;return e.wrap((n=this._native)[t].apply(n,r.map((function(t){var r=e.unwrap(t);return r instanceof _r?r.toString():r}))))}}(s,this):function(t,e){return function(r){var n;return e.wrap((n=this._native)[t].apply(n,r.map((function(t){return e.unwrap(t)}))))}}(s,this),this.interpreter.setProperty(t.properties.prototype,s,this.interpreter.createNativeFunction(c)),this.verbose&&(r+=" native method")}catch(t){}this.verbose&&console.log(r)}}},t}(),Xa={Matrix2D:Pr,Point:Or,Color:_r,Font:br,RenderingUnit:mr,TextUnit:yr,Graphic:wr,Phrase:Mr,Word:Er,Char:xr,Beat:tn,RepetitiveSegment:rn},Ja=["headTime","tailTime","insomnia"],Za=["animate","getAssignedUnit","name","type"],Ka=function(){function t(t,e,r){this._emitter=null,this._player=null,this.interpreter=null,this.unsafeAcceleration=!1,this._verbose=!1,this.rawConsole=!1,this._player=t,this._emitter=e,this.unsafeAcceleration=r,this.loader=new xi(e,this.register.bind(this)),t.addListener({onVideoReady:this.onVideoReady.bind(this)})}return Object.defineProperty(t.prototype,"verbose",{get:function(){return this._verbose},set:function(t){this._verbose=this.loader.verbose=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ready",{get:function(){return!!this.interpreter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this.loader.loaded},enumerable:!1,configurable:!0}),t.prototype.initialize=function(){var t=this;if(!this.ready){var e=function(t){var e=t.player,r=t.ignoredPropNames,n=t.rawConsole,i=t.templateGetter,o=e.graphics.wrapperTable,a=new Ya(Ur(Ur({},Xa),o),r,(function(t){return e.graphics.isGraphics(t)})),s={require:{func:function(t){if(!(t.length<1||"string"!=typeof t[0])){var e=t[0],r=i(e);return null===r?void 0:r.functionDefinition}},raw:!0,isConstructor:!0},print:{func:function(t){e.isEditing&&console.log.apply(console,t)},raw:n},findChorus:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.findChorus(t[0])}},findBeat:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.findBeat(t[0])}},getVocalFrequency:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.getVocalFrequency(t[0])}},getVocalAmplitude:{func:function(t){return t.length<1||"number"!=typeof t[0]?-1:e.getVocalAmplitude(t[0])}},getMaxVocalAmplitude:{func:function(t){return e.getMaxVocalAmplitude()}},getValenceArousal:{func:function(t){return t.length<1||"number"!=typeof t[0]?null:e.getValenceArousal(t[0])}},getMedianValenceArousal:{func:function(t){return e.getMedianValenceArousal()}}};Object.keys(Pe).forEach((function(t){a.setProperty(a.globalScope,t,Pe[t]),s[t]={value:Pe[t]}})),Object.keys(yi).forEach((function(t){var e=yi[t];0!==t.indexOf("get")&&(s[t]={func:e})}));var l=Object.keys(a.wrapperTable);return l&&l.forEach((function(t){return s[t]={cls:a.wrapperTable[t]}})),Object.keys(s).forEach((function(t){var e=s[t];e.func?a.createGlobalFunction(t,e):e.value&&a.setProperty(a.globalScope,t,e.value)})),{interpreter:a,unsafeGlobalScope:s}}({player:this._player,ignoredPropNames:Za,rawConsole:this.rawConsole,templateGetter:function(e){return t.getByName(e,!0)}}),r=e.interpreter,n=e.unsafeGlobalScope;this.unsafeGlobalScope=n,this.interpreter=r,this.onVideoReady(this._player.video)}},t.prototype.getByName=function(t,e){return void 0===e&&(e=!1),this.loader.getByName(t,e)},t.prototype.getById=function(t){return this.loader.getById(t)},t.prototype.clear=function(){this.loader.clear()},t.prototype.loadLatest=function(t){return void 0===t&&(t=100),Fr(this,void 0,void 0,(function(){return jr(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadLatest(t)]}))}))},t.prototype.loadForVideo=function(t){return Fr(this,void 0,void 0,(function(){return jr(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadForVideo(t)]}))}))},t.prototype.loadByNames=function(t){return Fr(this,void 0,void 0,(function(){return jr(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadByNames(t)]}))}))},t.prototype.loadByName=function(t){return Fr(this,void 0,void 0,(function(){return jr(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadByName(t)]}))}))},t.prototype.loadById=function(t){return Fr(this,void 0,void 0,(function(){return jr(this,(function(e){return this.ready||this.initialize(),[2,this.loader.loadById(t)]}))}))},t.prototype.commit=function(t,e){return Fr(this,void 0,void 0,(function(){return jr(this,(function(r){return[2,this.loader.commit(t,e)]}))}))},t.prototype.register=function(t){return Fr(this,void 0,void 0,(function(){var e,r,n,i,o=this;return jr(this,(function(a){switch(a.label){case 0:if(!t)return[2,null];if(!(e=this.createClass(t.script)))return[2,null];r=za(e.ast).dependencies,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Promise.all(r.map((function(t){var e=o.getByName(t);return e?Promise.resolve(e):o.loadByName(t)})))];case 2:return a.sent(),this.verbose&&console.log("load dependencies for",e.className,r),[3,4];case 3:return n=a.sent(),this.verbose&&console.error("failed loading dependencies for",e.className,n),[3,4];case 4:try{if(!this.newRawInstance(e))throw new Error("failed to create a template instance");return e.model=t,[2,this.registerClass(e)]}catch(e){throw delete(i=Ur({},t)).script,{error:e.message,stack:e.stack,cause:i}}return[2]}}))}))},t.prototype.updateClassScript=function(t,e){var r=this.createClass(e);return this.updateClass(t,r)},t.prototype.registerClass=function(t){if(!t)return null;if(this.loader.loaded[t.className]){this.verbose&&console.log("updating",t.className,t.model.id);var e=this.updateClass(this.loader.loaded[t.className],t);return this.verbose&&console.log("updated",e.className,e.id),e}return this.loader.loaded[t.className]=t,this.verbose&&console.log("loaded",t.className,t.model.id),t},t.prototype.updateClass=function(t,e){var r=t,n=e;if(!n)return null;if(r.model.script===n.model.script)return this.verbose&&console.log("no diff for",r.className),r;var i=this.newRawInstance(n);if(null===i)return null;if(n.id<0){var o=i.templateInstance,a=n.model.script;n.model={id:-1,sourceId:-1,className:n.className,prettyName:o?this.interpreter.getPrimitiveProperty(o,"name"):i.unsafeTemplateInstance.name,type:o?this.interpreter.getPrimitiveProperty(o,"type"):i.unsafeTemplateInstance.type,script:a,author:null,originalAuthor:null,createdDate:null}}if(r.className!==n.className){var s=this.getByName(n.className);if(!s)return n.cursor=r.cursor,this.loader.loaded[n.className]=n,this.verbose&&console.log("create",n.className),n;r=s}return r.newStatement=n.newStatement,r.widgets=n.widgets,r.scope=n.scope,r.functionDefinition=n.functionDefinition,r.newStatement=n.newStatement,r.unsafeConstructorGenerator=n.unsafeConstructorGenerator,r.ast=n.ast,r.cursor<0&&(r.cursor=n.cursor),n.id>=0?(this.verbose&&console.log("replace",n.className,r.id,n.id),r.model=n.model):(this.verbose&&console.log("update",n.className,r.id,n.id),r.model.type=n.model.type,r.model.className=n.model.className,r.model.prettyName=n.model.prettyName,r.model.script=n.model.script,r.model.createdDate=null,r.id>=0&&(r.model.sourceId=r.model.id,r.model.id=-1)),n=r,this.updateInstances(r.instances.slice(),n),this._emitter.onTemplateUpdate(n.className),n},t.prototype.updateInstances=function(t,e){var r=this;t.forEach((function(t){try{r.updateInstance(t,e)}catch(r){console.log("failed updating template for",t.assignedUnit,":",e)}})),this._player.isPlaying||this._player.requestStageUpdate()},t.prototype.createClass=function(t){var e=this;this.ready||this.initialize();var r=new _i;r.model={id:-1,sourceId:-1,className:null,prettyName:null,type:0,script:t,author:null,originalAuthor:null,createdDate:null};var n=Ga(t,Za),i=n.ast,o=n.widgets;if(r.ast=i,r.widgets=o,r.className=r.ast.body[0].id.name,r.scope=this.interpreter.prepareRun(r.ast),this.interpreter.run(1e3,"to define "+r.className),r.functionDefinition=this.interpreter.getRawProperty(r.scope,r.className),r.newStatement=this.interpreter.newStatementFor(r.className),this.unsafeAcceleration){var a=Object.keys(this.unsafeGlobalScope),s="return function(props){var "+Object.keys(this.getGlobalProperties()).map((function(t){return t+"=props."+t})).join(",")+";"+t+"return "+r.className+";}",l=new(Function.bind.apply(Function,Gr([void 0],a,[s]))),c=function(t){var r=e.getByName(t);return r?r.unsafeConstructorGenerator(e.getGlobalProperties()):null},u=a.map((function(t){if("require"===t)return c;var r=e.unsafeGlobalScope[t];return r.func?function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return r.func(t)}:r.cls||r.value}));r.unsafeConstructorGenerator=l.apply({},u)}return r},t.prototype.getGlobalProperties=function(){var t;return{width:this._player.videoWidth,height:this._player.videoHeight,margin:this._player.margin,duration:(null===(t=this._player.video)||void 0===t?void 0:t.duration)||0}},t.prototype.newRawInstance=function(t){var e=t,r=new bi;if(this.unsafeAcceleration){var n=new(e.unsafeConstructorGenerator(this.getGlobalProperties()));r.unsafeTemplateInstance=n}else{this.interpreter.prepareNewInstance(e.newStatement,e.scope);var i=this.interpreter.run(700,"to instantiate "+e.className);r.templateInstance=i,r.templateInstance._nativeInstance=r}return r.templateClass=e,r.ignore=!1,r},t.prototype.setProperty=function(t,e,r){this.unsafeAcceleration?t.unsafeTemplateInstance[e]=r:this.interpreter.setProperty(t.templateInstance,e,r)},t.prototype.getProperty=function(t,e){return this.unsafeAcceleration?t.unsafeTemplateInstance[e]:this.interpreter.getProperty(t.templateInstance,e)},t.prototype.exportInstance=function(t){for(var e={},r=0,n=t.templateClass.widgets.map((function(t){return t.name})).concat(Ja);r<n.length;r++){var i=n[r],o=this.getProperty(t,i);try{var a=Ha(o);void 0!==a&&(e[i]=a)}catch(e){console.error("cannot export "+t.templateClass.className+"."+i,o,"assigned to",t.assignedUnit)}}return{type:t.templateClass.className,value:e}},t.prototype.importInstances=function(t,e){try{this.importPhraseTemplates(t.firstCredit,e.credits),this.importPhraseTemplates(t.firstPhrase,e.phrases);for(var r=e.graphics,n=t.firstGraphic,i=0;null!==n;){var o=r[i++];this.importTemplates(n,o.templates),n=n.next}}catch(t){return console.error("restoring templates failed",t),!1}return!0},t.prototype.importPhraseTemplates=function(t,e){if(Array.isArray(e))for(var r=0;t;){var n=e[r++];this.importTemplates(t,n.templates);for(var i=t.firstWord,o=0;o<t.wordCount;o++){var a=n.words[o];this.importTemplates(i,a.templates);for(var s=i.firstChar,l=0;l<i.charCount;l++){var c=a.characters[l];this.importTemplates(s,c.templates),s=s.next}i=i.next}if(e.length<r+1)break;t=t.next}},t.prototype.importTemplates=function(t,e){if(Array.isArray(e))for(var r=0,n=e;r<n.length;r++){var i=n[r],o=this.importInstance(i);o&&t.addTemplate(o)}},t.prototype.importInstance=function(t){var e=this.getByName(t.type),r=this.newInstance(e);if(!r||!t.value)return null;for(var n=0,i=Object.keys(t.value);n<i.length;n++){var o=i[n],a=Va(t.value[o],this.interpreter.wrapperTable);void 0!==a&&this.setProperty(r,o,a)}return r},t.prototype.updateInstance=function(t,e){var r=t,n=e,i=this.newRawInstance(n),o=r.templateInstance,a=this.interpreter.cleanupProperties(o);r.templateClass!==n&&(this.disposeInstance(r),n.instances.push(r)),r.templateClass=n,r.scope=i.scope,r.templateInstance=i.templateInstance,r.ignore=i.ignore,this.interpreter.restoreProperties(r.templateInstance,a),this.attachGetAssignedUnitMethod(r)},t.prototype.newInstance=function(t){var e;try{if(null===(e=this.newRawInstance(t)))return null}catch(t){return null}return this.attachGetAssignedUnitMethod(e),t.instances.push(e),e},t.prototype.attachGetAssignedUnitMethod=function(t){this.unsafeAcceleration?t.unsafeTemplateInstance.getAssignedUnit=function(){return t.assignedUnit}:this.interpreter.attachGetAssignedUnitMethod(t)},t.prototype.disposeInstance=function(t){var e=t.templateClass;e.instances=e.instances.filter((function(e){return e!==t}))},t.prototype.disposeInstances=function(t){var e=this;if(Array.isArray(t))t.forEach((function(t){return e.disposeInstance(t)}));else{var r=t;[r.firstCredit,r.firstPhrase,r.firstWord,r.firstChar,r.firstGraphic].forEach((function(t){for(;t;)e.disposeInstances(t.removeTemplates()),t=t.next}))}},t.prototype.setTemplate=function(t,e){this.removeTemplates(t),t.addTemplate(e)},t.prototype.clearTemplate=function(t){this.removeTemplates(t)},t.prototype.removeTemplateAt=function(t,e){var r=t.removeTemplateAt(e);r&&this.disposeInstance(r)},t.prototype.removeTemplates=function(t){var e=t.removeTemplates();this.disposeInstances(e)},t.prototype.getRequiredTemplates=function(t){return za(t).dependencies},t.prototype.getRequiredTemplateAt=function(t,e){return za(t,e).dependencyAtCursor},t.prototype.exec=function(t,e,r){if(t.unsafeTemplateInstance){var n=t.unsafeTemplateInstance;return n[e].apply(n,r)}var i=this.interpreter.exec(t.templateInstance,e,r,t.assignedUnit);return this.interpreter.unwrap(i)},t.prototype.declareVariable=function(t,e,r,n){return this.updateClassScript(t,function(t,e,r,n){try{var i=Ga(t),o=i.ast,a=i.fields,s=a[a.length-1],l=t.match(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/),c=l?l.pop():"\n",u=t.split(c),h=s?Array(s.loc.start.column+1).join(" "):"  ",p=s?s.loc.end.line:0;if(p<=0){var d=o.body[0].body,f=u[d.loc.start.line-1],m=f.substring(0,d.loc.start.column+1),g=f.substring(d.loc.start.column+1);u[d.loc.start.line-1]=m,u.splice(d.loc.start.line,0,g),p=d.loc.start.line}for(var v=void 0;(v="var"+Math.random().toString().substring(2)).length>8&&(v=v.substring(0,8)),!(t.indexOf(v)<0););u.length>p&&u[p].length>0&&u.splice(p,0,""),u.splice(p,0,"",h+"// @proposed",h+"// @title "+e,h+"// "+function(t,e){if("Slider"===t)return"@ui Slider("+e.min+", "+e.max+")";if("Check"===t)return"@ui Check()";if("Color"===t)return"@ui Color()";var r=e.etc;return"@comment "+(r=r.replace(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/g,"")).replace(/\/[*/]/g,"")}(r,n),h+"this."+v+" = "+(_=n,("Slider"===(y=r)?((_.min+_.max)/2).toString():"Check"===y?"false":"Color"===y?'new Color("#000000")':"null")+";")),t=u.join(c)}catch(t){}var y,_;return t}(t.model.script,e,r,n))},t.prototype.onVideoReady=function(t){this.ready&&(this.interpreter.setSizeProperties(this._player.resolutionWidth,this._player.resolutionHeight,this._player.margin),this.interpreter.setDurationProperty((null==t?void 0:t.duration)||0))},t}(),Qa=function(t){function e(e,r){var n=this.constructor,i=t.call(this,e)||this;return i.video=r,Object.setPrototypeOf(i,n.prototype),i}return kr(e,t),e}(Error),$a=function(){this.halted=[],this.errors=[]},ts=function(){function t(t,e){var r=this;this.listener=e,this.player=null,this._scale=1,this.playerListener={onResize:function(t){r.elementWidth=t.width,r.updateSize()},onVideoReady:function(){r.elementWidth=r.calcWidth(),r.updateSize()},onStageElementSet:function(t){r.elementWidth=r.calcWidth(),r.updateSize(),r.player.graphics.setCanvas(t)},onDispose:function(){r.dispose()}},this.requestedTime=0,this.request=null,this.player=t,t.addListener(this.playerListener)}return Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this.updateSize()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.player.graphics.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.player.graphics.height},enumerable:!1,configurable:!0}),t.prototype.requestUpdate=function(t){return Fr(this,void 0,void 0,(function(){var e=this;return jr(this,(function(r){return this.requestedTime=void 0===t?this.player.videoPosition:t,this.request||(this.request=new Promise((function(t){setTimeout((function(){try{e.update(e.requestedTime)}catch(t){}e.request=null,t(e.requestedTime)}),0)}))),[2,this.request]}))}))},t.prototype.update=function(t){t||(t=this.player.mediaPosition),"number"==typeof t&&(this.player.graphics.reset(),this.animate(t),this.player.graphics.update(),this.listener.onStageUpdate(t))},t.prototype.animate=function(t){for(var e=new $a,r=e.errors,n=e.halted,i=0,o=[this.player.video.firstCredit,this.player.video.firstPhrase,this.player.video.firstWord,this.player.video.firstChar,this.player.video.firstGraphic];i<o.length;i++)for(var a=o[i];a;)this.animateRenderingUnit(t,a,e),a=a.next;if(n.length>0){console.error("---");for(var s=0;s<n.length;s++)console.error("halted",n[s],r[s])}},t.prototype.animateRenderingUnit=function(t,e,r){if(e.animate)e.animate(t,e);else if(e.templateCount<=0)es(e)&&e.getType()===Pe.CHAR&&(e.rendering.visible=!1);else for(var n=0;n<e.templateCount;n++)this.animateTemplate(t,e,e.getTemplate(n),r)},t.prototype.animateTemplate=function(t,e,r,n){var i,o,a,s,l,c,u=this;if(r.ignore)e.rendering.visible=!1;else{if(e.getType()!==Pe.GRAPHIC)for(var h=e.parent;h;){if(h.templateCount>0&&(!h.rendering.visible||0===h.rendering.alpha))return void(e.rendering.visible=!1);h=h.parent}var p=this.player.templates.getProperty(r,"insomnia"),d=es(e);if(!p&&d&&(i=function(t,e){return u.player.templates.getProperty(t,e)},o=t,a=e,l=(s=r)&&i(s,"headTime")||500,c=s&&i(s,"tailTime")||500,!(a.startTime-l<=o&&a.endTime+c>=o||(a.getType()!==Pe.GRAPHIC&&(a.rendering.visible=!1),0))))return;this.doAnimateTemplate(t,r,n)}},t.prototype.doAnimateTemplate=function(t,e,r){var n=r.errors,i=r.halted;try{this.player.templates.exec(e,"animate",[t])}catch(t){n.push(t),i.push(e)}},t.prototype.calcWidth=function(){var t=this.player.stageElement;if(!t)return 0;var e=window.getComputedStyle(t);return t.offsetWidth-Nr(e.borderLeftWidth)-Nr(e.borderRightWidth)-Nr(e.paddingLeft)-Nr(e.paddingRight)},t.prototype.updateSize=function(){var t=this.player.stageElement;if(t){var e=this.elementWidth*this.player.videoProportion;if(t.style.height=e+"px",t.width=this.elementWidth*this._scale,t.height=e*this._scale,this.player.video){var r=t.width/this.player.videoWidth;this.player.graphics.updateStageTx(r,this.player.margin),this.player.isPlaying||this.requestUpdate()}}},t.prototype.dispose=function(){this.player.removeListener(this.playerListener),this.player=null},t}();function es(t){if(t.getType()===Pe.GRAPHIC)return!0;for(var e=!0,r=t.parent;r;){if(r.templateCount>0){e=!1;break}r=r.parent}return e}var rs="https://textalive.jp",ns=function(){function t(t){var e,r=this;if(this.player=t,this._position="embed",this._rounded=!1,this._bordered=!1,this._shadowed=!1,this._background="#fff",this._color="#1f4391",void 0!==(null===(e=t.options)||void 0===e?void 0:e.mediaBannerPosition)&&(this._position=t.options.mediaBannerPosition),this.domEnabled){this.logoAnchor=document.createElement("a"),this.logoAnchor.className="textalive-logo",this.logoAnchor.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><style>.bg{fill:#1f4391;}.fg{fill:#fff;}</style></defs><g class="logo-sq"><rect class="bg" x="-20" y="-20" width="240" height="240"/><g class="textalive-logo-art"><path class="fg" d="M97.33,130.81V142a3,3,0,0,0,4.78,2.41l56.81-42.09a3,3,0,0,0,0-4.81l-8.33-6.14Z"/><path class="fg" d="M137.14,81.43l-35-25.84A3,3,0,0,0,97.33,58v52.92Z"/><path class="fg" d="M51,55H80.33a2,2,0,0,1,2,2V71.67a0,0,0,0,1,0,0H51a2,2,0,0,1-2-2V57A2,2,0,0,1,51,55Z"/><path class="fg" d="M44.83,107.5h56.33a2,2,0,0,1,2,2v12.67a2,2,0,0,1-2,2H44.83a0,0,0,0,1,0,0V107.5A0,0,0,0,1,44.83,107.5Z" transform="translate(189.83 41.84) rotate(90)"/></g></g></svg>',this.logoAnchor.style.padding=this.bordered?"1px 2px":"1px 3px",this.logoAnchor.href=rs,this.logoAnchor.target="_blank",this.logoAnchor.title="Powered by TextAlive App API",this.logoSvg=this.logoAnchor.querySelector("svg"),this.logoSvg.style.width="24px",this.songNameDiv=document.createElement("div"),this.songNameDiv.className="name",this.songNameDiv.style.fontWeight="bold",this.songNameDiv.style.overflow="hidden",this.songNameDiv.style.textOverflow="ellipsis",this.songNameDiv.style.marginBottom="2px",this.songNameDiv.textContent="-",this.songArtistDiv=document.createElement("div"),this.songArtistDiv.className="artist",this.songArtistDiv.textContent="-",this.songArtistDiv.style.overflow="hidden",this.songArtistDiv.style.textOverflow="ellipsis";var n=document.createElement("span");n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><g class="song"><path d="M120.95,45.77l-59.12,13a2.57,2.57,0,0,0-2,2.51v47.8c0,13.61-12.4,23.74-24.2,23.74-8.92,0-14.82-4.23-14.82-13,0-13,12.86-21.93,23.9-21.93a16.33,16.33,0,0,1,10,3V35a2.57,2.57,0,0,1,2-2.51l69.41-15.29a2.57,2.57,0,0,1,3.13,2.51V92.84c0,13.61-12.1,23.9-24.2,23.9-8.92,0-14.82-4.24-14.82-13,0-13.16,12.86-21.93,23.9-21.93a16.31,16.31,0,0,1,10,2.87V48.29A2.57,2.57,0,0,0,120.95,45.77Z"/><path d="M35.61,134.36c-10.22,0-16.32-5.42-16.32-14.51,0-13.81,13.38-23.43,25.4-23.43a18.4,18.4,0,0,1,8.48,1.88V35a4,4,0,0,1,3.2-4l69.41-15.29a4.07,4.07,0,0,1,5,4V92.83c0,15-13.54,25.4-25.7,25.4-10.22,0-16.32-5.42-16.32-14.51,0-13.81,13.38-23.43,25.4-23.43A19,19,0,0,1,122.57,82V48.29a1.07,1.07,0,0,0-1.3-1h0l-59.12,13a1.08,1.08,0,0,0-.84,1v47.8C61.3,124,47.76,134.36,35.61,134.36Zm9.07-34.94c-10.57,0-22.4,8.74-22.4,20.43,0,10,8.35,11.51,13.32,11.51,13.38,0,22.7-11.72,22.7-22.24V61.31a4.1,4.1,0,0,1,3.2-4l59.12-13h0a4.07,4.07,0,0,1,5,4V87.56l-2.37-1.67a14.88,14.88,0,0,0-9.12-2.6c-10.59,0-22.4,8.39-22.4,20.43,0,10,8.35,11.51,13.32,11.51,10.74,0,22.7-9.2,22.7-22.4V19.72a1.07,1.07,0,0,0-1.3-1L57,34a1.07,1.07,0,0,0-.84,1v68.83l-2.37-1.67A14.87,14.87,0,0,0,44.68,99.42Z"/></g></svg>',n.style.padding="0 3px 0 0",this.songSvg=n.querySelector("svg"),this.songSvg.style.width="14px",this.songWrapper=document.createElement("div"),this.songWrapper.style.width="203px",this.songWrapper.style.maxWidth="203px",this.songWrapper.appendChild(this.songNameDiv),this.songWrapper.appendChild(this.songArtistDiv),this.songAnchor=document.createElement("a"),this.songAnchor.className="song",this.songAnchor.target="_blank",this.songAnchor.style.display="flex",this.songAnchor.style.lineHeight="1.2em",this.songAnchor.style.padding="4px 3px 3px 3px",this.songAnchor.style.textDecoration="none",this.songAnchor.appendChild(n),this.songAnchor.appendChild(this.songWrapper),this.lyricsNameDiv=document.createElement("div"),this.lyricsNameDiv.className="name",this.lyricsNameDiv.style.fontWeight="bold",this.lyricsNameDiv.textContent="-",this.lyricsNameDiv.style.overflow="hidden",this.lyricsNameDiv.style.textOverflow="ellipsis",this.lyricsNameDiv.style.marginBottom="2px",this.lyricsArtistDiv=document.createElement("div"),this.lyricsArtistDiv.className="artist",this.lyricsArtistDiv.textContent="-",this.lyricsArtistDiv.style.overflow="hidden",this.lyricsArtistDiv.style.textOverflow="ellipsis";var i=document.createElement("span");i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><g class="lyrics"><path d="M78,126.3H67.52l-6.26-23.82H24.4L18.14,126.3H7.7L35.7,22H50ZM27,92.39H58.65l-15.82-61Z"/><path d="M78,128.3H67.52a2,2,0,0,1-1.93-1.49l-5.87-22.33H25.94l-5.87,22.33a2,2,0,0,1-1.93,1.49H7.7a2,2,0,0,1-1.93-2.52l28-104.34A2,2,0,0,1,35.7,20H50a2,2,0,0,1,1.93,1.48l28,104.34A2,2,0,0,1,78,128.3Zm-8.89-4h6.29L48.43,24H37.23L10.31,124.3h6.28L22.46,102a2,2,0,0,1,1.93-1.49H61.26A2,2,0,0,1,63.2,102ZM58.65,94.39H27a2,2,0,0,1-1.94-2.5l15.82-61a2,2,0,0,1,3.87,0l15.82,61a2,2,0,0,1-1.94,2.5Zm-29.06-4H56.07L42.83,39.32Z"/><path d="M106.82,128c-17.74,0-26.43-13-26.43-36.52S89.09,55,106.82,55a21.78,21.78,0,0,1,15.83,6.43L134,56.22V112c0,5.22,1.56,8,4.7,8a7.31,7.31,0,0,0,3.65-1v6.61A17.77,17.77,0,0,1,133.6,128a9.61,9.61,0,0,1-9.74-7.65A22.4,22.4,0,0,1,106.82,128Zm0-10.09a18.15,18.15,0,0,0,16.69-10.61V75.7a18.15,18.15,0,0,0-16.69-10.61c-11.3,0-16,9.56-16,26.43S95.52,118,106.82,118Z"/><path d="M133.6,130A11.61,11.61,0,0,1,123.08,124,24.48,24.48,0,0,1,106.82,130c-13,0-28.43-6.68-28.43-38.52S93.85,53,106.82,53A23.88,23.88,0,0,1,123,59.05l10.08-4.65A2,2,0,0,1,136,56.22V112c0,4,.91,6,2.7,6a5.3,5.3,0,0,0,2.66-.78,2,2,0,0,1,3,1.74v6.61a2,2,0,0,1-1,1.74A19.64,19.64,0,0,1,133.6,130Zm-9.74-11.65a2,2,0,0,1,1.95,1.55,7.63,7.63,0,0,0,7.79,6.1,15.19,15.19,0,0,0,6.69-1.64v-2.52a8.51,8.51,0,0,1-1.65.16c-2.5,0-6.7-1.3-6.7-10V59.34l-8.46,3.91a2,2,0,0,1-2.25-.4A19.67,19.67,0,0,0,106.82,57C90.61,57,82.39,68.62,82.39,91.52S90.61,126,106.82,126a20.33,20.33,0,0,0,15.55-7A2,2,0,0,1,123.86,118.39Zm-17,1.57c-11.94,0-18-9.57-18-28.43s6.06-28.43,18-28.43a20.07,20.07,0,0,1,18.5,11.75,2,2,0,0,1,.19.86v31.65a2,2,0,0,1-.19.86A20.06,20.06,0,0,1,106.82,120Zm0-52.86c-12.55,0-14,13.94-14,24.43,0,21.9,8,24.43,14,24.43a16.13,16.13,0,0,0,14.69-9.07V76.16A16.13,16.13,0,0,0,106.82,67.09Z"/></g></svg>',i.style.padding="0 3px 0 0",this.lyricsSvg=i.querySelector("svg"),this.lyricsSvg.style.width="14px",this.lyricsWrapper=document.createElement("div"),this.lyricsWrapper.style.width="90px",this.lyricsWrapper.style.maxWidth="90px",this.lyricsWrapper.appendChild(this.lyricsNameDiv),this.lyricsWrapper.appendChild(this.lyricsArtistDiv),this.lyricsAnchor=document.createElement("a"),this.lyricsAnchor.className="lyrics",this.lyricsAnchor.target="_blank",this.lyricsAnchor.style.display="flex",this.lyricsAnchor.style.lineHeight="1.2em",this.lyricsAnchor.style.padding="4px 3px 3px 3px",this.lyricsAnchor.style.textDecoration="none",this.lyricsAnchor.appendChild(i),this.lyricsAnchor.appendChild(this.lyricsWrapper),this.bannerDiv=document.createElement("div"),this.bannerDiv.className="textalive-banner",this.bannerDiv.style.cursor="pointer",this.bannerDiv.style.zIndex="10000",this.bannerDiv.style.background="#1f4391",this.bannerDiv.style.lineHeight="0",this.bannerDiv.style.display="flex",this.bannerDiv.style.maxWidth="256px",this.bannerDiv.style.fontFamily="'Hiragino Kaku Gothic Pro','游ゴシック体','Yu Gothic',YuGothic,Meiryo,HelveticaNeue,'Helvetica Neue',Helvetica,Arial,sans-serif",this.bannerDiv.style.fontSize="9px",this.bannerDiv.style.alignItems="center",this.bannerDiv.style.whiteSpace="nowrap",this.bannerDiv.appendChild(this.logoAnchor),this.bannerDiv.appendChild(this.songAnchor),this.bannerDiv.appendChild(this.lyricsAnchor),this.songAnchor.style.display="none",this.lyricsAnchor.style.display="none",this.updatePosition(),this.updateRounded(),this.updateBordered(),this.updateShadowed(),this.updateBackground(),this.updateColor()}this.listener={onAppReady:function(){r.updatePosition()},onMediaElementSet:function(t){r.domEnabled&&(r.bannerDiv&&r.bannerDiv.parentElement&&r.bannerDiv.parentElement.removeChild(r.bannerDiv),r.player.mediaBannerElement&&r.player.mediaBannerElement.appendChild(r.bannerDiv))},onVideoLoad:function(){r.domEnabled&&(r.logoAnchor.href=rs,r.songAnchor.style.display="none",r.lyricsAnchor.style.display="none",r.songAnchor.style.borderRadius="0")},onSongLoad:function(t){return Fr(r,void 0,void 0,(function(){var e,r,n,i,o,a,s,l,c;return jr(this,(function(u){switch(u.label){case 0:return t?(e=null===(s=null===(a=null==t?void 0:t.song)||void 0===a?void 0:a.artist)||void 0===s?void 0:s.name,r=null===(l=null==t?void 0:t.song)||void 0===l?void 0:l.name,n=null===(c=null==t?void 0:t.song)||void 0===c?void 0:c.permalink,i=rs+(n?"/songs/"+encodeURIComponent(Be.getSongPathFromUrl(n)):""),this.domEnabled&&(this.logoAnchor.href=i,this.songArtistDiv.textContent=is(e),this.songNameDiv.textContent=is(r),this.songAnchor.title=is(r)+" by "+is(e),this.songAnchor.href=n,this.songAnchor.style.display="flex",this.songAnchor.style.borderRadius=this.rounded?"0 4px 4px 0":"0",this.songWrapper.style.width="auto"),[4,Ke.getServerStatus()]):[2];case 1:return"ja"===(null==(o=u.sent())?void 0:o.lang)?console.warn("[TextAlive API] 楽曲 アーティスト:",is(e),"/ 楽曲名:",is(r),"/ 配信元サイト:",is(n)):console.warn("[TextAlive API] Song artist:",is(e),"/ song name:",is(r),"/ distributed at:",is(n)),[2]}}))}))},onLyricsLoad:function(t){t&&(r.songWrapper.style.maxWidth="90px",r.lyricsAnchor.style.display="flex",r.songAnchor.style.borderRadius="0")},onTextLoad:function(t){return Fr(r,void 0,void 0,(function(){var e,r,n,i,o;return jr(this,(function(a){switch(a.label){case 0:return t?(e=null===(o=null==t?void 0:t.artist)||void 0===o?void 0:o.name,r=null==t?void 0:t.name,n=null==t?void 0:t.url,this.domEnabled&&(this.lyricsArtistDiv.textContent=is(e),this.lyricsNameDiv.textContent=is(r),this.lyricsAnchor.title=is(r)+" by "+is(e),this.lyricsAnchor.href=n,this.lyricsWrapper.style.width="auto"),[4,Ke.getServerStatus()]):[2];case 1:return"ja"===(null==(i=a.sent())?void 0:i.lang)?console.warn("[TextAlive API] 歌詞 アーティスト:",is(e),"/ 歌詞名:",is(r),"/ 配信元サイト:",is(n)):console.warn("[TextAlive API] Song lyrics artist:",is(e),"/ lyrics name:",is(r),"/ distributed at:",is(n)),[2]}}))}))},onDispose:function(){this.dispose()}},t.addListener(this.listener),t.mediaBannerElement&&this.player.mediaBannerElement.appendChild(this.bannerDiv)}return Object.defineProperty(t.prototype,"domEnabled",{get:function(){return"undefined"!=typeof window},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(t){this._position=t,this.updatePosition()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rounded",{get:function(){return this._rounded},set:function(t){this._rounded=t,this.updateRounded()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bordered",{get:function(){return this._bordered},set:function(t){this._bordered=t,this.updateBordered()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowed",{get:function(){return this._shadowed},set:function(t){this._shadowed=t,this.updateShadowed()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(t){this._background=t,this.updateBackground()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this.updateColor()},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this.player.removeListener(this.listener)},t.prototype.updatePosition=function(){var t,e;if(this.domEnabled){var r=this.position,n=this.player;if(null===r||!(null===(t=n.options)||void 0===t?void 0:t.app)||(null===(e=n.app)||void 0===e?void 0:e.managed))this.bannerDiv.style.display="none";else if(this.bannerDiv.style.display="flex","embed"===r)this.bannerDiv.style.position="initial",this.bannerDiv.style.marginTop="4px",this.songAnchor.style.flexGrow="1",this.lyricsAnchor.style.flexGrow="1";else{this.bannerDiv.style.position="fixed",this.bannerDiv.style.marginTop="0";var i=r.indexOf("top")>=0,o=r.indexOf("right")>=0,a=r.indexOf("bottom")>=0,s=r.indexOf("left")>=0;this.bannerDiv.style.top=i?"4px":"initial",this.bannerDiv.style.right=o?"4px":"initial",this.bannerDiv.style.bottom=a?"4px":"initial",this.bannerDiv.style.left=s?"4px":"initial",this.songAnchor.style.flexGrow="0",this.lyricsAnchor.style.flexGrow="0"}}},t.prototype.updateRounded=function(){if(this.domEnabled){var t=this.rounded;this.logoSvg.style.borderRadius=t?"4px 0 0 4px":"0",this.lyricsAnchor.style.borderRadius=t?"0 4px 4px 0":"0",this.bannerDiv.style.borderRadius=t?"4px":"0"}},t.prototype.updateBordered=function(){if(this.domEnabled){var t=this.bordered;this.logoAnchor.style.padding=t?"1px 2px":"1px 3px",this.bannerDiv.style.border=t?"1px solid rgba(31, 67, 145, 0.3)":"none"}},t.prototype.updateShadowed=function(){if(this.domEnabled){var t=this.shadowed;this.bannerDiv.style.boxShadow=t?"1px 1px 3px 0 rgba(9, 19, 42, 0.9)":"none"}},t.prototype.updateBackground=function(){this.domEnabled&&(this.songAnchor.style.background=this.background,this.lyricsAnchor.style.background=this.background)},t.prototype.updateColor=function(){this.domEnabled&&(this.songSvg.style.fill=this.color,this.songAnchor.style.color=this.color,this.lyricsSvg.style.fill=this.color,this.lyricsAnchor.style.color=this.color)},t}();function is(t){return t&&""!==t?t:"-"}function os(t,e){var r=e.parser;return Fr(this,void 0,void 0,(function(){var e,n,i;return jr(this,(function(o){switch(o.label){case 0:return t&&t.length>0&&t[0].words&&t[0].words.length>0&&t[0].words[0]&&!t[0].words[0].pos?(e=t.map((function(t){return t.words.map((function(t){return t.characters.map((function(t){return t.char})).join("")})).join(" ")})),n=e.join("\n"),[4,r(n)]):[2];case 1:return(i=o.sent())&&"success"===i.status?(t.forEach((function(t,r){var n=i.result[r],o=0;t.words.forEach((function(t){var i=t.characters.map((function(t){return t.char})).join(""),a=e[r].indexOf(i,o);if(!(a<0)){o=a;var s=n.find((function(t){return t.startPosition<=a&&t.endPosition>=a}));s&&(t.pos=s.PoS,t.rawPoS=s.rawPoS,t.language=s.language)}}))})),[2]):[2]}}))}))}function as(t){for(;t.firstElementChild;)t.removeChild(t.firstElementChild)}function ss(t,e){var r=e.id,n=e.data,i=e.loader,o=e.deserializer;return Fr(this,void 0,void 0,(function(){return jr(this,(function(e){switch(e.label){case 0:return r&&r>=0?[4,i(r)]:[3,2];case 1:e.sent(),e.label=2;case 2:return o(t,n),[2]}}))}))}function ls(t){return"string"!=typeof t?t:"undefined"==typeof window?null:document.querySelector(t)}var cs=function(){function t(t){this._mediaPosition=0,this._videoPosition=0,this.isEditing=!1,this._isVideoSeeking=!1,this._volume=100,this._options=t,this.emitter=new Yr(t),this._templates=new Ka(this,this.emitter,t&&t.unsafeAcceleration);var e=Object.assign({},pr);t&&t.managers&&(e=Object.assign(e,t.managers)),this.managers=e,this._timer=t&&t.timer||this.createDefaultTimer(),this._data=new pn(e,this.emitter,t),this._backgroundGraphics=new Xr(this,e.asset,this.emitter),this._graphics=t&&t.graphics||this.createDefaultGraphicsDriver(),this.stage=new ts(this,{onStageUpdate:this.onStageUpdate.bind(this)}),this._banner=new ns(this),this.stageElement=ls(null==t?void 0:t.stageElement)||null,this.mediaElement=ls(null==t?void 0:t.mediaElement)||null,this._app=new dn(this,this.emitter)}return Object.defineProperty(t.prototype,"options",{get:function(){return this._options?Ur({},this._options):null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"app",{get:function(){return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundGraphics",{get:function(){return this._backgroundGraphics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"video",{get:function(){return this._video},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templates",{get:function(){return this._templates},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"graphics",{get:function(){return this._graphics},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageElement",{get:function(){return this._stageElement},set:function(t){this._stageElement=t,this.emitter.onStageElementSet(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageScale",{get:function(){return this.stage.scale},set:function(t){this.stage.scale=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaElement",{get:function(){return this._mediaElement},set:function(t){this.updateMediaElement(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaSourceElement",{get:function(){return this._mediaSourceElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaBannerElement",{get:function(){return this._mediaBannerElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mediaPosition",{get:function(){return this._mediaPosition},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoPosition",{get:function(){return this._videoPosition},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wait",{get:function(){return this._timer?this._timer.wait:0},set:function(t){this._timer&&(this._timer.wait=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fps",{get:function(){return 1e3/this.wait},set:function(t){this.wait=1e3/t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionWidth",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&"number"==typeof this._data.video.config.width?this._data.video.config.width:"number"==typeof(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.width)?this._options.defaultVideoSize.width:1280},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionHeight",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&"number"==typeof this._data.video.config.height?this._data.video.config.height:"number"==typeof(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.height)?this._options.defaultVideoSize.height:720},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolutionProportion",{get:function(){return this.resolutionHeight/this.resolutionWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"margin",{get:function(){var t,e,r,n;return"object"==typeof(null===(e=null===(t=this._data)||void 0===t?void 0:t.video)||void 0===e?void 0:e.config)&&this._data.video.config.margin?this._data.video.config.margin:(null===(n=null===(r=this._options)||void 0===r?void 0:r.defaultVideoSize)||void 0===n?void 0:n.margin)||Vr},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoWidth",{get:function(){var t=this.resolutionWidth,e=this.margin;return t+e[1]+e[3]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoHeight",{get:function(){var t=this.resolutionHeight,e=this.margin;return t+e[0]+e[2]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"videoProportion",{get:function(){return this.videoHeight/this.videoWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageWidth",{get:function(){return this.stage.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageHeight",{get:function(){return this.stage.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isLoading",{get:function(){return!!this._videoPromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPlaying",{get:function(){return!!this._timer&&this._timer.isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVideoSeeking",{get:function(){return this._isVideoSeeking},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"banner",{get:function(){return this._banner},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timer",{get:function(){return this._timer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(t){isNaN(t)||(this._volume=Math.min(100,Math.max(0,t)),this.emitter.onVolumeUpdate(this._volume))},enumerable:!1,configurable:!0}),t.prototype.createDefaultTimer=function(){try{if("undefined"!=typeof window&&"basic"!==Br("ta_timer"))return new qr}catch(t){}return new Hr},t.prototype.createDefaultGraphicsDriver=function(){return new Ir},t.prototype.addListener=function(t){return this.emitter.addListener(t)},t.prototype.removeListener=function(t){return this.emitter.removeListener(t)},t.prototype.createFromVideoId=function(t,e){return Fr(this,void 0,void 0,(function(){var r=this;return jr(this,(function(n){return[2,this.create((function(){return r.doCreateFromVideoId(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromVideoId=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,(r=new pn(this.managers,this.emitter,this._options)).createFromVideoId(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromVideo=function(t,e){return Fr(this,void 0,void 0,(function(){var r=this;return jr(this,(function(n){return[2,this.create((function(){return r.doCreateFromVideo(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromVideo=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){return(r=new pn(this.managers,this.emitter,this._options)).createFromVideo(t,null==e?void 0:e.video),[2,this.finalize(r,e)]}))}))},t.prototype.createFromSongUrl=function(t,e){return Fr(this,void 0,void 0,(function(){var r=this;return jr(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongUrl(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongUrl=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,(r=new pn(this.managers,this.emitter,this._options)).createFromSongUrl(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromSongPath=function(t,e){return Fr(this,void 0,void 0,(function(){var r=this;return jr(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongPath(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongPath=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,(r=new pn(this.managers,this.emitter,this._options)).createFromSongPath(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromSongId=function(t,e){return Fr(this,void 0,void 0,(function(){var r=this;return jr(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongId(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongId=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,(r=new pn(this.managers,this.emitter,this._options)).createFromSongId(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromSongCode=function(t,e){return Fr(this,void 0,void 0,(function(){var r=this;return jr(this,(function(n){return[2,this.create((function(){return r.doCreateFromSongCode(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromSongCode=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,(r=new pn(this.managers,this.emitter,this._options)).createFromSongCode(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromText=function(t,e){return Fr(this,void 0,void 0,(function(){var r=this;return jr(this,(function(n){return[2,this.create((function(){return r.doCreateFromText(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromText=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){switch(n.label){case 0:return[4,(r=new pn(this.managers,this.emitter,this._options)).createFromText(t,null==e?void 0:e.video)];case 1:return n.sent(),[2,this.finalize(r,e)]}}))}))},t.prototype.createFromJSON=function(t,e){return Fr(this,void 0,void 0,(function(){var r=this;return jr(this,(function(n){return[2,this.create((function(){return r.doCreateFromJSON(t,e)}),null==e?void 0:e.dryRun)]}))}))},t.prototype.doCreateFromJSON=function(t,e){return Fr(this,void 0,void 0,(function(){var r;return jr(this,(function(n){return(r=new pn(this.managers,this.emitter,this._options)).createFromJSON(t,null==e?void 0:e.video),[2,this.finalize(r,e)]}))}))},t.prototype.create=function(t,e){return Fr(this,void 0,void 0,(function(){var r,n=this;return jr(this,(function(i){if(this._videoPromise&&!e)throw new Qa("Player.createFrom* method calls cannot run in parallel",this._videoPromise);return r=t(),e||(this._videoPromise=r,r.finally((function(){return n._videoPromise=null}))),[2,r]}))}))},t.prototype.finalize=function(t,e){return Fr(this,void 0,void 0,(function(){var r,n,i,o=this;return jr(this,(function(a){switch(a.label){case 0:return t.video?[4,Promise.all([t.finalize(e),this.backgroundGraphics.setBackground(t.video.background)])]:[2,null];case 1:return a.sent(),(null==e?void 0:e.dryRun)?[2,null]:(r=t.video.json,s=n=new Tr(r),l={config:t.video.config,song:t.song},u=l.song,(c=l.config)&&"object"==typeof c&&"number"==typeof c.duration?s.duration=c.duration:u?s.duration=1e3*u.length:s.duration||(s.duration=s.endTime),[4,Promise.all([this.graphics.createRuntime(n),ss(n,{id:t.video.id,data:r,loader:function(t){return Fr(o,void 0,void 0,(function(){return jr(this,(function(e){switch(e.label){case 0:return[4,this.templates.loadForVideo(t)];case 1:return e.sent(),[2]}}))}))},deserializer:function(t,e){return o.templates.importInstances(t,e)}}),os(null==r?void 0:r.phrases,{parser:Qe.parse.bind(Qe)})])]);case 2:return a.sent(),this._data,this._video&&this.templates.disposeInstances(this._video),this._data=t,this._video=n,this.emitter.onVideoReady(n),i=(null==e?void 0:e.altSourceUrl)||void 0,[4,this._timer.initialize({player:this,updater:this.updateMediaPosition.bind(this),emitter:this.emitter,altSourceUrl:i})];case 3:return a.sent(),this.emitter.onTimerReady(this._timer),[2,n]}var s,l,c,u}))}))},t.prototype.updateMediaPosition=function(t){return Fr(this,void 0,void 0,(function(){var e=this;return jr(this,(function(r){return this._isVideoSeeking?(this._mediaPosition=t,this.emitter.onMediaSeek(t),[2,t]):[2,this.stage.requestUpdate(t).then((function(t){return e._mediaPosition=t,e._videoPosition=t,e.emitter.onMediaSeek(t),t}))]}))}))},t.prototype.exportVideo=function(t){return void 0===t&&(t={legacyStringMode:!0}),Fr(this,void 0,void 0,(function(){var e,r,n,i;return jr(this,(function(o){return e={sourceId:this._data.video.id,sourceOriginId:this._data.video.sourceOriginId,songleId:this._data.song.id,lyricId:this._data.lyricsId,lyricDiffId:this._data.lyrics?this._data.lyrics.id:-1,config:((null==t?void 0:t.legacyStringMode)?this._data.video.config&&JSON.stringify(this._data.video.config):this._data.video.config)||null},r=this.backgroundGraphics.exportPartialVideoEntry(t),n=this._video.exportData(this._templates),i=(null==t?void 0:t.legacyStringMode)?JSON.stringify(n):n,[2,Ur(Ur(Ur({},e),r),{json:i})]}))}))},t.prototype.getChoruses=function(){return this._data.getChoruses()},t.prototype.findChorus=function(t,e){return this._data.findChorus(t,e)},t.prototype.findChorusBetween=function(t,e){return this._data.findChorusBetween(t,e)},t.prototype.getBeats=function(){return this._data.getBeats()},t.prototype.findBeat=function(t,e){return this._data.findBeat(t,e)},t.prototype.getChords=function(){return this._data.getChords()},t.prototype.findChord=function(t,e){return this._data.findChord(t,e)},t.prototype.getVocalFrequency=function(t){return this._data.getVocalFrequency(t)},t.prototype.getVocalAmplitude=function(t){return this._data.getVocalAmplitude(t)},t.prototype.getMaxVocalAmplitude=function(){return this._data.getMaxVocalAmplitude()},t.prototype.getValenceArousal=function(t){return this._data.getValenceArousal(t)},t.prototype.getMedianValenceArousal=function(){return this._data.getMedianValenceArousal()},t.prototype.resize=function(t){return this.emitter.onResize(t)},t.prototype.onResize=function(t){return this.resize(t)},t.prototype.setStageElement=function(t){return this._stageElement=t,this.emitter.onStageElementSet(t)},t.prototype.setMediaElement=function(t){this.mediaElement=t},t.prototype.updateMediaElement=function(t){"undefined"!=typeof document&&(this._mediaElement&&as(this._mediaElement),t?(as(t),this._mediaSourceElement||(this._mediaSourceElement=document.createElement("div"),this._mediaSourceElement.classList.add("textalive-media-wrapper")),t.appendChild(this._mediaSourceElement),this._mediaBannerElement||(this._mediaBannerElement=document.createElement("div"),this._mediaSourceElement.classList.add("textalive-banner-wrapper")),t.appendChild(this._mediaBannerElement)):(this._mediaSourceElement=null,this._mediaBannerElement=null)),this._mediaElement=t,this.emitter.onMediaElementSet(t)},t.prototype.setVideoPosition=function(t){return Fr(this,void 0,void 0,(function(){var e=this;return jr(this,(function(r){return[2,this.stage.requestUpdate(t).then((function(t){return e._videoPosition=t,e.emitter.onVideoSeek(t),t}))]}))}))},t.prototype.setMediaPosition=function(t){return Fr(this,void 0,void 0,(function(){return jr(this,(function(e){return this.requestMediaSeek(t),[2]}))}))},t.prototype.requestPlay=function(){return this._timer.play(),!0},t.prototype.requestStop=function(){return this._timer.stop(),!0},t.prototype.requestPause=function(){return this._timer.pause(),!0},t.prototype.requestMediaSeek=function(t){return this._timer.seek(t),!0},t.prototype.startVideoSeek=function(){return this._isVideoSeeking=!0,this.emitter.onVideoSeekStart()},t.prototype.endVideoSeek=function(){return this._isVideoSeeking=!1,this.emitter.onVideoSeekEnd()},t.prototype.requestSettingBackground=function(t){return Fr(this,void 0,void 0,(function(){return jr(this,(function(e){return[2,this.backgroundGraphics.settingBackground(t)]}))}))},t.prototype.requestSetBackground=function(t){return Fr(this,void 0,void 0,(function(){return jr(this,(function(e){return[2,this.backgroundGraphics.setBackground(t)]}))}))},t.prototype.requestStageUpdate=function(){return Fr(this,void 0,void 0,(function(){return jr(this,(function(t){return[2,this.stage.requestUpdate()]}))}))},t.prototype.onStageUpdate=function(t){this._isVideoSeeking||this.emitter.onTimeUpdate(t)},t.prototype.dispose=function(){this._timer&&(this._timer.dispose(),this._timer=null),this.mediaElement&&(as(this._mediaElement),this._mediaElement=null),this.stageElement&&(this._stageElement=null),this.emitter.onDispose()},t}();console.log("# ライセンス表記に関するガイドライン\n\n国立研究開発法人産業技術総合研究所\n人間情報インタラクション研究部門\nメディアインタラクション研究グループ\n\nTextAlive App APIは非商用利用に限り、どなたでも無料・無保証で利用することができます。\nただし、原則としてTextAlive App APIを利用している旨を TextAlive https://textalive.jp/ サイト内楽曲ページまたは https://developer.textalive.jp/ にハイパーリンクした上で、利用しているシステムもしくは外部サイト等に表示する必要があります。\n\n# お問い合わせ\n\ntextalive-ml@aist.go.jp");Ce.sortedIndex;class us{get duration(){return this.endTime-this.startTime}constructor(t,e=0){this.startTime=t,this.state=e}}class hs{constructor(t=-1){this.update(t)}update(t){if(!(t<0)){var e=_.player;this.now=t,this.segId=e.getSegId(t),this.segData=e.segList[this.segId],this.beat=e.findBeat(t),this.beatProgress=(t-this.beat.startTime)/this.beat.duration}}}class ps{constructor(t,e=0){this.head=800,this.tail=800,this.options={},this.next=null,this.prev=null,this.phraseId=e,this.startTime=t.startTime,this.endTime=t.endTime,this.text=t.text,t.next&&t.next.startTime-this.endTime<500?this.endTime=t.next.startTime:this.endTime+=500,this.duration=this.endTime-this.startTime}progressHead(t,e=0){return Math.min((t-(this.startTime-this.head))/(this.head+e),1)}progressTail(t,e=0){return 1-Math.min((this.endTime+this.tail-t)/(this.tail+e),1)}progress(t){var e=this.duration+this.head+this.tail;return(t-(this.startTime-this.head))/e}}class ds{get list(){return this._dataList}get total(){return this._total}constructor(){this._dataList=[],this._total=0}add(t){if(t.id=this._total,this._dataList.push(t),0<this._total){var e=this._dataList[this._total-1];t.prev=e,e.next=t}this._total++}getList(t){for(var e=[],r=0;r<this._total;r++){var n=this._dataList[r];n.startTime-n.head<=t&&t<=n.endTime+n.tail&&e.push(n)}return e}}class fs{get bpm(){return this._bpm}get beatOffset(){return this._beatOffset}get video(){return this._video}get lyric(){return this._lyric}get segList(){return this._segList}get segLen(){return this._segLen}constructor(){this._listeners=[],this._position=0,this._updateTime=-1,this._bpm=120,this._beatOffset=.5,this.__bpm=120,this.__segtim=3e3,this.__seglen=10,this.__beat=4,this.__stime=0}init(){(this._presentData=new hs,_.isDebug)?this._initDebug():(this._player=new cs({app:{token:"xVxJokEe7rcbKIdy",parameters:[{title:"フォントのスタイル",name:"FontStyle",className:"Select",params:[[0,"サンセリフ (ゴシック体)"],[1,"セリフ (明朝体)"]],initialValue:0},{title:"モデル",name:"Model",className:"Select",params:[[0,"かんな"],[1,"初音ミク"],[2,"鏡音リン"],[3,"鏡音レン"],[4,"巡音ルカ"]],initialValue:0},{title:"ねこみみ",name:"Nekomimi",className:"Check",initialValue:!0},{title:"テキスト色",name:"FontColor",className:"Color",initialValue:"#333344"},{title:"色１",name:"Color1",className:"Color",initialValue:"#ff66cc"},{title:"色２",name:"Color2",className:"Color",initialValue:"#ffaabb"},{title:"色３",name:"Color3",className:"Color",initialValue:"#ffbb44"},{title:"色４",name:"Color4",className:"Color",initialValue:"#ff9966"},{title:"背景色",name:"BgColor",className:"Color",initialValue:"#eeeef9"},{title:"乱数のシード",name:"Seed",className:"Slider",params:[1,1e3],initialValue:1}]},mediaElement:document.querySelector("#media"),fontFamilies:[]})).addListener({onAppReady:t=>this._onAppReady(t),onVideoReady:t=>this._onVideoReady(t),onPlay:()=>this._onPlay(),onPause:()=>this._onPause(),onStop:()=>this._onStop(),onMediaSeek:t=>this._onMediaSeek(t),onTimeUpdate:t=>this._onTimeUpdate(t),onThrottledTimeUpdate:t=>this._onThrottledTimeUpdate(t),onAppParameterUpdate:(t,e)=>this._onAppParameterUpdate(t,e),onAppMediaChange:t=>this._onAppMediaChange(t)});return this._update(),this}getSegId(t){for(var e=0,r=this._segLen;e<r;e++)if(t<this._segList[e].endTime)return e;return this._segLen-1}findBeat(t){if(_.isDebug){var e=this.__getBeat(t);return 0<e.index&&(e.previous=this.__getBeat(t,-1)),e.next=this.__getBeat(t,1),e}var r=this._player.findBeat(t);if(!r){for(var n=this._player.data.songMap.beats,i=0,o=n.length;i<o;i++)if(t<=n[i].endTime)return n[i];return n[o-1]}return r}_ready(){_.three.ready(),this._animate(0),setTimeout((()=>this._animate(0)),100)}_animate(t){isNaN(t)||(this._presentData.update(t),_.three.update(this._presentData))}_initDebug(){this._bpm=this.__bpm,this._segLen=this.__seglen,this._segList=[];for(var t=0;t<this.__seglen;t++){var e=new us(t*this.__segtim,t%4);e.endTime=(t+1)*this.__segtim,this._segList.push(e)}var r=0,n=1e3;for(t=0;t<5;t++){for(var i=0;i<10;i++){var o={startTime:n,endTime:n+300,duration:300,text:String.fromCharCode(12354+Math.floor(82*Math.random()))},a=new ps(o,r);this._lyric.add(a),n+=300}n+=1e3,r++}this._ready(),this.__stime=Date.now(),this.__update()}__update(){var t=Date.now()-this.__stime;this._animate(t),window.requestAnimationFrame((()=>this.__update()))}__getBeat(t,e=0){var r=6e4/this.__bpm,n=t/r+e,i={};return i.index=Math.floor(n),i.startTime=r*i.index,i.endTime=i.startTime+r,i.duration=r,i.length=this.__beat,i.position=i.index%i.length+1,i}_onAppReady(t){console.log("app:",t),t.managed||(this._initDatGui(),document.getElementById("footer").style.display="block",document.getElementById("bt_play").addEventListener("click",(()=>this._player.requestPlay())),document.getElementById("bt_pause").addEventListener("click",(()=>this._player.requestPause())),document.getElementById("bt_rewind").addEventListener("click",(()=>this._player.requestMediaSeek(0)))),t.songUrl||this._player.createFromSongUrl("https://www.youtube.com/watch?v=-6oxY-quTOA",{altLyricsUrl:"data:text/plain;base64,44G744KT44Go44Gu44Kz44OI44CA44G744KT44Go44Gu44Kt44Oi44OB44Gg44GR44CA5Lyd44GI44KJ44KM44Gf44KJ44GE44GE44Gu44Gr44Gt44CA44Gq44KT44GmCuOBqOOBjeOBqeOBjeOAgOiAg+OBiOOBn+OCiuOBmeOCi+OBkeOBqeOAgOOBneOBhuOBneOBhuOAgOOBhuOBvuOBj+OBr+OBhOOBi+OBquOBhOOBv+OBn+OBhOOBrQoK44Gf44Go44GI44Gw44CA44Gd44GG44CA5oSb5oOz44KI44GP56yR44GG44GC44Gu5a2Q44Gu55yf5Ly844Go44GL44GX44Gf44KK44KC44GZ44KL44GR44GpCuOBn+OBhOOBpuOBhOOAgOOBhuOCj+OBueOBoOOBkeOBp+OAgOOBqeOBhuOBq+OCguOAgOOBk+OBhuOBq+OCguOAgOOBquOCk+OBqOOCguOAgOOBquOCieOBquOBhOOCguOBruOBpwoK44Gd44KM44Gn44KC44CA44G744KJ44CA44Kt44Of44GM56yR44Gj44Gm44KL44CA44G+44KP44KK44Gv44GE44Gk44KC5Yil5LiW55WM44GnCuOBteOBqOOBl+OBn+OBqOOBjeOAgOebruOBqOebruOBjOOBguOBo+OBn+OCieOAgOOCveODr+OCveODr+OBl+OBoeOCg+OBhuOAgOOCreODn+OBruOBm+OBhOOBoOOBi+OCiQoK5oGL44Gu44Ot44Oz44Oq55qE44Gr44CA6KqH5aSn5aaE5oOz44CA6ZuG5Lit56Cy54Gr44GnCuOCreODn+OBruOCs+ODiOODkOOBruOBsuOBqOOBpOOBsuOBqOOBpOOBq+OAgOaSg+OBoeaKnOOBi+OCjOOBn+ODj+ODvOODiOOBrwrjgZ/jgYjjgZrjgIDkuI3lronlrprjgafjgIDjgajjgY3jganjgY3jgIDou6LjgbPjgZ3jgYbjgavjgoLjgarjgovjgZHjgakK44Gd44Gj44Go44CA5pSv44GI44Gm44GP44KM44KL44CA44Gd44GG44GE44GG44Go44GT44KN44GM5aW944GN44Gq44Gu44GVCgoK44GE44Gk44KC44Gu44Kz44OI44CA44GC44KK44G144KM44Gf44Kz44OI44OQ44GV44GI44CA5Ye644Gm44GT44Gq44GP44Gm44CA44Oi44Ok44Oi44Ok44GX44Gf44KK44GtCuOBquOCk+OBpuOBreOAgOaCqeOCk+OBoOOCiuOCguOBmeOCi+OBkeOBqeOAgOOBneOBhuOBneOBhuOAgOetlOOBiOOBr+OBv+OBpOOBi+OCieOBquOBhOOBruOBrQoK44Gf44Go44GI44Gw44CA44Gd44GG44CA5puy44GM44KK6KeS5puy44GM44Gj44Gm44CA5YG254S244Kt44Of44Go5Ye65Lya44Gj44Gf44Go44GN44Gr44GvCuOCouOCv+ODleOCv+OBl+OBpuOBsOOBi+OCiuOBp+OAgOOBqeOBhuOBq+OCguOAgOOBk+OBhuOBq+OCguOAgOOBquOCk+OBqOOCguOAgOOBquOCieOBquOBhOOCguOBruOBpwoK44Gd44KM44Gn44KC44CA44G744KJ44CA44Kt44Of44GM6KaL44Gk44KB44Gm44KL44CA44G+44KP44KK44Gv44GE44Gk44KC5Yil5qyh5YWD44GnCuOBquOBq+OCguOBi+OCguOBjOOAgOOBoeOBo+OBveOBkeOBq+imi+OBiOOCi+OAgOacuuOBruS4iuOBq+etlOOBiOOBr+eEoeOBhOOBi+OCiQoK5oGL44Gu44Kr44Ks44Kv55qE44Gr44CA6I2S5ZSQ54Sh56i944CA57W156m65LqL44Gn44KCCuOCreODn+OBruWCjeOBq+OBhOOBn+OBhOOBruOAgOOCs+ODiOODkOOBquOCk+OBpuOBhOOCieOBquOBhOOBj+OCieOBhOOBqwrjgZ/jgYjjgZrjgIDpmqPjgavjgYTjgabjgIDmjIHjgaHjgaTmjIHjgZ/jgozjgaTjgIDjgoLjgZ/jgozjgYvjgYvjgorjgaTjgacK44Gd44Gj44Go44CA5omL44Go5omL5Y+W44KK5ZCI44GG44CA44Gd44GG44GE44GG5LqM5Lq644Gr44Gq44KK44Gf44GE44Gu44GVCgoK5oGL44Gu44Ot44Oz44Oq55qE44Gr44CA55+b55u+44Gg44KJ44GR44Gu44CA5aSi54mp6Kqe44GnCuOCreODn+OBruWPs+aJi+W3puaJi+OAgOOBpOOBi+OBvuOBiOOBpumbouOBleOBquOBhOOBj+OCieOBhOOBrwrjgZ/jgYjjgZrjgIDnqbrlm57jgorjgafjgIDjgajjgY3jganjgY3jgIDou6LjgbPjgZ3jgYbjgavjgoLjgarjgovjgZHjgakK44Gd44Gj44Go44CA5oqx44GI44Gm44GP44KM44KL44CA44Gd44GG44GE44GG44Go44GT44KN44GM5aW944GN44Gq44Gu44GV"})}_onVideoReady(t){console.log("video:",t),this._video=t;for(var e=this._player.data.songMap.beats,r=0,n=0;n<e.length;n++)r+=e[n].duration;r/=e.length,this._bpm=Math.round(6e4/r);var i=this._player.data.songMap.segments,o=[new us(0,0),new us(t.duration,0)];for(n=0;n<i.length;n++)for(var a=0;a<i[n].segments.length;a++){for(var s=i[n].segments[a],l=!0,c=!0,u=0;u<o.length;u++){var h=Math.abs(o[u].startTime-s.startTime),p=Math.abs(o[u].startTime-s.endTime);h<2e3&&(l=!1,i[n].chorus&&(o[u].state=1)),p<2e3&&(c=!1,i[n].chorus&&(o[u].state=3))}l&&o.push(new us(s.startTime,i[n].chorus?1:0)),c&&o.push(new us(s.endTime,i[n].chorus?3:0))}o.sort((function(t,e){return t.startTime-e.startTime}));for(n=0;n<o.length-1;n++){switch(o[n].state){case 1:case 2:0==o[n+1].state&&(o[n+1].state=2)}o[n].endTime=o[n+1].startTime}if(o.pop(),this._segList=o,this._segLen=o.length,this._lyric=new ds,t.firstPhrase)for(var d=0,f=t.firstPhrase;f;){for(var m=f.firstChar,g=(n=0,f.charCount);n<g;n++){var v=new ps(m,d);this._lyric.add(v),m=m.next}d++,f=f.next}this._ready()}_update(){if(this._player&&this._player.isPlaying&&0<this._updateTime){var t=Date.now()-this._updateTime+this._position;this._animate(t)}window.requestAnimationFrame((()=>this._update()))}_contorlChange(t){t?(document.getElementById("bt_play").style.display="none",document.getElementById("bt_pause").style.display="inline"):(document.getElementById("bt_play").style.display="inline",document.getElementById("bt_pause").style.display="none")}_onPlay(){this._contorlChange(!0),this._updateTime=Date.now(),console.log("play")}_onPause(){this._contorlChange(!1),console.log("pause")}_onStop(){this._contorlChange(!1),console.log("stop")}_onMediaSeek(t){}_onTimeUpdate(t){this._position=t,this._updateTime=Date.now(),this._animate(t)}_onThrottledTimeUpdate(t){}_onAppMediaChange(t){this._player.requestMediaSeek(0),this._player.requestPause()}_onAppParameterUpdate(t,e){switch(t){case"FontStyle":var r;if(1===parseInt(e))r="serif";else r="sans-serif";_.parameter.fontName=e=r;break;case"FontColor":_.parameter.fontColor=e=this._getColorNumber(e);break;case"BgColor":_.parameter.bgColor=e=this._getColorNumber(e);break;case"Color1":case"Color2":case"Color3":case"Color4":var n=parseInt(t.replace("Color",""))-1;_.parameter.colors[n]=e=this._getColorNumber(e);break;case"Model":_.parameter.modelId=e=parseInt(e);break;case"Nekomimi":_.parameter.nekomimi=e=Boolean(e);break;case"Seed":_.parameter.seed=e=parseInt(e)}for(var i=0,o=this._listeners.length;i<o;i++)this._listeners[i](t,e)}_getColorNumber(t){return t.rgb?t.value:0<=t.r?65536*t.r+256*t.g+t.b:isNaN(t)?parseInt(t.replace("#",""),16):t}addParameterUpdateListener(t){this._listeners.push(t)}_initDatGui(){var t={FontStyle:0,Model:_.parameter.modelId,Nekomimi:_.parameter.nekomimi,FontColor:_.parameter.fontColor,Color1:_.parameter.colors[0],Color2:_.parameter.colors[1],Color3:_.parameter.colors[2],Color4:_.parameter.colors[3],BgColor:_.parameter.bgColor,Seed:_.parameter.seed},e=new Me.GUI(null);e.add(t,"FontStyle",{"Sans-serif":0,Serif:1}).onFinishChange((t=>this._onAppParameterUpdate("FontStyle",t))),e.add(t,"Model",{"かんな":0,"初音ミク":1,"鏡音リン":2,"鏡音レン":3,"巡音ルカ":4}).onFinishChange((t=>this._onAppParameterUpdate("Model",t))),e.add(t,"Nekomimi").onFinishChange((t=>this._onAppParameterUpdate("Nekomimi",t))),e.addColor(t,"FontColor").onFinishChange((t=>this._onAppParameterUpdate("FontColor",t))),e.addColor(t,"Color1").onFinishChange((t=>this._onAppParameterUpdate("Color1",t))),e.addColor(t,"Color2").onFinishChange((t=>this._onAppParameterUpdate("Color2",t))),e.addColor(t,"Color3").onFinishChange((t=>this._onAppParameterUpdate("Color3",t))),e.addColor(t,"Color4").onFinishChange((t=>this._onAppParameterUpdate("Color4",t))),e.addColor(t,"BgColor").onFinishChange((t=>this._onAppParameterUpdate("BgColor",t))),e.add(t,"Seed",1,1e4).step(1).onFinishChange((t=>this._onAppParameterUpdate("Seed",t))),e.close();var r=document.createElement("style");r.append(".dg.ac { z-index: 1000 !important; }"),document.head.appendChild(r)}}(new class{constructor(){}initialize(){_.enabledWarn||(console.warn=function(){}),this._three=_.three=new mt,this._player=_.player=new fs,this._player.init(),this._resize(),window.addEventListener("resize",(()=>this._resize()))}_resize(){_.stw=document.documentElement.clientWidth,_.sth=document.documentElement.clientHeight,this._three.resize()}}).initialize()}();